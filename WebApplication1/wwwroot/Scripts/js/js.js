angular.module("ibartarApp",["ngAnimate","ngMessages","ngResource","angularMoment","ngSanitize","uiGmapgoogle-maps","pascalprecht.translate","ui.router","ngProgress","modalSys","ngNotificationsBar","angular-google-analytics","angular-svg-round-progressbar","ng","seo","oc.lazyLoad","xeditable","ui.select","ngSanitize","slick","ui.bootstrap"]).config(function($locationProvider,$urlRouterProvider,notificationsConfigProvider,appConfig,uiGmapGoogleMapApiProvider,$stateProvider,AnalyticsProvider,$uiViewScrollProvider,$translateProvider,$sceDelegateProvider,$sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["**"]),$uiViewScrollProvider.useAnchorScroll(),uiGmapGoogleMapApiProvider.configure({key:"AIzaSyBxE55IbFxIQxnPFW9Mde_rOA7hTg2jujQ",v:"3.24",libraries:"places"}),$translateProvider.translations("fa",IB.FA),$translateProvider.preferredLanguage("fa"),$translateProvider.useSanitizeValueStrategy(null);var ThemePrefix="webApplication/desktop/app";notificationsConfigProvider.setHideDelay(5e3),notificationsConfigProvider.setAutoHide(!0),notificationsConfigProvider.setAcceptHTML(!0),AnalyticsProvider.setAccount("UA-54671173-9"),AnalyticsProvider.useDisplayFeatures(!0),AnalyticsProvider.useAnalytics(!0),AnalyticsProvider.ignoreFirstPageLoad(!0),AnalyticsProvider.useEnhancedLinkAttribution(!0),$locationProvider.html5Mode(!0),$urlRouterProvider.when("",["$state","$match",function($state,$match){$state.go("home")}]),$stateProvider.state("home",{url:"/",views:{"home-header":{templateUrl:ThemePrefix+"/views/newView/homeHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/newView/newHome.html",controller:"NewHomeCtrl",resolve:{DataHomePage:function(WebServices){return WebServices.GetDataHomePage()},PopularareasHome:function(WebServices){return WebServices.GetPopularAreas()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("search",{url:"/search?q?guild&area&page&f_guild&has_image&has_video&has_product?keyword",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/search.html",controller:"SearchCtrl",resolve:{loadStickyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load("sticky")}],SearchResult:function(SearchRequests,$stateParams,searchTraceService){return SearchRequests.GetNodesOfSearchByObj({guild:$stateParams.guild,q:$stateParams.q,area:$stateParams.area,page:$stateParams.page,f_guild:$stateParams.f_guild,f_image:$stateParams.f_image,f_video:$stateParams.f_video,f_product:$stateParams.f_product,keyword:$stateParams.keyword},searchTraceService.setTrace("main"),!0)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("map",{url:"/map",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/map.html",controller:"MapCtrl",resolve:{MenuJobs:function(SearchRequests){return SearchRequests.Menu()}}}}}).state("map.list",{url:"?q&guild&area&page&f_guild&has_image&has_video&has_product&currentLocation&keyword",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/mapPartial/Result.html",controller:"ListCtrl",resolve:{ResultList:function($stateParams,SearchRequests,searchTraceService){return SearchRequests.GetNodesOfSearchByObj({guild:$stateParams.guild,q:$stateParams.q,area:$stateParams.area,page:$stateParams.page,keyword:$stateParams.keyword},searchTraceService.setTrace("menu"))}}}}}).state("create",{url:"/page/create",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/create.html",controller:"CreateCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()},CaptchaRequiremention:function(WebServices){return WebServices.GetCaptchaRequirementStatus()}}}}}).state("landingPage.child",{url:"/{path:.*}"}).state("create.optional",{url:"/:optional"}).state("statistics",{url:"/amar?created_by",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/statistics.html",controller:"StatsCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()},lazyLoadModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["highcharts-ng","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("landingPageIntro",{url:"/intro",views:{"home-header":{templateUrl:ThemePrefix+"/views/newView/homeHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/landingPage.html",controller:"LandingPageCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("user-registration",{url:"/user/register",views:{"":{templateUrl:ThemePrefix+"/views/userRegister.html",controller:"UserReg"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("userlogin",{url:"/user/login?{redirect}",data:{mustBeLoggedOut:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/userLogin.html",controller:"UserLogin"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("editshow",{url:"/page/manage/:uuid",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/ShowCaseEdit.html",controller:"EditShowCtrl",resolve:{ShowDate:function(SearchRequests,$stateParams,utils){return SearchRequests.GetExtendEditMode($stateParams.uuid).success(function(response){response.status||utils.NormalNotificationForServerResponse(response.message,!1)}).error(function(errors){})},guildlist:function(WebServices){return WebServices.getlist()},Suggestions:function(WebServices,$stateParams){return WebServices.getKeyWordsSuggestion($stateParams.uuid)},loadLazyModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["OpeningHours","sotos.crop-image","sticky","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}],loadMapBeforeLoading:function(uiGmapGoogleMapApi,$q){var deffer=$q.defer();return uiGmapGoogleMapApi.then(function(map){deffer.resolve(map)}),deffer.promise}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("editshow.hastitle",{url:"/:title"}).state("termsOfService",{url:"/tos",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/termsOfService.html",controller:"tosCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("claim",{url:"/page/claim/:uuid",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/claim.html",controller:"ClaimCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("show",{url:"/page/:uuid",controller:"detectPageVersion",resolve:{ShowData:function(SearchRequests,$stateParams,channelService,searchTraceService){return SearchRequests.GetExtend($stateParams.uuid,channelService.getChannel($stateParams.uuid),searchTraceService.getSavedSearchLogByUuid($stateParams.uuid))},CheckShowRate:function($stateParams,WebServices){return WebServices.myRateCheck($stateParams.uuid)},userMediaData:function($stateParams,WebServices){return WebServices.userMediaUpload($stateParams.uuid)},ShowComments:function($stateParams,WebServices){return WebServices.getComments($stateParams.uuid,1)},loadMapBeforeLoading:function(uiGmapGoogleMapApi,$q){var deffer=$q.defer();return uiGmapGoogleMapApi.then(function(map){deffer.resolve(map)}),deffer.promise}}}).state("defaultShow",{url:"",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/ShowCase.html",controller:"ShowCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{loadLazyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["sticky","720kb.socialshare"])}]}}}}).state("specialPage1",{url:"",views:{"specialPage-header":{templateUrl:ThemePrefix+"/views/newView/specialPageHeader.html",controller:"AuthLoginSpecialPage"},"":{templateUrl:ThemePrefix+"/views/specialPage1.html",controller:"firstSpecialCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{loadLazyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["sticky","720kb.socialshare"])}]}}}}).state("specialPage2",{url:"",views:{"specialPage-header":{templateUrl:ThemePrefix+"/views/newView/specialPageHeader.html",controller:"AuthLoginSpecialPage"},"":{templateUrl:ThemePrefix+"/views/specialPage2.html",controller:"secondSpecialCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{loadLazyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["sticky","720kb.socialshare"])}]}}}}).state("specialPage3",{url:"",views:{"specialPage-header":{templateUrl:ThemePrefix+"/views/newView/specialPageHeader.html",controller:"AuthLoginSpecialPage"},"":{templateUrl:ThemePrefix+"/views/specialPage3.html",controller:"thirdSpecialCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{loadLazyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["sticky","720kb.socialshare"])}]}}}}).state("show.hasTitle",{url:"/:title"}).state("landingEvent",{url:"/event/:id",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/landingEvent.html",controller:"landingEventCtrl",resolve:{loadStickyModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load("sticky")}],showEvent:function($stateParams,WebServices){return WebServices.getEventData($stateParams.id)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{Popularareas:function(WebServices){return WebServices.GetPopularAreas()}}}}}).state("eventsList",{url:"/eventlist",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/eventList.html",controller:"eventListCtrl",resolve:{showEventList:function(WebServices){return WebServices.getEventListData()},showAllEvents:function(WebServices){return WebServices.getAllEventsData()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{Popularareas:function(WebServices){return WebServices.GetPopularAreas()}}}}}).state("eventCategoryPage",{url:"/event/category/:id",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/eventCategory.html",controller:"eventCategoryCtrl",resolve:{showEventList:function(WebServices){return WebServices.getEventListData()},eventCategory:function($stateParams,WebServices){return WebServices.getEventCategoryData($stateParams.id)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl",resolve:{Popularareas:function(WebServices){return WebServices.GetPopularAreas()}}}}}).state("counsellorpanel",{url:"/counsellor/panel",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/counsellor.html",controller:"CounsellorCtrl",resolve:{counsellorData:function(WebServices,notifications,$stateParams,$rootScope,$location,$state){return $rootScope.IbartarUserInfo&&$rootScope.IbartarUserInfo.id?WebServices.GetCousellorData():($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),void notifications.showError("شما ابتدا باید وارد شوید"))},counsellorStat:function(WebServices){return WebServices.GetCounsellorState()},lazyLoadModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["highcharts-ng"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("editProfile",{url:"/editProfile",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/editProfile.html",controller:"EditProfileCtrl",resolve:{GetEditProfileData:function(WebServices,$state){return WebServices.GetEditProfile().success(function(response){}).error(function(errors){$state.go("userlogin")})},lazyLoadModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["sotos.crop-image","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("userProfile",{url:"/userProfile",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/profile.html",controller:"ProfileCtrl",resolve:{ProfileData:function(WebServices){return WebServices.GetUserProfile()},UserFavoritesBusiness:function(WebServices){return WebServices.getFavoritesBusiness()},UserFavoritesEvents:function(WebServices,$rootScope){return WebServices.getFavoritesEvents($rootScope.IbartarUserInfo.id)},UserComments:function(WebServices,$rootScope){return WebServices.userComments($rootScope.IbartarUserInfo.id)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("moreFavorite",{url:"/moreFavorite",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/moreFavoritesUser.html",controller:"moreFavoriteCtrl",resolve:{UserFavoritesBusiness:function(WebServices){return WebServices.getFavoritesBusiness()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("moreEvents",{url:"/moreEvents",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/moreEventsUser.html",controller:"moreEventsCtrl",resolve:{UserFavoritesEvents:function(WebServices,$rootScope){return WebServices.getFavoritesEvents($rootScope.IbartarUserInfo.id)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("weekSchedule",{url:"/admin/schedule",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/AdminPanel/weekSchedule/weekSchedule.html",controller:"weekScheduleCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()},weekSchedule:function(operatorRequests){return operatorRequests.weekSchedule.GetWeekSchedule()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("forgetpassword",{url:"/user/forgotPassword",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/forgetpass.html",controller:"forgetpassCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("resetpassword",{url:"/user/resetpassword",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/resetpass.html",controller:"resetpassCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("operators-google-page",{url:"/operators/googlepage",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/googlepage.html",controller:"GPageOperatorCtrl",resolve:{GMapTableData:function(operatorRequests){return operatorRequests.getGRequestStatus()},GMapGuildList:function(operatorRequests){return operatorRequests.GoogleGuildList()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("operators-csv",{url:"/operators/csv",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/csv.html",controller:"CsvPageOperatorCtrl",resolve:{CsvTableData:function(operatorRequests){return operatorRequests.GetCsvRequests()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("operator-import",{url:"/operators/import",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/import.html",controller:"OperatorImportCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("favourite",{url:"/favorites",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/favorite.html",controller:"favouriteCtrl",resolve:{favoriteList:function(WebServices){return WebServices.getFavorites()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("temp-validity",{url:"/operators/temp-correct?source",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/temp-validity.html",controller:"TempValidityCtrl",resolve:{tempPageData:function($stateParams,operatorRequests){return operatorRequests.getPopRand("raw",$stateParams)},guildlist:function(WebServices){return WebServices.getlist()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("temp-validity-supervisor",{url:"/operators/temp-complete?source",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/temp-validity.html",controller:"TempValidityCtrl",resolve:{tempPageData:function($stateParams,operatorRequests){return operatorRequests.getPopRand("is_correct",$stateParams)},guildlist:function(WebServices){return WebServices.getlist()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("pagesDeletedReport",{url:"/pages-deleted",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/ReportPage/pagesDeletedReport.html",controller:"pagesDeletedReportCtrl",resolve:{reportPagesDeleted:function(operatorRequests){return operatorRequests.pagesDeleted.getReportPagesDeleted().success(function(response){}).error(function(error){})},lazyLoadModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("page-unique",{url:"/operators/page-unique",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/uniquepage.html",controller:"UniqePageCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("page-complete",{url:"/operators/page-complete",data:{mustBeLoggedIn:!0},onEnter:function(operatorRequests,$state,utils){operatorRequests.getPageCorrectUuid("is_complete").then(function(result){if(result.data.status){var uuidToEdit=result.data.data.entity.uuid;$state.go("operator-page-check",{uuid:uuidToEdit,status:"page-complete"})}else utils.NormalNotificationForServerResponse(result.data.message,!1),$state.go("home")},utils.MHandler[1])}}).state("operator-page-check",{url:"/operators/page/:uuid/:status",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/ShowCaseEdit.html",controller:"EditShowCtrl",resolve:{ShowDate:function(SearchRequests,$stateParams){return SearchRequests.GetExtendEdiMode($stateParams.uuid)},guildlist:function(WebServices){return WebServices.getlist()},Suggestions:function(WebServices,$stateParams){return WebServices.getKeyWordsSuggestion($stateParams.uuid)},loadLazyModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["OpeningHours","sotos.crop-image","sticky","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("arealist",{url:"/arealist",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/arealist.html",controller:"FooterCtrl",resolve:{Popularareas:function(WebServices){return WebServices.GetPopularAreas()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("areaEditor",{data:{mustBeLoggedIn:!0},url:"/operators/area-editor",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/areaEditor.html",controller:"AreaEditorCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("operator-media-check",{url:"/operators/media-check",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/mediaAccepter.html",controller:"mediaCheckerCtrl",resolve:{mediaPoped:function(operatorRequests){return operatorRequests.popMedia()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("operator-product-check",{url:"/operators/product-check",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/productAccepter.html",controller:"productCheckerCtrl",resolve:{productPoped:function(operatorRequests){return operatorRequests.popProduct()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("league",{url:"/league",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/invitationLeague.html",controller:"invitationLeagueCtrl",resolve:{userPbCode:function(WebServices,$rootScope){var userId="null";return $rootScope.IbartarUserInfo&&(userId=$rootScope.IbartarUserInfo.id),WebServices.getUserPbCodeCountInstaller(userId)},loadTimerModule:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["timer"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("checkLog",{url:"/operators/statistics",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/checkLog.html",controller:"checkLogCtrl",resolve:{operators:function(operatorRequests){return operatorRequests.getOperatorList()},loadLazyModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("bugLog",{url:"/operators/bug-log",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/bugLog.html",controller:"bugLogCtrl",resolve:{operators:function(operatorRequests){return operatorRequests.getOperatorList()},loadLazyModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["highcharts-ng","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("pageViewLog",{url:"/operators/page-log",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/pageViewLogPanel.html",controller:"pageViewLogCtrl",resolve:{loadLazyModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["highcharts-ng","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("message",{url:"/message-panel?uuid?title",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/messagePanel.html",controller:"messagePanelCtrl",resolve:{messagesOfUser:function(WebServices){return WebServices.message.personInbox()}}}}}).state("userCreatedPages",{url:"/my-created-pages",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/userCreatedPagesView.html",controller:"userCreatedPagesCtrl",resolve:{createdPagesArr:function(WebServices){return WebServices.getPageListCreatedByUser()}}}}}).state("scoreBank",{url:"/user/scores",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/scoreBank.html",controller:"scoreBankCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("scoreBankDetail",{url:"/user/scores/details/:userId",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/scoreBankDetails.html",controller:"scoreBankDetailsCtrl",resolve:{userScoreContent:function(WebServices,$stateParams){return WebServices.score.getDetailByUserId($stateParams.userId)},userProfile:function(WebServices,$stateParams){return WebServices.GetProfile($stateParams.userId)}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("mergeReq",{url:"/merge?uuids",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/operatorspages/mergeRequestView.html",controller:"mergeReqCtrl"}}}).state("pageRevision",{url:"/operators/page-revision",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/pageRevision/pageRevisionHome.html",controller:"RevisionCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("editJobs",{url:"/operators/page-final?:uuid",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/EditJobs/editJobs.html",controller:"editJobsCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()},ShowPageJob:function(operatorRequests,$stateParams){return operatorRequests.editJobs.GetListJobs("is_final",$stateParams.uuid)}}}}}).state("errorReport",{url:"/operators/page-correct",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/EditJobs/editJobs.html",controller:"editJobsCtrl",resolve:{JobList:function(WebServices){return WebServices.getlist()},ShowPageJob:function(operatorRequests){return operatorRequests.editJobs.GetListJobs("is_correct")}}}}}).state("getReportPage",{url:"/get-report-page/:uuid",data:{mustBeLoggedIn:!0},views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/ReportPage/getReportPage.html",controller:"getReportPageCtrl",resolve:{ReportsOfPage:function(WebServices,$stateParams){return WebServices.reportPage.getReportPage($stateParams.uuid).success(function(response){}).error(function(error){})},lazyLoadModules:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load(["highcharts-ng","ui.bootstrap.datepicker","ui.bootstrap.persian.datepicker"])}]}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("help",{url:"/help",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/help.html"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("leaderBoard",{url:"/pbc",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/leaderBoard.html",controller:"leaderBoardCtrl",resolve:{leaderBoard:function(WebServices){return WebServices.GetLeaderBoard()}}},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("CPC",{url:"/win",views:{"home-header":{templateUrl:ThemePrefix+"/views/newView/homeHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/win.html",controller:"CPCCtrl"}}}).state("sampling",{url:"/sampling",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/sampling.html",controller:"samplingCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("privacy",{url:"/privacy",views:{"other-header":{templateUrl:ThemePrefix+"/views/newView/otherHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/privacy.html",controller:"privacyCtrl"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}}).state("404",{url:"{path:.*}",views:{"home-header":{templateUrl:ThemePrefix+"/views/newView/homeHeader.html",controller:"AuthLogin"},"":{templateUrl:ThemePrefix+"/views/404.html",controller:"404Controller"},footer:{templateUrl:ThemePrefix+"/views/footer.html",controller:"FooterCtrl"}}})}).constant("appConfig",{api:base+"/api/v1.1",apiV1_0:base+"/api/v1.0",apiV1_2:base+"/api/v1.2",apiV1_3:base+"/api/v1.3",apiV1_4:base+"/api/v1.4",apiAdmin:base+"/api/admin",base:base,BaseTheme:base+"/webApplication/desktop/app",BaseThemeNew:base+"/webApplication/desktop/newStyle/assets"}).run(function($rootScope,$state,appConfig,$log,$location,$window,SearchResultSaver,$timeout,ngProgress,Analytics,WebServices,notifications,editableOptions,$stateParams,$anchorScroll,channelService){editableOptions.theme="bs3",$rootScope.iterationCount=0,$rootScope.base=appConfig.base,$rootScope.Themebase=appConfig.BaseTheme,$rootScope.ThemebaseNew=appConfig.BaseThemeNew,"undefined"!=typeof userJson&&($rootScope.IbartarUserInfo=userJson,1==$rootScope.IbartarUserInfo.profileVersion&&($rootScope.IbartarUserInfo=null)),$rootScope.AttachMenuInHome=!0,ngProgress.color("#FE6E73"),ngProgress.height("2px"),$rootScope.$on("$stateChangeStart",function(){$rootScope.PageNotFound=!1,$rootScope.Pagedescriptions="",$rootScope.nextPage=null,$rootScope.prevPage=null,$rootScope.OgTitle=null,$rootScope.OgImage=null,$rootScope.OgDescription=null,ngProgress.start()}),$rootScope.$on("$stateChangeSuccess",function(currentRoute,previousRoute){if($rootScope.showHeader=!0,"nazargardi"==previousRoute.name&&($rootScope.showHeader=!1),ngProgress.complete(),
$rootScope.loadFooter=!0,$rootScope.iterationCount=0,$timeout(function(){$rootScope.LoaderOnPage=!1},500),pageUrl="/404","404"!=$state.current.name)var pageUrl=$state.href($state.current.name,$state.params).replace($rootScope.base,"");if(Analytics.trackPage(pageUrl),previousRoute.data){var requireLogin=previousRoute.data;requireLogin.mustBeLoggedIn&&$rootScope.IbartarUserInfo||$state.go("userlogin")}var page=jQuery("html, body");page.on("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove",function(){page.stop()}),page.animate({scrollTop:0},"slow",function(){page.off("scroll mousedown wheel DOMMouseScroll mousewheel keyup touchmove")}),$rootScope.PageLoaded="ready",setTimeout(function(){jQuery(".CloseBackground").click()},500),$rootScope.isHome="home"==$state.current.name,channelService.resetChannel()}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,utils){$rootScope.LoaderOnPage=!0,$rootScope.previousPath=$location.$$path}),$rootScope.$on("$locationChangeStart",function(locationChangeObj,toLocationUrl,fromLocationUrl){$rootScope.previousActualUrl&&$location.absUrl()==$rootScope.previousActualUrl&&"/search"==$location.$$path&&-1!=$rootScope.previousPath.indexOf("/page/")&&SearchResultSaver.unlock(),$rootScope.previousActualUrl=fromLocationUrl,$rootScope.previousPath=$location.$$path}),$rootScope.$on("$stateChangeError",function(event){ngProgress.complete(),$rootScope.LoaderOnPage=!1}),$rootScope.$on("$viewContentLoaded",function(){})});var handleCircleBars=function(){var circularBars=jQuery(".circular-bars"),percentagesDataAttr="percentages",scalesDataAttr="scales",colorsDataAttr="colors",trailColorDataAttr="trail-color",barTrailClass="bar-trail",barFrontClass="bar-main",loadedClass="loaded",startDelayDataAttr="start-delay",staggerDelayDataAttr="stagger-delay",nativeSvgWidth=610,valueDelimiter=",",pathElement=jQuery("<path />").attr({d:"M306.613,47.156 c143.236,0,259.354,116.118,259.354,259.355c0,143.238-116.118,259.356-259.354,259.356c-143.239,0-259.357-116.118-259.357-259.356 C47.256,163.274,163.374,47.156,306.613,47.156z","vector-effect":"non-scaling-stroke"}),svgElement=jQuery("<svg  />").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"100%",viewBox:"0 0 "+nativeSvgWidth+" "+nativeSvgWidth,"enable-background":"new 0 0 "+nativeSvgWidth+" "+nativeSvgWidth,"xml:space":"preserve"});circularBars.length&&jQuery.each(circularBars,function(index,circularBar){jQuery.circularBar=jQuery(circularBar);var svg=svgElement.clone(),path=pathElement.clone(),percentages=jQuery.circularBar.data(percentagesDataAttr),scales=jQuery.circularBar.data(scalesDataAttr),colors=jQuery.circularBar.data(colorsDataAttr),trailColors=jQuery.circularBar.data(trailColorDataAttr),startDelay=jQuery.circularBar.data(startDelayDataAttr),staggerDelay=jQuery.circularBar.data(staggerDelayDataAttr);percentages=percentages&&percentages.length?percentages.split(valueDelimiter):[],scales=scales&&scales.length?scales.split(valueDelimiter):[],colors=colors&&colors.length?colors.split(valueDelimiter):[],trailColors=trailColors&&trailColors.length?trailColors.split(valueDelimiter):[],startDelay="undefined"!=typeof startDelay?startDelay:500,staggerDelay="undefined"!=typeof staggerDelay?staggerDelay:50;var count=Math.min(percentages.length,scales.length,colors.length),samplePath=path.clone().attr("opacity",0);svg.append(samplePath).appendTo(jQuery.circularBar).attr({width:jQuery.circularBar.width(),height:jQuery.circularBar.width()}),jQuery.circularBar.html(jQuery.circularBar.html()),svg=jQuery.circularBar.find("svg"),samplePath=jQuery.circularBar.find("path");var totalLength=samplePath.get(0).getTotalLength();if(samplePath.remove(),count>0){for(var i=0;count>i;i++){var transform="translate( "+(1-scales[i])*(svg.width()/2)*(nativeSvgWidth/svg.width())+", "+(1-scales[i])*(svg.height()/2)*(nativeSvgWidth/svg.width())+"), scale( "+scales[i]+" )",pathBehind=path.clone().attr({transform:transform,stroke:trailColors[i],"stroke-dasharray":totalLength*scales[i]/(nativeSvgWidth/svg.height())+" "+totalLength*scales[i]/(nativeSvgWidth/svg.height()),"class":barTrailClass}),pathFront=path.clone().attr({transform:transform,stroke:colors[i],"stroke-dasharray":"0 "+totalLength*scales[i]/(nativeSvgWidth/svg.height()),"stroke-linecap":"round",opacity:0,"class":barFrontClass});svg.append(pathBehind).append(pathFront)}jQuery.circularBar.html(jQuery.circularBar.html()),svg=jQuery.circularBar.find("svg"),jQuery.circularBar.addClass(loadedClass),setTimeout(function(){jQuery.each(jQuery.circularBar.find("."+barFrontClass),function(i,pathFront){setTimeout(function(){jQuery(pathFront).attr({opacity:1,"stroke-dasharray":percentages[i]*(totalLength*scales[i]/(nativeSvgWidth/svg.height()))/100+" "+totalLength*scales[i]/(nativeSvgWidth/svg.height())})},i*staggerDelay)})},startDelay)}})};setTimeout(handleCircleBars(),5e3),!function($){"use strict";var Typed=function(el,options){this.el=$(el),this.options=$.extend({},$.fn.typed.defaults,options),this.isInput=this.el.is("input"),this.attr=this.options.attr,this.showCursor=this.isInput?!1:this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};Typed.prototype={constructor:Typed,init:function(){var self=this;self.timeout=setTimeout(function(){for(var i=0;i<self.strings.length;++i)self.sequence[i]=i;self.shuffle&&(self.sequence=self.shuffleArray(self.sequence)),self.typewrite(self.strings[self.sequence[self.arrayPos]],self.strPos)},self.startDelay)},build:function(){var self=this;if(this.showCursor===!0&&(this.cursor=$('<span class="typed-cursor">'+this.cursorChar+"</span>"),this.el.after(this.cursor)),this.stringsElement){this.strings=[],this.stringsElement.hide();var strings=this.stringsElement.children();$.each(strings,function(key,value){self.strings.push($(value).html())})}this.init()},typewrite:function(curString,curStrPos){if(this.stop!==!0){var humanize=Math.round(70*Math.random())+this.typeSpeed,self=this;self.timeout=setTimeout(function(){var charPause=0,substr=curString.substr(curStrPos);if("^"===substr.charAt(0)){var skip=1;/^\^\d+/.test(substr)&&(substr=/\d+/.exec(substr)[0],skip+=substr.length,charPause=parseInt(substr)),curString=curString.substring(0,curStrPos)+curString.substring(curStrPos+skip)}if("html"===self.contentType){var curChar=curString.substr(curStrPos).charAt(0);if("<"===curChar||"&"===curChar){var tag="",endTag="";for(endTag="<"===curChar?">":";";curString.substr(curStrPos+1).charAt(0)!==endTag&&(tag+=curString.substr(curStrPos).charAt(0),curStrPos++,!(curStrPos+1>curString.length)););curStrPos++,tag+=endTag}}self.timeout=setTimeout(function(){if(curStrPos===curString.length){if(self.options.onStringTyped(self.arrayPos),self.arrayPos===self.strings.length-1&&(self.options.callback(),self.curLoop++,self.loop===!1||self.curLoop===self.loopCount))return;self.timeout=setTimeout(function(){self.backspace(curString,curStrPos)},self.backDelay)}else{0===curStrPos&&self.options.preStringTyped(self.arrayPos);var nextString=curString.substr(0,curStrPos+1);self.attr?self.el.attr(self.attr,nextString):self.isInput?self.el.val(nextString):"html"===self.contentType?self.el.html(nextString):self.el.text(nextString),curStrPos++,self.typewrite(curString,curStrPos)}},charPause)},humanize)}},backspace:function(curString,curStrPos){if(this.stop!==!0){var humanize=Math.round(70*Math.random())+this.backSpeed,self=this;self.timeout=setTimeout(function(){if("html"===self.contentType&&">"===curString.substr(curStrPos).charAt(0)){for(var tag="";"<"!==curString.substr(curStrPos-1).charAt(0)&&(tag-=curString.substr(curStrPos).charAt(0),curStrPos--,!(0>curStrPos)););curStrPos--,tag+="<"}var nextString=curString.substr(0,curStrPos);self.attr?self.el.attr(self.attr,nextString):self.isInput?self.el.val(nextString):"html"===self.contentType?self.el.html(nextString):self.el.text(nextString),curStrPos>self.stopNum?(curStrPos--,self.backspace(curString,curStrPos)):curStrPos<=self.stopNum&&(self.arrayPos++,self.arrayPos===self.strings.length?(self.arrayPos=0,self.shuffle&&(self.sequence=self.shuffleArray(self.sequence)),self.init()):self.typewrite(self.strings[self.sequence[self.arrayPos]],curStrPos))},humanize)}},shuffleArray:function(array){var tmp,current,top=array.length;if(top)for(;--top;)current=Math.floor(Math.random()*(top+1)),tmp=array[current],array[current]=array[top],array[top]=tmp;return array},reset:function(){var self=this;clearInterval(self.timeout);this.el.attr("id");this.el.empty(),"undefined"!=typeof this.cursor&&this.cursor.remove(),this.strPos=0,this.arrayPos=0,this.curLoop=0,this.options.resetCallback()}},$.fn.typed=function(option){return this.each(function(){var $this=$(this),data=$this.data("typed"),options="object"==typeof option&&option;data&&data.reset(),$this.data("typed",data=new Typed(this,options)),"string"==typeof option&&data[option]()})},$.fn.typed.defaults={strings:["These are the default values...","You know what you should do?","Use your own!","Have a great day!"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:"|",attr:null,contentType:"html",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery),!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){"use strict";var o=!1,t=!1,r=0,i=2e3,s=0,n=e,l=document,a=n(window),c=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||!1}(),d=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||!1}();if(c)window.cancelAnimationFrame||(d=function(e){});else{var u=0;c=function(e,o){var t=(new Date).getTime(),r=Math.max(0,16-(t-u)),i=window.setTimeout(function(){e(t+r)},r);return u=t+r,i},d=function(e){window.clearTimeout(e)}}var h=window.MutationObserver||window.WebKitMutationObserver||!1,p=Date.now||function(){return(new Date).getTime()},m={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"6px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,emulatetouch:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var e=l.currentScript||function(){var e=l.getElementsByTagName("script");return!!e.length&&e[e.length-1]}(),o=e?e.src.split("?")[0]:"";return o.split("/").length>0?o.split("/").slice(0,-1).join("/")+"/":""}(),preventmultitouchscrolling:!0,disablemutationobserver:!1,enableobserver:!0,scrollbarid:!1},f=!1,g=function(){if(f)return f;var e=l.createElement("DIV"),o=e.style,t=navigator.userAgent,r=navigator.platform,i={};return i.haspointerlock="pointerLockElement"in l||"webkitPointerLockElement"in l||"mozPointerLockElement"in l,i.isopera="opera"in window,i.isopera12=i.isopera&&"getUserMedia"in navigator,i.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),i.isie="all"in l&&"attachEvent"in e&&!i.isopera,i.isieold=i.isie&&!("msInterpolationMode"in o),i.isie7=i.isie&&!i.isieold&&(!("documentMode"in l)||7===l.documentMode),i.isie8=i.isie&&"documentMode"in l&&8===l.documentMode,i.isie9=i.isie&&"performance"in window&&9===l.documentMode,i.isie10=i.isie&&"performance"in window&&10===l.documentMode,i.isie11="msRequestFullscreen"in e&&l.documentMode>=11,i.ismsedge="msCredentials"in window,i.ismozilla="MozAppearance"in o,i.iswebkit=!i.ismsedge&&"WebkitAppearance"in o,i.ischrome=i.iswebkit&&"chrome"in window,i.ischrome38=i.ischrome&&"touchAction"in o,i.ischrome22=!i.ischrome38&&i.ischrome&&i.haspointerlock,i.ischrome26=!i.ischrome38&&i.ischrome&&"transition"in o,i.cantouch="ontouchstart"in l.documentElement||"ontouchstart"in window,i.hasw3ctouch=(window.PointerEvent||!1)&&(navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0),i.hasmstouch=!i.hasw3ctouch&&(window.MSPointerEvent||!1),i.ismac=/^mac$/i.test(r),i.isios=i.cantouch&&/iphone|ipad|ipod/i.test(r),i.isios4=i.isios&&!("seal"in Object),i.isios7=i.isios&&"webkitHidden"in l,i.isios8=i.isios&&"hidden"in l,i.isios10=i.isios&&window.Proxy,i.isandroid=/android/i.test(t),i.haseventlistener="addEventListener"in e,i.trstyle=!1,i.hastransform=!1,i.hastranslate3d=!1,i.transitionstyle=!1,i.hastransition=!1,i.transitionend=!1,i.trstyle="transform",i.hastransform="transform"in o||function(){for(var e=["msTransform","webkitTransform","MozTransform","OTransform"],t=0,r=e.length;r>t;t++)if(void 0!==o[e[t]]){i.trstyle=e[t];break}i.hastransform=!!i.trstyle}(),i.hastransform&&(o[i.trstyle]="translate3d(1px,2px,3px)",i.hastranslate3d=/translate3d/.test(o[i.trstyle])),i.transitionstyle="transition",i.prefixstyle="",i.transitionend="transitionend",i.hastransition="transition"in o||function(){i.transitionend=!1;for(var e=["webkitTransition","msTransition","MozTransition","OTransition","OTransition","KhtmlTransition"],t=["-webkit-","-ms-","-moz-","-o-","-o","-khtml-"],r=["webkitTransitionEnd","msTransitionEnd","transitionend","otransitionend","oTransitionEnd","KhtmlTransitionEnd"],s=0,n=e.length;n>s;s++)if(e[s]in o){i.transitionstyle=e[s],i.prefixstyle=t[s],i.transitionend=r[s];break}i.ischrome26&&(i.prefixstyle=t[1]),i.hastransition=i.transitionstyle}(),i.cursorgrabvalue=function(){var e=["grab","-webkit-grab","-moz-grab"];(i.ischrome&&!i.ischrome38||i.isie)&&(e=[]);for(var t=0,r=e.length;r>t;t++){var s=e[t];if(o.cursor=s,o.cursor==s)return s}return"url(https://cdnjs.cloudflare.com/ajax/libs/slider-pro/1.3.0/css/images/openhand.cur),n-resize"}(),i.hasmousecapture="setCapture"in e,i.hasMutationObserver=!1!==h,e=null,f=i,i},w=function(e,u){function f(){var e=S.doc.css(E.trstyle);return!(!e||"matrix"!=e.substr(0,6))&&e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function w(){var e=S.win;if("zIndex"in e)return e.zIndex();for(;e.length>0;){if(9==e[0].nodeType)return!1;var o=e.css("zIndex");if(!isNaN(o)&&0!=o)return parseInt(o);e=e.parent()}return!1}function b(e,o,t){var r=e.css(o),i=parseFloat(r);if(isNaN(i)){var s=3==(i=P[r]||0)?t?S.win.outerHeight()-S.win.innerHeight():S.win.outerWidth()-S.win.innerWidth():1;return S.isie8&&i&&(i+=1),s?i:0}return i}function y(e,o,t,r){S._bind(e,o,function(r){var i={original:r=r||window.event,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==o?(r.wheelDeltaX&&(i.deltaX=-.025*r.wheelDeltaX),r.wheelDeltaY&&(i.deltaY=-.025*r.wheelDeltaY),!i.deltaY&&!i.deltaX&&(i.deltaY=-.025*r.wheelDelta)):i.deltaY=r.detail,t.call(e,i)},r)}function x(e,o,t){var r,i;if(0==e.deltaMode?(r=-Math.floor(e.deltaX*(S.opt.mousescrollstep/54)),i=-Math.floor(e.deltaY*(S.opt.mousescrollstep/54))):1==e.deltaMode&&(r=-Math.floor(e.deltaX*S.opt.mousescrollstep),i=-Math.floor(e.deltaY*S.opt.mousescrollstep)),o&&S.opt.oneaxismousemode&&0===r&&i&&(r=i,i=0,t&&(0>r?S.getScrollLeft()>=S.page.maxw:S.getScrollLeft()<=0)&&(i=r,r=0)),S.isrtlmode&&(r=-r),r){if(S.scrollmom)S.scrollmom.stop();else if(0>r){if(S.getScrollLeft()>=S.page.maxw)return!0}else if(S.getScrollLeft()<=0)return!0;S.lastdeltax+=r,S.debounced("mousewheelx",function(){var e=S.lastdeltax;S.lastdeltax=0,S.rail.drag||S.doScrollLeftBy(e)},15)}if(i){if(S.opt.nativeparentscrolling&&t&&!S.ispage&&!S.zoomactive)if(0>i){if(S.getScrollTop()>=S.page.maxh)return!0}else if(S.getScrollTop()<=0)return!0;S.scrollmom&&S.scrollmom.stop(),S.lastdeltay+=i,S.synched("mousewheely",function(){var e=S.lastdeltay;S.lastdeltay=0,S.rail.drag||S.doScrollBy(e)},15)}return e.stopImmediatePropagation(),e.preventDefault()}var S=this;this.version="3.7.3",this.name="nicescroll",this.me=u;var z=n("body");if(this.opt={doc:z,win:!1},n.extend(this.opt,m),this.opt.snapbackspeed=80,e)for(var k in S.opt)void 0!==e[k]&&(S.opt[k]=e[k]);if(S.opt.disablemutationobserver&&(h=!1),this.doc=S.opt.doc,this.iddoc=this.doc&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(S.opt.win?S.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==S.opt.win,this.win=S.opt.win||(this.ispage?a:this.doc),this.docscroll=this.ispage&&!this.haswrapper?a:this.win,this.body=z,this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=S.opt.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,"auto"==this.opt.rtlmode){var T=this.win[0]==window?this.body:this.win,M=T.css("writing-mode")||T.css("-webkit-writing-mode")||T.css("-ms-writing-mode")||T.css("-moz-writing-mode");"horizontal-tb"==M||"lr-tb"==M||""==M?(this.isrtlmode="rtl"==T.css("direction"),this.isvertical=!1):(this.isrtlmode="vertical-rl"==M||"tb"==M||"tb-rl"==M||"rl-tb"==M,this.isvertical="vertical-rl"==M||"tb"==M||"tb-rl"==M)}else this.isrtlmode=!0===this.opt.rtlmode,this.isvertical=!1;if(this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1,this.observerbody=!1,!1===S.opt.scrollbarid){do this.id="ascrail"+i++;while(l.getElementById(this.id))}else this.id=S.opt.scrollbarid;this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.visibility=!0,this.railslocked=!1,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=S.opt.overflowx,this.overflowy=S.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=g();var E=n.extend({},this.detected);this.canhwscroll=E.hastransform&&S.opt.hwacceleration,this.ishwscroll=this.canhwscroll&&S.haswrapper,this.isrtlmode?this.isvertical?this.hasreversehr=!(E.iswebkit||E.isie||E.isie11):this.hasreversehr=!(E.iswebkit||E.isie&&!E.isie10&&!E.isie11):this.hasreversehr=!1,this.istouchcapable=!1,E.cantouch||!E.hasw3ctouch&&!E.hasmstouch?!E.cantouch||E.isios||E.isandroid||!E.iswebkit&&!E.ismozilla||(this.istouchcapable=!0):this.istouchcapable=!0,S.opt.enablemouselockapi||(E.hasmousecapture=!1,E.haspointerlock=!1),this.debounced=function(e,o,t){S&&(S.delaylist[e]||!1||(S.delaylist[e]={h:c(function(){S.delaylist[e].fn.call(S),S.delaylist[e]=!1},t)},o.call(S)),S.delaylist[e].fn=o)};var L=!1;this.synched=function(e,o){return S.synclist[e]=o,function(){L||(c(function(){if(S){L=!1;for(var e in S.synclist){var o=S.synclist[e];o&&o.call(S),S.synclist[e]=!1}}}),L=!0)}(),e},this.unsynched=function(e){S.synclist[e]&&(S.synclist[e]=!1)},this.css=function(e,o){for(var t in o)S.saved.css.push([e,t,e.css(t)]),e.css(t,o[t])},this.scrollTop=function(e){return void 0===e?S.getScrollTop():S.setScrollTop(e)},this.scrollLeft=function(e){return void 0===e?S.getScrollLeft():S.setScrollLeft(e)};var C=function(e,o,t,r,i,s,n){this.st=e,this.ed=o,this.spd=t,this.p1=r||0,this.p2=i||1,this.p3=s||0,this.p4=n||1,this.ts=p(),this.df=this.ed-this.st};if(C.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-(p()-this.ts)/this.spd,o=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*o)},update:function(e,o){return this.st=this.getNow(),this.ed=e,this.spd=o,this.ts=p(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},E.hastranslate3d&&E.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){var o=f();if(o)return 16==o.length?-o[13]:-o[5];if(S.timerscroll&&S.timerscroll.bz)return S.timerscroll.bz.getNow()}return S.doc.translate.y},this.getScrollLeft=function(e){if(!e){var o=f();if(o)return 16==o.length?-o[12]:-o[4];if(S.timerscroll&&S.timerscroll.bh)return S.timerscroll.bh.getNow()}return S.doc.translate.x},this.notifyScrollEvent=function(e){var o=l.createEvent("UIEvents");o.initUIEvent("scroll",!1,!0,window,1),o.niceevent=!0,e.dispatchEvent(o)};var N=this.isrtlmode?1:-1;E.hastranslate3d&&S.opt.enabletranslate3d?(this.setScrollTop=function(e,o){S.doc.translate.y=e,S.doc.translate.ty=-1*e+"px",S.doc.css(E.trstyle,"translate3d("+S.doc.translate.tx+","+S.doc.translate.ty+",0)"),o||S.notifyScrollEvent(S.win[0])},this.setScrollLeft=function(e,o){S.doc.translate.x=e,S.doc.translate.tx=e*N+"px",S.doc.css(E.trstyle,"translate3d("+S.doc.translate.tx+","+S.doc.translate.ty+",0)"),o||S.notifyScrollEvent(S.win[0])}):(this.setScrollTop=function(e,o){S.doc.translate.y=e,S.doc.translate.ty=-1*e+"px",S.doc.css(E.trstyle,"translate("+S.doc.translate.tx+","+S.doc.translate.ty+")"),o||S.notifyScrollEvent(S.win[0])},this.setScrollLeft=function(e,o){S.doc.translate.x=e,S.doc.translate.tx=e*N+"px",S.doc.css(E.trstyle,"translate("+S.doc.translate.tx+","+S.doc.translate.ty+")"),o||S.notifyScrollEvent(S.win[0])})}else this.getScrollTop=function(){return S.docscroll.scrollTop()},this.setScrollTop=function(e){return setTimeout(function(){S&&S.docscroll.scrollTop(e)},1)},this.getScrollLeft=function(){return S.hasreversehr?S.detected.ismozilla?S.page.maxw-Math.abs(S.docscroll.scrollLeft()):S.page.maxw-S.docscroll.scrollLeft():S.docscroll.scrollLeft()},this.setScrollLeft=function(e){return setTimeout(function(){return S?(S.hasreversehr&&(e=S.detected.ismozilla?-(S.page.maxw-e):S.page.maxw-e),S.docscroll.scrollLeft(e)):void 0},1)};this.getTarget=function(e){return!!e&&(e.target?e.target:!!e.srcElement&&e.srcElement)},this.hasParent=function(e,o){if(!e)return!1;for(var t=e.target||e.srcElement||e||!1;t&&t.id!=o;)t=t.parentNode||!1;return!1!==t};var P={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:window.pageYOffset||l.documentElement.scrollTop,left:window.pageXOffset||l.documentElement.scrollLeft}},this.getOffset=function(){if(S.isfixed){var e=S.win.offset(),o=S.getDocumentScrollOffset();return e.top-=o.top,e.left-=o.left,e}var t=S.win.offset();if(!S.viewport)return t;var r=S.viewport.offset();return{top:t.top-r.top,left:t.left-r.left}},this.updateScrollBar=function(e){var o,t;if(S.ishwscroll)S.rail.css({height:S.win.innerHeight()-(S.opt.railpadding.top+S.opt.railpadding.bottom)}),S.railh&&S.railh.css({width:S.win.innerWidth()-(S.opt.railpadding.left+S.opt.railpadding.right)});else{var r=S.getOffset();if(o={top:r.top,left:r.left-(S.opt.railpadding.left+S.opt.railpadding.right)},o.top+=b(S.win,"border-top-width",!0),o.left+=S.rail.align?S.win.outerWidth()-b(S.win,"border-right-width")-S.rail.width:b(S.win,"border-left-width"),(t=S.opt.railoffset)&&(t.top&&(o.top+=t.top),t.left&&(o.left+=t.left)),S.railslocked||S.rail.css({top:o.top,left:o.left,height:(e?e.h:S.win.innerHeight())-(S.opt.railpadding.top+S.opt.railpadding.bottom)}),S.zoom&&S.zoom.css({top:o.top+1,left:1==S.rail.align?o.left-20:o.left+S.rail.width+4}),S.railh&&!S.railslocked){o={top:r.top,left:r.left},(t=S.opt.railhoffset)&&(t.top&&(o.top+=t.top),t.left&&(o.left+=t.left));var i=S.railh.align?o.top+b(S.win,"border-top-width",!0)+S.win.innerHeight()-S.railh.height:o.top+b(S.win,"border-top-width",!0),s=o.left+b(S.win,"border-left-width");S.railh.css({top:i-(S.opt.railpadding.top+S.opt.railpadding.bottom),left:s,width:S.railh.width})}}},this.doRailClick=function(e,o,t){var r,i,s,n;S.railslocked||(S.cancelEvent(e),"pageY"in e||(e.pageX=e.clientX+l.documentElement.scrollLeft,e.pageY=e.clientY+l.documentElement.scrollTop),o?(r=t?S.doScrollLeft:S.doScrollTop)(s=t?(e.pageX-S.railh.offset().left-S.cursorwidth/2)*S.scrollratio.x:(e.pageY-S.rail.offset().top-S.cursorheight/2)*S.scrollratio.y):(r=t?S.doScrollLeftBy:S.doScrollBy,s=t?S.scroll.x:S.scroll.y,n=t?e.pageX-S.railh.offset().left:e.pageY-S.rail.offset().top,i=t?S.view.w:S.view.h,r(s>=n?i:-i)))},S.hasanimationframe="requestAnimationFrame"in window,S.hascancelanimationframe="cancelAnimationFrame"in window,this.init=function(){if(S.saved.css=[],E.isoperamini)return!0;if(E.isandroid&&!("hidden"in l))return!0;S.opt.emulatetouch=S.opt.emulatetouch||S.opt.touchbehavior;var e={"overflow-y":"hidden"};if((E.isie11||E.isie10)&&(e["-ms-overflow-style"]="none"),S.zindex="auto",S.ispage||"auto"!=S.opt.zindex?S.zindex=S.opt.zindex:S.zindex=w()||"auto",!S.ispage&&"auto"!=S.zindex&&S.zindex>s&&(s=S.zindex),S.isie&&0==S.zindex&&"auto"==S.opt.zindex&&(S.zindex="auto"),!S.ispage||!E.cantouch&&!E.isieold){var i=S.docscroll;S.ispage&&(i=S.haswrapper?S.win:S.doc),S.css(i,e),S.ispage&&(E.isie11||E.isie)&&S.css(n("html"),e),!E.isios||S.ispage||S.haswrapper||S.css(z,{"-webkit-overflow-scrolling":"touch"});var c=n(l.createElement("div"));c.css({position:"relative",top:0,"float":"right",width:S.opt.cursorwidth,height:0,"background-color":S.opt.cursorcolor,border:S.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":S.opt.cursorborderradius,"-moz-border-radius":S.opt.cursorborderradius,"border-radius":S.opt.cursorborderradius}),c.addClass("nicescroll-cursors"),S.cursor=c;var d=n(l.createElement("div"));d.attr("id",S.id),d.addClass("nicescroll-rails nicescroll-rails-vr");var u,p,m=["left","right","top","bottom"];for(var f in m)p=m[f],(u=S.opt.railpadding[p])?d.css("padding-"+p,u+"px"):S.opt.railpadding[p]=0;d.append(c),d.width=Math.max(parseFloat(S.opt.cursorwidth),c.outerWidth()),d.css({width:d.width+"px",zIndex:S.zindex,background:S.opt.background,cursor:"default"}),d.visibility=!0,d.scrollable=!0,d.align="left"==S.opt.railalign?0:1,S.rail=d,S.rail.drag=!1;var g=!1;!S.opt.boxzoom||S.ispage||E.isieold||(g=l.createElement("div"),S.bind(g,"click",S.doZoom),S.bind(g,"mouseenter",function(){S.zoom.css("opacity",S.opt.cursoropacitymax)}),S.bind(g,"mouseleave",function(){S.zoom.css("opacity",S.opt.cursoropacitymin)}),S.zoom=n(g),S.zoom.css({cursor:"pointer",zIndex:S.zindex,backgroundImage:"url("+S.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0 0"}),S.opt.dblclickzoom&&S.bind(S.win,"dblclick",S.doZoom),E.cantouch&&S.opt.gesturezoom&&(S.ongesturezoom=function(e){return e.scale>1.5&&S.doZoomIn(e),e.scale<.8&&S.doZoomOut(e),S.cancelEvent(e)},S.bind(S.win,"gestureend",S.ongesturezoom))),S.railh=!1;var b;if(S.opt.horizrailenabled&&(S.css(i,{overflowX:"hidden"}),(c=n(l.createElement("div"))).css({position:"absolute",top:0,height:S.opt.cursorwidth,width:0,backgroundColor:S.opt.cursorcolor,border:S.opt.cursorborder,backgroundClip:"padding-box","-webkit-border-radius":S.opt.cursorborderradius,"-moz-border-radius":S.opt.cursorborderradius,"border-radius":S.opt.cursorborderradius}),E.isieold&&c.css("overflow","hidden"),c.addClass("nicescroll-cursors"),S.cursorh=c,(b=n(l.createElement("div"))).attr("id",S.id+"-hr"),b.addClass("nicescroll-rails nicescroll-rails-hr"),b.height=Math.max(parseFloat(S.opt.cursorwidth),c.outerHeight()),b.css({height:b.height+"px",zIndex:S.zindex,background:S.opt.background}),b.append(c),b.visibility=!0,b.scrollable=!0,b.align="top"==S.opt.railvalign?0:1,S.railh=b,S.railh.drag=!1),S.ispage)d.css({position:"fixed",top:0,height:"100%"}),d.align?d.css({right:0}):d.css({left:0}),S.body.append(d),S.railh&&(b.css({position:"fixed",left:0,width:"100%"}),b.align?b.css({bottom:0}):b.css({top:0}),S.body.append(b));else{if(S.ishwscroll){"static"==S.win.css("position")&&S.css(S.win,{position:"relative"});var y="HTML"==S.win[0].nodeName?S.body:S.win;n(y).scrollTop(0).scrollLeft(0),S.zoom&&(S.zoom.css({position:"absolute",top:1,right:0,"margin-right":d.width+4}),y.append(S.zoom)),d.css({position:"absolute",top:0}),d.align?d.css({right:0}):d.css({left:0}),y.append(d),b&&(b.css({position:"absolute",left:0,bottom:0}),b.align?b.css({bottom:0}):b.css({top:0}),y.append(b))}else{S.isfixed="fixed"==S.win.css("position");var x=S.isfixed?"fixed":"absolute";S.isfixed||(S.viewport=S.getViewport(S.win[0])),S.viewport&&(S.body=S.viewport,0==/fixed|absolute/.test(S.viewport.css("position"))&&S.css(S.viewport,{position:"relative"})),d.css({position:x}),S.zoom&&S.zoom.css({position:x}),S.updateScrollBar(),S.body.append(d),S.zoom&&S.body.append(S.zoom),S.railh&&(b.css({position:x}),S.body.append(b))}E.isios&&S.css(S.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),E.isie&&S.opt.disableoutline&&S.win.attr("hideFocus","true"),E.iswebkit&&S.opt.disableoutline&&S.win.css("outline","none")}if(!1===S.opt.autohidemode?(S.autohidedom=!1,S.rail.css({opacity:S.opt.cursoropacitymax}),S.railh&&S.railh.css({opacity:S.opt.cursoropacitymax})):!0===S.opt.autohidemode||"leave"===S.opt.autohidemode?(S.autohidedom=n().add(S.rail),E.isie8&&(S.autohidedom=S.autohidedom.add(S.cursor)),S.railh&&(S.autohidedom=S.autohidedom.add(S.railh)),S.railh&&E.isie8&&(S.autohidedom=S.autohidedom.add(S.cursorh))):"scroll"==S.opt.autohidemode?(S.autohidedom=n().add(S.rail),S.railh&&(S.autohidedom=S.autohidedom.add(S.railh))):"cursor"==S.opt.autohidemode?(S.autohidedom=n().add(S.cursor),S.railh&&(S.autohidedom=S.autohidedom.add(S.cursorh))):"hidden"==S.opt.autohidemode&&(S.autohidedom=!1,S.hide(),S.railslocked=!1),E.cantouch||S.istouchcapable||S.opt.emulatetouch||E.hasmstouch){S.scrollmom=new v(S),S.ontouchstart=function(e){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(S.hasmoving=!1,!S.railslocked){var o;if(E.hasmstouch)for(o=!!e.target&&e.target;o;){var t=n(o).getNiceScroll();if(t.length>0&&t[0].me==S.me)break;if(t.length>0)return!1;if("DIV"==o.nodeName&&o.id==S.id)break;o=!!o.parentNode&&o.parentNode}if(e.stopPropagation(),S.cancelScroll(),(o=S.getTarget(e))&&/INPUT/i.test(o.nodeName)&&/range/i.test(o.type))return S.stopPropagation(e);if(!("clientX"in e)&&"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),S.forcescreen){var r=e;(e={original:e.original?e.original:e}).clientX=r.screenX,e.clientY=r.screenY}if(S.rail.drag={x:e.clientX,y:e.clientY,sx:S.scroll.x,sy:S.scroll.y,st:S.getScrollTop(),sl:S.getScrollLeft(),pt:2,dl:!1,tg:o},S.ispage||!S.opt.directionlockdeadzone)S.rail.drag.dl="f";else{var i={w:a.width(),h:a.height()},s={w:Math.max(l.body.scrollWidth,l.documentElement.scrollWidth),h:Math.max(l.body.scrollHeight,l.documentElement.scrollHeight)},c=Math.max(0,s.h-i.h),d=Math.max(0,s.w-i.w);!S.rail.scrollable&&S.railh.scrollable?S.rail.drag.ck=c>0&&"v":S.rail.scrollable&&!S.railh.scrollable?S.rail.drag.ck=d>0&&"h":S.rail.drag.ck=!1,
S.rail.drag.ck||(S.rail.drag.dl="f")}if(S.opt.emulatetouch&&S.isiframe&&E.isie){var u=S.win.position();S.rail.drag.x+=u.left,S.rail.drag.y+=u.top}if(S.hasmoving=!1,S.lastmouseup=!1,S.scrollmom.reset(e.clientX,e.clientY),!E.cantouch&&!this.istouchcapable&&!e.pointerType){if(!o||!/INPUT|SELECT|BUTTON|TEXTAREA/i.test(o.nodeName))return!S.ispage&&E.hasmousecapture&&o.setCapture(),S.opt.emulatetouch?(o.onclick&&!o._onclick&&(o._onclick=o.onclick,o.onclick=function(e){return S.hasmoving?!1:void o._onclick.call(this,e)}),S.cancelEvent(e)):S.stopPropagation(e);/SUBMIT|CANCEL|BUTTON/i.test(n(o).attr("type"))&&(S.preventclick={tg:o,click:!1})}}},S.ontouchend=function(e){if(!S.rail.drag)return!0;if(2==S.rail.drag.pt){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(S.rail.drag=!1,S.hasmoving&&(S.scrollmom.doMomentum(),S.lastmouseup=!0,S.hideCursor(),E.hasmousecapture&&l.releaseCapture(),!E.cantouch))return S.cancelEvent(e)}else if(1==S.rail.drag.pt)return S.onmouseup(e)};var k=S.opt.emulatetouch&&S.isiframe&&!E.hasmousecapture;S.ontouchmove=function(e,o){if(!S.rail.drag)return!1;if(e.targetTouches&&S.opt.preventmultitouchscrolling&&e.targetTouches.length>1)return!1;if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(2==S.rail.drag.pt){if("changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),S.rail.drag.y===e.clientY&&S.rail.drag.x===e.clientX)return!1;S.hasmoving||S.onscrollstart&&S.triggerScrollStart(e.clientX,e.clientY,0,0,0),S.hasmoving=!0,S.preventclick&&!S.preventclick.click&&(S.preventclick.click=S.preventclick.tg.onclick||!1,S.preventclick.tg.onclick=S.onpreventclick);var t,r;if(r=t=0,k&&!o){var i=S.win.position();r=-i.left,t=-i.top}var s=e.clientY+t,n=s-S.rail.drag.y,a=e.clientX+r,c=a-S.rail.drag.x,d=S.rail.drag.st-n;S.ishwscroll&&S.opt.bouncescroll?0>d?d=Math.round(d/2):d>S.page.maxh&&(d=S.page.maxh+Math.round((d-S.page.maxh)/2)):(0>d&&(d=0,s=0),d>S.page.maxh&&(d=S.page.maxh,s=0));var u;S.railh&&S.railh.scrollable&&(u=S.isrtlmode?c-S.rail.drag.sl:S.rail.drag.sl-c,S.ishwscroll&&S.opt.bouncescroll?0>u?u=Math.round(u/2):u>S.page.maxw&&(u=S.page.maxw+Math.round((u-S.page.maxw)/2)):(0>u&&(u=0,a=0),u>S.page.maxw&&(u=S.page.maxw,a=0)));var h=!1;if(S.rail.drag.dl)h=!0,"v"==S.rail.drag.dl?u=S.rail.drag.sl:"h"==S.rail.drag.dl&&(d=S.rail.drag.st);else{var p=Math.abs(n),m=Math.abs(c),f=S.opt.directionlockdeadzone;if("v"==S.rail.drag.ck){if(p>f&&.3*p>=m)return S.rail.drag=!1,!0;m>f&&(S.rail.drag.dl="f",z.scrollTop(z.scrollTop()))}else if("h"==S.rail.drag.ck){if(m>f&&.3*m>=p)return S.rail.drag=!1,!0;p>f&&(S.rail.drag.dl="f",z.scrollLeft(z.scrollLeft()))}}if(S.synched("touchmove",function(){S.rail.drag&&2==S.rail.drag.pt&&(S.prepareTransition&&S.prepareTransition(0),S.rail.scrollable&&S.setScrollTop(d),S.scrollmom.update(a,s),S.railh&&S.railh.scrollable?(S.setScrollLeft(u),S.showCursor(d,u)):S.showCursor(d),E.isie10&&l.selection.clear())}),E.ischrome&&S.istouchcapable&&(h=!1),h)return S.cancelEvent(e)}else if(1==S.rail.drag.pt)return S.onmousemove(e)},S.ontouchstartCursor=function(e,o){if(!S.rail.drag||3==S.rail.drag.pt){if(S.locked)return S.cancelEvent(e);S.cancelScroll(),S.rail.drag={x:e.touches[0].clientX,y:e.touches[0].clientY,sx:S.scroll.x,sy:S.scroll.y,pt:3,hr:!!o};var t=S.getTarget(e);return!S.ispage&&E.hasmousecapture&&t.setCapture(),S.isiframe&&!E.hasmousecapture&&(S.saved.csspointerevents=S.doc.css("pointer-events"),S.css(S.doc,{"pointer-events":"none"})),S.cancelEvent(e)}},S.ontouchendCursor=function(e){if(S.rail.drag){if(E.hasmousecapture&&l.releaseCapture(),S.isiframe&&!E.hasmousecapture&&S.doc.css("pointer-events",S.saved.csspointerevents),3!=S.rail.drag.pt)return;return S.rail.drag=!1,S.cancelEvent(e)}},S.ontouchmoveCursor=function(e){if(S.rail.drag){if(3!=S.rail.drag.pt)return;if(S.cursorfreezed=!0,S.rail.drag.hr){S.scroll.x=S.rail.drag.sx+(e.touches[0].clientX-S.rail.drag.x),S.scroll.x<0&&(S.scroll.x=0);var o=S.scrollvaluemaxw;S.scroll.x>o&&(S.scroll.x=o)}else{S.scroll.y=S.rail.drag.sy+(e.touches[0].clientY-S.rail.drag.y),S.scroll.y<0&&(S.scroll.y=0);var t=S.scrollvaluemax;S.scroll.y>t&&(S.scroll.y=t)}return S.synched("touchmove",function(){S.rail.drag&&3==S.rail.drag.pt&&(S.showCursor(),S.rail.drag.hr?S.doScrollLeft(Math.round(S.scroll.x*S.scrollratio.x),S.opt.cursordragspeed):S.doScrollTop(Math.round(S.scroll.y*S.scrollratio.y),S.opt.cursordragspeed))}),S.cancelEvent(e)}}}if(S.onmousedown=function(e,o){if(!S.rail.drag||1==S.rail.drag.pt){if(S.railslocked)return S.cancelEvent(e);S.cancelScroll(),S.rail.drag={x:e.clientX,y:e.clientY,sx:S.scroll.x,sy:S.scroll.y,pt:1,hr:o||!1};var t=S.getTarget(e);return!S.ispage&&E.hasmousecapture&&t.setCapture(),S.isiframe&&!E.hasmousecapture&&(S.saved.csspointerevents=S.doc.css("pointer-events"),S.css(S.doc,{"pointer-events":"none"})),S.hasmoving=!1,S.cancelEvent(e)}},S.onmouseup=function(e){return S.rail.drag?1!=S.rail.drag.pt||(E.hasmousecapture&&l.releaseCapture(),S.isiframe&&!E.hasmousecapture&&S.doc.css("pointer-events",S.saved.csspointerevents),S.rail.drag=!1,S.hasmoving&&S.triggerScrollEnd(),S.cancelEvent(e)):void 0},S.onmousemove=function(e){if(S.rail.drag){if(1!==S.rail.drag.pt)return;if(E.ischrome&&0===e.which)return S.onmouseup(e);if(S.cursorfreezed=!0,S.hasmoving=!0,S.rail.drag.hr){S.scroll.x=S.rail.drag.sx+(e.clientX-S.rail.drag.x),S.scroll.x<0&&(S.scroll.x=0);var o=S.scrollvaluemaxw;S.scroll.x>o&&(S.scroll.x=o)}else{S.scroll.y=S.rail.drag.sy+(e.clientY-S.rail.drag.y),S.scroll.y<0&&(S.scroll.y=0);var t=S.scrollvaluemax;S.scroll.y>t&&(S.scroll.y=t)}return S.synched("mousemove",function(){S.rail.drag&&1==S.rail.drag.pt&&(S.showCursor(),S.rail.drag.hr?S.hasreversehr?S.doScrollLeft(S.scrollvaluemaxw-Math.round(S.scroll.x*S.scrollratio.x),S.opt.cursordragspeed):S.doScrollLeft(Math.round(S.scroll.x*S.scrollratio.x),S.opt.cursordragspeed):S.doScrollTop(Math.round(S.scroll.y*S.scrollratio.y),S.opt.cursordragspeed))}),S.cancelEvent(e)}S.checkarea=0},E.cantouch||S.opt.emulatetouch)S.onpreventclick=function(e){return S.preventclick?(S.preventclick.tg.onclick=S.preventclick.click,S.preventclick=!1,S.cancelEvent(e)):void 0},S.onclick=!E.isios&&function(e){return!S.lastmouseup||(S.lastmouseup=!1,S.cancelEvent(e))},S.opt.grabcursorenabled&&E.cursorgrabvalue&&(S.css(S.ispage?S.doc:S.win,{cursor:E.cursorgrabvalue}),S.css(S.rail,{cursor:E.cursorgrabvalue}));else{var T=function(e){if(S.selectiondrag){if(e){var o=S.win.outerHeight(),t=e.pageY-S.selectiondrag.top;t>0&&o>t&&(t=0),t>=o&&(t-=o),S.selectiondrag.df=t}if(0!=S.selectiondrag.df){var r=2*-Math.floor(S.selectiondrag.df/6);S.doScrollBy(r),S.debounced("doselectionscroll",function(){T()},50)}}};S.hasTextSelected="getSelection"in l?function(){return l.getSelection().rangeCount>0}:"selection"in l?function(){return"None"!=l.selection.type}:function(){return!1},S.onselectionstart=function(e){S.ispage||(S.selectiondrag=S.win.offset())},S.onselectionend=function(e){S.selectiondrag=!1},S.onselectiondrag=function(e){S.selectiondrag&&S.hasTextSelected()&&S.debounced("selectionscroll",function(){T(e)},250)}}if(E.hasw3ctouch?(S.css(S.ispage?n("html"):S.win,{"touch-action":"none"}),S.css(S.rail,{"touch-action":"none"}),S.css(S.cursor,{"touch-action":"none"}),S.bind(S.win,"pointerdown",S.ontouchstart),S.bind(l,"pointerup",S.ontouchend),S.bind(l,"pointermove",S.ontouchmove)):E.hasmstouch?(S.css(S.ispage?n("html"):S.win,{"-ms-touch-action":"none"}),S.css(S.rail,{"-ms-touch-action":"none"}),S.css(S.cursor,{"-ms-touch-action":"none"}),S.bind(S.win,"MSPointerDown",S.ontouchstart),S.bind(l,"MSPointerUp",S.ontouchend),S.bind(l,"MSPointerMove",S.ontouchmove),S.bind(S.cursor,"MSGestureHold",function(e){e.preventDefault()}),S.bind(S.cursor,"contextmenu",function(e){e.preventDefault()})):E.cantouch&&(S.bind(S.win,"touchstart",S.ontouchstart,!1,!0),S.bind(l,"touchend",S.ontouchend,!1,!0),S.bind(l,"touchcancel",S.ontouchend,!1,!0),S.bind(l,"touchmove",S.ontouchmove,!1,!0)),S.opt.emulatetouch&&(S.bind(S.win,"mousedown",S.ontouchstart,!1,!0),S.bind(l,"mouseup",S.ontouchend,!1,!0),S.bind(l,"mousemove",S.ontouchmove,!1,!0)),(S.opt.cursordragontouch||!E.cantouch&&!S.opt.emulatetouch)&&(S.rail.css({cursor:"default"}),S.railh&&S.railh.css({cursor:"default"}),S.jqbind(S.rail,"mouseenter",function(){return S.ispage||S.win.is(":visible")?(S.canshowonmouseevent&&S.showCursor(),void(S.rail.active=!0)):!1}),S.jqbind(S.rail,"mouseleave",function(){S.rail.active=!1,S.rail.drag||S.hideCursor()}),S.opt.sensitiverail&&(S.bind(S.rail,"click",function(e){S.doRailClick(e,!1,!1)}),S.bind(S.rail,"dblclick",function(e){S.doRailClick(e,!0,!1)}),S.bind(S.cursor,"click",function(e){S.cancelEvent(e)}),S.bind(S.cursor,"dblclick",function(e){S.cancelEvent(e)})),S.railh&&(S.jqbind(S.railh,"mouseenter",function(){return S.ispage||S.win.is(":visible")?(S.canshowonmouseevent&&S.showCursor(),void(S.rail.active=!0)):!1}),S.jqbind(S.railh,"mouseleave",function(){S.rail.active=!1,S.rail.drag||S.hideCursor()}),S.opt.sensitiverail&&(S.bind(S.railh,"click",function(e){S.doRailClick(e,!1,!0)}),S.bind(S.railh,"dblclick",function(e){S.doRailClick(e,!0,!0)}),S.bind(S.cursorh,"click",function(e){S.cancelEvent(e)}),S.bind(S.cursorh,"dblclick",function(e){S.cancelEvent(e)})))),S.opt.cursordragontouch&&(this.istouchcapable||E.cantouch)&&(S.bind(S.cursor,"touchstart",S.ontouchstartCursor),S.bind(S.cursor,"touchmove",S.ontouchmoveCursor),S.bind(S.cursor,"touchend",S.ontouchendCursor),S.cursorh&&S.bind(S.cursorh,"touchstart",function(e){S.ontouchstartCursor(e,!0)}),S.cursorh&&S.bind(S.cursorh,"touchmove",S.ontouchmoveCursor),S.cursorh&&S.bind(S.cursorh,"touchend",S.ontouchendCursor)),E.cantouch||S.opt.emulatetouch?(S.bind(E.hasmousecapture?S.win:l,"mouseup",S.ontouchend),S.onclick&&S.bind(l,"click",S.onclick),S.opt.cursordragontouch?(S.bind(S.cursor,"mousedown",S.onmousedown),S.bind(S.cursor,"mouseup",S.onmouseup),S.cursorh&&S.bind(S.cursorh,"mousedown",function(e){S.onmousedown(e,!0)}),S.cursorh&&S.bind(S.cursorh,"mouseup",S.onmouseup)):(S.bind(S.rail,"mousedown",function(e){e.preventDefault()}),S.railh&&S.bind(S.railh,"mousedown",function(e){e.preventDefault()}))):(S.bind(E.hasmousecapture?S.win:l,"mouseup",S.onmouseup),S.bind(l,"mousemove",S.onmousemove),S.onclick&&S.bind(l,"click",S.onclick),S.bind(S.cursor,"mousedown",S.onmousedown),S.bind(S.cursor,"mouseup",S.onmouseup),S.railh&&(S.bind(S.cursorh,"mousedown",function(e){S.onmousedown(e,!0)}),S.bind(S.cursorh,"mouseup",S.onmouseup)),!S.ispage&&S.opt.enablescrollonselection&&(S.bind(S.win[0],"mousedown",S.onselectionstart),S.bind(l,"mouseup",S.onselectionend),S.bind(S.cursor,"mouseup",S.onselectionend),S.cursorh&&S.bind(S.cursorh,"mouseup",S.onselectionend),S.bind(l,"mousemove",S.onselectiondrag)),S.zoom&&(S.jqbind(S.zoom,"mouseenter",function(){S.canshowonmouseevent&&S.showCursor(),S.rail.active=!0}),S.jqbind(S.zoom,"mouseleave",function(){S.rail.active=!1,S.rail.drag||S.hideCursor()}))),S.opt.enablemousewheel&&(S.isiframe||S.mousewheel(E.isie&&S.ispage?l:S.win,S.onmousewheel),S.mousewheel(S.rail,S.onmousewheel),S.railh&&S.mousewheel(S.railh,S.onmousewheelhr)),S.ispage||E.cantouch||/HTML|^BODY/.test(S.win[0].nodeName)||(S.win.attr("tabindex")||S.win.attr({tabindex:++r}),S.bind(S.win,"focus",function(e){o=S.getTarget(e).id||!0,S.hasfocus=!0,S.canshowonmouseevent&&S.noticeCursor()}),S.bind(S.win,"blur",function(e){o=!1,S.hasfocus=!1}),S.bind(S.win,"mouseenter",function(e){t=S.getTarget(e).id||!0,S.hasmousefocus=!0,S.canshowonmouseevent&&S.noticeCursor()}),S.bind(S.win,"mouseleave",function(e){t=!1,S.hasmousefocus=!1,S.rail.drag||S.hideCursor()})),S.onkeypress=function(e){if(S.railslocked&&0==S.page.maxh)return!0;e=e||window.e;var r=S.getTarget(e);if(r&&/INPUT|TEXTAREA|SELECT|OPTION/.test(r.nodeName)&&(!r.getAttribute("type")&&!r.type||!/submit|button|cancel/i.tp))return!0;if(n(r).attr("contenteditable"))return!0;if(S.hasfocus||S.hasmousefocus&&!o||S.ispage&&!o&&!t){var i=e.keyCode;if(S.railslocked&&27!=i)return S.cancelEvent(e);var s=e.ctrlKey||!1,l=e.shiftKey||!1,a=!1;switch(i){case 38:case 63233:S.doScrollBy(72),a=!0;break;case 40:case 63235:S.doScrollBy(-72),a=!0;break;case 37:case 63232:S.railh&&(s?S.doScrollLeft(0):S.doScrollLeftBy(72),a=!0);break;case 39:case 63234:S.railh&&(s?S.doScrollLeft(S.page.maxw):S.doScrollLeftBy(-72),a=!0);break;case 33:case 63276:S.doScrollBy(S.view.h),a=!0;break;case 34:case 63277:S.doScrollBy(-S.view.h),a=!0;break;case 36:case 63273:S.railh&&s?S.doScrollPos(0,0):S.doScrollTo(0),a=!0;break;case 35:case 63275:S.railh&&s?S.doScrollPos(S.page.maxw,S.page.maxh):S.doScrollTo(S.page.maxh),a=!0;break;case 32:S.opt.spacebarenabled&&(l?S.doScrollBy(S.view.h):S.doScrollBy(-S.view.h),a=!0);break;case 27:S.zoomactive&&(S.doZoom(),a=!0)}if(a)return S.cancelEvent(e)}},S.opt.enablekeyboard&&S.bind(l,E.isopera&&!E.isopera12?"keypress":"keydown",S.onkeypress),S.bind(l,"keydown",function(e){(e.ctrlKey||!1)&&(S.wheelprevented=!0)}),S.bind(l,"keyup",function(e){e.ctrlKey||!1||(S.wheelprevented=!1)}),S.bind(window,"blur",function(e){S.wheelprevented=!1}),S.bind(window,"resize",S.lazyResize),S.bind(window,"orientationchange",S.lazyResize),S.bind(window,"load",S.lazyResize),E.ischrome&&!S.ispage&&!S.haswrapper){var M=S.win.attr("style"),L=parseFloat(S.win.css("width"))+1;S.win.css("width",L),S.synched("chromefix",function(){S.win.attr("style",M)})}S.onAttributeChange=function(e){S.lazyResize(S.isieold?250:30)},S.opt.enableobserver&&(S.isie11||!1===h||(S.observerbody=new h(function(e){return e.forEach(function(e){return"attributes"==e.type?z.hasClass("modal-open")&&z.hasClass("modal-dialog")&&!n.contains(n(".modal-dialog")[0],S.doc[0])?S.hide():S.show():void 0}),S.me.clientWidth!=S.page.width||S.me.clientHeight!=S.page.height?S.lazyResize(30):void 0}),S.observerbody.observe(l.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),S.ispage||S.haswrapper||(!1!==h?(S.observer=new h(function(e){e.forEach(S.onAttributeChange)}),S.observer.observe(S.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),S.observerremover=new h(function(e){e.forEach(function(e){if(e.removedNodes.length>0)for(var o in e.removedNodes)if(S&&e.removedNodes[o]==S.win[0])return S.remove()})}),S.observerremover.observe(S.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(S.bind(S.win,E.isie&&!E.isie9?"propertychange":"DOMAttrModified",S.onAttributeChange),E.isie9&&S.win[0].attachEvent("onpropertychange",S.onAttributeChange),S.bind(S.win,"DOMNodeRemoved",function(e){e.target==S.win[0]&&S.remove()})))),!S.ispage&&S.opt.boxzoom&&S.bind(window,"resize",S.resizeZoom),S.istextarea&&(S.bind(S.win,"keydown",S.lazyResize),S.bind(S.win,"mouseup",S.lazyResize)),S.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var C=function(){S.iframexd=!1;var o;try{(o="contentDocument"in this?this.contentDocument:this.contentWindow._doc).domain}catch(e){S.iframexd=!0,o=!1}if(S.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(S.forcescreen=!0,S.isiframe&&(S.iframe={doc:n(o),html:S.doc.contents().find("html")[0],body:S.doc.contents().find("body")[0]},S.getContentSize=function(){return{w:Math.max(S.iframe.html.scrollWidth,S.iframe.body.scrollWidth),h:Math.max(S.iframe.html.scrollHeight,S.iframe.body.scrollHeight)}},S.docscroll=n(S.iframe.body)),!E.isios&&S.opt.iframeautoresize&&!S.isiframe){S.win.scrollTop(0),S.doc.height("");var t=Math.max(o.getElementsByTagName("html")[0].scrollHeight,o.body.scrollHeight);S.doc.height(t)}S.lazyResize(30),S.css(n(S.iframe.body),e),E.isios&&S.haswrapper&&S.css(n(o.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?S.bind(this.contentWindow,"scroll",S.onscroll):S.bind(o,"scroll",S.onscroll),S.opt.enablemousewheel&&S.mousewheel(o,S.onmousewheel),S.opt.enablekeyboard&&S.bind(o,E.isopera?"keypress":"keydown",S.onkeypress),E.cantouch?(S.bind(o,"touchstart",S.ontouchstart),S.bind(o,"touchmove",S.ontouchmove)):S.opt.emulatetouch&&(S.bind(o,"mousedown",S.ontouchstart),S.bind(o,"mousemove",function(e){return S.ontouchmove(e,!0)}),S.opt.grabcursorenabled&&E.cursorgrabvalue&&S.css(n(o.body),{cursor:E.cursorgrabvalue})),S.bind(o,"mouseup",S.ontouchend),S.zoom&&(S.opt.dblclickzoom&&S.bind(o,"dblclick",S.doZoom),S.ongesturezoom&&S.bind(o,"gestureend",S.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){C.call(S.doc[0],!1)},500),S.bind(this.doc,"load",C)}},this.showCursor=function(e,o){if(S.cursortimeout&&(clearTimeout(S.cursortimeout),S.cursortimeout=0),S.rail){if(S.autohidedom&&(S.autohidedom.stop().css({opacity:S.opt.cursoropacitymax}),S.cursoractive=!0),S.rail.drag&&1==S.rail.drag.pt||(void 0!==e&&!1!==e&&(S.scroll.y=Math.round(1*e/S.scrollratio.y)),void 0!==o&&(S.scroll.x=Math.round(1*o/S.scrollratio.x))),S.cursor.css({height:S.cursorheight,top:S.scroll.y}),S.cursorh){var t=S.hasreversehr?S.scrollvaluemaxw-S.scroll.x:S.scroll.x;!S.rail.align&&S.rail.visibility?S.cursorh.css({width:S.cursorwidth,left:t+S.rail.width}):S.cursorh.css({width:S.cursorwidth,left:t}),S.cursoractive=!0}S.zoom&&S.zoom.stop().css({opacity:S.opt.cursoropacitymax})}},this.hideCursor=function(e){S.cursortimeout||S.rail&&S.autohidedom&&(S.hasmousefocus&&"leave"==S.opt.autohidemode||(S.cursortimeout=setTimeout(function(){S.rail.active&&S.showonmouseevent||(S.autohidedom.stop().animate({opacity:S.opt.cursoropacitymin}),S.zoom&&S.zoom.stop().animate({opacity:S.opt.cursoropacitymin}),S.cursoractive=!1),S.cursortimeout=0},e||S.opt.hidecursordelay)))},this.noticeCursor=function(e,o,t){S.showCursor(o,t),S.rail.active||S.hideCursor(e)},this.getContentSize=S.ispage?function(){return{w:Math.max(l.body.scrollWidth,l.documentElement.scrollWidth),h:Math.max(l.body.scrollHeight,l.documentElement.scrollHeight)}}:S.haswrapper?function(){return{w:S.doc[0].offsetWidth,h:S.doc[0].offsetHeight}}:function(){return{w:S.docscroll[0].scrollWidth,h:S.docscroll[0].scrollHeight}},this.onResize=function(e,o){if(!S||!S.win)return!1;if(!S.haswrapper&&!S.ispage){if("none"==S.win.css("display"))return S.visibility&&S.hideRail().hideRailHr(),!1;S.hidden||S.visibility||S.showRail().showRailHr()}var t=S.page.maxh,r=S.page.maxw,i={h:S.view.h,w:S.view.w};if(S.view={w:S.ispage?S.win.width():S.win[0].clientWidth,h:S.ispage?S.win.height():S.win[0].clientHeight},S.page=o||S.getContentSize(),S.page.maxh=Math.max(0,S.page.h-S.view.h),S.page.maxw=Math.max(0,S.page.w-S.view.w),S.page.maxh==t&&S.page.maxw==r&&S.view.w==i.w&&S.view.h==i.h){if(S.ispage)return S;var s=S.win.offset();if(S.lastposition){var n=S.lastposition;if(n.top==s.top&&n.left==s.left)return S}S.lastposition=s}return 0===S.page.maxh?(S.hideRail(),S.scrollvaluemax=0,S.scroll.y=0,S.scrollratio.y=0,S.cursorheight=0,S.setScrollTop(0),S.rail&&(S.rail.scrollable=!1)):(S.page.maxh-=S.opt.railpadding.top+S.opt.railpadding.bottom,S.rail.scrollable=!0),0===S.page.maxw?(S.hideRailHr(),S.scrollvaluemaxw=0,S.scroll.x=0,S.scrollratio.x=0,S.cursorwidth=0,S.setScrollLeft(0),S.railh&&(S.railh.scrollable=!1)):(S.page.maxw-=S.opt.railpadding.left+S.opt.railpadding.right,S.railh&&(S.railh.scrollable=S.opt.horizrailenabled)),S.railslocked=S.locked||0===S.page.maxh&&0===S.page.maxw,S.railslocked?(S.ispage||S.updateScrollBar(S.view),!1):(S.hidden||S.visibility?!S.railh||S.hidden||S.railh.visibility||S.showRailHr():S.showRail().showRailHr(),S.istextarea&&S.win.css("resize")&&"none"!=S.win.css("resize")&&(S.view.h-=20),S.cursorheight=Math.min(S.view.h,Math.round(S.view.h*(S.view.h/S.page.h))),S.cursorheight=S.opt.cursorfixedheight?S.opt.cursorfixedheight:Math.max(S.opt.cursorminheight,S.cursorheight),S.cursorwidth=Math.min(S.view.w,Math.round(S.view.w*(S.view.w/S.page.w))),S.cursorwidth=S.opt.cursorfixedheight?S.opt.cursorfixedheight:Math.max(S.opt.cursorminheight,S.cursorwidth),S.scrollvaluemax=S.view.h-S.cursorheight-(S.opt.railpadding.top+S.opt.railpadding.bottom),S.railh&&(S.railh.width=S.page.maxh>0?S.view.w-S.rail.width:S.view.w,S.scrollvaluemaxw=S.railh.width-S.cursorwidth-(S.opt.railpadding.left+S.opt.railpadding.right)),S.ispage||S.updateScrollBar(S.view),S.scrollratio={x:S.page.maxw/S.scrollvaluemaxw,y:S.page.maxh/S.scrollvaluemax},S.getScrollTop()>S.page.maxh?S.doScrollTop(S.page.maxh):(S.scroll.y=Math.round(S.getScrollTop()*(1/S.scrollratio.y)),S.scroll.x=Math.round(S.getScrollLeft()*(1/S.scrollratio.x)),S.cursoractive&&S.noticeCursor()),S.scroll.y&&0==S.getScrollTop()&&S.doScrollTo(Math.floor(S.scroll.y*S.scrollratio.y)),S)},this.resize=S.onResize,this.hlazyresize=0,this.lazyResize=function(e){return S.haswrapper||S.hide(),S.hlazyresize&&clearTimeout(S.hlazyresize),S.hlazyresize=setTimeout(function(){S&&(S.resize(),S.show())},240),S},this.jqbind=function(e,o,t){S.events.push({e:e,n:o,f:t,q:!0}),n(e).bind(o,t)},this.mousewheel=function(e,o,t){var r="jquery"in e?e[0]:e;if("onwheel"in l.createElement("div"))S._bind(r,"wheel",o,t||!1);else{var i=void 0!==l.onmousewheel?"mousewheel":"DOMMouseScroll";y(r,i,o,t||!1),"DOMMouseScroll"==i&&y(r,"MozMousePixelScroll",o,t||!1)}};var R=!1;if(E.haseventlistener){try{var H=Object.defineProperty({},"passive",{get:function(){R=!0}});window.addEventListener("test",null,H)}catch(e){}this.cancelEvent=function(e){return!!e&&((e=e.original?e.original:e).cancelable&&e.preventDefault(),e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),!1)},this.stopPropagation=function(e){return!!e&&((e=e.original?e.original:e).stopPropagation(),!1)}}else Event.prototype.preventDefault=function(){this.returnValue=!1},Event.prototype.stopPropagation=function(){this.cancelBubble=!0},window.constructor.prototype.addEventListener=l.constructor.prototype.addEventListener=Element.prototype.addEventListener=function(e,o,t){this.attachEvent("on"+e,o)},window.constructor.prototype.removeEventListener=l.constructor.prototype.removeEventListener=Element.prototype.removeEventListener=function(e,o,t){this.detachEvent("on"+e,o)},this.cancelEvent=function(e){return!!(e=window.event||!1)&&(e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1,!1)},this.stopPropagation=function(e){return!!(e=window.event||!1)&&(e.cancelBubble=!0,!1)};this.bind=function(e,o,t,r,i){var s="jquery"in e?e[0]:e;S._bind(s,o,t,r||!1,i||!1)},this._bind=function(e,o,t,r,i){S.events.push({e:e,n:o,f:t,b:r,q:!1}),R&&i?e.addEventListener(o,t,{passive:!1,capture:r}):e.addEventListener(o,t,r||!1)},this._unbind=function(e,o,t,r){e.removeEventListener(o,t,r)},this.unbindAll=function(){for(var e=0;e<S.events.length;e++){var o=S.events[e];o.q?o.e.unbind(o.n,o.f):S._unbind(o.e,o.n,o.f,o.b)}},this.showRail=function(){return 0==S.page.maxh||!S.ispage&&"none"==S.win.css("display")||(S.visibility=!0,S.rail.visibility=!0,S.rail.css("display","block")),S},this.showRailHr=function(){return S.railh?(0==S.page.maxw||!S.ispage&&"none"==S.win.css("display")||(S.railh.visibility=!0,S.railh.css("display","block")),S):S},this.hideRail=function(){return S.visibility=!1,S.rail.visibility=!1,S.rail.css("display","none"),S},this.hideRailHr=function(){return S.railh?(S.railh.visibility=!1,S.railh.css("display","none"),S):S},this.show=function(){return S.hidden=!1,S.railslocked=!1,S.showRail().showRailHr()},this.hide=function(){return S.hidden=!0,S.railslocked=!0,S.hideRail().hideRailHr()},this.toggle=function(){return S.hidden?S.show():S.hide()},this.remove=function(){S.stop(),S.cursortimeout&&clearTimeout(S.cursortimeout);for(var e in S.delaylist)S.delaylist[e]&&d(S.delaylist[e].h);S.doZoomOut(),S.unbindAll(),E.isie9&&S.win[0].detachEvent("onpropertychange",S.onAttributeChange),!1!==S.observer&&S.observer.disconnect(),!1!==S.observerremover&&S.observerremover.disconnect(),!1!==S.observerbody&&S.observerbody.disconnect(),S.events=null,S.cursor&&S.cursor.remove(),S.cursorh&&S.cursorh.remove(),S.rail&&S.rail.remove(),S.railh&&S.railh.remove(),S.zoom&&S.zoom.remove();for(var o=0;o<S.saved.css.length;o++){var t=S.saved.css[o];t[0].css(t[1],void 0===t[2]?"":t[2])}S.saved=!1,S.me.data("__nicescroll","");var r=n.nicescroll;r.each(function(e){if(this&&this.id===S.id){delete r[e];for(var o=++e;o<r.length;o++,e++)r[e]=r[o];--r.length&&delete r[r.length]}});for(var i in S)S[i]=null,delete S[i];S=null},this.scrollstart=function(e){return this.onscrollstart=e,S},this.scrollend=function(e){return this.onscrollend=e,S},this.scrollcancel=function(e){return this.onscrollcancel=e,S},this.zoomin=function(e){return this.onzoomin=e,S},this.zoomout=function(e){return this.onzoomout=e,S},this.isScrollable=function(e){var o=e.target?e.target:e;if("OPTION"==o.nodeName)return!0;for(;o&&1==o.nodeType&&o!==this.me[0]&&!/^BODY|HTML/.test(o.nodeName);){var t=n(o),r=t.css("overflowY")||t.css("overflowX")||t.css("overflow")||"";if(/scroll|auto/.test(r))return o.clientHeight!=o.scrollHeight;o=!!o.parentNode&&o.parentNode}return!1},this.getViewport=function(e){for(var o=!(!e||!e.parentNode)&&e.parentNode;o&&1==o.nodeType&&!/^BODY|HTML/.test(o.nodeName);){var t=n(o);if(/fixed|absolute/.test(t.css("position")))return t;var r=t.css("overflowY")||t.css("overflowX")||t.css("overflow")||"";if(/scroll|auto/.test(r)&&o.clientHeight!=o.scrollHeight)return t;if(t.getNiceScroll().length>0)return t;o=!!o.parentNode&&o.parentNode}return!1},this.triggerScrollStart=function(e,o,t,r,i){var s={type:"scrollstart",current:{x:e,y:o},request:{x:t,y:r},end:{x:S.newscrollx,y:S.newscrolly},speed:i};S.onscrollstart.call(S,s)},this.triggerScrollEnd=function(){if(S.onscrollend){var e=S.getScrollLeft(),o=S.getScrollTop(),t={type:"scrollend",current:{x:e,y:o},end:{x:e,y:o}};S.onscrollend.call(S,t)}},this.onmousewheel=function(e){if(!S.wheelprevented){if(S.railslocked)return S.debounced("checkunlock",S.resize,250),!0;if(S.rail.drag)return S.cancelEvent(e);if("auto"===S.opt.oneaxismousemode&&0!==e.deltaX&&(S.opt.oneaxismousemode=!1),S.opt.oneaxismousemode&&0===e.deltaX&&!S.rail.scrollable)return!S.railh||!S.railh.scrollable||S.onmousewheelhr(e);var o=p(),t=!1;if(S.opt.preservenativescrolling&&S.checkarea+600<o&&(S.nativescrollingarea=S.isScrollable(e),t=!0),S.checkarea=o,S.nativescrollingarea)return!0;var r=x(e,!1,t);return r&&(S.checkarea=0),r}},this.onmousewheelhr=function(e){if(!S.wheelprevented){if(S.railslocked||!S.railh.scrollable)return!0;if(S.rail.drag)return S.cancelEvent(e);var o=p(),t=!1;return S.opt.preservenativescrolling&&S.checkarea+600<o&&(S.nativescrollingarea=S.isScrollable(e),t=!0),S.checkarea=o,!!S.nativescrollingarea||(S.railslocked?S.cancelEvent(e):x(e,!0,t))}},this.stop=function(){return S.cancelScroll(),S.scrollmon&&S.scrollmon.stop(),S.cursorfreezed=!1,S.scroll.y=Math.round(S.getScrollTop()*(1/S.scrollratio.y)),S.noticeCursor(),S},this.getTransitionSpeed=function(e){var o=Math.round(10*S.opt.scrollspeed),t=Math.min(o,Math.round(e/20*S.opt.scrollspeed));return t>20?t:0},S.opt.smoothscroll?S.ishwscroll&&E.hastransition&&S.opt.usetransition&&S.opt.smoothscroll?(this.prepareTransition=function(e,o){var t=o?e>20?e:0:S.getTransitionSpeed(e),r=t?E.prefixstyle+"transform "+t+"ms ease-out":"";return S.lasttransitionstyle&&S.lasttransitionstyle==r||(S.lasttransitionstyle=r,S.doc.css(E.transitionstyle,r)),t},this.doScrollLeft=function(e,o){var t=S.scrollrunning?S.newscrolly:S.getScrollTop();S.doScrollPos(e,t,o)},this.doScrollTop=function(e,o){var t=S.scrollrunning?S.newscrollx:S.getScrollLeft();S.doScrollPos(t,e,o)},this.doScrollPos=function(e,o,t){var r=S.getScrollTop(),i=S.getScrollLeft();return((S.newscrolly-r)*(o-r)<0||(S.newscrollx-i)*(e-i)<0)&&S.cancelScroll(),0==S.opt.bouncescroll&&(0>o?o=0:o>S.page.maxh&&(o=S.page.maxh),0>e?e=0:e>S.page.maxw&&(e=S.page.maxw)),(!S.scrollrunning||e!=S.newscrollx||o!=S.newscrolly)&&(S.newscrolly=o,S.newscrollx=e,S.newscrollspeed=t||!1,!S.timer&&void(S.timer=setTimeout(function(){var t=S.getScrollTop(),r=S.getScrollLeft(),i={};i.x=e-r,i.y=o-t,i.px=r,i.py=t;var s=Math.round(Math.sqrt(Math.pow(i.x,2)+Math.pow(i.y,2))),n=S.newscrollspeed&&S.newscrollspeed>1?S.newscrollspeed:S.getTransitionSpeed(s);if(S.newscrollspeed&&S.newscrollspeed<=1&&(n*=S.newscrollspeed),S.prepareTransition(n,!0),S.timerscroll&&S.timerscroll.tm&&clearInterval(S.timerscroll.tm),n>0){!S.scrollrunning&&S.onscrollstart&&S.triggerScrollStart(r,t,e,o,n),E.transitionend?S.scrollendtrapped||(S.scrollendtrapped=!0,S.bind(S.doc,E.transitionend,S.onScrollTransitionEnd,!1)):(S.scrollendtrapped&&clearTimeout(S.scrollendtrapped),S.scrollendtrapped=setTimeout(S.onScrollTransitionEnd,n));var l=t,a=r;S.timerscroll={bz:new C(l,S.newscrolly,n,0,0,.58,1),bh:new C(a,S.newscrollx,n,0,0,.58,1)},S.cursorfreezed||(S.timerscroll.tm=setInterval(function(){S.showCursor(S.getScrollTop(),S.getScrollLeft())},60))}S.synched("doScroll-set",function(){S.timer=0,S.scrollendtrapped&&(S.scrollrunning=!0),S.setScrollTop(S.newscrolly),S.setScrollLeft(S.newscrollx),S.scrollendtrapped||S.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!S.scrollendtrapped)return!0;var e=S.getScrollTop(),o=S.getScrollLeft();return S.scrollrunning=!1,E.transitionend||clearTimeout(E.transitionend),S.scrollendtrapped=!1,S._unbind(S.doc[0],E.transitionend,S.onScrollTransitionEnd),S.prepareTransition(0),S.setScrollTop(e),S.railh&&S.setScrollLeft(o),S.timerscroll&&S.timerscroll.tm&&clearInterval(S.timerscroll.tm),S.timerscroll=!1,S.cursorfreezed=!1,S.showCursor(e,o),S},this.onScrollTransitionEnd=function(){S.scrollendtrapped&&S._unbind(S.doc[0],E.transitionend,S.onScrollTransitionEnd),S.scrollendtrapped=!1,S.prepareTransition(0),S.timerscroll&&S.timerscroll.tm&&clearInterval(S.timerscroll.tm),S.timerscroll=!1;var e=S.getScrollTop(),o=S.getScrollLeft();return S.setScrollTop(e),S.railh&&S.setScrollLeft(o),S.noticeCursor(!1,e,o),S.cursorfreezed=!1,0>e?e=0:e>S.page.maxh&&(e=S.page.maxh),0>o?o=0:o>S.page.maxw&&(o=S.page.maxw),e!=S.newscrolly||o!=S.newscrollx?S.doScrollPos(o,e,S.opt.snapbackspeed):(S.onscrollend&&S.scrollrunning&&S.triggerScrollEnd(),void(S.scrollrunning=!1))}):(this.doScrollLeft=function(e,o){var t=S.scrollrunning?S.newscrolly:S.getScrollTop();S.doScrollPos(e,t,o)},this.doScrollTop=function(e,o){var t=S.scrollrunning?S.newscrollx:S.getScrollLeft();S.doScrollPos(t,e,o)},this.doScrollPos=function(e,o,t){function r(){if(S.cancelAnimationFrame)return!0;if(S.scrollrunning=!0,h=1-h)return S.timer=c(r)||1;var e,o,t=0,i=o=S.getScrollTop();S.dst.ay?(((n=(i=S.bzscroll?S.dst.py+S.bzscroll.getNow()*S.dst.ay:S.newscrolly)-o)<0&&i<S.newscrolly||n>0&&i>S.newscrolly)&&(i=S.newscrolly),S.setScrollTop(i),i==S.newscrolly&&(t=1)):t=1;var s=e=S.getScrollLeft();if(S.dst.ax){var n=(s=S.bzscroll?S.dst.px+S.bzscroll.getNow()*S.dst.ax:S.newscrollx)-e;(0>n&&s<S.newscrollx||n>0&&s>S.newscrollx)&&(s=S.newscrollx),S.setScrollLeft(s),s==S.newscrollx&&(t+=1)}else t+=1;2==t?(S.timer=0,S.cursorfreezed=!1,S.bzscroll=!1,S.scrollrunning=!1,0>i?i=0:i>S.page.maxh&&(i=Math.max(0,S.page.maxh)),0>s?s=0:s>S.page.maxw&&(s=S.page.maxw),s!=S.newscrollx||i!=S.newscrolly?S.doScrollPos(s,i):S.onscrollend&&S.triggerScrollEnd()):S.timer=c(r)||1}var o=void 0===o||!1===o?S.getScrollTop(!0):o;if(S.timer&&S.newscrolly==o&&S.newscrollx==e)return!0;S.timer&&d(S.timer),S.timer=0;var i=S.getScrollTop(),s=S.getScrollLeft();((S.newscrolly-i)*(o-i)<0||(S.newscrollx-s)*(e-s)<0)&&S.cancelScroll(),S.newscrolly=o,S.newscrollx=e,S.bouncescroll&&S.rail.visibility||(S.newscrolly<0?S.newscrolly=0:S.newscrolly>S.page.maxh&&(S.newscrolly=S.page.maxh)),S.bouncescroll&&S.railh.visibility||(S.newscrollx<0?S.newscrollx=0:S.newscrollx>S.page.maxw&&(S.newscrollx=S.page.maxw)),S.dst={},S.dst.x=e-s,S.dst.y=o-i,S.dst.px=s,S.dst.py=i;var n=Math.round(Math.sqrt(Math.pow(S.dst.x,2)+Math.pow(S.dst.y,2)));S.dst.ax=S.dst.x/n,S.dst.ay=S.dst.y/n;var l=0,a=n;0==S.dst.x?(l=i,a=o,S.dst.ay=1,S.dst.py=0):0==S.dst.y&&(l=s,a=e,S.dst.ax=1,S.dst.px=0);var u=S.getTransitionSpeed(n);if(t&&1>=t&&(u*=t),S.bzscroll=u>0&&(S.bzscroll?S.bzscroll.update(a,u):new C(l,a,u,0,1,0,1)),!S.timer){(i==S.page.maxh&&o>=S.page.maxh||s==S.page.maxw&&e>=S.page.maxw)&&S.checkContentSize();var h=1;S.cancelAnimationFrame=!1,S.timer=1,S.onscrollstart&&!S.scrollrunning&&S.triggerScrollStart(s,i,e,o,u),
r(),(i==S.page.maxh&&o>=i||s==S.page.maxw&&e>=s)&&S.checkContentSize(),S.noticeCursor()}},this.cancelScroll=function(){return S.timer&&d(S.timer),S.timer=0,S.bzscroll=!1,S.scrollrunning=!1,S}):(this.doScrollLeft=function(e,o){var t=S.getScrollTop();S.doScrollPos(e,t,o)},this.doScrollTop=function(e,o){var t=S.getScrollLeft();S.doScrollPos(t,e,o)},this.doScrollPos=function(e,o,t){var r=e>S.page.maxw?S.page.maxw:e;0>r&&(r=0);var i=o>S.page.maxh?S.page.maxh:o;0>i&&(i=0),S.synched("scroll",function(){S.setScrollTop(i),S.setScrollLeft(r)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,o){var t=0;if(t=o?Math.floor((S.scroll.y-e)*S.scrollratio.y):(S.timer?S.newscrolly:S.getScrollTop(!0))-e,S.bouncescroll){var r=Math.round(S.view.h/2);-r>t?t=-r:t>S.page.maxh+r&&(t=S.page.maxh+r)}S.cursorfreezed=!1;var i=S.getScrollTop(!0);return 0>t&&0>=i?S.noticeCursor():t>S.page.maxh&&i>=S.page.maxh?(S.checkContentSize(),S.noticeCursor()):void S.doScrollTop(t)},this.doScrollLeftBy=function(e,o){var t=0;if(t=o?Math.floor((S.scroll.x-e)*S.scrollratio.x):(S.timer?S.newscrollx:S.getScrollLeft(!0))-e,S.bouncescroll){var r=Math.round(S.view.w/2);-r>t?t=-r:t>S.page.maxw+r&&(t=S.page.maxw+r)}S.cursorfreezed=!1;var i=S.getScrollLeft(!0);return 0>t&&0>=i?S.noticeCursor():t>S.page.maxw&&i>=S.page.maxw?S.noticeCursor():void S.doScrollLeft(t)},this.doScrollTo=function(e,o){var t=o?Math.round(e*S.scrollratio.y):e;0>t?t=0:t>S.page.maxh&&(t=S.page.maxh),S.cursorfreezed=!1,S.doScrollTop(e)},this.checkContentSize=function(){var e=S.getContentSize();e.h==S.page.h&&e.w==S.page.w||S.resize(!1,e)},S.onscroll=function(e){S.rail.drag||S.cursorfreezed||S.synched("scroll",function(){S.scroll.y=Math.round(S.getScrollTop()*(1/S.scrollratio.y)),S.railh&&(S.scroll.x=Math.round(S.getScrollLeft()*(1/S.scrollratio.x))),S.noticeCursor()})},S.bind(S.docscroll,"scroll",S.onscroll),this.doZoomIn=function(e){if(!S.zoomactive){S.zoomactive=!0,S.zoomrestore={style:{}};var o=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],t=S.win[0].style;for(var r in o){var i=o[r];S.zoomrestore.style[i]=void 0!==t[i]?t[i]:""}S.zoomrestore.style.width=S.win.css("width"),S.zoomrestore.style.height=S.win.css("height"),S.zoomrestore.padding={w:S.win.outerWidth()-S.win.width(),h:S.win.outerHeight()-S.win.height()},E.isios4&&(S.zoomrestore.scrollTop=a.scrollTop(),a.scrollTop(0)),S.win.css({position:E.isios4?"absolute":"fixed",top:0,left:0,zIndex:s+100,margin:0});var n=S.win.css("backgroundColor");return(""==n||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(n))&&S.win.css("backgroundColor","#fff"),S.rail.css({zIndex:s+101}),S.zoom.css({zIndex:s+102}),S.zoom.css("backgroundPosition","0 -18px"),S.resizeZoom(),S.onzoomin&&S.onzoomin.call(S),S.cancelEvent(e)}},this.doZoomOut=function(e){return S.zoomactive?(S.zoomactive=!1,S.win.css("margin",""),S.win.css(S.zoomrestore.style),E.isios4&&a.scrollTop(S.zoomrestore.scrollTop),S.rail.css({"z-index":S.zindex}),S.zoom.css({"z-index":S.zindex}),S.zoomrestore=!1,S.zoom.css("backgroundPosition","0 0"),S.onResize(),S.onzoomout&&S.onzoomout.call(S),S.cancelEvent(e)):void 0},this.doZoom=function(e){return S.zoomactive?S.doZoomOut(e):S.doZoomIn(e)},this.resizeZoom=function(){if(S.zoomactive){var e=S.getScrollTop();S.win.css({width:a.width()-S.zoomrestore.padding.w+"px",height:a.height()-S.zoomrestore.padding.h+"px"}),S.onResize(),S.setScrollTop(Math.min(S.page.maxh,e))}},this.init(),n.nicescroll.push(this)},v=function(e){var o=this;this.nc=e,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.reset=function(e,t){o.stop(),o.steptime=0,o.lasttime=p(),o.speedx=0,o.speedy=0,o.lastx=e,o.lasty=t,o.lastscrollx=-1,o.lastscrolly=-1},this.update=function(e,t){var r=p();o.steptime=r-o.lasttime,o.lasttime=r;var i=t-o.lasty,s=e-o.lastx,n=o.nc.getScrollTop()+i,l=o.nc.getScrollLeft()+s;o.snapx=0>l||l>o.nc.page.maxw,o.snapy=0>n||n>o.nc.page.maxh,o.speedx=s,o.speedy=i,o.lastx=e,o.lasty=t},this.stop=function(){o.nc.unsynched("domomentum2d"),o.timer&&clearTimeout(o.timer),o.timer=0,o.lastscrollx=-1,o.lastscrolly=-1},this.doSnapy=function(e,t){var r=!1;0>t?(t=0,r=!0):t>o.nc.page.maxh&&(t=o.nc.page.maxh,r=!0),0>e?(e=0,r=!0):e>o.nc.page.maxw&&(e=o.nc.page.maxw,r=!0),r?o.nc.doScrollPos(e,t,o.nc.opt.snapbackspeed):o.nc.triggerScrollEnd()},this.doMomentum=function(e){var t=p(),r=e?t+e:o.lasttime,i=o.nc.getScrollLeft(),s=o.nc.getScrollTop(),n=o.nc.page.maxh,l=o.nc.page.maxw;o.speedx=l>0?Math.min(60,o.speedx):0,o.speedy=n>0?Math.min(60,o.speedy):0;var a=r&&60>=t-r;(0>s||s>n||0>i||i>l)&&(a=!1);var c=!(!o.speedy||!a)&&o.speedy,d=!(!o.speedx||!a)&&o.speedx;if(c||d){var u=Math.max(16,o.steptime);if(u>50){var h=u/50;o.speedx*=h,o.speedy*=h,u=50}o.demulxy=0,o.lastscrollx=o.nc.getScrollLeft(),o.chkx=o.lastscrollx,o.lastscrolly=o.nc.getScrollTop(),o.chky=o.lastscrolly;var m=o.lastscrollx,f=o.lastscrolly,g=function(){var e=p()-t>600?.04:.02;o.speedx&&(m=Math.floor(o.lastscrollx-o.speedx*(1-o.demulxy)),o.lastscrollx=m,(0>m||m>l)&&(e=.1)),o.speedy&&(f=Math.floor(o.lastscrolly-o.speedy*(1-o.demulxy)),o.lastscrolly=f,(0>f||f>n)&&(e=.1)),o.demulxy=Math.min(1,o.demulxy+e),o.nc.synched("domomentum2d",function(){o.speedx&&(o.nc.getScrollLeft(),o.chkx=m,o.nc.setScrollLeft(m)),o.speedy&&(o.nc.getScrollTop(),o.chky=f,o.nc.setScrollTop(f)),o.timer||(o.nc.hideCursor(),o.doSnapy(m,f))}),o.demulxy<1?o.timer=setTimeout(g,u):(o.stop(),o.nc.hideCursor(),o.doSnapy(m,f))};g()}else o.doSnapy(o.nc.getScrollLeft(),o.nc.getScrollTop())}},b=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(e,o,t){var r=n.data(e,"__nicescroll")||!1;return r&&r.ishwscroll?r.getScrollTop():b.call(e)},set:function(e,o){var t=n.data(e,"__nicescroll")||!1;return t&&t.ishwscroll?t.setScrollTop(parseInt(o)):b.call(e,o),this}},e.fn.scrollTop=function(e){if(void 0===e){var o=!!this[0]&&(n.data(this[0],"__nicescroll")||!1);return o&&o.ishwscroll?o.getScrollTop():b.call(this)}return this.each(function(){var o=n.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollTop(parseInt(e)):b.call(n(this),e)})};var y=e.fn.scrollLeft;n.cssHooks.pageXOffset={get:function(e,o,t){var r=n.data(e,"__nicescroll")||!1;return r&&r.ishwscroll?r.getScrollLeft():y.call(e)},set:function(e,o){var t=n.data(e,"__nicescroll")||!1;return t&&t.ishwscroll?t.setScrollLeft(parseInt(o)):y.call(e,o),this}},e.fn.scrollLeft=function(e){if(void 0===e){var o=!!this[0]&&(n.data(this[0],"__nicescroll")||!1);return o&&o.ishwscroll?o.getScrollLeft():y.call(this)}return this.each(function(){var o=n.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollLeft(parseInt(e)):y.call(n(this),e)})};var x=function(e){var o=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){return n.each(o,e),o},this.push=function(e){o[o.length]=e,o.length++},this.eq=function(e){return o[e]},e)for(var t=0;t<e.length;t++){var r=n.data(e[t],"__nicescroll")||!1;r&&(this[this.length]=r,this.length++)}return this};!function(e,o,t){for(var r=0,i=o.length;i>r;r++)t(e,o[r])}(x.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos"],function(e,o){e[o]=function(){var e=arguments;return this.each(function(){this[o].apply(this,e)})}}),e.fn.getNiceScroll=function(e){return void 0===e?new x(this):this[e]&&n.data(this[e],"__nicescroll")||!1},e.expr[":"].nicescroll=function(e){return void 0!==n.data(e,"__nicescroll")},n.fn.niceScroll=function(e,o){void 0!==o||"object"!=typeof e||"jquery"in e||(o=e,e=!1);var t=new x;return this.each(function(){var r=n(this),i=n.extend({},o);if(e){var s=n(e);i.doc=s.length>1?n(e,r):s,i.win=r}!("doc"in i)||"win"in i||(i.win=r);var l=r.data("__nicescroll")||!1;l||(i.doc=i.doc||r,l=new w(i,r),r.data("__nicescroll",l)),t.push(l)}),1===t.length?t[0]:t},window.NiceScroll={getjQuery:function(){return e}},n.nicescroll||(n.nicescroll=new x,n.nicescroll.options=m)}),angular.module("ibartarApp").filter("cut",function(){return function(value,wordwise,max,tail){if(!value)return"";if(max=parseInt(max,10),!max)return value;if(value.length<=max)return value;if(value=value.substr(0,max),wordwise){var lastspace=value.lastIndexOf(" ");-1!=lastspace&&(value=value.substr(0,lastspace))}return value+tail}}),angular.module("ibartarApp").filter("persianNumber",function(){return function(value){if(!value)return"";var s=value.toString();return s=s.replace(/1/g,"۱").replace(/2/g,"۲").replace(/3/g,"۳").replace(/4/g,"۴").replace(/5/g,"۵").replace(/6/g,"۶").replace(/7/g,"۷").replace(/8/g,"۸").replace(/9/g,"۹").replace(/0/g,"۰")}}),angular.module("ibartarApp").filter("englishNumber",function(){return function(value){if(!value)return"";var s=value.toString();return s=s.replace(/۱/g,"1").replace(/۲/g,"2").replace(/۳/g,"3").replace(/۴/g,"4").replace(/۵/g,"5").replace(/۶/g,"6").replace(/۷/g,"7").replace(/۸/g,"8").replace(/۹/g,"9").replace(/۰/g,"0")}});var IB=IB||{};IB.FA={crowd:"خوداظهاری",crm:"CRM"},angular.module("ibartarApp").filter("range",function(){return function(n){for(var res=[],i=0;n>i;i++)res.push(i);return res}}),angular.module("ibartarApp").filter("monthName",[function(){return function(monthNumber){var monthNames=["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"];return monthNames[monthNumber-1]}}]),angular.module("ibartarApp").filter("propsFilter",function(){return function(items,props){var out=[];if(angular.isArray(items)){var keys=Object.keys(props);items.forEach(function(item){for(var itemMatches=!1,i=0;i<keys.length;i++){var prop=keys[i],text=props[prop].toLowerCase();if(-1!==item[prop].toString().toLowerCase().indexOf(text)){itemMatches=!0;break}}itemMatches&&out.push(item)})}else out=items;return out}}),angular.module("ibartarApp").directive("scroller",function(){return{restrict:"A",link:function(scope,elem,attrs){var rawElement=elem[0],thisOptions=scope[attrs.scrollOptions];elem.bind("scroll",function(){rawElement.scrollTop+rawElement.offsetHeight+thisOptions.offset>=rawElement.scrollHeight&&thisOptions.scrollToBotFunc()})}}}),angular.module("ibartarApp").directive("autocompeleforsearch",function(suggestion,channelService){return{restrict:"A",scope:{options:"="},template:function(){return'<div class="SuggestionSearchResult" ng-show="(Jobs.length > 0 || guilds.length > 0 || keywords.length > 0)"><div class="row"><div class="col-xs-6"><div class="titleForSeaerchSuggestion"><i class="icon-down-dir"></i>کسب و کارهای مرتبط</div><div class="ListForSuggestions"><a ng-click="SetChannel($index+1)" class="SearchSuggItem" ng-repeat="Job in Jobs" ui-sref="show({uuid: Job.payload.uuid, title: Job.text})" ng-class="{\'SelectedItemByKeyboard\':($index == SelectedItemByKeyboardIndex && SelctionItemSectionNum == 0)}"><i class="icon-left-dir"></i>{{Job.text | cut:true:30:".." }}</a></div></div><div class="col-xs-6 RightBorderedForSuggestionsBox"  ng-show="guilds.length > 0"><div class="titleForSeaerchSuggestion"><i class="icon-down-dir"></i>گروه های پیشنهادی</div><div class="ListForSuggestions"><a class="SearchSuggItem" ng-repeat="guild in guilds" ng-click="FillInput(guild.text)"  href="/search?q={{guild.text}}" ng-class="{\'SelectedItemByKeyboard\':($index == SelectedItemByKeyboardIndex && SelctionItemSectionNum == 1)}"><i class="icon-left-dir"></i>{{guild.text}}</a></div></div></div><div class="KeyWordsSuggestionForSearch"><div class="titleForSeaerchSuggestion"><i class="icon-down-dir"></i>خدمات و امکانات مرتبط</div><div class="TagSuggItem" ng-repeat="keyword in keywords" ng-click="FillInput(\'#\'+keyword.text)" ng-class="{\'SelectedItemByKeyboard\':($index == SelectedItemByKeyboardIndex && SelctionItemSectionNum == 2)}">{{keyword.text | cut:true:10:".."}}</div></div></div><div class="CloseBackground" ng-show="(Jobs.length > 0)" ng-click="options.clearSearch()"></div>'},link:function(scope,iElm,iAttrs){scope.SelectedItemByKeyboardIndex=-1,scope.SelctionItemSectionNum=0;var prevRequests,TypedQuery;scope.options.runsearch=function(Query){TypedQuery=Query,scope.SelectedItemByKeyboardIndex=-1,scope.SelctionItemSectionNum=0,prevRequests&&prevRequests.cancel();var request=suggestion.getByQuery(Query);prevRequests=request,request.promise.then(function(result){scope.Jobs=result.title_suggest[0].options,scope.guilds=result.guild_suggest[0].options,scope.keywords=result.keyword_suggest[0].options})},scope.FillInput=function(val){scope.options.FillInput(val),scope.options.clearSearch()},scope.options.clearSearch=function(){scope.SelectedItemByKeyboardIndex=-1,scope.SelctionItemSectionNum=0,scope.Jobs=[],scope.guilds=[],scope.keywords=[]},scope.options.keyActions=function(event,keyCode){if(40==keyCode){event.preventDefault();var valueToCompare;switch(scope.SelctionItemSectionNum){case 0:valueToCompare=scope.Jobs.length-1;break;case 1:valueToCompare=scope.guilds.length-1;break;case 3:valueToCompare=scope.keywords.length-1}scope.SelectedItemByKeyboardIndex<valueToCompare?scope.SelectedItemByKeyboardIndex+=1:2!=scope.SelctionItemSectionNum&&(scope.SelctionItemSectionNum+=1,scope.SelectedItemByKeyboardIndex=0)}if(38==keyCode)if(event.preventDefault(),0!=scope.SelectedItemByKeyboardIndex)scope.SelectedItemByKeyboardIndex-=1;else if(0!=scope.SelctionItemSectionNum)switch(scope.SelctionItemSectionNum-=1,scope.SelctionItemSectionNum){case 0:scope.SelectedItemByKeyboardIndex=scope.Jobs.length-1;break;case 1:scope.SelectedItemByKeyboardIndex=scope.guilds.length-1}27==keyCode&&(event.preventDefault(),scope.options.clearSearch()),13==keyCode&&-1!=scope.SelectedItemByKeyboardIndex&&(event.preventDefault(),setTimeout(function(){jQuery(".SelectedItemByKeyboard").click(),scope.options.clearSearch(),scope.$apply()},0)),9==keyCode&&(scope.Jobs.length>0||scope.guilds.lengh>0||scope.keywords.length>0)&&(-1==scope.SelectedItemByKeyboardIndex?scope.options.clearSearch():(event.preventDefault(),scope.SelectedItemByKeyboardIndex=0,2!=scope.SelctionItemSectionNum?scope.SelctionItemSectionNum++:scope.SelctionItemSectionNum=0))},scope.SetChannel=function(indexChannel){channelService.setChannel("suggestion",{chanel_details:indexChannel,q:TypedQuery})}}}}),angular.module("ibartarApp").directive("autocompeleforareasearch",function(AreaSuggestion){return{restrict:"A",scope:{options:"="},template:function(){return'<div class="SuggestionSearchResult" ng-show="(areas.length > 0)"><div class="row"><div class="col-xs-12"><div class="ListForSuggestions"><div class="SearchSuggItem" ng-repeat="area in areas" ng-click="FillInput(area.formatted_address)" ng-click="FillInput(keyword.text)" ng-class="{\'SelectedItemByKeyboard\':($index == SelectedItemByKeyboardIndex)}"><i class="icon-left-dir"></i>{{area.formatted_address}}</div></div></div></div></div><div class="CloseBackground" ng-show="(areas.length > 0)" ng-click="areas = []"></div>'},link:function(scope,iElm,iAttrs){scope.SelectedItemByKeyboardIndex=-1;var prevRequests;scope.options.runsearch=function(Query){prevRequests&&prevRequests.cancel();var request=AreaSuggestion.getByQuery(Query);prevRequests=request,request.promise.then(function(result){scope.areas=result.data})},scope.FillInput=function(val){scope.options.FillInput(val),scope.options.clearSearch()},scope.options.clearSearch=function(){scope.areas=[],scope.SelectedItemByKeyboardIndex=-1},scope.options.keyActions=function(event,keyCode){40==keyCode&&(event.preventDefault(),scope.SelectedItemByKeyboardIndex<scope.areas.length-1&&(scope.SelectedItemByKeyboardIndex+=1)),38==keyCode&&(event.preventDefault(),0!=scope.SelectedItemByKeyboardIndex&&(scope.SelectedItemByKeyboardIndex-=1)),27==keyCode&&(event.preventDefault(),scope.options.clearSearch()),13==keyCode&&-1!=scope.SelectedItemByKeyboardIndex&&(event.preventDefault(),setTimeout(function(){jQuery(".SelectedItemByKeyboard").click(),scope.options.clearSearch(),scope.$apply()}))}}}}),angular.module("ibartarApp").directive("scrollPosition",function(){return{scope:{scroll:"=scrollPosition"},link:function(scope,element,iElm,attrs){var RawElement=element[0],handler=function(){scope.scroll=RawElement.scrollTop,scope.$apply()};iElm.$$element.scroll(function(event){handler()})}}}),angular.module("ibartarApp").directive("guildSelector",function(utils,notifications){return{restrict:"A",scope:{input:"=",model:"=",pselectable:"=",nolimit:"=",changeEvent:"="},template:function(){return'<div class="form-group relative normalLineHeight"><div class="input-group cursorpointer" ng-click=" showJobList = true; reusltsForSame = {}"><div class="input-group-addon"><i class="icon-suitcase"></i></div><div class="BtnInputStyle">گروه کسب و کار<span class="pull-left"><i class="icon-down-open"></i></span></div></div><div class="CloseBackground" ng-show="showJobList" ng-click="showJobList = false"></div><div class="dropdownWindow" ng-show="showJobList" ng-init="SearchInGuild = \'\'"><div class="JobListContainer"><div class="SearchInGuildList"><div class="form-group"><div class="input-group"><div class="input-group-addon"><i class="icon-search"></i></div><input type="text" ng-model="SearchInGuild" class="form-control" placeholder="جستجو"></div></div></div><div class="GuildListContainer"><div class="GuildListContainer"><div class="jobPackage" ng-repeat="JobPackage in JobPackages | filter: search"><hr><div class="childrens checkboxFive relative" ng-if="parentSelectable"><input type="checkbox" id="JobId{{JobPackage.id}}" ng-model="JobsIdSelected[JobPackage.id]" ng-change="addRemoveArr()"><label class="BoldTitle" for="JobId{{JobPackage.id}}">{{JobPackage.title}}</label></div><span ng-if="!parentSelectable">{{JobPackage.title}}</span><hr><div class="childrens checkboxFive relative" ng-repeat="children in JobPackage.children | filter: {title: SearchInGuild}" ><input type="checkbox" id="JobId{{children.id}}" ng-model="JobsIdSelected[children.id]" ng-change="addRemoveArr()"><label for="JobId{{children.id}}">{{children.title}}</label></div></div></div></div></div></div><div class="container-fluid"><div class="row"><div class="span12"><div class="JobsSelected"><div class="filteredItem AppearAnimation transitionAnimated" ng-repeat="jobId in model"><i class="icon-cancel CancelFilter" ng-click="RemoveTagGFilter(jobId)"></i><span ng-repeat="JobPackage in JobPackages"><span ng-if="JobPackage.id == jobId">{{JobPackage.title}}</span><span ng-repeat="children in JobPackage.children" ng-if="jobId == children.id">{{children.title}}</span><span ng-repeat="children in JobPackage" ng-if="jobId == children.id">{{children.title}}</span></span></div></div></div></div></div></div></div>'},link:function(scope,iElm,attrs){scope.JobPackages=scope.input,scope.parentSelectable=!1,scope.noLimit=scope.nolimit,scope.pselectable&&(scope.parentSelectable=scope.pselectable),scope.JobsIdSelected={},scope.JobPackages.forEach(function(JobPackage){JobPackage.children.forEach(function(childId){return-1==scope.model.indexOf(childId)?void(scope.JobsIdSelected[childId]=!1):void(scope.JobsIdSelected[childId]=!0)})}),scope.addRemoveArr=function(){for(var guildId in scope.JobsIdSelected)scope.JobsIdSelected[guildId]?-1==scope.model.indexOf(guildId)&&(scope.model.length<3||scope.noLimit?scope.model.push(guildId):(notifications.showError("امکان اضافه کردن بیش از سه مورد وجود ندارد"),scope.RemoveTagGFilter(guildId))):-1!=scope.model.indexOf(guildId)&&(scope.model=utils.ArrRemove(scope.model,guildId));scope.changeEvent&&"function"==typeof scope.changeEvent&&scope.changeEvent()},scope.RemoveTagGFilter=function(id){scope.JobsIdSelected[id]=!1,scope.addRemoveArr()},scope.search=function(JobPackage){if(void 0===scope.SearchInGuild||0===scope.SearchInGuild.length)return!0;var match=!1;return angular.forEach(JobPackage.children,function(children){children.title.indexOf(scope.SearchInGuild)>-1&&(match=!0)}),match}}}}),angular.module("ibartarApp").directive("scrollTo",function($timeout){return{restrict:"A",link:function(scope,iElm,iAttrs){var offsetVal=iAttrs.offset;$timeout(function(){iElm.click(function(event){event.preventDefault();var Elmposition=jQuery("#"+iAttrs.scrollTo).offset().top;if(offsetVal)var ScrollingVal=Elmposition-offsetVal;jQuery("html, body").animate({scrollTop:ScrollingVal},500)})},0)}}}),angular.module("ibartarApp").directive("confirmation",function(){return{restrict:"A",link:function(scope,element,attrs){element.bind("click",function(event){var msg=attrs.confirmation,clickAction=attrs.action,clickActionInput=attrs.actioninput;if(window.confirm(msg)){var ThisFunc=scope.$eval(clickAction);ThisFunc(clickActionInput)}else event.stopImmediatePropagation(),event.preventDefault()})}}}),angular.module("ibartarApp").directive("tooltip",function(){return{restrict:"A",link:function(scope,element,attrs){$(element).hasClass("OpenDefaultTooltip")&&setTimeout(function(){$(element).tooltip("show")},500),$(element).hover(function(){jQuery("*").tooltip("hide"),$(element).tooltip("show")},function(){$(element).tooltip("hide")})}}}),angular.module("ibartarApp").directive("focusMe",function($timeout,$parse){return{link:function(scope,element,attrs){var model=$parse(attrs.focusMe);scope.$watch(model,function(value){value===!0&&$timeout(function(){element[0].focus()})}),element.bind("blur",function(){"function"==typeof model.assign&&scope.$apply(model.assign(scope,!1))})}}}),angular.module("ibartarApp").directive("fileDrop",function(){return{restrict:"A",scope:{file:"=",callback:"="},link:function(scope,element,attrs){var DataTransfer=function(event){return event.dataTransfer||event.originalEvent.dataTransfer},processDrag=function(event){return event&&(event.preventDefault&&event.preventDefault(),event.stopPropagation)?!1:(DataTransfer(event).effectAllowed="copy",!1)};return element.bind("dragover",processDrag),element.bind("dragenter",processDrag),element.bind("drop",function(event){var file;null!=event&&event.preventDefault();var reader=new FileReader;return reader.onload=function(evt){scope.$apply(function(){return scope.callback&&"function"==typeof scope.callback&&scope.callback(evt.target.result),scope.file=evt.target.result})},file=DataTransfer(event).files[0],reader.readAsDataURL(file),!1})}}}),angular.module("ibartarApp").directive("modalIbartar",function($state){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true" ng-click="close()"><i class="icon-cancel"></i></button><h4 class="modal-title">{{title}}</h4></div><div class="modal-body" ng-transclude></div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:{visible:"=",onSown:"&",onHide:"&"},link:function(scope,element,attrs){scope.title=attrs.title,$(element).modal({show:!1,keyboard:attrs.keyboard,backdrop:attrs.backdrop}),scope.$watch(function(){return scope.visible},function(value){1==value?$(element).modal("show"):$(element).modal("hide")}),$(element).on("shown.bs.modal",function(){scope.$apply(function(){scope.$parent[attrs.visible]=!0})}),$(element).on("shown.bs.modal",function(){scope.$apply(function(){scope.onSown({})})}),$(element).on("hidden.bs.modal",function(){scope.$apply(function(){scope.$parent[attrs.visible]=!1})}),$(element).on("hidden.bs.modal",function(){scope.$apply(function(){scope.onHide({})})})}}}),angular.module("ibartarApp").directive("setClassWhenAtTop",function($window){var $win=angular.element($window);return{restrict:"A",link:function(scope,element,attrs){var topClass=attrs.setClassWhenAtTop;element.offset().top;$win.on("scroll",function(e){var positionScroll=$win.scrollTop()+270;1500>=positionScroll?element.addClass(topClass):element.removeClass(topClass)})}}}),angular.module("ibartarApp").directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){modelSetter(scope,element[0].files[0])})})}}}]),angular.module("ibartarApp").directive("scroll",function($window){return function(scope,element,attrs){angular.element($window).bind("scroll",function(){this.pageYOffset>=100,scope.$apply()})}}),!function(root,factory){"object"==typeof exports?module.exports=factory(root,require("angular")):"function"==typeof define&&define.amd?define(["angular"],function(angular){return root.ngNotificationsBar=factory(root,angular)}):root.ngNotificationsBar=factory(root,root.angular)}(this,function(window,angular){var module=angular.module("ngNotificationsBar",[]);return module.provider("notificationsConfig",function(){function setHideDelay(value){config.hideDelay=value}function getHideDelay(){return config.hideDelay}function setLogo(value){config.logo=value}function getLogo(){return config.logo}function setAcceptHTML(value){config.acceptHTML=value}function getAcceptHTML(){return config.acceptHTML}function setAutoHide(value){config.autoHide=value}function getAutoHide(){return config.autoHide}var config={};return{setHideDelay:setHideDelay,setAutoHide:setAutoHide,setAcceptHTML:setAcceptHTML,setLogo:setLogo,$get:function(){return{getHideDelay:getHideDelay,getAutoHide:getAutoHide,getAcceptHTML:getAcceptHTML,getLogo:getLogo}}}}),module.factory("notifications",["$rootScope",function($rootScope){var showError=function(message){$rootScope.$broadcast("notifications:error",message)},showWarning=function(message){$rootScope.$broadcast("notifications:warning",message)},showSuccess=function(message){$rootScope.$broadcast("notifications:success",message)},closeAll=function(){$rootScope.$broadcast("notifications:closeAll")};return{showError:showError,showWarning:showWarning,showSuccess:showSuccess,closeAll:closeAll}}]),module.directive("notificationsBar",function(notificationsConfig,$timeout){return{restrict:"EA",template:function(){var acceptHTML=notificationsConfig.getAcceptHTML()||!1,thisImg=notificationsConfig.getLogo();return acceptHTML?'<div class="notifications-container" ng-if="notifications.length"><div class="{{note.type}} notificationMessage bounceIn animated" ng-repeat="note in notifications"><div class="message" ng-bind-html="note.message"></div><span class="glyphicon glyphicon-remove close-click" ng-click="close($index)"></span></div></div>':'<div class="notifications-container" ng-if="notifications.length"><div class="{{note.type}} notificationMessage bounceIn animated" ng-repeat="note in notifications"><div class="LogoPosition"><img src='+thisImg+' alt=""></div><div class="message" >{{note.message}}</div><span class="glyphicon glyphicon-remove close-click" ng-click="close($index)"></span></div></div>'},link:function(scope){var notifications=scope.notifications=[],autoHideDelay=notificationsConfig.getHideDelay()||3e3,autoHide=notificationsConfig.getAutoHide()||!1,removeById=function(id){var found=-1;notifications.forEach(function(el,index){el.id===id&&(found=index)}),found>=0&&notifications.splice(found,1)},notificationHandler=function(event,data,type){var message,hide=autoHide,hideDelay=autoHideDelay;"object"==typeof data?(message=data.message,hide="undefined"==typeof data.hide?autoHide:!!data.hide,hideDelay=data.hideDelay||hideDelay):message=data;var id="notif_"+Math.floor(128*Math.random());if(notifications.push({id:id,type:type,message:message}),hide)var timer=$timeout(function(){removeById(id),$timeout.cancel(timer)},hideDelay)};scope.$on("notifications:error",function(event,data){notificationHandler(event,data,"error")}),scope.$on("notifications:warning",function(event,data){notificationHandler(event,data,"warning")}),scope.$on("notifications:success",function(event,data){notificationHandler(event,data,"success")}),scope.$on("notifications:closeAll",function(){notifications.length=0}),scope.close=function(index){notifications.splice(index,1)}}}}),module});var App=angular.module("modalSys",[]);App.directive("modalpackage",function(){return{restrict:"A",scope:{options:"="},template:function(){return'<div class="ModalPackage"><div class="ModalBackPlaces"></div><div class="ModalWindow fadeInUp animated" ng-style=\'{"width": options.width}\'><div class="titleForModakBox">{{options.title}}</div><div class="closeButOfModal"><i class="icon-cancel"></i></div><div ng-include="options.template"></div></div></div>'},link:function(scope,iElm,iAttrs){setTimeout(function(){var thisModalPackage=iElm.find(".ModalPackage");scope.options&&(scope.options.OpenModalClass&&jQuery(document).on("click","."+scope.options.OpenModalClass,function(event){event.preventDefault(),scope.options.OpenModalAction()}),scope.options.OpenModalAction=function(){thisModalPackage.addClass("ShowTheModal"),scope.options.AfterOpenModalFunc&&scope.options.AfterOpenModalFunc()},scope.options.close=function(){thisModalPackage.removeClass("ShowTheModal"),scope.options.AfterCloseModalFunc&&scope.options.AfterCloseModalFunc()}),thisModalPackage.find(".closeButOfModal,.ModalBackPlaces, .CloseButInModal").click(function(event){event.preventDefault(),scope.options.close()}),jQuery(document).on("click",".CloseButInModal",function(event){event.preventDefault(),scope.options.close()})},0)}}}),angular.module("ibartarApp").controller("MobVerifCtrl",function($scope,WebServices,ngProgress,utils,appConfig){$scope.OpenMobileVerification={title:"فعال سازی شماره همراه",width:640,BaseTheme:appConfig.BaseTheme,template:appConfig.BaseTheme+"/views/MobileVerification.html",MestBeFocused:function(){return $scope.MestBeFocused},AfterOpenModalFunc:function(){$scope.MestBeFocused=!0},ResendSms:function(){ngProgress.start(),WebServices.SendMobileVerification().then(utils.MHandler[0],utils.MHandler[1])},SubmitVerification:function(SendingCode){ngProgress.start(),WebServices.MobileValidation(SendingCode).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),location.reload()):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}},$scope.$on("mobverifaction:open",function(event,data){$scope.OpenMobileVerification.OpenModalAction()})}),angular.module("ibartarApp").directive("mobVerif",function(){return{restrict:"A",template:function(){return'<div ng-controller="MobVerifCtrl"><div modalpackage options="OpenMobileVerification"></div></div>'}}}),angular.module("ibartarApp").factory("mobVerif",function($rootScope){var Model={};return Model.Open=function(){$rootScope.$broadcast("mobverifaction:open")},Model}),angular.module("ibartarApp").controller("getUserNamePanelCtrl",function($scope,$rootScope,WebServices,ngProgress,utils,appConfig){$scope.OpenGetUserNamePanel={title:"دریافت نام کاربر",width:640,BaseTheme:appConfig.BaseTheme,template:appConfig.BaseTheme+"/views/getUserNamePanel.html",MestBeFocused:function(){return $scope.MestBeFocused},AfterOpenModalFunc:function(){$scope.MestBeFocused=!0},SubmitUserName:function(usernameToSend){ngProgress.start(),$rootScope.LoaderOnPage=!0,WebServices.editProfile("name",usernameToSend).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),location.reload()):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}},$scope.$on("getUserNamePanel:open",function(event,data){$scope.OpenGetUserNamePanel.OpenModalAction()})}),angular.module("ibartarApp").directive("getUserNamePanelDirective",function(){return{restrict:"A",template:function(){return'<div ng-controller="getUserNamePanelCtrl"><div modalpackage options="OpenGetUserNamePanel"></div></div>'}}}),angular.module("ibartarApp").factory("getUserNamePanelFactory",function($rootScope){var Model={};return Model.Open=function(){$rootScope.$broadcast("getUserNamePanel:open")},Model}),angular.module("ibartarApp").service("MetaService",function(){var title="",metaDescription="",metaImage="",metaCanonical="";return{set:function(newTitle,newMetaDescription,newImage,canonical){metaImage=newImage,metaDescription=newMetaDescription,title=newTitle,metaCanonical=canonical;
},metaTitle:function(){return title},metaDescription:function(){return metaDescription},metaImage:function(){return metaImage},metaCanonical:function(){return metaCanonical}}}),angular.module("ibartarApp").factory("SearchRequests",function($http,$log,$rootScope,$state,$stateParams,appConfig,SearchResultSaver){var Model={},EnableCurrentLocation=!1,CurrentLocationInArray=[];return Model.EnableLocation=function(){EnableCurrentLocation=!0},Model.DisableLocation=function(){EnableCurrentLocation=!1},Model.SetCurrentLocationInArray=function(LocationArr){CurrentLocationInArray=LocationArr},Model.Menu=function(options){return $http.get(appConfig.apiV1_0+"/page/menu?menu_type=web")},Model.GetNodesOfSearchByObj=function(DataObj,searchLogQuery,save){var Params="";for(var key in DataObj)DataObj[key]&&"area"!=key&&(Params+=key+"="+DataObj[key]+"&");if(EnableCurrentLocation?(Params+="area=15,"+CurrentLocationInArray.toString()+"&",Params+="current_location="+CurrentLocationInArray.toString()+"&order_by=distance &"):DataObj.area&&(Params+="area="+DataObj.area+"&"),Params=Params.substring(0,Params.length-1),Params="?"+Params,searchLogQuery&&(Params+=searchLogQuery),SearchResultSaver.isLock()){var response=$http.get(appConfig.api+"/page/search"+Params);save&&SearchResultSaver.save(response)}return response||SearchResultSaver.restore()},Model.GetExtend=function(pageUuid,LogQuery,SearchTrade){if($rootScope.iterationCount++,$rootScope.iterationCount>2){var splitHref=window.location.href.split("/");return splitHref.splice(-1,1),window.location.assign(splitHref.join("/")+"/thisTitle"),!1}var SearchTradeQuery="";SearchTrade&&(SearchTradeQuery=LogQuery?SearchTrade:SearchTrade.replace("&","?"));var ThisQuery="";LogQuery&&(ThisQuery=LogQuery);var devType="&device_type=desktop";return LogQuery||SearchTrade||(devType="?device_type=desktop"),$http.get(appConfig.apiV1_3+"/business/show/"+pageUuid+"/extend"+ThisQuery+SearchTradeQuery+devType).error(function(){$state.go("landingPageIntro")})},Model.GetExtendEditMode=function(pageUuid){return $http.get(appConfig.api+"/page/show/"+pageUuid+"/edit")},Model}).factory("WebServices",function($http,$log,$q,appConfig,$rootScope,$state){var Model={};Model.GetLeaderBoard=function(){return $http.get(appConfig.apiV1_3+"/commentCampaign/all")},Model.GetMinPageMenu=function(){return $http.get(appConfig.apiV1_0+"/page/menu/mainpage")},Model.GetUserProfile=function(){return $http.get(appConfig.apiV1_3+"/user/profile")},Model.GetDataHomePage=function(){return $http.get(appConfig.apiV1_3+"/webhome").error(function(response){$state.go("landingPageIntro")})},Model.getEventData=function(id){return $http.get(appConfig.apiV1_3+"/events/"+id)},Model.getEventListData=function(){return $http.get(appConfig.apiV1_3+"/events/list")},Model.getEventCategoryData=function(id){return $http.get(appConfig.apiV1_3+"/events/category/"+id)},Model.getAllEventsData=function(){return $http.get(appConfig.apiV1_3+"/events/category/home")},Model.GetPopularAreas=function(){return $rootScope.FooterAreas?$rootScope.FooterAreas:($rootScope.FooterAreas=$http.get(appConfig.api+"/page/area/city-distribution"),$rootScope.FooterAreas)},Model.getlist=function(){return $http.get(appConfig.api+"/page/guild/list")},Model.getmenutype=function(){return $http.get(appConfig.api+"/menu/types")},Model.getMenuByType=function(type){return $http.get(appConfig.api+"/menu?menu_type="+type)},Model.LoginUserNew=function(signInUser){return $http.post(appConfig.apiV1_3+"/user/login",signInUser,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.LogOutUser=function(){return $http.get(appConfig.api+"/user/logout")},Model.AthenticateForEdit=function(uuid){return $http.post(appConfig.api+"/page/edit-access/"+uuid)},Model.getPageListCreatedByUser=function(paramsToSend){return $http.get(appConfig.api+"/page/my-created-pages",{params:paramsToSend})},Model.mergePages=function(mergeObj){return $http.post(appConfig.api+"/page/merge",mergeObj)},Model.UpdatePage=function(uuid,updateObj){return $http.post(appConfig.api+"/page/update/"+uuid,updateObj)},Model.getKeyWordsSuggestion=function(uuid){return $http.get(appConfig.api+"/page/"+uuid+"/keyword/suggestions")},Model.StoreJob=function(objData,StoreType){return $http.post(appConfig.api+"/page/store/"+StoreType,objData)},Model.GetCaptchaRequirementStatus=function(){return $http.get(appConfig.api+"/captcha/required/page-create")},Model.SignUpUser=function(objData){return $http.post(appConfig.apiV1_3+"/user/register",objData)},Model.ProductUpdateOrCreate=function(objData,uuid,Action,productId){if("create"==Action){var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/"+uuid+"/product",type:"POST",dataType:"json",data:objData,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise}var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/"+uuid+"/product/"+productId,type:"POST",dataType:"json",data:objData,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise},Model.RemoveProduct=function(uuid,productId){return $http["delete"](appConfig.api+"/page/"+uuid+"/product/"+productId)},Model.LogoStore=function(objData,uuid){var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/"+uuid+"/logo",type:"POST",dataType:"json",data:objData,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise},Model.removeLogo=function(uuid){return $http["delete"](appConfig.api+"/page/"+uuid+"/logo")},Model.StoreGallery=function(objData,uuid){var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/"+uuid+"/media",type:"POST",dataType:"json",data:objData,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise},Model.UpdateGallery=function(objData,imageId){return $http.put(appConfig.api+"/page/media/"+imageId,objData)},Model.removeMedia=function(mediaid){return $http["delete"](appConfig.api+"/page/media/"+mediaid)},Model.AddOrRemoveKeywords=function(uuid,objData,MethodAction){return"add"==MethodAction?$http.post(appConfig.api+"/page/"+uuid+"/keyword",objData):$http["delete"](appConfig.api+"/page/"+uuid+"/keyword?id="+objData.id)},Model.GetCousellorData=function(counsellorId){return $http.get(appConfig.apiV1_0+"/counsellor/customers"+(counsellorId?"/"+counsellorId:""))},Model.GetCounsellorState=function(counsellorId){return $http.get(appConfig.apiV1_0+"/counsellor/stats"+(counsellorId?"/"+counsellorId:""))},Model.getCounsellorBadges=function(counsellor_id){return $http.get(appConfig.api+"/game/badges/counsellor/"+counsellor_id)},Model.GetProfile=function(id){var baseProfileUrl="/profile";return id&&(baseProfileUrl+="/"+id),$http.get(appConfig.api+baseProfileUrl)},Model.GetEditProfile=function(){return $http.get(appConfig.apiV1_3+"/user/edit")},Model.UpdateEditProfile=function(UpdateEditProfileObj){return $http.post(appConfig.apiV1_3+"/user/update",UpdateEditProfileObj,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.UpdateMobileEditProfile=function(urlVerifyMobile,mobileObj){return $http.post(urlVerifyMobile,mobileObj,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.claimBiz=function(urlVerify){return $http.post(urlVerify,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.editProfile=function(EditItem,NewValue){var SendingObj={};return SendingObj[EditItem]=NewValue,$http.post(appConfig.api+"/profile",SendingObj)},Model.changePassword=function(PassObj){return $http.post(appConfig.api+"/user/change-password",PassObj)},Model.SendSmsInvitation=function(PageUuid){return $http.get(appConfig.apiV1_0+"/counsellor/send-invite-sms/"+PageUuid)},Model.forgetpass=function(forgetpassObj){return $http.post(appConfig.api+"/user/forgot-password",forgetpassObj)},Model.resetpass=function(resetpassObj){return $http.post(appConfig.api+"/user/reset-password",resetpassObj)},Model.MobileValidation=function(code){return $http.post(appConfig.api+"/user/verify-mobile",{code:code})},Model.SendMobileVerification=function(){return $http.post(appConfig.api+"/user/send-mobile-verification")},Model.SendEmailVerification=function(){return $http.post(appConfig.api+"/user/send-email-verification")},Model.GetStatistics=function(SearchObj){return $http.post(appConfig.api+"/page/statistics",SearchObj)},Model.getUserPbCodeCountInstaller=function(UserInfo){return $http.get(appConfig.api+"/installer/"+UserInfo+"/count")},Model.getFavorites=function(){return $http.get(appConfig.api+"/page/favorites")},Model.getFavoritesBusiness=function(){return $http.get(appConfig.apiV1_3+"/business/favorites")},Model.getFavoritesEvents=function(idUser){return $http.get(appConfig.apiV1_3+"/events/userEvents/"+idUser)},Model.addToFavorite=function(PageUuid){return $http.post(appConfig.api+"/page/knot/toggle/"+PageUuid)},Model.GetStatisticsMapNodes=function(SearchObj){return $http.post(appConfig.api+"/page/statistics/map",SearchObj)},Model.GetStatisticsList=function(pageNum,SearchObj){return $http.post(appConfig.api+"/page/statistics/list?page="+pageNum,SearchObj)},Model.Claim=function(mobile,uuid){return $http.post(appConfig.api+"/page/claim/"+uuid,{mobile:mobile})},Model.getCounterData=function(){return $http.get(appConfig.api+"/page/counter")},Model.areaSearchQueryHirarical=function(areaQuery){return $http.get(appConfig.api+"/area/search?q="+areaQuery)},Model.SubmitPolyfun=function(Obj){return $http.post(appConfig.api+"/area/update/"+Obj.id,Obj)},Model.SubmitNewArea=function(objData){return $http.post(appConfig.api+"/area/create",objData)},Model.detachPageUser=function(uuid){return $http.put(appConfig.api+"/page/detach-manager/"+uuid)},Model.GetRevisionList=function(pageNum,RevisionObj){return $http.post(appConfig.api+"/page/revision?page="+pageNum,RevisionObj)},Model.UpdateRevisionList=function(RevisionObj){return $http.put(appConfig.api+"/page/revision",RevisionObj)},Model.DeleteRevisionList=function(RevisionObj){return $http["delete"](appConfig.api+"/page/revision",{data:RevisionObj})},Model.DeleteAvatarUser=function(){return $http["delete"](appConfig.api+"/profile/avatar")},Model.myRateCheck=function(uuid){return $http.get(appConfig.api+"/page/"+uuid+"/my-rate")},Model.userMediaUpload=function(uuid){return $http.get(appConfig.apiV1_4+"/page/"+uuid+"/media/users")},Model.addRatePage=function(uuid,ratePageObj){return $http.post(appConfig.api+"/page/"+uuid+"/rate",ratePageObj,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.getComments=function(uuid,pageNum){var Params="";return Params="?page="+pageNum,$http.get(appConfig.api+"/page/"+uuid+"/comments"+Params)},Model.reportComment=function(uuid,commentId){return $http.post(appConfig.api+"/page/"+uuid+"/comments/"+commentId+"/report")},Model.deleteComment=function(uuid,commentId){return $http["delete"](appConfig.api+"/page/"+uuid+"/comments/"+commentId)},Model.userComments=function(id){return $http.get(appConfig.api+"/user/"+id+"/comments")},Model.addComment=function(uuid,commentObj){return $http.post(appConfig.api+"/page/"+uuid+"/comments",commentObj,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.getViewsOfPage=function(uuid,paramsToSend){var urlRelative="/page/analytics/page-view";return uuid&&(urlRelative+="/"+uuid),$http.post(appConfig.api+urlRelative,paramsToSend)};var message={};message.showMessage=function(uuid,user_id){return $http.get(appConfig.api+"/message/show/"+uuid+"/"+user_id)},message.pageCreateMessage=function(messageObj){return $http.post(appConfig.api+"/message/page/create",messageObj)},message.personCreateMessage=function(messageObj){return $http.post(appConfig.api+"/message/person/create",messageObj)},message.pageInbox=function(uuid){return $http.get(appConfig.api+"/message/inbox/page/"+uuid)},message.personInbox=function(){return $http.get(appConfig.api+"/message/inbox/person")},Model.message=message;var bugServices={};bugServices.bug_type=function(url){return $http.get(url)},bugServices.send_bug=function(url,data){return $http.post(url,data)},bugServices.bugsLog=function(pageNum,params){return pageNum||(pageNum=1),$http.post(appConfig.api+"/bugs/bug-logs?page="+pageNum,params)},bugServices.dailyLog=function(params){return $http.post(appConfig.api+"/bugs/daily-bugs",params)},Model.bugServices=bugServices;var userScore={};userScore.getByName=function(name){return $http.post(appConfig.api+"/user/score",{name:name})},userScore.getDetailByUserId=function(id,params){return $http.get(appConfig.api+"/user/score/"+id,{params:params})},userScore.create=function(dataObj){return $http.post(appConfig.api+"/user/score/create",dataObj)},Model.score=userScore;var reportPage={};reportPage.getReportPage=function(uuid){return $http.get(appConfig.apiV1_2+"/report-cost/"+uuid)},Model.reportPage=reportPage;var events={};return events.add=function(uuidOfPage,ParamsToSend){return $http.post(appConfig.api+"/page/"+uuidOfPage+"/event",ParamsToSend,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},events.edit=function(uuidOfPage,EventId,ParamsToSend){return $http.post(appConfig.api+"/page/"+uuidOfPage+"/event/"+EventId,ParamsToSend,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},events["delete"]=function(uuidOfPage,EventId){return $http["delete"](appConfig.api+"/page/"+uuidOfPage+"/event/"+EventId)},Model.events=events,Model}),angular.module("ibartarApp").factory("operatorRequests",function($http,appConfig,$q,utils){var Model={};Model.getGRequestStatus=function(){return $http.get(appConfig.apiV1_0+"/spanel/google/request/status")},Model.SendGrequest=function(dataToSend){return $http.post(appConfig.apiV1_0+"/spanel/google/request",dataToSend)},Model.GetCsvRequests=function(){return $http.get(appConfig.apiV1_0+"/spanel/csv")},Model.StoreCvsRequest=function(FormToSend){return $http.post(appConfig.apiV1_0+"/spanel/import",FormToSend,{withCredentials:!0,headers:{"Content-Type":void 0},transformRequest:angular.identity})},Model.EraseCsvRequest=function(csv_id){return $http["delete"](appConfig.apiV1_0+"/spanel/csv/"+csv_id)},Model.GetDictionaries=function(){return $http.get(appConfig.apiV1_0+"/spanel/translatable")},Model.getPopRand=function(typeOfStatus,Params){return $http.get(appConfig.apiV1_0+"/spanel/pipeline/temppage/pop-random?status="+typeOfStatus,{params:Params})},Model.PushBack=function(tempPageId){return $http.put(appConfig.apiV1_0+"/spanel/pipeline/temppage/push-back/"+tempPageId)},Model.NextForTempPage=function(tempPageId,updateTempPageObj){return $http.put(appConfig.apiV1_0+"/spanel/pipeline/temppage/next/"+tempPageId,updateTempPageObj)},Model.ConvertToPage=function(tempPageId,updateTempPageObj){return $http.post(appConfig.apiV1_0+"/spanel/pipeline/temppage/convert-to-page/"+tempPageId,updateTempPageObj)},Model.OperatorImport=function(OperatorImportObj){return $http.post(appConfig.apiV1_0+"/spanel/operator-import",OperatorImportObj)},Model.deleteTempPage=function(tempPageId){return $http["delete"](appConfig.apiV1_0+"/spanel/temppage/"+tempPageId)},Model.GoogleGuildList=function(){return $http.get(appConfig.api+"/page/guild/google")},Model.getTranslatedFile=function(GoogleFileId){return $http.get(appConfig.apiV1_0+"/translatable/google/"+GoogleFileId)},Model.PostTranslatedFile=function(fileObj){return $http.post(appConfig.apiV1_0+"/spanel/translated",fileObj)},Model.getPageCorrectUuid=function(statusType,Params){return $http.get(appConfig.api+"/spanel/pipeline/pages/pop-task?pipeline_status="+statusType,{params:Params})},Model.PageCorrectionSendToNextStep=function(uuid){return $http.put(appConfig.api+"/spanel/pipeline/pages/next/"+uuid)},Model.PageCorrectionDeleteAction=function(uuid){return $http["delete"](appConfig.api+"/spanel/pipeline/pages/delete/"+uuid)},Model.GetBugList=function(uuid){return $http.get(appConfig.apiV1_0+"/bugs/page/"+uuid)},Model.delay=function(uuid,dataObj){return $http.post(appConfig.api+"/spanel/pipeline/pages/delay/"+uuid,dataObj)},Model.getLogOfPage=function(uuid){return $http.get(appConfig.api+"/spanel/pipeline/pages/logs/"+uuid)},Model.getPageHistory=function(uuid){return $http.get(appConfig.api+"/operators/page-history/"+uuid)};var manageComment={};manageComment.GetCommentsShowList=function(pageNum,CommentObj){return $http.post(appConfig.api+"/page/comments/manage?page="+pageNum,CommentObj)},manageComment.RejectCommentsShow=function(idComment,UUIDComments){return $http["delete"](appConfig.api+"/page/"+UUIDComments+"/comments/manage/"+idComment+"/reject")},manageComment.AcceptCommentsShow=function(idComment,UUIDComments){return $http.put(appConfig.api+"/page/"+UUIDComments+"/comments/manage/"+idComment+"/accept")},Model.manageComment=manageComment;var editFirstPage={};editFirstPage.uploadFile=function(file){return $http.post(appConfig.api+"/uploadFile",file,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},editFirstPage.uploadSlide=function(file){return $http.post(appConfig.api+"/uploadSlide",file,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.editFirstPage=editFirstPage;var editOperators={};editOperators.GetUsers=function(DataObj){var Params="";for(var key in DataObj)DataObj[key]&&(Params+=key+"="+DataObj[key]+"&");return Params=Params.substring(0,Params.length-1),Params="?"+Params,$http.get(appConfig.apiAdmin+"/users"+Params)},editOperators.UpdateUserPermission=function(userId,groupsData){return $http.post(appConfig.apiAdmin+"/users/"+userId+"/update",groupsData)},editOperators.DeleteUserPermission=function(userId){return $http["delete"](appConfig.apiAdmin+"/users/"+userId)},Model.editOperators=editOperators;var weekSchedule={};weekSchedule.GetWeekSchedule=function(){return $http.get(appConfig.apiAdmin+"/schedule-guilds")},weekSchedule.GetGuilds=function(){return $http.get(appConfig.apiAdmin+"/guilds-list/")},Model.weekSchedule=weekSchedule;var pagesDeleted={};pagesDeleted.getReportFilterPagesDeleted=function(DataObj){var Params="";for(var key in DataObj)DataObj[key]&&(Params+=key+"="+DataObj[key]+"&");return Params=Params.substring(0,Params.length-1),Params="?"+Params,$http.get(appConfig.apiAdmin+"/filter-deleted-pages"+Params)},pagesDeleted.getReportPagesDeleted=function(){return $http.get(appConfig.apiAdmin+"/deleted-pages")},Model.pagesDeleted=pagesDeleted;var handpicked={};handpicked.GetHandPicked=function(){return $http.get(appConfig.apiAdmin+"/handpicked")},handpicked.UpdateHandPicked=function(guildId,handPickedData){return $http.post(appConfig.apiAdmin+"/handpicked/"+guildId,handPickedData,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.handpicked=handpicked;var addEvents={};addEvents.GetEvents=function(){return $http.get(appConfig.apiAdmin+"/events/list")},addEvents.GetEvent=function(id){return $http.get(appConfig.apiAdmin+"/events/"+id)},addEvents.upsertEvent=function(ObjEvent){return $http.post(appConfig.apiAdmin+"/events/upsert",ObjEvent,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},Model.addEvents=addEvents;var editJobs={};editJobs.GetListJobs=function(status,uuid){return $http.get(appConfig.api+"/spanel/pipeline/pages/pop-task?pipeline_status="+status+(uuid?"&id="+uuid:""))},editJobs.DeleteLogoMainPage=function(uuidPageLogo){return $http["delete"](appConfig.api+"/page/"+uuidPageLogo+"/logo")},editJobs.DeleteKeywordsMainPage=function(uuidPageKeywords,idKeyword){return $http["delete"](appConfig.api+"/page/"+uuidPageKeywords+"/keyword?id="+idKeyword)},editJobs.UpdatePageJob=function(bugId,status,updateObjFormData){return $http.post(appConfig.apiV1_4+"/errorReport/"+bugId+"/"+status,updateObjFormData,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},editJobs.UpdatePageJobFinal=function(uuidPage,updateObjFormData){return $http.post(appConfig.api+"/page/update/"+uuidPage,updateObjFormData,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},editJobs.similarPages=function(DataObj){var Params="";for(var key in DataObj)DataObj[key]&&(Params+=key+"="+DataObj[key]+"&");return Params=Params.substring(0,Params.length-1),Params="?"+Params,$http.get(appConfig.api+"/page/similar"+Params)},editJobs.savePageNext=function(UuidPageSave,saveObjFormData){return $http.put(appConfig.api+"/spanel/pipeline/pages/next/"+UuidPageSave,saveObjFormData,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},editJobs.DelayPageJob=function(UuidPageDelay,delayObjFormData){return $http.post(appConfig.api+"/spanel/pipeline/pages/delay/"+UuidPageDelay,delayObjFormData,{transformRequest:angular.identity,headers:{"Content-Type":void 0}})},editJobs.DeletePageJob=function(bugId,status,deleteObjFormData){return $http["delete"](appConfig.apiV1_4+"/errorReport/"+bugId+"/"+status+"?message="+deleteObjFormData)},editJobs.DeletePageJobFinal=function(UuidPageDelete,deleteObjFormData){return $http["delete"](appConfig.api+"/spanel/pipeline/pages/delete/"+UuidPageDelete+"?message="+deleteObjFormData)},Model.editJobs=editJobs;var foursquare={};return foursquare.getRequestsList=function(){return $http.get(appConfig.api+"/foursquare/request")},foursquare.getCategories=function(){return $http.get(appConfig.api+"/foursquare/categories")},foursquare.createRequest=function(requestObj){return $http.post(appConfig.api+"/foursquare/request/create",requestObj)},Model.foursquare=foursquare,Model.popMedia=function(){return $http.get(appConfig.api+"/feed/check/media")},Model.acceptOrFeedTheMedia=function(mediaId,feedOrNot){var sendingObj={};return feedOrNot&&(sendingObj={feed:!0}),$http.post(appConfig.api+"/feed/check/media/"+mediaId,sendingObj)},Model.popProduct=function(){return $http.get(appConfig.api+"/feed/check/products")},Model.acceptOrFeedTheProduct=function(mediaId,feedOrNot){var sendingObj={};return feedOrNot&&(sendingObj={feed:!0}),$http.post(appConfig.api+"/feed/check/products/"+mediaId,sendingObj)},Model.getOperatorLog=function(counsellorObj){return $http.post(appConfig.api+"/operators/statistic-report",counsellorObj)},Model.getOperatorList=function(){return $http.get(appConfig.api+"/operators/user-list")},Model.createCollectionApi=function(form){var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/collection",type:"POST",dataType:"json",data:form,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise},Model.getCollectionByID=function(id){return $http.get(appConfig.api+"/page/collection/"+id)},Model.deleCollectionByID=function(id){return $http["delete"](appConfig.api+"/page/collection/"+id)},Model.areaSuggest=function(str){return $http.get(appConfig.api+"/area/search?q="+str)},Model.availabeLayer=function(){return $http.get(appConfig.api+"/page/main-page/list")},Model.deleteMainPage=function(id){return $http["delete"](appConfig.api+"/page/main-page/"+id)},Model.getMainPage=function(id){return $http.get(appConfig.api+"/page/main-page/"+id)},Model.setConfigHome=function(obj){return $http.post(appConfig.api+"/page/main-page",obj)},Model.updateCollection=function(form){var deferred=$q.defer();return $.ajax({url:appConfig.api+"/page/collection/update",type:"POST",dataType:"json",data:form,cache:!1,contentType:!1,processData:!1,success:function(data){deferred.resolve(data)},error:function(err){deferred.reject(err)}}),deferred.promise},Model.getCollectionByFilter=function(dataObj){return $http.get(appConfig.api+"/page/collection?"+utils.EncodeQueryData(dataObj))},Model});var module=angular.module("ibartarApp");module.factory("urlUpdater",function($injector,$q,$location){var urlUpdaterConfig={request:function(config){return config.url=encodeURI(config.url),config},responseError:function(result){return 403==result.status&&($injector.get("$rootScope").VisibleLoginFloating=!0,$injector.get("$rootScope").IbartarUserInfo=null,$injector.get("$state").go("userlogin",{redirect:$location.$$absUrl.toString()}),$injector.get("utils").NormalNotificationForServerResponse(result.data.message)),404==result.status&&($injector.get("$rootScope").IbartarUserInfo=null,$injector.get("$state").transitionTo("404"),$injector.get("utils").NormalNotificationForServerResponse(result.data.message)),$q.reject(result)}};return urlUpdaterConfig}),module.config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("urlUpdater")}]),angular.module("ibartarApp").factory("MapIcon",function(){var Model={};return Model.getIconPos=function(Status,digit){digit+=1;var Pos={};return Pos=digit%10?{X:58*Math.floor(digit/10),Y:580*Status+58*(digit%10-1)}:{X:58*(Math.floor(digit/10)-1),Y:580*Status+522}},Model}),angular.module("ibartarApp").factory("suggestion",function($http,$q,appConfig){var getByQuery=function(Query){var canceller=$q.defer(),cancel=function(reason){canceller.resolve(reason)},promise=$http.get(appConfig.apiV1_0+"/query-suggestion?k="+Query,{timeout:canceller.promise}).then(function(response){return response.data});return{promise:promise,cancel:cancel}};return{getByQuery:getByQuery}}),angular.module("ibartarApp").factory("AreaSuggestion",function($http,$q,appConfig){var getByQuery=function(Query){var canceller=$q.defer(),cancel=function(reason){canceller.resolve(reason)},promise=$http.get(appConfig.apiV1_0+"/area-suggestion?query="+Query,{timeout:canceller.promise}).then(function(response){return response});return{promise:promise,cancel:cancel}};return{getByQuery:getByQuery}}),angular.module("ibartarApp").service("MapArea",function(){var property;return{getProperty:function(){return property},setProperty:function(value){property=value}}}),angular.module("ibartarApp").factory("MapMarker",function(appConfig,utils,MapIcon,$filter,uiGmapGoogleMapApi,$ocLazyLoad,$rootScope){var ib,MarkerBanner;uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&(ib=new InfoBox,MarkerBanner=new InfoBox)})});var MarkerBannersNumObj=[],Markerevents={},ResultMarkers=[],Model={},opts={},banners={},multiPlier=0,showInfoWindow=!0;return Model.reset=function(){showInfoWindow=!0,multiPlier=0,ResultMarkers=[],opts={},banners={},uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&"undefined"!=typeof ib&&"function"==typeof ib.close&&ib.close(),"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&"undefined"!=typeof MarkerBanner&&"function"==typeof MarkerBanner.close&&MarkerBanner.close()})});for(var i=MarkerBannersNumObj.length-1;i>=0;i--)MarkerBannersNumObj[i].close(),utils.ArrRemove(MarkerBannersNumObj,MarkerBannersNumObj[i])},Model.HiddenInfoWindow=function(){showInfoWindow=!1},Model.AddMarkers=function(NodesOnPageContent){if("undefined"==typeof google)return!1;for(var infoWindowOptions={},MarkerBanneropts={},i=0;i<=NodesOnPageContent.length-1;i++){var BannerImg=document.createElement("div");BannerImg.className=" custBannerPlace bounceIn animated",BannerImg.innerHTML="<div class='MarkerGold'><div class='custBanner'><img src='"+NodesOnPageContent[i].logo.Small+"' /></div></div>",MarkerBanneropts[NodesOnPageContent[i].uuid]={content:BannerImg,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-37,-75),zIndex:6,boxStyle:{height:"100px",width:"100px"},closeBoxURL:"",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};var thisMarkerPos=MapIcon.getIconPos(NodesOnPageContent[i].status,10*multiPlier+i),NodeMarker={coords:{latitude:parseFloat(NodesOnPageContent[i].lat),longitude:parseFloat(NodesOnPageContent[i].lng)},title:NodesOnPageContent[i].title,icon:new google.maps.MarkerImage(appConfig.BaseTheme+"/images/markers/marker3.png",new google.maps.Size(58,58),new google.maps.Point(thisMarkerPos.X,thisMarkerPos.Y)),options:{animation:google.maps.Animation.DROP},id:NodesOnPageContent[i].uuid,zIndex:5,status:NodesOnPageContent[i].status};ResultMarkers.push(NodeMarker);var boxText=document.createElement("div");boxText.className=" infoplace",boxText.innerHTML="<div class='NodeInformations'><div class='row'><div class='col-xs-12'><div class='NodeTitle'>"+NodesOnPageContent[i].title+"</div><div class='GuildCategory'>"+(NodesOnPageContent[i].guilds[0]?NodesOnPageContent[i].guilds[0].title:"")+"<div class='pull-left'>"+$filter("persianNumber")(NodesOnPageContent[i].tel_1)+"</div></div></div></div></div>";var myOptions={content:boxText,disableAutoPan:!1,maxWidth:0,pixelOffset:new google.maps.Size(-135,-150),zIndex:10,boxStyle:{background:"#fafafa",opacity:1,width:"200px",border:"3px solid #fff",borderRadius:"5px",MozBorderRadius:"5px",boxShadow:"0px 4px 5px rgba(0, 0, 0, 0.3)",MozBoxShadow:"0px 4px 5px rgba(0, 0, 0, 0.3)"},closeBoxMargin:"10px 0px 0px 10px",closeBoxURL:"assets/front/img/close2.png",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1};infoWindowOptions[NodesOnPageContent[i].uuid]=myOptions}multiPlier++,Markerevents={mouseover:function(Marker){showInfoWindow&&"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){ib.setOptions(infoWindowOptions[Marker.key]),ib.open(Marker.map,Marker)})}),Marker.setZIndex(1e5)},mouseout:function(Marker){"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){ib.close()})}),Marker.setZIndex(1)}},$.extend(!0,opts,infoWindowOptions),$.extend(!0,banners,MarkerBanneropts)},Model.AtachBanner=function(Marker){"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){MarkerBanner.setOptions(banners[Marker.key]),MarkerBanner.open(Marker.map,Marker)})})},Model.CloseBanner=function(){"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){MarkerBanner.close()})})},Model.openInfoWindow=function(Marker){Marker&&"undefined"!=typeof InfoBox&&"undefined"!=typeof google&&uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){ib.setOptions(opts[Marker.key]),ib.open(Marker.map,Marker)})})},Model.GetParam=function(){return{Markers:ResultMarkers,Events:Markerevents}},Model}),angular.module("ibartarApp").factory("utils",function($rootScope,$log,$q,appConfig,notifications,ngProgress){function hasPermission(obj){for(var key in $rootScope.IbartarUserInfo.permissions)if(1==$rootScope.IbartarUserInfo.permissions[key]&&-1!=obj.roles.indexOf(key))return!0;return!1}function dfs(node){var rm=[];for(var key in node.child){var thisChild=node.child[key];hasPermission(thisChild)?dfs(thisChild):rm.push(thisChild)}for(var key in rm)node.child=Model.ArrRemove(node.child,rm[key])}var Model={},hasOwnProperty=Object.prototype.hasOwnProperty;Model.getJsonFromUrl=function(UrlPath){if(UrlPath)var query=UrlPath.substr(1);else var query=location.search.substr(1);var result={};return query.split("&").forEach(function(part){var item=part.split("=");result[item[0]]=decodeURIComponent(item[1])}),result},Model.EncodeQueryData=function(data){var ret=[];for(var d in data)ret.push(encodeURIComponent(d)+"="+encodeURIComponent(data[d]));return ret.join("&")},Model.setCookie=function(cname,cvalue,exdays){exdays||(exdays=30);var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toGMTString();document.cookie=cname+"="+cvalue+"; "+expires},Model.getCookie=function(cname){for(var name=cname+"=",ca=document.cookie.split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length);
}return null},Model.removeCookie=function(name){document.cookie=name+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},Model.isEmpty=function(obj){if(null==obj)return!0;if(obj.length>0)return!1;if(0===obj.length)return!0;for(var key in obj)if(hasOwnProperty.call(obj,key))return!1;return!0},Model.ArrRemove=function(Arr,item,index){if(item)var i=Arr.indexOf(item);else if(index)var i=index;return-1!=i&&Arr.splice(i,1),Arr},Model.getCurrentLocation=function(){var deferred=$q.defer();if(navigator.geolocation){var DidntAnswer=setInterval(function(){$log.info("The User Is using Mozilla FireFox && didn'nt answer the qustion for Geolocation || user answered too late! || didn'nt answer the qustion for Geolocation"),deferred.reject(),clearInterval(DidntAnswer)},6e3);navigator.geolocation.getCurrentPosition(function(loc){clearInterval(DidntAnswer),deferred.resolve(loc.coords)},function(e){clearInterval(DidntAnswer);var loc={coords:{latitude:35.755707,longitude:51.430709}};$log.error("failed to get location",e),deferred.resolve(loc.coords)},{timeout:5e3})}else $log.info("location is not supported"),deferred.reject();return deferred.promise},Model.NormalNotificationForServerResponse=function(Messages,SuccessOrNot){for(var notifs in Messages)if(SuccessOrNot)if("info"==notifs&&"string"==typeof Messages.info)notifications.showSuccess(Messages.info);else for(var i=Messages[notifs].length-1;i>=0;i--)notifications.showSuccess(Messages[notifs][i]);else if("info"==notifs&&"string"==typeof Messages.info)notifications.showError(Messages.info);else for(var i=Messages[notifs].length-1;i>=0;i--)notifications.showError(Messages[notifs][i])};var SuccessHandler=function(result){ngProgress.complete(),result.data.status?Model.NormalNotificationForServerResponse(result.data.message,!0):Model.NormalNotificationForServerResponse(result.data.message,!1)},ErrorHanlder=function(err){err&&$log.error(err),$rootScope.LoaderOnPage=!1,ngProgress.complete(),notifications.showError("مشکلی در برقراری ارتباط به وجود آمده است")};return Model.MHandler=[SuccessHandler,ErrorHanlder],Model.prepareTheUserRoutes=function(){$rootScope.IbartarUserInfo&&($rootScope.IbartarUserInfo.routes=[],$rootScope.routesOfRoles.forEach(function(data){var copyOfData=angular.copy(data);hasPermission(copyOfData)&&(dfs(copyOfData),$rootScope.IbartarUserInfo.routes.push(copyOfData))}))},Model.dataURItoBlob=function(dataURI){var byteString;byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):unescape(dataURI.split(",")[1]);for(var mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],ia=new Uint8Array(byteString.length),i=0;i<byteString.length;i++)ia[i]=byteString.charCodeAt(i);return new Blob([ia],{type:mimeString})},Model.generateUUID=function(){var d=(new Date).getTime(),uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)});return uuid},Model.hasProperty=function(thisObject){var answer=!1;for(var key in thisObject){answer=!0;break}return answer},Model.copyTextToClipboard=function(text){var textArea=document.createElement("textarea");textArea.style.position="fixed",textArea.style.top=0,textArea.style.left=0,textArea.style.width="2em",textArea.style.height="2em",textArea.style.padding=0,textArea.style.border="none",textArea.style.outline="none",textArea.style.boxShadow="none",textArea.style.background="transparent",textArea.value=text,document.body.appendChild(textArea),textArea.select();var successful=!1;try{successful=document.execCommand("copy")}catch(err){}return document.body.removeChild(textArea),successful},Model}),angular.module("ibartarApp").factory("searchTraceService",function(SearchResultSaver,utils){var Model={},s_id={},SearchLog="";return Model.setTrace=function(channel){if(SearchResultSaver.isLock()){s_id[channel]=utils.generateUUID(),SearchLog="&chanel="+channel+"&s_id="+s_id[channel]+"&device_type=desktop";try{localStorage.setItem(channel+"Log",SearchLog)}catch(err){}}return SearchLog},Model.getTrace=function(){return SearchLog},Model.getSearchLog=function(searchChannel){return"&s_id="+this.getSearchId(searchChannel)},Model.saveSearchLogByUuid=function(uuid,searchChannel){try{localStorage.setItem("Search"+uuid,this.getSearchLog(searchChannel))}catch(err){}},Model.getSavedSearchLogByUuid=function(uuid){var LogToSend=utils.getCookie("Search"+uuid);return this.removeSearchLogByUuid(uuid),LogToSend},Model.getSearchId=function(channel){return s_id[channel]},Model.removeSearchLogByUuid=function(uuid){try{localStorage.removeItem("Search"+uuid)}catch(err){}},Model}),angular.module("ibartarApp").factory("channelService",function($rootScope,utils){var Model={},channel=null,chanel_details=null,ChannelToSend="";return Model.setChannel=function(ChannelType,ChannelDetailObj,uuid){channel="",chanel_details="",channel=ChannelType;for(var ObjKey in ChannelDetailObj)ChannelDetailObj[ObjKey]&&(chanel_details+="&"+ObjKey+"="+ChannelDetailObj[ObjKey]);var referrer="";if(document.referrer.length>0&&(referrer="&refer="+document.referrer),$rootScope.previousPath&&(referrer="&refer="+$rootScope.previousPath),ChannelToSend="?chanel="+channel+chanel_details+referrer,uuid)try{localStorage.setItem(uuid,ChannelToSend)}catch(err){}},Model.resetChannel=function(){var referrer="";document.referrer.length>0&&(referrer="?refer="+document.referrer),$rootScope.previousPath&&(referrer="?refer="+$rootScope.previousPath),ChannelToSend=referrer},Model.removeChannelByUuid=function(uuid){try{localStorage.removeItem(uuid)}catch(err){}},Model.getChannel=function(uuid){try{var DatabaseLog=localStorage.getItem(uuid)}catch(err){}return this.removeChannelByUuid(uuid),DatabaseLog||ChannelToSend},Model}),angular.module("ibartarApp").factory("operatorGame",function($q,$rootScope,operatorRequests,utils){var Method={},localVars={},scoreMultiplierConfig={"گزارش خطا":10,"تکراری بودن":2,"ثبت":2,"صحت اطلاعات":5,"مشتریان ثبت شده":15,"تاییدنهایی":10,"کامل بودن":2};return Method.getOperatorLog=function(callback){var startTime=moment().format("YYYY-MM-DD");operatorRequests.getOperatorLog({start_time:startTime}).then(function(result){localVars.log=result.data.data.report,Method.calcUserScores(),"function"==typeof callback&&callback()},utils.MHandler[1])},Method.giveManualOperatorLog=function(reportObj,callback){localVars.log=reportObj,Method.calcUserScores(),"function"==typeof callback&&callback()},Method.operatorNameDicInit=function(dic){localVars.operatorDic=dic},Method.takeTabledOfScores=function(){if(!localVars.calculatedScores)return!1;var thisTable={headers:["امتیاز محاسبه شده"],rows:[]};for(var operatorId in localVars.calculatedScores){var name=operatorId;localVars.operatorDic&&localVars.operatorDic[operatorId]&&(name=localVars.operatorDic[operatorId]),thisTable.rows.push([name,localVars.calculatedScores[operatorId]])}return thisTable.rows.sort(function(a,b){return b[1]-a[1]}),thisTable},Method.getUserScore=function(){return $rootScope.IbartarUserInfo&&localVars.calculatedScores&&-1!=localVars.userPlaces.indexOf(String($rootScope.IbartarUserInfo.id))?{score:localVars.calculatedScores[$rootScope.IbartarUserInfo.id],place:localVars.userPlaces.indexOf(String($rootScope.IbartarUserInfo.id))+1}:!1},Method.calcUserScores=function(){if(!localVars.log)return!1;var scores={};for(var key in localVars.log)if("total"!=key){scores[key]=0;var userLogs=localVars.log[key];for(var pageKey in userLogs)for(var catKey in userLogs[pageKey]){var cat=userLogs[pageKey][catKey];for(var actionKey in cat)scores[key]+=scoreMultiplierConfig[actionKey]*cat[actionKey]}}return localVars.log=null,localVars.calculatedScores=scores,Method.calculateLevelOfThisUser(),scores},Method.calculateLevelOfThisUser=function(){if(!$rootScope.IbartarUserInfo||!localVars.calculatedScores)return!1;var sortable=[];for(var key in localVars.calculatedScores)sortable.push([key,localVars.calculatedScores[key]]);sortable.sort(function(a,b){return b[1]-a[1]});for(var levelOfUsersArr=[],i=0;i<=sortable.length-1;i++)levelOfUsersArr.push(sortable[i][0]);localVars.userPlaces=levelOfUsersArr},Method.tryToShow=function(){$rootScope.IbartarUserInfo||localStorage.removeItem("operatorGame"),"5"==localStorage.getItem("operatorGame")?Method.getOperatorLog(Method.showScore):(localStorage.getItem("operatorGame")||localStorage.setItem("operatorGame",0),localStorage.setItem("operatorGame",parseInt(localStorage.getItem("operatorGame"))+1))},Method.showScore=function(){var userScore=Method.getUserScore();userScore&&swal({title:"امتیاز شما!",text:"شما تا به الان نفر "+userScore.place+" با امتیاز "+userScore.score+" بین اپراتورها هستید ",type:"success",confirmButtonColor:"#DD6B55",confirmButtonText:"بسیار خوب",closeOnConfirm:!0}),localStorage.setItem("operatorGame",0)},Method}),angular.module("ibartarApp").factory("SearchResultSaver",function(){var resultJsonResponse,Model={},lock=!0;return Model.save=function(response){resultJsonResponse=response},Model.restore=function(){var response=lock?null:resultJsonResponse;return lock=!0,response},Model.isLock=function(){return lock},Model.lock=function(){lock=!0},Model.unlock=function(){lock=!1},Model.reset=function(){resultJsonResponse=null},Model}),angular.module("ibartarApp").factory("feedService",function($http,appConfig){var Model={};return Model.getFeedList=function(paramsOfList){return $http.post(appConfig.api+"/feed/list",paramsOfList)},Model}),angular.module("ibartarApp").controller("AuthLogin",function($scope,$http,$log,$state,$location,$window,$timeout,$rootScope,appConfig,WebServices,notifications,ngProgress,Analytics,utils){$scope.reloadThisPage=function(input){input&&location.reload()},$scope.showMsgSuc=!1,$scope.showMsgErr=!1,$scope.newUser=!0,$scope.msgSuccess="",$scope.msgError="",utils.prepareTheUserRoutes(),$rootScope.IbartarUserInfo?$rootScope.VisibleLoginFloating=!1:$rootScope.VisibleLoginFloating=!0,$scope.signINUser={EmailOrPhone:"",Userpassword:""},$scope.SubmitLoginFloating=function(signInUser){$scope.loginUser=!1;var FormDataSignIn={username:signInUser.EmailOrPhone,password:signInUser.Userpassword};for(key in FormDataSignIn)0===FormDataSignIn[key].length&&($scope.loginUser=!0);var signInDataForSend=new FormData;signInDataForSend.append("username",FormDataSignIn.username),signInDataForSend.append("password",FormDataSignIn.password),$scope.loginUser?notifications.showError("پر کردن تمامی فیلد ها اجباری است!"):WebServices.LoginUserNew(signInDataForSend).success(function(response){ngProgress.complete(),$scope.EmailOrPhone="",$scope.Userpassword="",$rootScope.IbartarUserInfo=response,utils.prepareTheUserRoutes(),$rootScope.VisibleLoginFloating=!1,$scope.ErrorMessages="",$state.$current.data&&$state.$current.data.mustBeLoggedOut&&$state.go("home",{},{reload:!0}),1==response.profileVersion?($scope.openModalSignIn=!1,$scope.openModalShowMessageEditProfile=!0,$scope.showMessageEditProfile=!0,$scope.newUser=!1):($scope.signInForm=!1,$scope.showMsgSuc=!0,$scope.msgSuccess="ورود شما با موفقیت انجام شد.",$timeout(function(){$scope.showMsgSuc=!1,$scope.openModalSignIn=!1},1e3))}).error(function(errors){$scope.errors=errors,$scope.signInForm=!1,$scope.showMsgErr=!0,$scope.msgError=$scope.errors.errors,$timeout(function(){$scope.openModalSignIn=!0,$scope.showMsgErr=!1,$scope.signInForm=!0},2e3)})},$scope.LogOutUser=function(){ngProgress.start(),WebServices.LogOutUser().then(function(result){if(ngProgress.complete(),result.data.status){$rootScope.VisibleLoginFloating=!0,$rootScope.IbartarUserInfo=null;$state.$current.data;$state.go($state.current,{},{reload:!0})}else notifications.showError("خطایی در سیستم رخ داده است"),$log.error("unexpected Error Has been occurred")},function(){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور رخ داده است"),$log.error("Error in Sending Data For Loging in")})},$scope.LogOutUserShowMessage=function(){$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,ngProgress.start(),WebServices.LogOutUser().then(function(result){if(ngProgress.complete(),result.data.status){$rootScope.VisibleLoginFloating=!0,$rootScope.IbartarUserInfo=null;var required=$state.$current.data;$state.$current.data&&required.mustBeLoggedIn&&$state.go("home")}else notifications.showError("خطایی در سیستم رخ داده است"),$log.error("unexpected Error Has been occurred")},function(){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور رخ داده است"),$log.error("Error in Sending Data For Loging in")})},$scope.OpenMobVerif=function(){mobVerif.Open()},angular.element($window).bind("scroll",function(){this.pageYOffset>=10?$rootScope.AttachMenuInHome=!1:$state.is("home")&&($rootScope.AttachMenuInHome=!0),$scope.$apply()}),$scope.signUpForm=!1,$scope.signInForm=!1,$scope.openModalSignUp=!1,$scope.openModalSignIn=!1,$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,$scope.GoToCreatePageByMenu=function(){Analytics.trackEvent("TopMenuCreatePage")},$scope.GotoUserCreateLinkByMenu=function(){$scope.openModalSignUp=!0,$scope.signUpForm=!0},$scope.linkSignUpFun=function(){$scope.openModalSignIn=!1,$scope.openModalSignUp=!0,$scope.signUpForm=!0},$scope.linkSignInFun=function(){$scope.openModalSignUp=!1,$scope.openModalSignIn=!0,$scope.signInForm=!0},$scope.signInUser=function(){$scope.openModalSignIn=!0,$scope.signInForm=!0},$scope.GoToMapByMenu=function(){Analytics.trackEvent("TopMenuMapClick")};$scope.inputType="password",$scope.showOrHidePassword=function(){"password"==$scope.inputType?$scope.inputType="text":$scope.inputType="password"},$scope.FormErrors={},$scope.checkedMale=!0,$scope.checkedFemale=!1,$scope.selectMale=function(){$scope.checkedMale=!0,$scope.checkedFemale=!1},$scope.selectFemale=function(){$scope.checkedMale=!1,$scope.checkedFemale=!0},$scope.SubmitUserRegForm=function(signUpUser){if($scope.dontReg=!1,ngProgress.start(),$scope.checkedMale?$scope.gender="male":$scope.gender="female",void 0!==signUpUser){var formDataToSend={email:signUpUser.email,password:signUpUser.userPassword,firstName:signUpUser.firstName,lastName:signUpUser.lastName,gender:$scope.gender};for(key in formDataToSend)void 0===formDataToSend[key]&&($scope.dontReg=!0)}else $scope.dontReg=!0;var referrer=$location.$$search.referrer;referrer&&(formDataToSend.referrer=referrer),$scope.dontReg?notifications.showError("پر کردن  تمامی فیلد ها اجباری است!"):WebServices.SignUpUser(formDataToSend).success(function(response){ngProgress.complete(),$scope.signUpForm=!1,$scope.showMsgSuc=!0,$scope.msgSuccess="ثبت نام شما با موفقیت انجام شد",$timeout(function(){$scope.openModalSignUp=!1,$scope.showMsgSuc=!1,$rootScope.IbartarUserInfo=response,$state.params.redirect="http://"+$window.location.host,window.location.href=decodeURIComponent($state.params.redirect)},1e3)}).error(function(errors,status){$scope.errors={message:errors,status:status},$scope.signUpForm=!1,$scope.showMsgErr=!0,422==$scope.errors.status?angular.forEach($scope.errors.message,function(objError,inx){angular.forEach(objError,function(messageError,item){notifications.showError(messageError[0])})}):notifications.showError($scope.errors.message),$timeout(function(){$scope.openModalSignUp=!0,$scope.showMsgErr=!1,$scope.signUpForm=!0},2e3)})},$scope.goForgetPassword=function(){$scope.openModalSignIn=!1,$scope.signInForm=!1,$state.params.redirect="http://"+$window.location.host+"/user/forgotPassword",window.location.href=decodeURIComponent($state.params.redirect)},$scope.goEditProfile=function(){$scope.openModalSignIn=!1,$scope.showMessageEditProfile=!1,$state.params.redirect="http://"+$window.location.host+"/editProfile",window.location.href=decodeURIComponent($state.params.redirect)},$scope.goToTos=function(){$scope.openModalSignUp=!1,$state.params.redirect="http://"+$window.location.host+"/tos",window.location.href=decodeURIComponent($state.params.redirect)}}),angular.module("ibartarApp").controller("AuthLoginSpecialPage",function($scope,$http,$log,$state,$location,$window,$timeout,$rootScope,appConfig,WebServices,notifications,ngProgress,Analytics,utils){$scope.dunroLogo=$rootScope.ShowData.data.data.template.dunro_logo,$scope.titleColor=$rootScope.ShowData.data.data.template.title_color,$scope.businessUuid=$rootScope.ShowData.data.data.uuid,$scope.reloadThisPage=function(input){input&&location.reload()},$scope.showMsgSuc=!1,$scope.showMsgErr=!1,$scope.newUser=!0,$scope.msgSuccess="",$scope.msgError="",utils.prepareTheUserRoutes(),$rootScope.IbartarUserInfo?$rootScope.VisibleLoginFloating=!1:$rootScope.VisibleLoginFloating=!0,$scope.signINUser={EmailOrPhone:"",Userpassword:""},$scope.SubmitLoginFloating=function(signInUser){$scope.loginUser=!1;var FormDataSignIn={username:signInUser.EmailOrPhone,password:signInUser.Userpassword};for(key in FormDataSignIn)0===FormDataSignIn[key].length&&($scope.loginUser=!0);var signInDataForSend=new FormData;signInDataForSend.append("username",FormDataSignIn.username),signInDataForSend.append("password",FormDataSignIn.password),$scope.loginUser?notifications.showError("پر کردن تمامی فیلد ها اجباری است!"):WebServices.LoginUserNew(signInDataForSend).success(function(response){ngProgress.complete(),$scope.EmailOrPhone="",$scope.Userpassword="",$rootScope.IbartarUserInfo=response,utils.prepareTheUserRoutes(),$rootScope.VisibleLoginFloating=!1,$scope.ErrorMessages="",$state.$current.data&&$state.$current.data.mustBeLoggedOut&&$state.go("home",{},{reload:!0}),1==response.profileVersion?($scope.openModalSignIn=!1,$scope.openModalShowMessageEditProfile=!0,$scope.showMessageEditProfile=!0,$scope.newUser=!1):($scope.signInForm=!1,$scope.showMsgSuc=!0,$scope.msgSuccess="ورود شما با موفقیت انجام شد.",$timeout(function(){$scope.showMsgSuc=!1,$scope.openModalSignIn=!1},1e3))}).error(function(errors){$scope.errors=errors,$scope.signInForm=!1,$scope.showMsgErr=!0,$scope.msgError=$scope.errors.errors,$timeout(function(){$scope.openModalSignIn=!0,$scope.showMsgErr=!1,$scope.signInForm=!0},2e3)})},$scope.LogOutUser=function(){ngProgress.start(),WebServices.LogOutUser().then(function(result){if(ngProgress.complete(),result.data.status){$rootScope.VisibleLoginFloating=!0,$rootScope.IbartarUserInfo=null;$state.$current.data;$state.go($state.current,{},{reload:!0})}else notifications.showError("خطایی در سیستم رخ داده است"),$log.error("unexpected Error Has been occurred")},function(){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور رخ داده است"),$log.error("Error in Sending Data For Loging in")})},$scope.LogOutUserShowMessage=function(){$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,ngProgress.start(),WebServices.LogOutUser().then(function(result){if(ngProgress.complete(),result.data.status){$rootScope.VisibleLoginFloating=!0,$rootScope.IbartarUserInfo=null;var required=$state.$current.data;$state.$current.data&&required.mustBeLoggedIn&&$state.go("home")}else notifications.showError("خطایی در سیستم رخ داده است"),$log.error("unexpected Error Has been occurred")},function(){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور رخ داده است"),$log.error("Error in Sending Data For Loging in")})},$scope.OpenMobVerif=function(){mobVerif.Open()},angular.element($window).bind("scroll",function(){this.pageYOffset>=10?$rootScope.AttachMenuInHome=!1:$state.is("home")&&($rootScope.AttachMenuInHome=!0),$scope.$apply()}),$scope.signUpForm=!1,$scope.signInForm=!1,$scope.openModalSignUp=!1,$scope.openModalSignIn=!1,$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,$scope.GoToCreatePageByMenu=function(){Analytics.trackEvent("TopMenuCreatePage")},$scope.GotoUserCreateLinkByMenu=function(){$scope.openModalSignUp=!0,$scope.signUpForm=!0},$scope.linkSignUpFun=function(){$scope.openModalSignIn=!1,$scope.openModalSignUp=!0,$scope.signUpForm=!0},$scope.linkSignInFun=function(){$scope.openModalSignUp=!1,$scope.openModalSignIn=!0,$scope.signInForm=!0},$scope.signInUser=function(){$scope.openModalSignIn=!0,$scope.signInForm=!0},$scope.GoToMapByMenu=function(){Analytics.trackEvent("TopMenuMapClick")};$scope.inputType="password",$scope.showOrHidePassword=function(){"password"==$scope.inputType?$scope.inputType="text":$scope.inputType="password"},$scope.FormErrors={},$scope.checkedMale=!0,$scope.checkedFemale=!1,$scope.selectMale=function(){$scope.checkedMale=!0,$scope.checkedFemale=!1},$scope.selectFemale=function(){$scope.checkedMale=!1,$scope.checkedFemale=!0},$scope.SubmitUserRegForm=function(signUpUser){if($scope.dontReg=!1,ngProgress.start(),$scope.checkedMale?$scope.gender="male":$scope.gender="female",void 0!==signUpUser){var formDataToSend={email:signUpUser.email,password:signUpUser.userPassword,firstName:signUpUser.firstName,lastName:signUpUser.lastName,gender:$scope.gender};for(key in formDataToSend)void 0===formDataToSend[key]&&($scope.dontReg=!0)}else $scope.dontReg=!0;var referrer=$location.$$search.referrer;referrer&&(formDataToSend.referrer=referrer),$scope.dontReg?notifications.showError("پر کردن  تمامی فیلد ها اجباری است!"):WebServices.SignUpUser(formDataToSend).success(function(response){ngProgress.complete(),$scope.signUpForm=!1,$scope.showMsgSuc=!0,$scope.msgSuccess="ثبت نام شما با موفقیت انجام شد",$timeout(function(){$scope.openModalSignUp=!1,$scope.showMsgSuc=!1,$rootScope.IbartarUserInfo=response,$state.params.redirect="http://"+$window.location.host,window.location.href=decodeURIComponent($state.params.redirect)},1e3)}).error(function(errors,status){$scope.errors={message:errors,status:status},$scope.signUpForm=!1,$scope.showMsgErr=!0,422==$scope.errors.status?angular.forEach($scope.errors.message,function(objError,inx){angular.forEach(objError,function(messageError,item){notifications.showError(messageError[0])})}):notifications.showError($scope.errors.message),$timeout(function(){$scope.openModalSignUp=!0,$scope.showMsgErr=!1,$scope.signUpForm=!0},2e3)})},$scope.goForgetPassword=function(){$scope.openModalSignIn=!1,$scope.signInForm=!1,$state.params.redirect="http://"+$window.location.host+"/user/forgotPassword",window.location.href=decodeURIComponent($state.params.redirect)},$scope.goEditProfile=function(){$scope.openModalSignIn=!1,$scope.showMessageEditProfile=!1,$state.params.redirect="http://"+$window.location.host+"/editProfile",window.location.href=decodeURIComponent($state.params.redirect)},$scope.goToTos=function(){$scope.openModalSignUp=!1,$state.params.redirect="http://"+$window.location.host+"/tos",window.location.href=decodeURIComponent($state.params.redirect)}}),angular.module("ibartarApp").controller("NewHomeCtrl",function($scope,$state,$http,$log,$rootScope,$timeout,ngProgress,appConfig,MetaService,uiGmapGoogleMapApi,MapMarker,$window,$ocLazyLoad,utils,WebServices,SearchRequests,searchTraceService,Analytics,channelService,DataHomePage,PopularareasHome){$(window).on("beforeunload",function(){$(window).scrollTop(0)}),$scope.DataHome=DataHomePage.data,$scope.PopAreas=PopularareasHome.data.data,$scope.dataHomeCopy=angular.copy($scope.DataHome),$scope.openModalPlay=!1,$rootScope.PageHeader="دانرو - راهنمای شهر",$rootScope.Pagedescriptions="دانرو کاملترین مرجع اطلاعات شهری در ایران است. نشانی نزدیکترین و بهترین کسب و کارهای شهر را در دانرو پیدا کنید.",$scope.OgTitle=$rootScope.PageHeader,$scope.OgImage=$rootScope.ThemebaseNew+"/img/logo/logo.png",$scope.OgDescription=$rootScope.Pagedescriptions,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage),$rootScope.pathClose=$rootScope.ThemebaseNew+"/img/logo/close.svg",$("#sliderCarousel").carousel({interval:4e3}),$("#eventCarousel").carousel({interval:2e3}),$("#commentsCarousel").carousel({interval:2e3}),angular.forEach($scope.dataHomeCopy,function(ObjData,index){if("slider"===ObjData._type&&($scope.sliders=ObjData.items),"events"===ObjData._type){if($scope.eventsArray=[],4===ObjData.items.length)var indexEventsArray=Math.floor(ObjData.items.length/4);else var indexEventsArray=Math.floor(ObjData.items.length/4)+1;for(var i=0;indexEventsArray>i;i++)$scope.eventsArray.push(ObjData.items.splice(0,4))}if("comments"===ObjData._type){if($scope.commentsArray=[],4===ObjData.items.length)var indexCommentsArray=Math.floor(ObjData.items.length/4);else var indexCommentsArray=Math.floor(ObjData.items.length/4)+1;for(var i=0;indexCommentsArray>i;i++)$scope.commentsArray.push(ObjData.items.splice(0,4))}"categories"===ObjData._type&&($scope.categories=ObjData.items)}),$scope.playVideo=function(){$scope.openModalPlay=!0},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},WebServices.getCounterData().then(function(result){$scope.Count=result.data.data.count,0!=result.data.data.speed&&setInterval(function(){$scope.Count++,$scope.$apply()},result.data.data.speed)},utils.MHandler[1]);var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.GoToMapByMapModule=function(){Analytics.trackEvent("HomeMoreInMap")},$scope.ClickOnSuggestedJobs=function(){Analytics.trackEvent("SuggestedJobsClick")},$scope.SetChannel=function(indexPos,guildSelected,uuid){channelService.setChannel("main_page",{chanel_details:indexPos,q:guildSelected},uuid),searchTraceService.saveSearchLogByUuid(uuid,"menu")},$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))},$scope.beautyUriEvent=function(id,urlEvent){return decodeURIComponent($state.href("landingEvent",{id:id,urlEvent:urlEvent}))},window.onscroll=function(){var parallaxElement=$(".parallax");if(0!=parallaxElement.length){var minTopConstraintMobileView=-350,maxTopConstraintMobileView=50,mobileViewElement=$(".mobileViewBanner"),parallaxHeight=parallaxElement.height(),parallaxTopToWindowTop=parallaxElement.offset().top-parallaxHeight,windowScrollTop=window.pageYOffset,offsetThreshold=window.innerHeight/2;if(windowScrollTop+offsetThreshold>parallaxTopToWindowTop){var startParallaxValue=parallaxTopToWindowTop-offsetThreshold,endParallaxValue=parallaxTopToWindowTop+parallaxHeight+offsetThreshold,parallaxScrollPercent=(windowScrollTop-startParallaxValue)/(endParallaxValue-startParallaxValue),calculatedTopConstraintOfMobileView=(minTopConstraintMobileView-maxTopConstraintMobileView)*parallaxScrollPercent+maxTopConstraintMobileView;mobileViewElement.css({top:calculatedTopConstraintOfMobileView+"px"})}else mobileViewElement.css({top:maxTopConstraintMobileView+"px"})}},$("#typed").typed({stringsElement:$("#typed-strings"),loop:!0,typeSpeed:50,startDelay:150,backDelay:1e3})}),angular.module("ibartarApp").controller("MapCtrl",function($scope,$state,$ocLazyLoad,$stateParams,$location,$rootScope,$timeout,uiGmapGoogleMapApi,SearchRequests,utils,MenuJobs,appConfig,MapArea,ngProgress,Analytics){function GetCorners(){var bounds=$scope.map.control.getGMap().getBounds();if(bounds){var boundTopRight=bounds.getNorthEast(),boundLeftBottom=bounds.getSouthWest();return boundTopRight.lat()+","+boundLeftBottom.lng()+","+boundLeftBottom.lat()+","+boundTopRight.lng()}}$scope.JobChilds=[],$rootScope.loadFooter=!0,$rootScope.PageHeader="نتیجه جستجو روی نقشه | دانرو",$scope.TopHeadMenuCarousel={OWOptions:{items:10,responsive:!1,singleItem:!0,rtl:!0,autoWidth:!1},CarouselClass:"MenuBaCkGround TopHeaderMenu CarouselContainer",SlideClass:"JobsCat",ItemTemplate:appConfig.BaseTheme+"/views/carousel/CarouselItems/TopHeadMenuItems.html",SlideItems:MenuJobs.data.result,base:appConfig.base,SlidesBackGround:"MenuBackGround",GetArea:MapArea.getProperty},$scope.SubCategoryItems={OWOptions:{items:10,singleItem:!0,responsive:!1,rtl:!0},CarouselClass:"MenuBaCkGround SubCategoryItems CarouselContainer ReloadAble",SlideClass:"JobsChild",ItemTemplate:appConfig.BaseTheme+"/views/carousel/CarouselItems/SubCategoryItems.html",SlideItems:[],base:appConfig.base,GetArea:MapArea.getProperty,GotoResultState:function(Guild,PageNum,Area){$scope.GoogleMapViewBoxClass="FullWidthCol8",$scope.ResultViewBoxClass="FullWidthCol4",$scope.LoaderList="",setTimeout(function(){$scope.map.control.refresh();var urlobj=utils.getJsonFromUrl(Guild);$scope.shownotification=!1,$state.go("map.list",{guild:urlobj.guild?urlobj.guild:"",q:"undefined"!=typeof urlobj.q?q:"",page:PageNum,area:Area})},1e3)}},$scope.OpenSubCats="ClosedSubCatsMenu",$scope.GoogleMapSearch="MapBoxContainer",$scope.RightMenuContainer="RigthListContainer",$scope.ResultViewBoxClass="FullWidthCol0",$scope.GoogleMapViewBoxClass="FullWidthCol12",$scope.sortByLocation=!0,$scope.ResetMapSearch=!1,$scope.TopHeadMenuCarousel.ChangeChild=function(JobCategory){JobCategory.children.length?($scope.OpenSubCats="ClosedSubCatsMenu OpenSubCatsMenu fadeIn animated",$scope.GoogleMapSearch="MapBoxContainerChangeSize",$scope.RightMenuContainer="RigthListContainerChangeSize"):($scope.OpenSubCats="ClosedSubCatsMenu",$scope.GoogleMapSearch="MapBoxContainer",$scope.RightMenuContainer="RigthListContainer",$scope.GoogleMapViewBoxClass="FullWidthCol8",$scope.ResultViewBoxClass="FullWidthCol4",$scope.LoaderList="",setTimeout(function(){$scope.map.control.refresh();var urlobj=utils.getJsonFromUrl(JobCategory.search_string),ThisArea=MapArea.getProperty();$state.go("map.list",{guild:urlobj.guild?urlobj.guild:"",q:"undefined"!=typeof urlobj.q?q:"",page:1,area:ThisArea})},1e3)),$scope.SubCategoryItems.SlideItems=JobCategory.children},uiGmapGoogleMapApi.then(function(maps){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}},events:{resize:function(){MapArea.setProperty(GetCorners())},center_changed:function(){MapArea.setProperty(GetCorners())},tilesloaded:function(){MapArea.setProperty(GetCorners())},dragend:function(){($location.$$search.guild||$location.$$search.q)&&($scope.ResetMapSearch=!0)}}},$scope.ResultMarkers=[],$scope.controlMarkers={},$scope.me={idKey:"me",Coords:{latitude:35.755707,longitude:51.430709},icon:appConfig.BaseTheme+"/images/location.png",control:{},options:{draggable:!0,animation:google.maps.Animation.DROP},events:{dragend:function(marker){var settingArr=[marker.position.lat(),marker.position.lng()];SearchRequests.SetCurrentLocationInArray(settingArr),$state.is("map.list")&&$scope.ReseachTheMap()}}};var clearTheMeMArker=setInterval(function(){$scope.me.control.getGMarkers&&($scope.me.control.getGMarkers()[0].setMap(null),clearInterval(clearTheMeMArker))},200);$scope.changeSearchType=function(){$scope.Switchclass=!$scope.Switchclass},$scope.$watch("Switchclass",function(){if($scope.me.control.getGMarkers){var CurMarker=$scope.me.control.getGMarkers(),CurMapMap=$scope.map.control.getGMap();setTimeout(function(){$scope.Switchclass?(Analytics.trackEvent("EnableLocationInMap"),$scope.me.Coords={latitude:$scope.map.center.latitude,longitude:$scope.map.center.longitude},SearchRequests.SetCurrentLocationInArray([$scope.map.center.latitude,$scope.map.center.longitude]),SearchRequests.EnableLocation(),CurMarker[0].setMap(CurMapMap),$state.is("map.list")&&$scope.ReseachTheMap()):($scope.shownotification=!1,
CurMarker[0].setMap(null),SearchRequests.DisableLocation(),$state.is("map.list")&&$scope.ReseachTheMap()),$scope.$apply()},100)}})})}),$scope.SetMarkerToCurrentLocation=function(){ngProgress.start();var CurMarker=$scope.me.control.getGMarkers(),CurMapMap=$scope.map.control.getGMap();utils.getCurrentLocation().then(function(coords){ngProgress.complete(),$scope.me.Coords={latitude:coords.latitude,longitude:coords.longitude};var thisUserMarker=$scope.me.control.getGMarkers();thisUserMarker[0].setZIndex(10),SearchRequests.SetCurrentLocationInArray([coords.latitude,coords.longitude]),SearchRequests.EnableLocation(),CurMarker[0].setMap(CurMapMap),$state.is("map.list")?$scope.ReseachTheMap():($scope.MapNotif="<i class='icon-target'></i> مکان شما با موفقیت یافت شد. حال می توانید با <br>استفاده از منوی بالا جستجو نمایید.",$scope.map.center={latitude:coords.latitude,longitude:coords.longitude},$scope.shownotification=!0)},function(){ngProgress.complete(),$scope.me.Coords={latitude:$scope.map.center.latitude,longitude:$scope.map.center.longitude},notification.showError("متاسفانه مکان فعلی شما را پیدا نکردیم، لطفا تنظیمات مرورگر خود را تغییر دهید و دوباره تلاش کنید."),$scope.shownotification=!0,SearchRequests.SetCurrentLocationInArray([$scope.map.center.latitude,$scope.map.center.longitude]),SearchRequests.EnableLocation(),CurMarker[0].setMap(CurMapMap),$state.is("map.list")&&$scope.ReseachTheMap()})},uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){$timeout(function(){$scope.map.control.refresh()})})}),$scope.ReseachTheMap=function(){$state.go("map.list",{guild:$location.$$search.guild?$location.$$search.guild:"",q:$location.$$search.q?$location.$$search.q:"",page:1,area:MapArea.getProperty()}),$scope.ResetMapSearch=!1},$scope.ResearchButAction=function(){$scope.me.control.getGMarkers&&$scope.ResetMapSearch?($scope.me.Coords={latitude:$scope.map.control.getGMap().center.lat(),longitude:$scope.map.control.getGMap().center.lng()},SearchRequests.SetCurrentLocationInArray([$scope.me.Coords.latitude,$scope.me.Coords.longitude]),$scope.ReseachTheMap()):$scope.ReseachTheMap()},$location.$$search.guild||$location.$$search.q||$location.$$search.keyword?($scope.GoogleMapViewBoxClass="FullWidthCol8",$scope.ResultViewBoxClass="FullWidthCol4",$scope.LoaderList="",uiGmapGoogleMapApi.then(function(){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){setTimeout(function(){"undefined"!=typeof google&&$scope.map.control.refresh(),"true"==$location.$$search.currentlocation?($scope.Switchclass=!0,setTimeout(function(){$state.go("map.list",{guild:$location.$$search.guild?$location.$$search.guild:"",q:$location.$$search.q?$location.$$search.q:"",page:$location.$$search.page?$location.$$search.page:"",area:$location.$$search.area?$location.$$search.area:"",keyword:$location.$$search.keyword?$location.$$search.keyword:""})},5e3)):$state.go("map.list",{guild:$location.$$search.guild?$location.$$search.guild:"",q:$location.$$search.q?$location.$$search.q:"",page:$location.$$search.page?$location.$$search.page:"",area:$location.$$search.area?$location.$$search.area:"",keyword:$location.$$search.keyword?$location.$$search.keyword:""})},500)})})):utils.getCookie("mapshownhint")||(utils.setCookie("mapshownhint",!0),$scope.startJoyRide=!0,$scope.HintHasBeenShown=!0),$scope.$on("$destroy",function(){SearchRequests.DisableLocation()}),$scope.TourConfig=[{type:"element",selector:".TopHeadMenuCarousel",placement:"bottom",heading:"انتخاب گروه های کسب و کار",text:"شما ازا این قسمت می توانید گروه کسب و کار را انتخاب و نتایج را روی نقشه مشاهده کنید."},{type:"function",fn:function(){jQuery(".TopHeaderMenu .owl-carousel .owl-stage-outer .owl-stage .owl-item:first-child button").click()}},{type:"element",selector:".TopGuildModule",placement:"bottom",heading:"انتخاب از زیر گروه ها",text:"برخی از کسب و کار ها مانند این مورد دارای زیر گروه می باشند، شما می توانید برای جستجوی دقیق تر یکی از این موارد را انتخاب نمایید"},{type:"function",fn:function(){jQuery(".SubMenuCategoryCarousel .owl-carousel .owl-stage-outer .owl-stage .owl-item:first-child button").click()}}],$scope.htmlReady()}),angular.module("ibartarApp").controller("ShowCtrl",function($scope,$rootScope,$ocLazyLoad,$state,roundProgressService,$timeout,$stateParams,$log,$location,appConfig,uiGmapGoogleMapApi,utils,$interval,$window,MetaService,WebServices,Analytics,ngProgress,notifications,SearchRequests,channelService,$http,searchTraceService){function PrepareForRate(){ngProgress.start();var PrepareForRateObj={popular:$scope.popular,reliable:$scope.reliable,credible:$scope.credible};return PrepareForRateObj}$(window).on("beforeunload",function(){$(window).scrollTop(0)}),$window.scrollTo(0,0);var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};if($scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},!$rootScope.ShowData||!$rootScope.ShowData.data.status)return $state.go("404",{location:!1}),!1;$scope.page=$rootScope.ShowData.data.data,$scope.userMediaUpload=$rootScope.userMediaData.data,$scope.sameItemsTitle="کسب و کارهای مشابه",$scope.RelatedBusinesses=$scope.page.relatedBusinesses,$scope.lazyLoadPrettyPhoto=$rootScope.lazyLoad.prettyPhoto,$scope.favorite=$rootScope.ShowData.data.data.liked_by_user,$scope.MoreProduct=!1,$scope.showMoreAbout=!1,$scope.isEmpty=utils.isEmpty,$scope.likeImage="/img/images/heart-Final.svg",$scope.likedImage="/img/images/isLiked.svg",$scope.claimableBiz=!1,$rootScope.templateDetect=$scope.page.template,null!==$scope.page._links.claim&&($scope.claimableBiz=!0),$scope.moreAbout=function(){$scope.showMoreAbout=!0},$scope.lessAbout=function(){$scope.showMoreAbout=!1},$scope.addRate=!0,$scope.addComment=!1,$scope.openModal=!1,$scope.addRateModal=!1,$scope.editRateModal=!1,$scope.doneRateModal=!1,$scope.addCommentModal=!1,$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!1,$scope.defaultRateReliable=!1,$scope.defaultRateCredible=!1,$scope.rate=$rootScope.CheckShowRate.data,$scope.rateData=$scope.rate.data,$scope.replyOpen=!1,$scope.popular=null,$scope.reliable=null,$scope.credible=null,$scope.rate.status&&null!==$scope.rate.data&&($scope.addRate=!1,$scope.addComment=!0),null!==$scope.page.rates&&($scope.totalRates=$scope.page.rates.count),null!==$scope.page.rates&&($scope.fivestarRate=(($scope.page.rates.credibility+$scope.page.rates.popularity+$scope.page.rates.reliability)/3*100).toFixed(0)/10/2),$scope.page.rates&&$scope.page.rates.popularity&&($scope.popularity=Math.round(100*$scope.page.rates.popularity)),$scope.page.rates&&$scope.page.rates.reliability&&($scope.reliability=Math.round(100*$scope.page.rates.reliability)),$scope.page.rates&&$scope.page.rates.credibility&&($scope.credibility=Math.round(100*$scope.page.rates.credibility)),$timeout(function(){var c=document.getElementById("canvas"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=25,thirdRadius=40;ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),$scope.page.rates&&(1==$scope.page.rates.credibility&&($scope.page.rates.credibility=0),1==$scope.page.rates.popularity&&($scope.page.rates.popularity=0),1==$scope.page.rates.reliability&&($scope.page.rates.reliability=0),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#be49cc",ctx.stroke())},0),$timeout(function(){var c=document.getElementById("canvas-comment"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=25,thirdRadius=40;ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),$scope.page.rates&&(1==$scope.page.rates.credibility&&($scope.page.rates.credibility=0),1==$scope.page.rates.popularity&&($scope.page.rates.popularity=0),1==$scope.page.rates.reliability&&($scope.page.rates.reliability=0),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-$scope.page.rates.popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#be49cc",ctx.stroke())},0),$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.page),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.popularUpRate=function(){$scope.popular="1",$scope.defaultRatePopularUp=!0,$scope.defaultRatePopularDown=!1},$scope.popularDownRate=function(){$scope.popular="0",$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!0},$scope.reliableUpRate=function(){$scope.reliable="1",$scope.defaultRateReliableUp=!0,$scope.defaultRateReliableDown=!1},$scope.reliableDownRate=function(){$scope.reliable="0",$scope.defaultRateReliableUp=!1,$scope.defaultRateReliableDown=!0},$scope.credibleUpRate=function(){$scope.credible="1",$scope.defaultRateCredibleUp=!0,$scope.defaultRateCredibleDown=!1},$scope.credibleDownRate=function(){$scope.credible="0",$scope.defaultRateCredibleUp=!1,$scope.defaultRateCredibleDown=!0},$scope.addRatePage=function(pageModal){ngProgress.start(),$scope.modalRatePage=angular.copy(pageModal);var FormDataToRate=PrepareForRate(),FormDataToRateModal=new FormData;FormDataToRateModal.append("popular",FormDataToRate.popular),FormDataToRateModal.append("reliable",FormDataToRate.reliable),FormDataToRateModal.append("credible",FormDataToRate.credible),WebServices.addRatePage($scope.page.uuid,FormDataToRateModal).then(function(result){result.data.status?(ngProgress.complete(),$scope.addRateModal=!$scope.addRateModal,$scope.doneRateModal=!$scope.doneRateModal,$timeout(function(){var c=document.getElementById("canvas-modal"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=25,thirdRadius=40;if($scope.modalRatePage.rates)var count=parseInt($scope.modalRatePage.rates.count),pagePopularity=$scope.modalRatePage.rates.popularity,pageReliability=$scope.modalRatePage.rates.reliability,pageCredibility=$scope.modalRatePage.rates.credibility;else var count=0,pagePopularity=0,pageReliability=0,pageCredibility=0;$scope.rate.data?(countRate=count,oldRatePopular=$scope.rate.data.popular,oldRateCredible=$scope.rate.data.credible,oldRateReliable=$scope.rate.data.reliable):(countRate=count+1,oldRatePopular="0",oldRateCredible="0",oldRateReliable="0");var popularity=pagePopularity+(FormDataToRate.popular-oldRatePopular)/countRate,reliability=pageReliability+(FormDataToRate.reliable-oldRateReliable)/countRate,credibility=pageCredibility+(FormDataToRate.credible-oldRateCredible)/countRate,modalRate={popularity:popularity,reliability:reliability,credibility:credibility};$scope.pageModal.rates=modalRate,ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=10,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=10,ctx.strokeStyle="#be49cc",ctx.stroke()},0)):(notifications.showError("پر کردن هر سه فیلد اجباری است!"),$state.go($state.current,{reload:!0,inherit:!1}))},utils.MHandler[1])},$scope.editRate=function(){$scope.pageModal=angular.copy($scope.page),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.editRateModal=!$scope.editRateModal,$scope.addCommentModal=!$scope.addCommentModal},$scope.activeBtn=!1,$scope.activeBtnFirst=!0,$scope.showComments=!1,$scope.paginateComment=!1,$scope.deleteComment=[],$scope.reportComment=[],$scope.deleteReply=[],$scope.activeBtn=[],$scope.uploadImgComment=!1,$scope.theImageComment=!1,$scope.theNameImageComment=!1,$scope.modalPropertiesAddComment={title:null,content:null,image:null},$scope.mouseDownComment=function(commentUserId,commentIndex){$rootScope.IbartarUserInfo&&commentUserId===$rootScope.IbartarUserInfo.id?($scope.deleteComment[commentIndex]=!0,$scope.reportComment[commentIndex]=!1):($scope.deleteComment[commentIndex]=!1,$scope.reportComment[commentIndex]=!0)},$scope.mouseLeaveComment=function(commentIndex){$scope.reportComment[commentIndex]=!1},$scope.reportCommentFunc=function(comment){$rootScope.IbartarUserInfo?WebServices.reportComment($scope.page.uuid,comment.id).then(function(result){result.data.status?(ngProgress.complete(),comment.UserLikeDislikeStatus="reports",notifications.showSuccess(result.data.message.info)):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.deleteCommentFunc=function(commentId){swal({title:"آیا مطمئن هستید؟",text:"آیا کامنت را حذف می کنید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.deleteComment($scope.page.uuid,commentId).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),ngProgress.complete(),swal("دیدگاه شما حذف گردید.","","success"),$window.location.reload()):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.totalCommentsShow=$rootScope.ShowComments.data,$scope.totalCommentsShow.status&&($scope.totalComments=$scope.totalCommentsShow.data.total,$scope.perPage=$scope.totalCommentsShow.data.per_page,$scope.pages=Math.ceil($scope.totalComments/$scope.perPage),$scope.pages>1&&($scope.pages=$scope.pages-1,$scope.paginateComment=!0),$scope.comments=$scope.totalCommentsShow.data.comments,0!==$scope.totalComments&&($scope.showComments=!0)),$scope.firstComments=function(pageNum){WebServices.getComments($scope.page.uuid,pageNum).then(function(result){result.data.status?(ngProgress.complete(),$scope.activeBtnFirst=!0,$scope.activeBtn=!1,$scope.comments=result.data.data.comments):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])},$scope.moreComments=function(pageNum,paginateIndex){WebServices.getComments($scope.page.uuid,pageNum).then(function(result){result.data.status?(ngProgress.complete(),$scope.activeBtnFirst=!1,$scope.activeBtn[paginateIndex]=!0,$scope.comments=result.data.data.comments):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])},$scope.showAddMyComment=function(){$scope.addCommentModal=!$scope.addCommentModal,$scope.doneRateModal=!$scope.doneRateModal},$scope.showAddMyCommentModal=function(){$scope.openModal=!$scope.openModal,$scope.addCommentModal=!0},$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.prepareToUpload=function(data){$scope.uploadImgComment=!0,$scope.theImageComment=!0,$scope.productImg=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.deleteImgComment=function(){$scope.uploadImgComment=!1,$scope.theImageComment=!1,$scope.productImg="",$scope.imgEditorConfig.image="",$scope.fileToUpload=!1,$scope.fileReadyToUpload=""},$scope.addMyComment=function(){if($scope.dontComment=!0,null!==$scope.modalPropertiesAddComment.title&&($scope.dontComment=!1),null!==$scope.modalPropertiesAddComment.content&&($scope.dontComment=!1),$scope.dontComment)$scope.openModal=!1,$scope.addCommentModal=!1,notifications.showError(" برای دیدگاه خود عنوان و متن قرار دهید!"),$timeout(function(){$scope.openModal=!0,$scope.addCommentModal=!0},500);else{var FormDataToAddComment=new FormData;if(FormDataToAddComment.append("title",$scope.modalPropertiesAddComment.title),FormDataToAddComment.append("content",$scope.modalPropertiesAddComment.content),$scope.fileReadyToUpload){var imageHandPicked=$scope.fileReadyToUpload;FormDataToAddComment.append("image",imageHandPicked)}WebServices.addComment($scope.page.uuid,FormDataToAddComment).then(function(result){result.data.status?(ngProgress.complete(),$scope.addCommentModal=!$scope.addCommentModal,notifications.showSuccess("دیدگاه شما با موفقیت ثبت گردید."),$window.location.reload()):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"),$state.go($state.current,{reload:!0,inherit:!1}))},utils.MHandler[1])}},$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},$scope.getNumber=function(num){return new Array(num)};$scope.page.guilds;$scope.showSocial=!1;var keys=Object.keys($scope.page.social_networks),len=keys.length;0!==len&&($scope.showSocial=!0);var PageHeader=$scope.page.title;if($scope.page.region&&PageHeader.length<47){var splitedRegionText=$scope.page.region.split("،");splitedRegionText.reverse()}PageHeader+=" ",$rootScope.PageHeader=PageHeader;var telDesc="";if($scope.page.tel_1?telDesc=$scope.page.tel_1:$scope.page.tel_2&&(telDesc=$scope.page.tel_2),$rootScope.OgTitle=$scope.page.title,$rootScope.OgImage=$scope.page.logo.Small,$rootScope.OgDescription="دانرو - "+$scope.page.title+" واقع در "+$scope.page.address+"  "+telDesc,$rootScope.Pagedescriptions=$scope.page.title+" واقع در "+$scope.page.address+"  "+telDesc,$rootScope.canonical=$scope.page.canonicalLink,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage,$rootScope.canonical),$scope.getAnalysis=function(){WebServices.getViewsOfPage($scope.page.uuid).then(function(result){$scope.visits=result.data.data,utils.NormalNotificationForServerResponse(result.data.message)},utils.MHandler[1])},$scope.hoverOut=function(){$scope.visits=!1},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$rootScope.IbartarUserInfo){$scope.Authorized=!1;for(var page in $rootScope.IbartarUserInfo.pages)$scope.page.uuid==$rootScope.IbartarUserInfo.pages[page].uuid&&($scope.Authorized=!0)}$scope.addToWishList=function(){$rootScope.IbartarUserInfo?WebServices.addToFavorite($scope.page.uuid).then(function(result){result.data.status&&($scope.favorite=!$scope.favorite,utils.NormalNotificationForServerResponse(result.data.message,!0))},utils.MHandler[1]):notifications.showError("لطفا ابتدا وارد سیستم شوید")},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:$scope.page.lat,longitude:$scope.page.lng},zoom:15,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!0,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1},events:{}},$scope.windowOptions={visible:!0},$scope.User={Coords:{latitude:$scope.page.lat,longitude:$scope.page.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!1,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,animation:google.maps.Animation.DROP}}}),$scope.daysSchedule=$scope.page.opening_hours,$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},$scope.start_time=null,$scope.end_time=null,$scope.daysName=["Sat"],angular.forEach($scope.daysSchedule,function(ObjDay,key){"Sat"==key&&angular.forEach(ObjDay,function(planTime,key){$scope.start_time=planTime.start_time,$scope.end_time=planTime.end_time}),angular.forEach(ObjDay,function(planTime,index){planTime.start_time==$scope.start_time&&planTime.end_time==$scope.end_time&&$scope.daysName.push(key)})}),$scope.startDay=$scope.daysName[0],$scope.endDay=$scope.daysName[$scope.daysName.length-1],angular.forEach($scope.days,function(value,key){key==$scope.startDay&&($scope.startDay=value),key==$scope.endDay&&($scope.endDay=value)}),$scope.notSorted=function(obj){return obj?Object.keys(obj):[]},$scope.MoreItems=function(MoreValue){$scope[MoreValue]=!$scope[MoreValue]};var VideoGoingToBePlayed={};$scope.PreparToShowVideo=function(ThisVideo){VideoGoingToBePlayed=ThisVideo};var CreatePlayer=function(){$ocLazyLoad.load($rootScope.lazyLoad.JwPlayer).then(function(){new jPlayerPlaylist({jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},[{title:VideoGoingToBePlayed.description,m4v:VideoGoingToBePlayed.files.High,poster:VideoGoingToBePlayed.files.Thumbnail}],{supplied:"webmv, ogv, m4v",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!0})})},DestroyPlayer=function(){$("#jquery_jplayer_1").jPlayer("destroy")};$scope.VideoPlayerModal={title:VideoGoingToBePlayed.description,OpenModalClass:"GotoPlayVideo",width:481,template:appConfig.BaseTheme+"/views/VideoPlayerModalTemplate.html",VideoObj:VideoGoingToBePlayed,AfterOpenModalFunc:CreatePlayer,AfterCloseModalFunc:DestroyPlayer},$scope.ProductViewModal={title:"",OpenModalClass:"OpenProductView",width:700,passdata:{},template:appConfig.BaseTheme+"/views/productModalView.html"};var scrollToBugTypeSection=function(){var Target=jQuery(".ReportPanel");jQuery("html,body").animate({scrollTop:Target.offset().top-100},500).promise().then(function(){$scope.ShowBugReportPanel=!0,$scope.$apply()})},getBugTypesUrl=$rootScope.ShowData.data.data._links.bugTypes;$scope.TurnOnReportPanel=function(){WebServices.bugServices.bug_type(getBugTypesUrl).success(function(response){ngProgress.complete(),$scope.bugTypes=response.data,scrollToBugTypeSection()}).error(function(error){notifications.showError("مشکلی در سرور وجود دارد")})},$scope.showBoxMobile=!1;var sendBugUrl=$rootScope.ShowData.data.data._links.sendBug;$scope.addBugReport=function(bugId){$scope.bug_TypeId=bugId,8===bugId&&($scope.showBoxMobile=!0)},$scope.sendBug=function(){8===$scope.bug_TypeId&&void 0===$scope.mobileBug&&notifications.showError("وارد کردن شماره موبایل الزامی است.");var bugObj={bug_type:$scope.bug_TypeId,message:$scope.bugText,uuid:$scope.page.uuid};8===$scope.bug_TypeId&&void 0!==$scope.mobileBug&&(bugObj.mobile=$scope.mobileBug),WebServices.bugServices.send_bug(sendBugUrl,bugObj).then(function(data){data.data.status?(utils.NormalNotificationForServerResponse(data.data.message,!0),$scope.ShowBugReportPanel=!1,jQuery("html,body").animate({scrollTop:120},500)):utils.NormalNotificationForServerResponse(data.data.message,!1)},utils.MHandler[1])},$scope.analyticsEvent=function(social){var userId=$rootScope.IbartarUserInfo?$rootScope.IbartarUserInfo.id:"no_user_id";Analytics.trackEvent("SocialShareEvent",social,userId+" in "+$scope.page.uuid)},$scope.clickOnShownSameItems=function(index,uuid){Analytics.trackEvent(searchSame.getTypeOfSearch()+"Clicked",index),channelService.setChannel("same_items",{chanel_details:index},uuid),searchTraceService.saveSearchLogByUuid(uuid,"same_items")},$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))},$scope.htmlReady();var menuSticky=$(".menuBusinessPage")[0],menuPosition=menuSticky.getBoundingClientRect(),placeholder=document.createElement("div");placeholder.style.width=menuPosition.width+"px",placeholder.style.height=menuPosition.height+"px";var isAdded=!1;window.onscroll=function(){var otherHeader=$(".MainMenuContainerHome"),windowScrollTop=window.pageYOffset;0!=windowScrollTop?otherHeader.css({boxShadow:" 0px 2px 4px rgba(0, 0, 0, 0.2)"}):otherHeader.css({boxShadow:"none"}),windowScrollTop>=menuPosition.top-56&&!isAdded?(menuSticky.classList.add("sticky"),menuSticky.parentNode.insertBefore(placeholder,menuSticky),isAdded=!0):windowScrollTop<menuPosition.top-56&&isAdded&&(menuSticky.classList.remove("sticky"),menuSticky.parentNode.removeChild(placeholder),isAdded=!1)},$rootScope.claimUrl=$rootScope.ShowData.data.data._links.claim,null!=$rootScope.claimUrl||$rootScope.IbartarUserInfo||$(".manageBusinessMenu").hide(),$scope.requestClaim=function(){$rootScope.IbartarUserInfo?$rootScope.IbartarUserInfo.mobileVerified?WebServices.claimBiz($rootScope.claimUrl).success(function(response){ngProgress.complete(),notifications.showSuccess("شما با موفقیت صاحب این کسب و کار شده اید.")}).error(function(errors){$scope.errors=errors.errors,notifications.showError($scope.errors),$state.go($state.current,{reload:!0,inherit:!1})}):$state.go("claim",{uuid:$scope.page.uuid}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$timeout(function(){window.prerenderReady=!0},1e4),$scope.likeFunc=function(comment){$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.page.uuid+"/comments/"+comment.id+"/commentAction",data:{action:"like"}}).then(function(response){response.data.UserLikeDislikeStatus?comment.UserLikeDislikeStatus="like":comment.UserLikeDislikeStatus=null,comment.likeCount=response.data.likeCount},function(response){notifications.showError(response.message.info[0]),ngProgress.complete(),notifications.showError(response.statusText)}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.showReplyBox=[],$scope.loginCheck=function(index){$scope.showReplyBox[index]=!1,$rootScope.IbartarUserInfo?$scope.showReplyBox[index]=!0:($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))};var replyContentLength="";$scope.commentReply=function(comment,replyContent){$scope.replyContent=replyContent,$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.page.uuid+"/comments/"+comment.id+"/replyComment",data:{replyContent:$scope.replyContent}}).then(function(response){$scope.replyContent=response.data.content,replyContentLength=$scope.replyContent,$scope.replyId=response.data.id,$scope.userAvatar=response.data.userAvatar,$scope.userFullName=response.data.userFullName,ngProgress.complete(),notifications.showSuccess("جواب شما ثبت شد."),$window.location.reload()},function(response){422==response.status?notifications.showError(response.data.error):(ngProgress.complete(),notifications.showError(response.statusText))}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.showMore=function(){$("."+this.replyIndex).toggleClass("rotate"),$("."+this.replyIndex).parent().toggleClass("replyContentToggled")},$scope.showSubmenu=function(commentId){$("#"+commentId).toggleClass("submenuActive")},$scope.hideSubmenu=function(commentId){$("#"+commentId).toggleClass("submenuActive")},$scope.mouseEnterReply=function(replyUserId,replyIndex){$rootScope.IbartarUserInfo&&replyUserId===parseInt($rootScope.IbartarUserInfo.id)&&($scope.deleteReply[replyIndex]=!0)},$scope.mouseLeaveReport=function(replyIndex){$scope.deleteReply[replyIndex]=!1},$scope.deleteReplyFunc=function(commentId,replyId){swal({title:"آیا مطمئن هستید؟",text:"آیا پاسخ را حذف می کنید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?$http({method:"DELETE",url:appConfig.api+"/page/"+$scope.page.uuid+"/comments/"+commentId+"/deleteReplyComment/"+replyId}).then(function(response){response.data&&($window.location.reload(),notifications.showSuccess("پاسخ حذف شد"))},function(response){ngProgress.complete(),notifications.showError(response.statusText)}):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.showAllReply=function(commentLinks,index){$scope.comments[index].replyOpen=!0,$http({method:"GET",url:commentLinks.allReplies}).then(function(response){response.data&&($scope.comments[index].showAllReplies=response.data.items,$scope.comments[index].showAllReplies.splice(0,3))},function(response){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور وجود دارد.")})},$scope.hideReply=function(){$scope.replyOpen=!1},$(".replyComment").click(function(){$("html,body").animate({scrollDown:$(".replyInput").offset().down},"slow")})}),angular.module("ibartarApp").controller("EditShowCtrl",function($rootScope,$scope,$state,$http,$window,$stateParams,$location,Analytics,Suggestions,notifications,WebServices,openingHoursService,appConfig,operatorGame,uiGmapGoogleMapApi,ShowDate,guildlist,ngProgress,operatorRequests,utils){function NotAuthRedirect(){WebServices.AthenticateForEdit($scope.page.uuid).then(function(result){result.data.status||(notifications.showError("شما امکان دسترسی به صفحه مدیریت این مشتری را ندارید"),$state.go("show",{uuid:$scope.page.uuid,title:$scope.page.title}))},utils.MHandler[1])}function getPageHistoryData(){ngProgress.start(),operatorRequests.getPageHistory($stateParams.uuid).then(function(result){ngProgress.complete(),result.data.status&&($scope.pageHistories=result.data.data);
},utils.MHandler[1])}function SubmitThisDataForm(DataObj){ngProgress.start(),WebServices.UpdatePage($scope.page.uuid,DataObj).then(function(result){ngProgress.complete(),result.data.status?($state.go($state.current,{title:$scope.page.title,uuid:$scope.page.uuid},{reload:!0}),utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(){ngProgress.complete(),notifications.showError("مشکلی در ارسال داده به سرور رخ داده است")})}$(window).on("beforeunload",function(){$(window).scrollTop(0)}),$window.scrollTo(0,0),$scope.guilds=[],$scope.page=ShowDate.data.data,$scope.MoreProduct=!1,$scope.showModalForDeletePage=!1,$scope.manager=$scope.page.manager,$scope.JobPackages=guildlist.data.data,$scope.JobGuildArr=[],$scope.disableBtn=!1,$scope.messagesDelete=[{name:"کسب و کار جمع شده",value:"message1"},{name:"شماره تلفن اشتباه",value:"message2"},{name:"منزل است.",value:"message3"},{name:" روی فاکس",value:"message4"},{name:"عدم تمایل صاحب کسب و کار",value:"message5"},{name:"تکراری",value:"message6"},{name:"هیچ کدام - افزودن گزینه جدید",value:"message7"}],$scope.FormDataToDelete={message:null};for(var ThisGuildId in $scope.page.guilds)$scope.JobGuildArr.push(ThisGuildId);if(!$state.is("editshow")){$scope.ViewForOperators=!0,$scope.SendToNextStep=function(){operatorRequests.PageCorrectionSendToNextStep($stateParams.uuid).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($stateParams.status)):(utils.NormalNotificationForServerResponse(result.data.message,!1),$state.go("home"))},utils.MHandler[1])};var posponeScales={"۱ ساعت":1,"۲ ساعت":2,"۳ ساعت":3,"۴ ساعت":4,"۵ ساعت":5,"۶ ساعت":6,"۷ ساعت":7,"۸ ساعت":8,"۹ ساعت":9,"۱۰ ساعت":10,"۱۱ ساعت":11,"۱۲ ساعت":12,"۱ روز":24,"۲ روز":48,"۱ هفته":168,"۲ هفته":336};$scope.postponeScale=[];for(var key in posponeScales){var arr={item:key,key:posponeScales[key]};$scope.postponeScale.push(arr)}$scope.submitPostpone=function(hours,message){ngProgress.start();var dataObj={hours:hours,message:message};operatorRequests.delay($stateParams.uuid,dataObj).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($stateParams.status)):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},operatorRequests.GetBugList($stateParams.uuid).then(function(result){$scope.bugsToShow=result.data.data,$scope.BugsTypes={};for(var types=[],i=$scope.bugsToShow.length-1;i>=0;i--)types=types.concat($scope.bugsToShow[i].bug_type);for(var i=types.length-1;i>=0;i--)$scope.BugsTypes[types[i]]=!0},utils.MHandler[1]),operatorRequests.getLogOfPage($stateParams.uuid).then(function(result){$scope.LogsOfPage=result.data.data.logs},utils.MHandler[1])}if($scope.removeAdmin=function(uuid){swal({title:"آیا مطمئن هستید؟",text:"ایا مطمئنید که مدیر این صفحه باید حذف شود؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.detachPageUser(uuid).then(function(result){utils.NormalNotificationForServerResponse(result.data.message,!0),ngProgress.complete(),$state.go($state.current,$stateParams,{reload:!0}),swal("مدیر با موفقیت حذف شد","","success")},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$rootScope.IbartarUserInfo){var Authorized=!1;for(var page in $rootScope.IbartarUserInfo.pages)$scope.page.uuid==$rootScope.IbartarUserInfo.pages[page].uuid&&(Authorized=!0);Authorized?$scope.AuthenticateForEdit=!0:NotAuthRedirect()}else NotAuthRedirect();$scope.getPageHistoryButtonTouchUpInside=function(){getPageHistoryData()},$scope.Suggestions=Suggestions.data.data,$rootScope.IbartarUserInfo&&$rootScope.IbartarUserInfo.permissions["page.manage.all"]&&($scope.Suggestions.ads={firstpage:24273,special:28374}),openingHoursService.setOpeningHours(ShowDate.data.data.opening_hours,ShowDate.data.data.uuid),$rootScope.PageHeader=$scope.page.title+" | دانرو",$rootScope.OgTitle=$scope.page.title,$rootScope.OgImage=$scope.page.logo.Small,$rootScope.OgDescription=$scope.page.description;for(var UserScore=0,AddScoreOfAdmin=function(){UserScore+=1},Standards=[$scope.page.description,$scope.page.title,$scope.page.slogan,$scope.page.tel_1,$scope.page.mobile,$scope.page.email,$scope.page.opening_hours,$scope.page.guilds],i=Standards.length-1;i>=0;i--)Standards[i]&&("object"!=typeof Standards[i]&&Standards[i].length>0&&AddScoreOfAdmin(),"object"!=typeof Standards[i]||utils.isEmpty(Standards[i])||AddScoreOfAdmin());$scope.increment=1.8,setTimeout(function(){var EsimatedScore=(UserScore/Standards.length*100).toFixed(0);$scope.UserDataPrecetage=EsimatedScore},500),$scope.toggleModalDeletePage=function(){$scope.showModalForDeletePage=!$scope.showModalForDeletePage},$scope.changeValueDelete=function(){"message7"===$scope.FormDataToDelete.message.value?$scope.noCustomMessage=!0:$scope.noCustomMessage=!1},$scope.deletePageJob=function(){if($scope.noCustomMessage)var message=$rootScope.customMessageDelete;else var message=$scope.FormDataToDelete.message.name;operatorRequests.editJobs.DeletePageJobFinal($stateParams.uuid,message).then(function(result){result.data.status?(notifications.showSuccess("پیام تعویق شما با موفقیت ذخیره شد."),$state.go("home")):notifications.showError("مشکلی در سرور وجود دارد")})},$scope.SelectedProperties={};for(var Key in $scope.Suggestions){$scope.SelectedProperties[Key]={};for(var Property in $scope.Suggestions[Key])$scope.page.keywords&&$scope.page.keywords[Key]&&$scope.page.keywords[Key][Property]&&($scope.SelectedProperties[Key][Property]=!0)}for(var UsersuggestionCat in $scope.page.keywords)for(var KeyTagItem in $scope.page.keywords[UsersuggestionCat])$scope.Suggestions[UsersuggestionCat]&&!$scope.Suggestions[UsersuggestionCat][KeyTagItem]&&($scope.Suggestions[UsersuggestionCat][KeyTagItem]=$scope.page.keywords[UsersuggestionCat][KeyTagItem],$scope.SelectedProperties[UsersuggestionCat][KeyTagItem]=!0),$scope.Suggestions[UsersuggestionCat]||($scope.Suggestions[UsersuggestionCat]={},$scope.Suggestions[UsersuggestionCat][KeyTagItem]=$scope.page.keywords[UsersuggestionCat][KeyTagItem],$scope.SelectedProperties[UsersuggestionCat]={},$scope.SelectedProperties[UsersuggestionCat][KeyTagItem]=!0);$scope.InProgress={},$scope.AddRemoveKeyWord=function(KeyId,dataModel){$scope.InProgress[KeyId]=!0;var Method=dataModel?"add":"delete";WebServices.AddOrRemoveKeywords($scope.page.uuid,{id:KeyId},Method).then(function(result){$scope.InProgress[KeyId]=!1,result.data.status||utils.NormalNotificationForServerResponse(result.data.message)},function(){notifications.showError("اتصال به شبکه دچار مشکل شده است")})},$scope.SubmitCostumtag=function(input,catName){WebServices.AddOrRemoveKeywords($scope.page.uuid,{label:input,category:catName},"add").then(function(result){result.data.status&&(utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.Suggestions[catName]||($scope.Suggestions[catName]={},$scope.SelectedProperties[catName]={}),$scope.Suggestions[catName][input]=result.data.data.id,$scope.SelectedProperties[catName][input]=!0)},function(){notifications.showError("اتصال به شبکه دچار مشکل شده است")}),$scope.CostumEmkanat="",$scope.CostumKhadamat=""},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:$scope.page.lat,longitude:$scope.page.lng},zoom:15,options:{draggable:!1,disableDefaultUI:!0,zoomControl:!1},events:{}},$scope.windowOptions={visible:!0},$scope.User={Coords:{latitude:$scope.page.lat,longitude:$scope.page.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!1,animation:google.maps.Animation.DROP}}}),$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},$scope.notSorted=function(obj){return obj?Object.keys(obj):[]},$scope.MoreItems=function(MoreValue){$scope[MoreValue]=!$scope[MoreValue]},$scope.AuthenticateForEdit=!0,$scope.Submition={title:$scope.page.title,Description:$scope.page.description,tel_1:$scope.page.tel_1,tel_2:$scope.page.tel_2,slogan:$scope.page.slogan,guilds:$scope.page.guilds,mobile:$scope.page.mobile,private_mobile:$scope.page.private_mobile,website:$scope.page.website,email:$scope.page.email,address:$scope.page.address},$scope.EditShowVal={DescBox:!1,ContactBox:!1},$scope.EditShow=function(BoxName){setTimeout(function(){$scope.EditShowVal[BoxName]=!$scope.EditShowVal[BoxName],$scope.$apply()},0)};var TimesOfDayPos={0:26,1:50,2:74,3:98,4:122,5:146,6:170,7:194,8:218,9:242,10:266,11:290,12:314,13:338,14:362,15:386,16:410,17:434,18:458,19:482,20:506,21:530,22:554,23:578,24:602};$scope.OpeningHoursModal={title:"مدیریت ساعات کاری",OpenModalClass:"EditToolForOpeningHours",width:650,Times:TimesOfDayPos,days:$scope.days,notSorted:$scope.notSorted,template:appConfig.BaseTheme+"/views/editModulesForShowCase/openingHours.html"},$scope.SocialLinksModal={title:"مدیریت لینک ها",OpenModalClass:"OpenTheSocialLinks",width:500,passdata:{},template:appConfig.BaseTheme+"/views/editModulesForShowCase/SocialLinksEdit.html"};var PrevLogo=$scope.page.logo.Small;$scope.EditLogoModal={title:"آپلود لوگو",OpenModalClass:"GotoEditLogo",width:800,template:appConfig.BaseTheme+"/views/editModulesForShowCase/LogoEditView.html",PrevLogo:PrevLogo},$scope.AddProductPanel={title:"",OpenModalClass:"AddProductPanelBut",width:700,template:appConfig.BaseTheme+"/views/editModulesForShowCase/addproductpanel.html"},$scope.EditProductPanel={title:"ویرایش محصول",OpenModalClass:"EditProductPanelBut",width:700,passdata:{},template:appConfig.BaseTheme+"/views/editModulesForShowCase/editproductpanel.html"},$scope.AddNewImgGallery={title:"اضافه کردن تصویر",OpenModalClass:"AddNewGalleryPic",width:700,template:appConfig.BaseTheme+"/views/editModulesForShowCase/addGalleryPic.html"},$scope.EditImgGallery={title:"ویرایش تصویر",OpenModalClass:"editGalleryPic",width:700,passdata:{},template:appConfig.BaseTheme+"/views/editModulesForShowCase/editGalleryPic.html"},$scope.AddNewVideoGallery={title:"اضافه کردن ویدئو",OpenModalClass:"AddNewGalleryVideo",width:700,template:appConfig.BaseTheme+"/views/editModulesForShowCase/addGalleryVideo.html"},$scope.EditVideoGallery={title:"ویرایش ویدئو",OpenModalClass:"editGalleryVideo",width:700,passdata:{},template:appConfig.BaseTheme+"/views/editModulesForShowCase/editGalleryPic.html"},$scope.passTheGAlleryForEditing=function(imgObj){$scope.EditImgGallery.passdata=imgObj,$scope.EditVideoGallery.passdata=imgObj},$scope.passDataForSocialNetworks=function(){var social_networks=$scope.page.social_networks;$scope.SocialLinksModal.passdata=social_networks},$scope.EditMapPanel={title:"ویرایش نقشه",OpenModalClass:"EditMapBut",width:950,passdata:{latitude:$scope.page.lat,longitude:$scope.page.lng,address:$scope.page.address},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",template:appConfig.BaseTheme+"/views/editModulesForShowCase/editmappanel.html"},$scope.PassingDataForProductModal=function(Product){$scope.EditProductPanel.passdata=Product;var formatingDate=$scope.EditProductPanel.passdata.expired.date.split(" ")[0];$scope.EditProductPanel.dt=formatingDate},$scope.SubmitAboutUs=function(){var aboutUsSectionData={title:$scope.Submition.title,description:$scope.Submition.Description,slogan:$scope.Submition.slogan,guild:$scope.JobGuildArr};SubmitThisDataForm(aboutUsSectionData)},$scope.SubmitConnectUs=function(){var ConnectUsData={tel_1:$scope.Submition.tel_1,tel_2:$scope.Submition.tel_2,mobile:$scope.Submition.mobile,private_mobile:$scope.Submition.private_mobile,website:$scope.Submition.website,email:$scope.Submition.email,address:$scope.Submition.address};SubmitThisDataForm(ConnectUsData)};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)};var menuSticky=$(".menuBusinessPage")[0],menuPosition=menuSticky.getBoundingClientRect(),placeholder=document.createElement("div");placeholder.style.width=menuPosition.width+"px",placeholder.style.height=menuPosition.height+"px";var isAdded=!1;window.onscroll=function(){var otherHeader=$(".MainMenuContainerHome"),windowScrollTop=window.pageYOffset;0!=windowScrollTop?otherHeader.css({boxShadow:" 0px 2px 4px rgba(0, 0, 0, 0.2)"}):otherHeader.css({boxShadow:"none"}),windowScrollTop>=menuPosition.top-56&&!isAdded?(menuSticky.classList.add("sticky"),menuSticky.parentNode.insertBefore(placeholder,menuSticky),isAdded=!0):windowScrollTop<menuPosition.top-56&&isAdded&&(menuSticky.classList.remove("sticky"),menuSticky.parentNode.removeChild(placeholder),isAdded=!1)}}),angular.module("ibartarApp").controller("EditModeProductCtrl",function($state,$rootScope,$scope,$stateParams,dateFilter,WebServices,ngProgress,notifications,utils){function SubmitThisDataForm(DataObj){ngProgress.start(),$scope.disableBtn=!0,WebServices.ProductUpdateOrCreate(DataObj,$stateParams.uuid,$scope.options.passdata?"edit":"create",$scope.options.passdata?$scope.options.passdata.id:"").then(function(result){ngProgress.complete(),result.status?(notifications.showSuccess(result.message.info),$state.go($state.current,$stateParams,{reload:!0}),$scope.disableBtn=!1):(utils.NormalNotificationForServerResponse(result.message,!1),$scope.disableBtn=!1)},function(){ngProgress.complete(),notifications.showError("مشکلی در ارسال داده به سرور رخ داده است"),$scope.disableBtn=!1})}$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.prepareToUpload=function(data){$scope.options.passdata&&$scope.options.passdata.images&&$scope.options.passdata.images[0].Medium?$scope.options.passdata.images[0].Medium=data:$scope.productImg=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},$scope.options.AfterOpenModalFunc=function(){$scope.options.passdata&&$scope.options.passdata.images&&($scope.imgEditorConfig.image=$scope.options.passdata.images[0].Medium)},$scope.options.AfterCloseModalFunc=function(){$scope.editViewModeForImg=!1},$scope.cropImage=function(){$scope.$broadcast("cropImage")},$scope.$watch("imageOut",function(data){$scope.imageOut&&$scope.editViewModeForImg&&($scope.options.passdata&&$scope.options.passdata.images[0].Medium?$scope.options.passdata.images[0].Medium=$scope.imageOut:$scope.productImg=$scope.imageOut,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob($scope.imageOut)),$scope.editViewModeForImg=!1}),$scope.openPersian=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.persianIsOpen=!0},$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.renderTheImg=function(data){$scope.productImg=data},$scope.SubmitProduct=function(){var fd=new FormData;if($scope.fileToUpload){var file=$scope.fileReadyToUpload;fd.append("image",file)}$scope.options.dt?fd.append("expired_at",dateFilter($scope.options.dt,"yyyy-MM-dd")):$scope.dt&&fd.append("expired_at",dateFilter($scope.dt,"yyyy-MM-dd")),$scope.options.passdata&&$scope.options.passdata.quantity?fd.append("quantity",$scope.options.passdata.quantity):$scope.quantity&&fd.append("quantity",$scope.quantity),$scope.options.passdata&&$scope.options.passdata.title?fd.append("title",$scope.options.passdata.title):$scope.title&&fd.append("title",$scope.title),$scope.options.passdata&&$scope.options.passdata.description?fd.append("description",$scope.options.passdata.description):$scope.description&&fd.append("description",$scope.description),$scope.options.passdata&&"fix"==$scope.options.passdata.price_type?(fd.append("price_type","fix"),$scope.options.passdata&&$scope.options.passdata.price?fd.append("price",$scope.options.passdata.price):$scope.price&&fd.append("price",$scope.price)):(fd.append("price_type","range"),$scope.options.passdata&&$scope.options.passdata.price_start?fd.append("price_start",$scope.options.passdata.price_start):$scope.price_start&&fd.append("price_start",$scope.price_start),$scope.options.passdata&&$scope.options.passdata.price_end?fd.append("price_end",$scope.options.passdata.price_end):$scope.price_end&&fd.append("price_end",$scope.price_end)),SubmitThisDataForm(fd)},$scope.RemoveThisProduct=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید این محصول ("+$scope.options.passdata.title+") را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.RemoveProduct($stateParams.uuid,$scope.options.passdata.id).then(function(result){ngProgress.complete(),result.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("این محصول با موفقیت حذف گردید","","success"),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})}}),angular.module("ibartarApp").controller("SocialCtrl",function($scope,$state,$http,$stateParams,WebServices,ngProgress,notifications,utils){function SubmitThisDataForm(DataObj,link){ngProgress.start(),$http.post(link,DataObj).then(function(result){ngProgress.complete(),result.data.status?(ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!0),notifications.showSuccess("تغییرات با موفقیت ذخیره شد."),$state.go($state.current,$stateParams,{reload:!0})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])}$scope.noEditFacebook=!0,$scope.editSocial=function(value){$scope.noEditFacebook=!$scope.noEditFacebook},$scope.SubmitSocials=function(){var linksSelf=$scope.options.passdata._links.self,PerparData={social_networks:{facebook:$scope.options.passdata.items.facebook,gplus:$scope.options.passdata.items.gplus,linkedin:$scope.options.passdata.items.linkedin,instagram:$scope.options.passdata.items.instagram,twitter:$scope.options.passdata.items.twitter}};(void 0===$scope.options.passdata.items.facebook||""==$scope.options.passdata.items.facebook)&&delete PerparData.social_networks.facebook,(void 0===$scope.options.passdata.items.gplus||""==$scope.options.passdata.items.gplus)&&delete PerparData.social_networks.gplus,(void 0===$scope.options.passdata.items.linkedin||""==$scope.options.passdata.items.linkedin)&&delete PerparData.social_networks.linkedin,(void 0===$scope.options.passdata.items.instagram||""==$scope.options.passdata.items.instagram)&&delete PerparData.social_networks.instagram,(void 0===$scope.options.passdata.items.twitter||""==$scope.options.passdata.items.twitter)&&delete PerparData.social_networks.twitter,void 0!==$scope.options.passdata.items.facebook&&($scope.options.passdata.items.facebook.indexOf("http")&&($scope.options.passdata.items.facebook="http://"+$scope.options.passdata.items.facebook),"http://facebook.com/"!=$scope.options.passdata.items.facebook.trim()?PerparData.social_networks.facebook=$scope.options.passdata.items.facebook:delete PerparData.social_networks.facebook),void 0!==$scope.options.passdata.items.twitter&&($scope.options.passdata.items.twitter.indexOf("http")&&($scope.options.passdata.items.twitter="http://"+$scope.options.passdata.items.twitter),"http://twitter.com/"!=$scope.options.passdata.items.twitter.trim()?PerparData.social_networks.twitter=$scope.options.passdata.items.twitter:delete PerparData.social_networks.twitter),void 0!==$scope.options.passdata.items.gplus&&($scope.options.passdata.items.gplus.indexOf("http")&&($scope.options.passdata.items.gplus="http://"+$scope.options.passdata.items.gplus),"http://plus.google.com"!=$scope.options.passdata.items.gplus.trim()?PerparData.social_networks.gplus=$scope.options.passdata.items.gplus:delete PerparData.social_networks.gplus),void 0!==$scope.options.passdata.items.linkedin&&($scope.options.passdata.items.linkedin.indexOf("http")&&($scope.options.passdata.items.linkedin="http://"+$scope.options.passdata.items.linkedin),"http://linkedin.com"!=$scope.options.passdata.items.linkedin.trim()?PerparData.social_networks.linkedin=$scope.options.passdata.items.linkedin:delete PerparData.social_networks.linkedin),void 0!==$scope.options.passdata.items.instagram&&($scope.options.passdata.items.instagram.indexOf("http")&&($scope.options.passdata.items.instagram="http://"+$scope.options.passdata.items.instagram),"http://instagram.com"!=$scope.options.passdata.items.instagram.trim()?PerparData.social_networks.instagram=$scope.options.passdata.items.instagram:delete PerparData.social_networks.instagram);var DataForm={social_networks:{}};for(var link in PerparData.social_networks)""!=PerparData.social_networks[link]&&(DataForm.social_networks[link]=PerparData.social_networks[link]);SubmitThisDataForm(DataForm,linksSelf)},$scope.StopToRemoveFacebookLink=function(event){void 0!==$scope.options.passdata.items.facebook&&($scope.options.passdata.items.facebook.length<21&&8==event.keyCode&&event.preventDefault(),$scope.options.passdata.items.facebook.indexOf("http://facebook.com/")&&($scope.options.passdata.items.facebook="http://facebook.com/"))},$scope.StopToRemoveTwitterLink=function(event){void 0!==$scope.options.passdata.items.twitter&&($scope.options.passdata.items.twitter.length<20&&8==event.keyCode&&event.preventDefault(),$scope.options.passdata.items.twitter.indexOf("http://twitter.com/")&&($scope.options.passdata.items.twitter="http://twitter.com/"))},$scope.StopToRemoveGplusLink=function(event){void 0!==$scope.options.passdata.items.gplus&&($scope.options.passdata.items.gplus.length<23&&8==event.keyCode&&event.preventDefault(),$scope.options.passdata.items.gplus.indexOf("http://plus.google.com/")&&($scope.options.passdata.items.gplus="http://plus.google.com/"))},$scope.StopToRemoveLinkedinLink=function(event){void 0!==$scope.options.passdata.items.linkedin&&($scope.options.passdata.items.linkedin.length<20&&8==event.keyCode&&event.preventDefault(),$scope.options.passdata.items.linkedin.indexOf("http://linkedin.com/")&&($scope.options.passdata.items.linkedin="http://linkedin.com/"))},$scope.StopToRemoveInstagramLink=function(event){void 0!==$scope.options.passdata.items.instagram&&($scope.options.passdata.items.instagram.length<22&&8==event.keyCode&&event.preventDefault(),$scope.options.passdata.items.instagram.indexOf("http://instagram.com/")&&($scope.options.passdata.items.instagram="http://instagram.com/"))}}),angular.module("ibartarApp").controller("MapEditCtrl",function($scope,$state,appConfig,uiGmapGoogleMapApi,$stateParams,ngProgress,WebServices,notifications,utils){function SubmitThisDataForm(DataObj){ngProgress.start(),WebServices.UpdatePage($stateParams.uuid,DataObj).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}$scope.options.AfterOpenModalFunc=function(){$scope.map||setTimeout(function(){uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:$scope.options.passdata.latitude,longitude:$scope.options.passdata.longitude},zoom:15,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}},events:{click:function(map,eventName,args){var e=args[0],lat=e.latLng.lat(),lng=e.latLng.lng();$scope.User.Coords={latitude:lat,longitude:lng},$scope.$apply()}}},$scope.windowOptions={visible:!0}}),$scope.User={Coords:{latitude:$scope.options.passdata.latitude,longitude:$scope.options.passdata.longitude},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!0}}},0)};var events={places_changed:function(searchBox){var ThisJobMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);ThisJobMap.fitBounds(bounds),ThisJobMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},$scope.SubmitMap=function(){SubmitThisDataForm({lat:$scope.User.Coords.latitude,lng:$scope.User.Coords.longitude})}}),angular.module("ibartarApp").controller("ImgGalleryCreateCtrl",function($scope,$state,$stateParams,$rootScope,ngProgress,WebServices,notifications,utils){$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},$scope.prepareToUpload=function(data){$scope.imageForGall=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.options.AfterCloseModalFunc=function(){$scope.editViewModeForImg=!1},$scope.cropImage=function(){$scope.$broadcast("cropImage")},$scope.$watch("imageOut",function(data){$scope.imageOut&&$scope.editViewModeForImg&&($scope.imageForGall=$scope.imageOut,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob($scope.imageOut)),$scope.editViewModeForImg=!1}),$scope.submitTheform=function(){ngProgress.start(),$rootScope.LoaderOnPage=!0;var file=$scope.fileReadyToUpload,fd=new FormData;fd.append("file",file),$scope.description&&fd.append("description",$scope.description),WebServices.StoreGallery(fd,$stateParams.uuid).then(function(result){ngProgress.complete(),result.status?(utils.NormalNotificationForServerResponse(result.message,!0),$state.go($state.current,$stateParams,{reload:!0})):(utils.NormalNotificationForServerResponse(result.message,!1),$rootScope.LoaderOnPage=!1)},utils.MHandler[1])}}),angular.module("ibartarApp").controller("ImgGalleryEditCtrl",function($scope,$state,$rootScope,$stateParams,WebServices,ngProgress,notifications,utils){$scope.options.AfterOpenModalFunc=function(){$rootScope.IbartarUserInfo&&$rootScope.IbartarUserInfo.permissions&&($scope.isAdminPermission=1==$rootScope.IbartarUserInfo.permissions["page.manage.all"]),$scope.options.passdata.feed=1==$scope.options.passdata.feed?!0:!1,$scope.options.passdata.is_special=1==$scope.options.passdata.is_special?!0:!1,$scope.$apply()},$scope.submitTheform=function(){$rootScope.LoaderOnPage=!0,ngProgress.start();var data={description:$scope.options.passdata.description,feed:$scope.options.passdata.feed?1:0,is_special:$scope.options.passdata.is_special?1:0};WebServices.UpdateGallery(data,$scope.options.passdata.id).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go($state.current,$stateParams,{reload:!0})):($rootScope.LoaderOnPage=!1,utils.NormalNotificationForServerResponse(result.data.message,!1))},utils.MHandler[1])},$scope.removeGalleryPic=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید این تصویر را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.removeMedia($scope.options.passdata.id).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("تصویر با موفقیت حذف گردید","","success"),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})}}),angular.module("ibartarApp").controller("EditLogoModal",function($scope,$rootScope,$state,$stateParams,WebServices,ngProgress,notifications,utils,$q){$scope.editViewModeForLogo=!1,$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.SourceImgOfLogo=$scope.options.PrevLogo,$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},setTimeout(function(){$scope.imgEditorConfig.image=$scope.SourceImgOfLogo},1e3),$scope.prepareToUpload=function(data){$scope.options.PrevLogo=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.cropImage=function(){$scope.$broadcast("cropImage")},$scope.$watch("imageOut",function(data){$scope.imageOut&&$scope.editViewModeForLogo&&($scope.options.PrevLogo=$scope.imageOut,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob($scope.imageOut)),$scope.editViewModeForLogo=!1}),$scope.SubmitTheLogoForm=function(){var image=new Image;image.src=$scope.options.PrevLogo;var fd=new FormData;image.onload=function(){fd.append("w",this.width),fd.append("h",this.height),fd.append("file",$scope.fileReadyToUpload),fd.append("x",0),fd.append("y",0),WebServices.LogoStore(fd,$stateParams.uuid).then(function(result){ngProgress.complete(),result.status?(utils.NormalNotificationForServerResponse(result.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.message,!1)},utils.MHandler[1])}},$scope.DeleteLogo=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید لوگو را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.removeLogo($stateParams.uuid).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("لوگو با موفقیت حذف گردید","","success"),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})}}),angular.module("ibartarApp").controller("VideoGalleryCreateCtrl",function($scope,$state,$rootScope,$stateParams,ngProgress,WebServices,notifications,utils){$scope.ActiveForm=function(){$scope.ReadyToSend=!0,$scope.$apply()},$scope.submitTheform=function(){ngProgress.start(),$rootScope.LoaderOnPage=!0;var file=jQuery("#VideoFileToUpload")[0].files[0],fd=new FormData;fd.append("file",file),fd.append("description",$scope.VideoDesc),WebServices.StoreGallery(fd,$stateParams.uuid).then(function(result){ngProgress.complete(),result.status?(utils.NormalNotificationForServerResponse(result.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.message,!1);
},utils.MHandler[1])}}),angular.module("ibartarApp").controller("FooterCtrl",function($scope){}),angular.module("ibartarApp").controller("SearchCtrl",function($scope,$state,$stateParams,$http,$log,$location,$rootScope,MetaService,ngProgress,appConfig,uiGmapGoogleMapApi,MapMarker,$ocLazyLoad,utils,searchTraceService,SearchResult,SearchRequests,Analytics,channelService){$scope.NodesOnPage=SearchResult.data.data,$scope.filters=SearchResult.data.filters,$scope.lastPage=SearchResult.data.last_page,$scope.total=SearchResult.data.total,$scope.CurrPage=SearchResult.data.current_page;var urlParamsBase="";for(var urlParamKey in $location.$$search)"page"!=urlParamKey&&(urlParamsBase+=urlParamKey+"="+$location.$$search[urlParamKey]+"&");if($scope.titleSearchResult=" نتایج جستجو "+($stateParams.q?" "+$stateParams.q:" ")+($stateParams.area&&$stateParams.q?" در ":"")+($stateParams.area?$stateParams.area:"")+" ",$rootScope.PageHeader=" نتایج جستجو "+($stateParams.q?" "+$stateParams.q:" ")+($stateParams.area&&$stateParams.q?" در ":"")+($stateParams.area?$stateParams.area:"")+" در دانرو",$scope.CurrPage<$scope.lastPage&&$scope.CurrPage<10&&($rootScope.nextPage=appConfig.base+"/search?"+urlParamsBase+"page="+(parseInt($scope.CurrPage)+1)),$scope.CurrPage>1&&($rootScope.prevPage=appConfig.base+"/search?"+urlParamsBase+"page="+(parseInt($scope.CurrPage)-1)),$rootScope.OgTitle=$rootScope.PageHeader,$rootScope.OgImage=$rootScope.ThemebaseNew+"/img/logo/logo.png",$rootScope.OgDescription=$rootScope.PageHeader,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage),$location.$$search.keyword)var keywords=" #"+$location.$$search.keyword.split(",").join("#");$scope.QueryValue=($location.$$search.q?$location.$$search.q:"")+($location.$$search.keyword?keywords:""),$scope.has_image=$location.$$search.has_image||0,$scope.has_video=$location.$$search.has_video||0,$scope.has_product=$location.$$search.has_product||0,$scope.AreaVaule=$location.$$search.area,$scope.GfilterActive=!1,$scope.lats=[],$scope.lngs=[],angular.forEach($scope.NodesOnPage,function(items){$scope.lats.push(items.lat),$scope.lngs.push(items.lng)});var maxLats=Math.max.apply(Math,$scope.lats),minLats=Math.min.apply(Math,$scope.lats),maxLngs=Math.max.apply(Math,$scope.lngs),minLngs=Math.min.apply(Math,$scope.lngs);uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:(maxLats+minLats)/2,longitude:(minLngs+maxLngs)/2},zoom:10,options:{disableDefaultUI:!0,draggable:!0,scrollwheel:!0,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMarkers=[],$scope.controlMarkers={}});var PutMarkers=function(ResultArr){$scope.ResultMarkers=[],MapMarker.reset(),MapMarker.HiddenInfoWindow(),uiGmapGoogleMapApi.then(function(maps){MapMarker.AddMarkers(ResultArr),$scope.ResultMarkers=[],setTimeout(function(){var GPrevIcon;$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.Markerevents.mousedown=function(Marker){var ItemIndex=$scope.controlMarkers.getGMarkers().indexOf(Marker);$scope.ActiveSearchResultIndex=ItemIndex;var Target=jQuery(".SearchResultItem").eq(ItemIndex);jQuery("html,body").animate({scrollTop:Target.offset().top-60},1e3)},$scope.Markerevents.mouseover=function(Marker){GPrevIcon=Marker.icon,Marker.setIcon(appConfig.BaseTheme+"/images/markers/2.png")},$scope.Markerevents.mouseout=function(Marker){Marker.setIcon(GPrevIcon)},$scope.$apply()},10)})};PutMarkers(SearchResult.data.data),$scope.ChangeMarker=function(indexVal){if($scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var CoMarker=$scope.controlMarkers.getGMarkers()[indexVal];CoMarker&&(CoMarker.setZIndex(1e5),MapMarker.AtachBanner(CoMarker))}},$scope.ResetIcon=function(indexVal){if($scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var CoMarker=$scope.controlMarkers.getGMarkers()[indexVal];CoMarker&&(MapMarker.CloseBanner(CoMarker),CoMarker.setZIndex(1))}},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule},{reload:!0})},$scope.filtersBoxes={};var f_guildToSend=[];$stateParams.f_guild&&(f_guildToSend=$stateParams.f_guild.split(",")),$scope.AddRemoveGFilter=function(ChangePage){Analytics.trackEvent("FilteredListAction");for(var filterForGuild in $scope.filtersBoxes)$scope.filtersBoxes[filterForGuild]?-1==f_guildToSend.indexOf(filterForGuild)&&f_guildToSend.push(filterForGuild):-1!=f_guildToSend.indexOf(filterForGuild)&&(f_guildToSend=utils.ArrRemove(f_guildToSend,filterForGuild));var fGuildString=f_guildToSend.toString(),has_image=$scope.has_image?1:0,has_video=$scope.has_video?1:0,has_product=$scope.has_product?1:0;ChangePage||($scope.CurrPage=1),ngProgress.start(),SearchRequests.GetNodesOfSearchByObj({guild:$stateParams.guild,q:$stateParams.q,area:$stateParams.area,page:$scope.CurrPage,f_guild:fGuildString,has_image:has_image,has_video:has_video,has_product:has_product,keyword:$stateParams.keyword},searchTraceService.getTrace(),!0).then(function(received){ngProgress.complete(),$scope.NodesOnPage=received.data.data,$scope.lastPage=received.data.last_page,PutMarkers($scope.NodesOnPage),jQuery("html, body").animate({scrollTop:0},1e3)},function(){ngProgress.complete(),$log.debug("Internal Server Error")})},$scope.RemoveTagGFilter=function(filterkey){$scope.filtersBoxes[filterkey]=!1,$scope.AddRemoveGFilter()},$scope.createArrByIndexes=function(Indexes){for(var arr=[],i=0;Indexes-1>=i;i++)arr[i]=i;return arr},$scope.Paginate=function(PageNum){$scope.CurrPage=PageNum,$scope.AddRemoveGFilter(!0)};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SetChannel=function(indexPos,uuid){channelService.setChannel("list",{chanel_details:indexPos+10*($scope.CurrPage-1),q:$stateParams.q,area:$stateParams.area},uuid),searchTraceService.saveSearchLogByUuid(uuid,"main")},$scope.htmlReady()}),angular.module("ibartarApp").controller("ListCtrl",function($scope,$state,$stateParams,notifications,ngProgress,channelService,uiGmapGoogleMapApi,appConfig,ResultList,utils,SearchRequests,MapIcon,MapMarker,searchTraceService,$rootScope,WebServices){$scope.isEmpty=utils.isEmpty,$scope.NodesOnPage=ResultList.data.data,$scope.filters=ResultList.data.filters,$scope.lastPage=ResultList.data.last_page,$scope.CurrPage=ResultList.data.current_page,$scope.FilterEnable=!1;var nextPageRequestBussy=!1;$scope.$parent.ResultMarkers=[],$scope.lastPage=ResultList.data.last_page,MapMarker.reset(),uiGmapGoogleMapApi.then(function(maps){MapMarker.AddMarkers(ResultList.data.data),$scope.$parent.ResultMarkers=[],$scope.$parent.ResultMarkers=MapMarker.GetParam().Markers,$scope.$parent.Markerevents=MapMarker.GetParam().Events,$scope.$parent.Markerevents.mousedown=function(Marker){var MarkerIndex=$scope.controlMarkers.getGMarkers().indexOf(Marker);$scope.GotoExtendMode(Marker.key,MarkerIndex)},setTimeout(function(){$scope.$apply()},1e3)}),$scope.$parent.GoogleMapViewBoxClass="FullWidthCol8",$scope.$parent.ResultViewBoxClass="FullWidthCol4",$scope.$parent.LoaderList="ListLoaded",$scope.ResetMapSearch=!1,$scope.ShowingList=!0,$scope.ScrollerOpt={offset:5},$scope.JumpMarker=function(indexVal){if($scope.$parent.controlMarkers.getGMarkers&&utils.isEmpty($scope.$parent.controlMarkers.getGMarkers)){var CoMarker=$scope.$parent.controlMarkers.getGMarkers()[indexVal];MapMarker.openInfoWindow(CoMarker),null!=CoMarker.getAnimation()?CoMarker.setAnimation(null):(CoMarker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){CoMarker.setAnimation(null)},700))}},$scope.ChangeMarker=function(uuid){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),hoveredMarker.setZIndex(1e5),MapMarker.AtachBanner(hoveredMarker))}},$scope.ResetIcon=function(uuid,status){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),MapMarker.CloseBanner(hoveredMarker),hoveredMarker.setZIndex(1))}},$scope.$parent.EnableMoreItems=$scope.CurrPage<=9&&$scope.CurrPage<$scope.lastPage,$scope.ScrollerOpt.scrollToBotFunc=function(){$scope.$parent.NextPage()},$scope.$parent.NextPage=function(){if(!nextPageRequestBussy)if($scope.CurrPage<=9&&$scope.CurrPage<$scope.lastPage){nextPageRequestBussy=!0,$scope.CurrPage++,$scope.PaginationLoader=!0,($stateParams.CurrPage+1>$scope.lastPage||$stateParams.CurrPage+1>10)&&($scope.PaginationLoader=!1);for(var filterForGuild in $scope.filtersBoxes)$scope.filtersBoxes[filterForGuild]?-1==f_guildToSend.indexOf(filterForGuild)&&f_guildToSend.push(filterForGuild):-1!=f_guildToSend.indexOf(filterForGuild)&&(f_guildToSend=utils.ArrRemove(f_guildToSend,filterForGuild));var fGuildString=f_guildToSend.toString(),has_image=$scope.has_image?1:0,has_video=$scope.has_video?1:0,has_product=$scope.has_product?1:0;ngProgress.start(),SearchRequests.GetNodesOfSearchByObj({guild:$stateParams.guild,q:$stateParams.q,area:$stateParams.area,page:$scope.CurrPage,f_guild:fGuildString,has_image:has_image,has_video:has_video,has_product:has_product,keyword:$stateParams.keyword}).then(function(result){ngProgress.complete(),$scope.NodesOnPage=$.merge($scope.NodesOnPage,result.data.data),MapMarker.AddMarkers(result.data.data),$scope.$parent.ResultMarkers=MapMarker.GetParam().Markers,$scope.$parent.Markerevents=MapMarker.GetParam().Events,$scope.$parent.Markerevents.mousedown=function(Marker){$scope.GotoExtendMode(Marker.key)},$scope.PaginationLoader=!1,nextPageRequestBussy=!1},function(){ngProgress.complete(),notifications.showError("خطایی در ارسال داده رخ داده است"),nextPageRequestBussy=!1})}else 1==$scope.$parent.EnableMoreItems&&($scope.$parent.EnableMoreItems=!1,notifications.showSuccess("دانرو ، بیشتر از صد نتیجه را نشان نمی دهد"))},$scope.GotoExtendMode=function(CostumerUuid,indexOfMarker){ngProgress.start(),$rootScope.iterationCount=0;var channelObj={guilds:$stateParams.guild,area:$stateParams.area,chanel_details:indexOfMarker+1};$scope.Switchclass&&(channelObj.current_location=$scope.me.Coords.latitude+","+$scope.me.Coords.longitude),channelService.setChannel("map",channelObj),SearchRequests.GetExtend(CostumerUuid,channelService.getChannel(CostumerUuid),searchTraceService.getSearchLog()).then(function(result){ngProgress.complete(),$scope.ShowingList=!1,$scope.Extend=result.data.data,$scope.favorite=result.data.data.liked_by_user,$scope.ProductCarousel.SlideItems=result.data.data.products?result.data.data.products:[],result.data.data.media?($scope.VideoCarousel.SlideItems=result.data.data.media.video?result.data.data.media.video:[],$scope.imageGalleryCarousel.SlideItems=result.data.data.media.image?result.data.data.media.image:[]):($scope.VideoCarousel.SlideItems=[],$scope.imageGalleryCarousel.SlideItems=[]),"undefined"!=typeof indexOfMarker&&setTimeout(function(){$scope.ChangeMarker(indexOfMarker)},500),$scope.gotoElement()},function(){ngProgress.complete(),notifications.showError("خطایی در ارسال داده رخ داده است")})},$scope.BackToList=function(){$scope.ShowingList=!0},$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},$scope.notSorted=function(obj){return obj?Object.keys(obj):[]},$scope.filtersBoxes={};var f_guildToSend=[];$stateParams.f_guild&&(f_guildToSend=$stateParams.f_guild.split(",")),$scope.AddRemoveGFilter=function(ChangePage){for(var filterForGuild in $scope.filtersBoxes)$scope.filtersBoxes[filterForGuild]?-1==f_guildToSend.indexOf(filterForGuild)&&f_guildToSend.push(filterForGuild):-1!=f_guildToSend.indexOf(filterForGuild)&&(f_guildToSend=utils.ArrRemove(f_guildToSend,filterForGuild));var fGuildString=f_guildToSend.toString(),has_image=$scope.has_image?1:0,has_video=$scope.has_video?1:0,has_product=$scope.has_product?1:0;ChangePage||($scope.CurrPage=1),ngProgress.start(),SearchRequests.GetNodesOfSearchByObj({guild:$stateParams.guild,q:$stateParams.q,area:$stateParams.area,page:$scope.CurrPage,f_guild:fGuildString,has_image:has_image,has_video:has_video,has_product:has_product}).then(function(Reviced){ngProgress.complete(),$scope.NodesOnPage=Reviced.data.data,$scope.lastPage=Reviced.data.last_page,PutMarkers($scope.NodesOnPage)},function(){ngProgress.complete(),notifications.showError("خطایی در ارسال داده رخ داده است")})},$scope.RemoveTagGFilter=function(filterkey){$scope.filtersBoxes[filterkey]=!1,$scope.AddRemoveGFilter()};var PutMarkers=function(ResultArr){$scope.$parent.ResultMarkers=[],MapMarker.reset(),uiGmapGoogleMapApi.then(function(maps){MapMarker.AddMarkers(ResultArr),$scope.$parent.ResultMarkers=[],setTimeout(function(){$scope.$parent.ResultMarkers=MapMarker.GetParam().Markers,$scope.$parent.Markerevents=MapMarker.GetParam().Events,$scope.$parent.Markerevents.mousedown=function(Marker){var MarkerIndex=$scope.$parent.controlMarkers.getGMarkers().indexOf(Marker);$scope.GotoExtendMode(Marker.key,MarkerIndex)},$scope.$parent.$apply()},10)})},VideoGoingToBePlayed={};$scope.ProductViewModal={title:"",OpenModalClass:"OpenProductView",width:700,passdata:{},template:appConfig.BaseTheme+"/views/productModalView.html"},$scope.ProductCarousel={OWOptions:{items:2,responsive:!1,margin:10,singleItem:!1,rtl:!0,autoWidth:!1},CarouselClass:"CarouselContainer ReloadAble",SlideClass:"ProductItem",ItemTemplate:appConfig.BaseTheme+"/views/carousel/CarouselItems/ProductCrousel.html",SlideItems:[],base:appConfig.base,SlidesBackGround:"ProductCarouselBack",PrepareToShowProduct:function(productItem){$scope.ProductViewModal.passdata=productItem,$scope.ProductViewModal.title=productItem.title}},$scope.VideoCarousel={OWOptions:{items:2,responsive:!1,margin:10,singleItem:!1,rtl:!0,autoWidth:!1},CarouselClass:"CarouselContainer ReloadAble",SlideClass:"ProductItem",ItemTemplate:appConfig.BaseTheme+"/views/carousel/CarouselItems/VideoCrousel.html",SlideItems:[],base:appConfig.base,SlidesBackGround:"VideoPlayerBack",preparetoshowvideo:function(ThisVideo){VideoGoingToBePlayed=ThisVideo}},$scope.imageGalleryCarousel={OWOptions:{items:2,responsive:!1,margin:10,singleItem:!1,rtl:!0,autoWidth:!1},CarouselClass:"CarouselContainer ReloadAble",SlideClass:"ProductItem",ItemTemplate:appConfig.BaseTheme+"/views/carousel/CarouselItems/imageGallCrousel.html",SlideItems:[],base:appConfig.base,SlidesBackGround:"ImageGalleryBack"};var CreatePlayer=function(){new jPlayerPlaylist({jPlayer:"#jquery_jplayer_1",cssSelectorAncestor:"#jp_container_1"},[{title:"کیفیت بالا",free:!0,m4v:VideoGoingToBePlayed.files.High,poster:VideoGoingToBePlayed.files.Large},{title:"کیفیت پایین",free:!0,m4v:VideoGoingToBePlayed.files.Low,poster:VideoGoingToBePlayed.files.Medium}],{supplied:"webmv, ogv, m4v",useStateClassSkin:!0,autoBlur:!1,smoothPlayBar:!0,keyEnabled:!0})},DestroyPlayer=function(){$("#jquery_jplayer_1").jPlayer("destroy")};$scope.VideoPlayerModal={title:VideoGoingToBePlayed.description,OpenModalClass:"GotoPlayVideo",width:481,template:appConfig.BaseTheme+"/views/VideoPlayerModalTemplate.html",VideoObj:VideoGoingToBePlayed,AfterOpenModalFunc:CreatePlayer,AfterCloseModalFunc:DestroyPlayer},$scope.gotoElement=function(eID){jQuery(".ExtendModeOfMapContent").animate({scrollTop:"0"})},setTimeout(function(){$scope.$broadcast("rebuild:me")},1e3),$scope.$parent.TourConfig=[{type:"element",selector:".filterBut",placement:"left",heading:"مرتب سازی نتایج",text:"از طریق این مکان می توانید نتایج را بر اساس نوع کسب و کار و مطالب دارای تصویر، ویدئو و کالا فیلتر نمایید."},{type:"element",selector:".OnOffButCurLoc",placement:"right",heading:"موقعیت مکانی",text:"با فعال سازی این سیستم می توانید کسب و کار های اطراف ناحیه مورد نظر خود را مشاهده نمایید."},{type:"function",fn:function(){$scope.$parent.Switchclass=!0}},{type:"element",selector:".SetToCurrentLocation",placement:"right",heading:"موقعیت فعلی",text:"با استفاده از این گزینه همچنین می توانید جستجوی خود را حول مکان فعلی خود انجام دهید. لازم به ذکر است که این گزینه در صورتیکه مرورگر شما امکان و اجازه ی درسترسی به مکان شما را داشته باشد، درست عمل می کند"},{type:"function",fn:function(){$scope.SetMarkerToCurrentLocation()}}],$scope.$parent.HintHasBeenShown&&($scope.$parent.startJoyRide=!0,$scope.$parent.HintHasBeenShown=!1),$scope.addToWishList=function(uuid){$rootScope.IbartarUserInfo?WebServices.addToFavorite(uuid).then(function(result){result.data.status&&($scope.favorite=!$scope.favorite,utils.NormalNotificationForServerResponse(result.data.message,!0))},utils.MHandler[1]):notifications.showError("لطفا ابتدا وارد سیستم شوید")}}),angular.module("ibartarApp").controller("CreateCtrl",function($http,$scope,$rootScope,$state,CaptchaRequiremention,WebServices,SearchRequests,uiGmapGoogleMapApi,appConfig,notifications,ngProgress,JobList,utils,Analytics,searchTraceService){if($scope.JobPackages=JobList.data.data,$scope.FormErrors={},$scope.JobGuildArr=[],$rootScope.loadFooter=!1,$scope.JobRegStep=1,$rootScope.PageHeader="ثبت کسب و کار رایگان | دانرو",$rootScope.Pagedescriptions="ثبت رایگان کسب و کار در دانرو",$scope.JobSelectionList=[{name:"پیشنهاد کسب و کار دیگران",key:"other"},{name:"ثبت کسب و کار خودتان",key:"self"},{name:"ثبت مکان عمومی",key:"public"}],CaptchaRequiremention.data.data.required){$scope.CaptphaRequired=!0;var RandIntForCaptcha=function(){return Math.round(1e5*Math.random())},GenerateCaptcha=function(){$scope.CaptchaImg=appConfig.base+"/captcha?"+RandIntForCaptcha()};GenerateCaptcha(),$scope.ReffereshCaptcha=function(){GenerateCaptcha()}}$scope.SetJobRegType=function(typename){$scope.JobRegType=typename,$scope.JobRegStep=2,Analytics.trackEvent("JobCreateStep",2),Analytics.trackEvent("typeOfPageCreateClick",typename),$scope.startJoyRide=!0,jQuery("*").tooltip("hide"),setTimeout(function(){jQuery(".Steptwo").tooltip("show")},500)};var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},uiGmapGoogleMapApi.then(function(){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},events:{drag:function(){$scope.reusltsForSame=[],$scope.FormErrors={}}},zoom:11,options:{disableDefaultUI:!0,zoomControl:!0,draggableCursor:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.me={idKey:"me",icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},events:{dragend:function(){$scope.searchForSameResults()}},options:{draggable:!0,animation:google.maps.Animation.DROP}},setTimeout(function(){var ThisJobMap=$scope.map.control.getGMap();google.maps.event.addListener(ThisJobMap,"click",function(event){var ZoomLevel=ThisJobMap.getZoom();if(ZoomLevel>13){var JobLat=event.latLng.lat(),JobLng=event.latLng.lng();$scope.me.Coords={latitude:JobLat,longitude:JobLng},ThisJobMap.setOptions({zoom:15}),ThisJobMap.setCenter({lat:JobLat,lng:JobLng+.01}),google.maps.event.clearListeners(ThisJobMap,"click"),google.maps.event.addListener(ThisJobMap,"click",function(event){$scope.FormErrors={},$scope.reusltsForSame=[],$scope.$apply()}),ThisJobMap.setOptions({draggableCursor:"default",draggingCursor:"move"}),$scope.JobRegStep=3,Analytics.trackEvent("JobCreateStep",3),jQuery("*").tooltip("hide"),setTimeout(function(){jQuery(".stepThree").tooltip("show")},500)}else notifications.showError("لطفا برای تعیین مکان، از دقت بیشتری استفاده نمایید و نقشه را زوم کنید"),$scope.$apply()})},10)});var submissionIsInProgress=!1,submissionAccomplished=!1;$scope.submitTheJobReg=function(){if(ngProgress.start(),1!=submissionIsInProgress){submissionIsInProgress=!0,$scope.reusltsForSame=[];var FormToSend={title:$scope.JobTitle,address:$scope.addressJob,lat:$scope.me.Coords.latitude,lng:$scope.me.Coords.longitude,tel_1:$scope.tel1Job,guild:$scope.JobGuildArr,mobile:$scope.mobile};$scope.CaptphaRequired&&(FormToSend.captcha=$scope.JobCaptcha),WebServices.StoreJob(FormToSend,$scope.JobRegType).then(function(result){if(submissionAccomplished=!0,ngProgress.complete(),result.data.status)utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.JobRegStep=4,Analytics.trackEvent("JobCreateStep",4),jQuery("*").tooltip("hide"),setTimeout(function(){jQuery(".stepFour").tooltip("show")},500),$scope.JobCreatedObj=result.data.data;else for(var errorKey in result.data.message)$scope.FormErrors[errorKey]=result.data.message[errorKey][0];submissionIsInProgress=!1},utils.MHandler[1])}},$scope.searchForSameResults=function(){if(1==submissionAccomplished)return!1;if($scope.JobTitle&&$scope.JobTitle.length>2){SearchRequests.GetNodesOfSearchByObj({q:$scope.JobTitle,ignore_exact_title:!0,ignore_exact_guild:!0,ignore_substring:!0,ignore_guild_filtered:!0,area:"1,"+$scope.me.Coords.latitude+","+$scope.me.Coords.longitude,current_location:$scope.me.Coords.latitude+","+$scope.me.Coords.longitude},searchTraceService.setTrace("similar")).then(function(result){$scope.reusltsForSame=result.data.data;for(var i=$scope.reusltsForSame.length-1;i>=0;i--){var Dist=$scope.reusltsForSame[i].distance;1>Dist?$scope.reusltsForSame[i].distance=(1e3*Dist).toFixed(0)+" متر":$scope.reusltsForSame[i].distance=Dist.toFixed(0)+" کیلومتر"}},function(){notifications.showError("خطایی در اتصال به سرور رخ داده است")})}},$scope.TourConfig=[{type:"title",heading:"انتخاب محل روی نقشه",text:"برای شروع مراحل ثبت کسب و کار، روی نقشه زوم و بر روی محل مورد نظرتان کلیک نمایید.",elementTemplate:function(content,isEnd){var template='<div class="row"><div id="pop-over-text" class="col-md-12">'+content+'</div></div><hr><div class="row"><div class="col-md-4 col-md-offset-4 center"><a class="skipBtn btn btn-default IbartarButs blueBut pull-left" type="button"><i class="icon-thumbs-up"></i> متوجه شدم</a></div></div>';return template}}],$scope.ClaimAnalytics=function(){Analytics.trackEvent("claimInCreatePage")},$scope.SetChannel=function(indexPos,uuid){searchTraceService.saveSearchLogByUuid(uuid,"samilar")},$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))},$scope.htmlReady()}),angular.module("ibartarApp").controller("UserReg",function($scope,$state,$location,$rootScope,notifications,WebServices,appConfig,utils,ngProgress,Analytics,mobVerif){$rootScope.PageHeader="ثبت نام کاربر | دانرو";$scope.inputType="password",$scope.showOrHidePassword=function(){"password"==$scope.inputType?$scope.inputType="text":$scope.inputType="password"},$scope.FormErrors={},$scope.checkedMale=!0,$scope.checkedFemale=!1,$scope.selectMale=function(){$scope.checkedMale=!0,$scope.checkedFemale=!1},$scope.selectFemale=function(){$scope.checkedMale=!1,$scope.checkedFemale=!0},$scope.SubmitUserRegForm=function(signUpUser){if($scope.dontReg=!1,ngProgress.start(),$scope.checkedMale?$scope.gender="male":$scope.gender="female",void 0!==signUpUser){var formDataToSend={email:signUpUser.email,password:signUpUser.userPassword,firstName:signUpUser.firstName,lastName:signUpUser.lastName,gender:$scope.gender};for(key in formDataToSend)void 0===formDataToSend[key]&&($scope.dontReg=!0)}else $scope.dontReg=!0;var referrer=$location.$$search.referrer;referrer&&(formDataToSend.referrer=referrer),$scope.dontReg?notifications.showError("پر کردن  تمامی فیلد ها اجباری است!"):WebServices.SignUpUser(formDataToSend).success(function(response){ngProgress.complete(),notifications.showSuccess("ثبت نام شما با موفقیت انجام شد"),$rootScope.IbartarUserInfo=response,$state.go("home")}).error(function(errors,status){$scope.errors={message:errors,status:status},422==$scope.errors.status?angular.forEach($scope.errors.message,function(objError,inx){angular.forEach(objError,function(messageError,item){notifications.showError(messageError[0])})}):notifications.showError($scope.errors.message)})};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.linkSignInFun=function(){$state.go("userlogin",{redirect:$location.$$absUrl.toString()})},$scope.htmlReady()}),angular.module("ibartarApp").controller("UserLogin",function($scope,$state,$rootScope,ngProgress,notifications,$stateParams,WebServices,Analytics){$rootScope.PageHeader="ورود کاربر | دانرو",$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,$scope.newUser=!0,$scope.SubmitUserLoginForm=function(){function PrepareDataSignIn(){ngProgress.start();var FormDataSignIn={username:$scope.UserMobileOrEmail,password:$scope.Userpassword};return FormDataSignIn}ngProgress.start(),ngProgress.start();var signInData=PrepareDataSignIn(),signInDataForSend=new FormData;signInDataForSend.append("username",signInData.username),signInDataForSend.append("password",signInData.password),WebServices.LoginUserNew(signInDataForSend).success(function(response){$rootScope.IbartarUserInfo=response,$scope.VisibleLoginFloating=!0,$scope.ErrorMessages="",1==response.profileVersion&&($scope.openModalShowMessageEditProfile=!0,$scope.showMessageEditProfile=!0,$scope.newUser=!1),$state.params.redirect?window.location.href=decodeURIComponent($state.params.redirect):location.reload()}).error(function(errors){$scope.errors=errors,$scope.openModalSignIn=!1,notifications.showError($scope.errors.errors)})},$scope.LogOutUserShowMessage=function(){$scope.openModalShowMessageEditProfile=!1,$scope.showMessageEditProfile=!1,ngProgress.start(),WebServices.LogOutUser().then(function(result){if(ngProgress.complete(),result.data.status){$rootScope.VisibleLoginFloating=!0,$rootScope.IbartarUserInfo=null;var required=$state.$current.data;$state.$current.data&&required.mustBeLoggedIn&&$state.go("home")}else notifications.showError("خطایی در سیستم رخ داده است"),$log.error("unexpected Error Has been occurred");$state.params.redirect?window.location.href=decodeURIComponent($state.params.redirect):location.reload()},function(){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور رخ داده است"),$log.error("Error in Sending Data For Loging in")})};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.htmlReady()}),angular.module("ibartarApp").controller("CounsellorCtrl",function($scope,$state,$rootScope,counsellorData,counsellorStat,notifications,WebServices,utils){if(1==counsellorStat.data.status){counsellorStat.data.data.profile.id;$scope.customers=counsellorData.data.data,$scope.profile=counsellorStat.data.data,""!=$scope.profile.profile.nikname?$rootScope.PageHeader="پنل مدیریتی "+$scope.profile.profile.nikname:$rootScope.PageHeader="پنل مدیریتی "+$scope.profile.profile.fullname,counsellorData.data.status||($state.go("home"),notifications.showError("شما اجازه دسترسی به این صفحه را ندارید")),$scope.SetOrder=function(order){$scope.order=order},$scope.CustomerTable=$scope.customers.customers,$scope.SetTheList=function(listNum){switch($scope.activeList=listNum,listNum){case 1:$scope.CustomerTable=$scope.customers.customers;break;case 2:$scope.CustomerTable=$scope.customers.registered;break;case 3:$scope.CustomerTable=$scope.customers.unregistered}};for(var temp_data=$scope.profile.teammate,i=0;i<temp_data.length;i++)temp_data[i].nikname?temp_data[i].name=temp_data[i].nikname:temp_data[i].name=temp_data[i].fullname,temp_data[i].y=Math.floor(temp_data[i].last_score);$scope.chartConfig={options:{chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,options3d:{enabled:!0,alpha:45,beta:0}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,dataLabels:{enabled:!0,format:"<b>{point.name}</b>  :  {point.y:.1f} ",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"},connectorColor:"silver"}},series:{stacking:"percent"}}},series:[{data:temp_data}],tooltip:{pointFormat:"{point.y:.1f}"},title:{text:""},credits:{enabled:!0},loading:!1,size:{}},$scope.sendSms=function(uuid){WebServices.SendSmsInvitation(uuid).then(function(result){result.data.status&&notifications.showSuccess("پیغام شما با موفقیت ارسال شد")},function(){notifications.showError("اتصال به سرور دچار مشکل شده است")})}}}),angular.module("ibartarApp").controller("ProfileCtrl",function($scope,$state,$location,$rootScope,Analytics,ProfileData,UserFavoritesBusiness,UserFavoritesEvents,amMoment,$window,UserComments,WebServices,notifications,utils){$rootScope.PageHeader="اطلاعات کاربر | دانرو",
$scope.UserProfile=ProfileData.data,$scope.userRateAndComment=$scope.UserProfile.userRateAndComment,$scope.UserFavoritesBusiness=UserFavoritesBusiness.data.data,$scope.showUserFavoritesBusiness=!1,0!==$scope.UserFavoritesBusiness.length&&($scope.showUserFavoritesBusiness=!0),amMoment.loadPersian(),$scope.zeroComment=!1,$scope.zeroRate=!1,0==$scope.userRateAndComment.commentCount&&($scope.zeroComment=!0),0==$scope.userRateAndComment.rateCount&&($scope.zeroRate=!0),$scope.UserFavoritesEvents=UserFavoritesEvents.data.items,$scope.showUserFavoritesEvents=!1,0!=$scope.UserFavoritesEvents.length&&($scope.showUserFavoritesEvents=!0),angular.forEach($scope.UserFavoritesEvents,function(item,index){angular.forEach(item,function(value,id){"start"==id&&(dateStringStart=moment.unix(value).format("YYYY/M/D"),value=dateStringStart,item.start=value),"end"==id&&(dateStringEnd=moment.unix(value).format("YYYY/M/D"),value=dateStringEnd,item.end=value)})}),$scope.UserComments=UserComments.data.data,$scope.showUserComments=!1,0!==$scope.UserComments.total&&($scope.showUserComments=!0),$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.goToEditProfile=function(){$scope.openModalSignIn=!1,$scope.signInForm=!1,$state.params.redirect="http://"+$window.location.host+"/editProfile",window.location.href=decodeURIComponent($state.params.redirect)},window.onscroll=function(){var windowScrollTop=window.pageYOffset,otherHeader=$(".MainMenuContainerHome");0!=windowScrollTop?otherHeader.css({boxShadow:" 0px 2px 4px rgba(0, 0, 0, 0.2)"}):otherHeader.css({boxShadow:"none"})}}),angular.module("ibartarApp").controller("EditProfileCtrl",function($scope,$state,$location,$rootScope,$window,dateFilter,WebServices,notifications,GetEditProfileData,utils,appConfig,amMoment,$timeout,ngProgress,mobVerif){amMoment.loadPersian(),$rootScope.PageHeader="دانرو - ویرایش پروفایل کاربری",$scope.EditProfileData=GetEditProfileData.data.user,$scope.showUpdateBtn=!0,$scope.birthday=$scope.EditProfileData.birthday,$scope.showBirth=!1,null!==$scope.birthday&&(dateString=moment.unix($scope.birthday).format("YYYY/M/D"),value=dateString,$scope.Jbirthday=value,$scope.showBirth=!0),$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenBirthdayTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenBirthdayTimeVal=!$scope.OpenBirthdayTimeVal},void 0!==$rootScope.avatarUserImg&&($scope.EditProfileData.avatar.Small=$rootScope.avatarUserImg);var PrevLogo=$scope.EditProfileData.avatar.Small;$scope.EditAvatarUser={title:"ویرایش عکس ",OpenModalClass:"GotoEditLogo",width:800,template:appConfig.BaseTheme+"/views/editModulesForShowCase/EditAvatarUser.html",PrevLogo:PrevLogo},$scope.provinces=GetEditProfileData.data.provinces,$scope.province=GetEditProfileData.data.user.province,$scope.cityUser=GetEditProfileData.data.user.city,$scope.provinces.push($scope.province),$scope.showAddress=!1,$scope.showCities=!1,null!==$scope.province&&($scope.showAddress=!0),$scope.changeValueProvince=function(province){$scope.provinceUserId=province.id,notifications.showError("انتخاب فیلد شهر الزامی است!"),$scope.cities=province.cities,$scope.showCities=!0},$scope.changeValueCity=function(city){$scope.cityUserId=city.id},$scope.province&&($scope.provinceUserId=$scope.EditProfileData.province.id,$scope.cityUserId=$scope.EditProfileData.city.id),$scope.Categories=GetEditProfileData.data.categories,$scope.favCategories=GetEditProfileData.data.user.favoriteCategories,$scope.multipleSelectedCategory=[];var selectedCategories=[],categoriesIdUser=[],categoriesId=[];angular.forEach($scope.Categories,function(obj,i){categoriesId.push(obj.id)}),null!=$scope.favCategories&&angular.forEach($scope.favCategories,function(fav,inx){var inxFavUser=categoriesId.indexOf(parseInt(fav.id));categoriesIdUser.push(parseInt(fav.id)),$scope.multipleSelectedCategory[inxFavUser]=!0});var selectedCategories=categoriesIdUser.concat(selectedCategories);$scope.selectCategory=function(idCategorySelect,selectCategory){if(0!=selectedCategories.length){var a=selectedCategories.indexOf(idCategorySelect);-1===a?selectedCategories.length<3?($scope.multipleSelectedCategory[selectCategory]=!0,selectedCategories.push(idCategorySelect)):notifications.showError("امکان انتخاب بیش از سه علاقه مندی وجود ندارد!"):($scope.multipleSelectedCategory[selectCategory]=!1,selectedCategories.splice(a,1))}else $scope.multipleSelectedCategory[selectCategory]=!0,selectedCategories.push(idCategorySelect)},$scope.checkedMale=!1,$scope.checkedFemale=!1,null!==$scope.EditProfileData.gender&&"male"===$scope.EditProfileData.gender&&($scope.checkedMale=!0),null!==$scope.EditProfileData.gender&&"female"===$scope.EditProfileData.gender&&($scope.checkedFemale=!0),$scope.selectMale=function(){$scope.checkedMale=!0,$scope.checkedFemale=!1},$scope.selectFemale=function(){$scope.checkedMale=!1,$scope.checkedFemale=!0},$scope.ToggleValue=function(value){$scope[value]=!$scope[value],$scope.showUpdateBtn=!$scope.showUpdateBtn},$scope.changePass=function(){WebServices.changePassword($scope.profile).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.UserPassEdit=!1,$scope.showUpdateBtn=!0):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.UpdateUserProfile=function(user){$scope.dontUpdate=!1,$scope.checkedMale===!0&&($scope.gender="male"),$scope.checkedFemale===!0&&($scope.gender="female"),$scope.birthdayTime?$scope.birthDate=moment(dateFilter($scope.birthdayTime,"yyyy-MM-dd")).unix():$scope.birthday?$scope.birthDate=$scope.birthday:$scope.birthDate="",void 0===$scope.provinceUserId&&($scope.province?$scope.provinceUserId=$scope.province.id:$scope.provinceUserId=""),void 0===$scope.cityUserId&&($scope.cityUser?$scope.cityUserId=$scope.cityUser.id:$scope.cityUserId=""),void 0===$scope.gender&&(notifications.showError("پر کردن فیلد جنسیت الزامی است!"),$scope.dontUpdate=!0),(" "===user.firstName||void 0===user.firstName)&&(notifications.showError("پر کردن فیلد نام الزامی است!"),$scope.dontUpdate=!0),(" "===user.lastName||void 0===user.lastName)&&($scope.dontUpdate=!0,notifications.showError("پر کردن فیلد نام خانوادگی الزامی است!")),(" "===user.email||void 0===user.email)&&($scope.dontUpdate=!0,notifications.showError("پر کردن فیلد ایمیل اجباری است!")),$scope.EditProfileObj={firstName:user.firstName,lastName:user.lastName,bio:user.bio,email:user.email,birthday:$scope.birthDate,province:$scope.provinceUserId,city:$scope.cityUserId,gender:$scope.gender,favoriteCategories:selectedCategories},void 0!==$rootScope.avatarUser&&($scope.EditProfileObj.avatar=$rootScope.avatarUser);var ObjEditProfile=new FormData;if(ObjEditProfile.append("firstName",$scope.EditProfileObj.firstName),ObjEditProfile.append("lastName",$scope.EditProfileObj.lastName),ObjEditProfile.append("bio",$scope.EditProfileObj.bio),ObjEditProfile.append("email",$scope.EditProfileObj.email),ObjEditProfile.append("birthday",$scope.EditProfileObj.birthday),ObjEditProfile.append("province",$scope.EditProfileObj.province),ObjEditProfile.append("city",$scope.EditProfileObj.city),ObjEditProfile.append("gender",$scope.EditProfileObj.gender),0!==$scope.EditProfileObj.favoriteCategories.length)for(var i in $scope.EditProfileObj.favoriteCategories)ObjEditProfile.append("favoriteCategories[]",$scope.EditProfileObj.favoriteCategories[i]);$scope.EditProfileObj.avatar&&ObjEditProfile.append("avatar",$scope.EditProfileObj.avatar),$scope.dontUpdate||WebServices.UpdateEditProfile(ObjEditProfile).success(function(response){ngProgress.complete(),notifications.showSuccess("تغییرات با موفقیت ذخیره شد."),$state.go($state.current,{},{reload:!0})}).error(function(errors,status){$scope.errors={message:errors,status:status},422==$scope.errors.status?angular.forEach($scope.errors.message,function(objError,inx){angular.forEach(objError,function(messageError,item){notifications.showError(messageError[0])})}):notifications.showError($scope.errors.message)})},$scope.showUpdateMobile=!0,1==$scope.EditProfileData.profileVersion&&($scope.showUpdateMobile=!1);var UpdateMobileURL=$scope.EditProfileData._links.updateMobile;$scope.openModalMobileVerifyEditProfile=!1,$scope.showMobileVerifyEditProfile=!1,$scope.showBoxVerify=!1,$scope.changeMobileEditProfile=function(mobileUser){$scope.changeMobile=mobileUser,$scope.openModalMobileVerifyEditProfile=!0,$scope.showMobileVerifyEditProfile=!0},$scope.sendMobileNumber=function(newMobile){var NewMobileObj=new FormData;$scope.newMobileVerify=newMobile,NewMobileObj.append("mobile",newMobile),WebServices.UpdateMobileEditProfile(UpdateMobileURL,NewMobileObj).success(function(response){ngProgress.complete(),$scope.showMobileVerifyEditProfile=!1,$scope.showBoxVerify=!0,$("#countdown").timeTo({seconds:60,displayHours:!1})}).error(function(errors){$scope.errors=errors,notifications.showError($scope.errors.errors)})},$scope.sendCodeNumber=function(codeVerify){var CodeObj=new FormData;CodeObj.append("code",codeVerify),WebServices.UpdateMobileEditProfile(UpdateMobileURL,CodeObj).success(function(response){ngProgress.complete(),$scope.showBoxVerify=!1,$scope.openModalMobileVerifyEditProfile=!1,$scope.EditProfileData.mobile=$scope.newMobileVerify,notifications.showSuccess("موبایل شما با موفقیت تایید شد."),$state.go($state.current,{},{reload:!0})}).error(function(errors){$scope.showBoxVerify=!1,$scope.openModalMobileVerifyEditProfile=!1,$scope.showMobileVerifyEditProfile=!1,$scope.errors=errors,notifications.showError($scope.errors.errors),$state.params.redirect="http://"+$window.location.host+"/editProfile",window.location.href=decodeURIComponent($state.params.redirect)})}}),angular.module("ibartarApp").controller("EditAvatarUser",function($scope,$rootScope,$state,$stateParams,WebServices,ngProgress,notifications,utils,$q){$scope.editViewModeForAvatar=!1,$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.SourceImgOfLogo=$scope.options.PrevLogo,$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},setTimeout(function(){$scope.imgEditorConfig.image=$scope.SourceImgOfLogo},1e3),$scope.prepareToUpload=function(data){$scope.options.PrevLogo=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.cropImage=function(){$scope.$broadcast("cropImage")},$scope.$watch("imageOut",function(data){$scope.imageOut&&$scope.editViewModeForAvatar&&($scope.options.PrevLogo=$scope.imageOut,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob($scope.imageOut)),$scope.editViewModeForAvatar=!1}),$scope.SubmitEditAvatarUser=function(){var image=new Image;image.src=$scope.options.PrevLogo,$rootScope.avatarUserImg=$scope.options.PrevLogo,$rootScope.avatarUser=$scope.fileReadyToUpload;var ext=$scope.fileReadyToUpload.type.slice(6);"jpg"===angular.lowercase(ext)||"jpeg"===angular.lowercase(ext)||"png"===angular.lowercase(ext)?$state.go($state.current,$stateParams,{reload:!0}):notifications.showError("فرمت فایل شما مورد قبول نیست!")},$scope.DeleteAvatar=function(){WebServices.DeleteAvatarUser().then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}}),angular.module("ibartarApp").controller("404Controller",function($scope,$rootScope,$state,Analytics){$scope.areaAutocompleteTools={},$rootScope.PageHeader="خطای ۴۰۴، صفحه مورد نظر پیدا نشد",$rootScope.PageNotFound=!0,$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$("#typed").typed({stringsElement:$("#typed-strings"),loop:!0,typeSpeed:50,startDelay:150,backDelay:1e3}),$scope.htmlReady(404)}),angular.module("ibartarApp").controller("forgetpassCtrl",function($scope,$state,$rootScope,WebServices,notifications,ngProgress,Analytics,utils){$scope.FormErrors={},$rootScope.PageHeader="فراموشی رمز عبور | دانرو";var patternEmail=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$rootScope.UserMobileOrEmail=$scope.UserMobileOrEmail,$scope.SubmitTheForm=function(){var sendingObj={mobileOrEmail:$scope.UserMobileOrEmail};ngProgress.start(),WebServices.forgetpass(sendingObj).then(function(result){ngProgress.complete(),result.data.status?patternEmail.test($scope.UserMobileOrEmail)?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go("home")):(utils.NormalNotificationForServerResponse(result.data.message,!0),$rootScope.UserMobileOrEmail=$scope.UserMobileOrEmail,$state.go("resetpassword")):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(){ngProgress.complete(),notifications.showError("اتصال به شبکه دچار مشکل شده است.")})};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.htmlReady()}),angular.module("ibartarApp").controller("resetpassCtrl",function($scope,$state,$rootScope,$location,WebServices,Analytics,notifications,ngProgress,utils){$scope.FormErrors={},$scope.step3=!1,$scope.goToStep=function(){$scope.step3=!0},$location.$$search.code||$location.$$search.email?($scope.FromEmail=!0,$scope.step3=!0,$rootScope.UserMobileOrEmail=$location.$$search.email,$scope.resetCode=$location.$$search.code):$scope.FromEmail=!1,$rootScope.PageHeader="تنظیم مجدد رمز عبور",$scope.SubmitTheForm=function(){if($scope.Userpassword!=$scope.repeatPass)$scope.FormErrors.repeatPass="تکرار پسورد مطابقت ندارد";else{var sendingObj={mobileOrEmail:$rootScope.UserMobileOrEmail,code:$scope.resetCode,password:$scope.Userpassword};ngProgress.start(),WebServices.resetpass(sendingObj).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go("home")):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(){ngProgress.complete(),notifications.showError("اتصال به شبکه دچار مشکل شده است")})}};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.htmlReady()}),angular.module("ibartarApp").controller("StatsCtrl",function($scope,$rootScope,$state,WebServices,JobList,uiGmapGoogleMapApi,utils,amMoment,ngProgress,dateFilter,$ocLazyLoad,$stateParams,appConfig){function AttachGoogleMapListeners(){var ThisMap=$scope.map.control.getGMap(),startRec={},endRec={};google.maps.event.addListener(ThisMap,"mousedown",function(event){startRec={latitude:event.latLng.lat(),longitude:event.latLng.lng()},$scope.visibleRectangle=!0,$scope.areaString="انتخاب از نقشه",$scope.ShowEraser=!0}),google.maps.event.addListener(ThisMap,"mouseup",function(event){DrewRectangle=!0,endRec={latitude:event.latLng.lat(),longitude:event.latLng.lng()};var StartLatLng=new google.maps.LatLng(startRec.latitude,startRec.longitude),EndLatLng=new google.maps.LatLng(endRec.latitude,endRec.longitude),ThisBounds=new google.maps.LatLngBounds;ThisBounds.extend(StartLatLng),ThisBounds.extend(EndLatLng),$scope.bounds.ne={latitude:ThisBounds.getNorthEast().lat(),longitude:ThisBounds.getNorthEast().lng()},$scope.bounds.sw={latitude:ThisBounds.getSouthWest().lat(),longitude:ThisBounds.getSouthWest().lng()},google.maps.event.clearListeners(ThisMap,"mouseup"),google.maps.event.clearListeners(ThisMap,"mousedown"),$scope.ToggleTheMapControl(),$scope.$apply()})}function PrepareForSearch(){ngProgress.start();var FormDataToSend={};FormDataToSend.filters={};var filters={has_media:$scope.has_media,has_products:$scope.has_product,has_openinghours:$scope.has_openinghours,has_logo:$scope.has_logo,has_user:$scope.has_user,has_description:$scope.has_description,has_slogan:$scope.has_slogan,has_email:$scope.has_email,has_website:$scope.has_website,has_tel_1:$scope.has_tel_1,guild:$scope.JobGuildArr,created_by:$stateParams.created_by,pipeline_status:$scope.pipeline_status};($scope.startTime||$scope.Endtime)&&(FormDataToSend.range={},$scope.startTime&&(FormDataToSend.range.from=dateFilter($scope.startTime,"yyyy-MM-dd")),$scope.Endtime&&(FormDataToSend.range.to=dateFilter($scope.Endtime,"yyyy-MM-dd"))),$scope.sourceArr&&$scope.sourceArr.length>0&&(filters.source=$scope.sourceArr);for(var filterKey in filters)-1!=filters[filterKey]&&(FormDataToSend.filters[filterKey]=filters[filterKey]);return $scope.visibleRectangle?FormDataToSend.filters.area={lat_nw:$scope.bounds.ne.latitude,lng_nw:$scope.bounds.sw.longitude,lat_se:$scope.bounds.sw.latitude,lng_se:$scope.bounds.ne.longitude}:$scope.areaString.length&&(FormDataToSend.filters.area=$scope.areaString),FormDataToSend}function responseOfGetinList(result){if(ngProgress.complete(),result.data.status){utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.NodesOnPage=result.data.data.data,$scope.pagesOfPagination=[];for(var i=1;i<=result.data.data.last_page;i++)$scope.pagesOfPagination.push({title:"صفحه "+i,key:i});lastPageOfSearch=result.data.data.last_page}else ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!1)}function chartHandler(){this.seenCharts=[],this.validChartsName=["Providers","Properties","Sources","Date","Cities","Guilds","Operators"],this.chartNameForRequest={Properties:"business_properties",Providers:"business_count_by_providers",Sources:"sources",Date:"business_creation",Cities:"business_count_by_cities",Guilds:"business_count_by_guilds",Operators:"business_count_by_operators"}}function resetAllCharts(){$scope.pageOfSearch=1,$scope.PieChartConfig.series=[],$scope.ColumnChartConfig.series=[],$scope.DateChartConfig.series=[],$scope.OperatorsChart.series=[],$scope.GuildsChartConfig.series=[],$scope.CitiChartConfig.series=[],$scope.ProvidersChartConfig.series=[]}function makeFilterColItemTitles(arrOfTitles){var result=[];return arrOfTitles.forEach(function(title,index){result.push({title:title,key:index})}),result}function prepareTheClassForTableFilteredByRowNames(arrOfColFilterValue){var classString="";for(var key in arrOfColFilterValue)arrOfColFilterValue[key]||(classString=classString+" filter-col-"+(parseInt(key)+1));return classString}amMoment.loadPersian(),$ocLazyLoad.load($rootScope.lazyLoad.highChart),$scope.JobPackages=JobList.data.data,$scope.JobGuildArr=[],$scope.showMap=!1,$scope.MapStuck=!1;var DrewRectangle=!1;$scope.pageOfSearch=1;var lastPageOfSearch,PreviousSearch;$scope.HasCollections=[{name:"دارد",key:!0},{name:"ندارد",key:!1},{name:"-",key:-1}],$scope.pipelineCollection=[{name:"مشتریان ثبت شده",key:"is_complete"},{name:"گزارش خطا",key:"is_correct"},{name:"تکراری بودن",key:"is_unique"},{name:"نهایی کردن",key:"is_final"},{name:"-",key:-1}],$scope.has_product=-1,$scope.has_description=-1,$scope.has_media=-1,$scope.has_logo=-1,$scope.has_user=-1,$scope.has_slogan=-1,$scope.has_email=-1,$scope.has_website=-1,$scope.has_openinghours=-1,$scope.has_tel_1=-1,$scope.pipeline_status=-1,$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenEndTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenEndTimeVal=!0},$scope.OpenStartTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenStartTimeVal=!0};var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMap={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMarkers=[],$scope.controlMarkers={},$scope.clusterOptions={imagePath:appConfig.BaseTheme+"/images/markers/cluster"},$scope.bounds={sw:{latitude:0,longitude:0},ne:{latitude:4,longitude:4}},$scope.visibleRectangle=!1,$scope.areaString="",$scope.ShowEraser=!1,$scope.TogglePanel=function(){$scope.showMap=!$scope.showMap,setTimeout(function(){$scope.map.control.refresh()},1e3)}}),$scope.ToggleTheMapControl=function(){if($scope.MapStuck=!$scope.MapStuck,$scope.MapStuck){var ThisMap=$scope.map.control.getGMap();ThisMap.setOptions({draggable:!1}),AttachGoogleMapListeners()}else{var ThisMap=$scope.map.control.getGMap();google.maps.event.clearListeners(ThisMap,"mousedown"),google.maps.event.clearListeners(ThisMap,"mouseup"),ThisMap.setOptions({draggable:!0})}},$scope.eraseRec=function(){DrewRectangle&&(DrewRectangle=!1,$scope.visibleRectangle=!1,$scope.areaString="",$scope.ShowEraser=!0,AttachGoogleMapListeners())},$scope.SourceToSearch=[],$scope.AddRemoveFilter=function(fromAllSelection){$scope.sourceArr=[];var StatusOfAllSelection=$scope.SourceToSearch.crm&&$scope.SourceToSearch.google&&$scope.SourceToSearch.crowd&&$scope.SourceToSearch.geotag&&$scope.SourceToSearch.csv&&$scope.SourceToSearch.operator;if($scope.SourceToSearch.all&&!StatusOfAllSelection&&fromAllSelection&&($scope.SourceToSearch={crm:!0,google:!0,crowd:!0,all:!0,geotag:!0,csv:!0,operator:!0}),!$scope.SourceToSearch.all||StatusOfAllSelection||fromAllSelection||($scope.SourceToSearch.all=!1),!$scope.SourceToSearch.all&&StatusOfAllSelection&&fromAllSelection)for(var key in $scope.SourceToSearch)$scope.SourceToSearch[key]=!1;$scope.SourceToSearch.all||!StatusOfAllSelection||fromAllSelection||($scope.SourceToSearch.all=!0);for(var sourceKey in $scope.SourceToSearch)$scope.SourceToSearch[sourceKey]&&$scope.sourceArr.push(sourceKey)};var chart=new chartHandler;$scope.chart_show=!1,$scope.lastChartArr=["Sources","Properties"],$scope.submitForCharts=function(){chart.reset(),resetAllCharts(),chart.searchForCharts($scope.lastChartArr),$scope.chartContainerVisible=!0},$scope.getCharts=function(arrayOfOrderedCharts,index){$scope.chart_show=index,chart.searchForCharts(arrayOfOrderedCharts),$scope.lastChartArr=arrayOfOrderedCharts},chartHandler.prototype.searchForCharts=function(arrayOfCharts){var that=this,validChartListForRendering=[],chartOrderForBacked=[];arrayOfCharts.forEach(function(value,index){-1!=that.validChartsName.indexOf(value)&&-1==that.seenCharts.indexOf(value)&&(that.seenCharts.push(value),validChartListForRendering.push("fill"+value+"Chart"),chartOrderForBacked.push(that.chartNameForRequest[value]))}),validChartListForRendering.length>0&&that.requestForStatistic(chartOrderForBacked,validChartListForRendering)},chartHandler.prototype.reset=function(){this.seenCharts=[]},chartHandler.prototype.requestForStatistic=function(chartOrderForBacked,arrOfCalBacks){var FormDataToSend=PrepareForSearch();FormDataToSend.charts=chartOrderForBacked;var that=this;$scope.loadingForNewChart=!0,WebServices.GetStatistics(FormDataToSend).then(function(result){ngProgress.complete(),$scope.loadingForNewChart=!1,result.data.status?($scope.NodesOnPage=[],utils.NormalNotificationForServerResponse(result.data.message,!0),arrOfCalBacks.forEach(function(value,index){"function"==typeof that[value]&&that[value](result)})):(ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!1))},utils.MHandler[1])},chartHandler.prototype.fillSourcesChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.sources)if(0!=result.data.data.sources[ObjKey]){var tempObj={name:ObjKey,y:result.data.data.sources[ObjKey]};dataToShowMode.push(tempObj)}$scope.PieChartConfig.series=[{name:"source",data:dataToShowMode}],$scope.PieChartConfig.title={text:"منابع (تعداد کل: "+result.data.data.total+")"}},chartHandler.prototype.fillPropertiesChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_properties){var precent=result.data.data.page_properties[ObjKey]/result.data.data.total*100,tempObj={name:ObjKey+" - "+result.data.data.page_properties[ObjKey],y:result.data.data.page_properties[ObjKey],drilldown:ObjKey,z:precent.toFixed(0)+"%"};0==result.data.data.page_properties[ObjKey]&&(tempObj.z=""),dataToShowMode.push(tempObj)}$scope.ColumnChartConfig.series=[{name:"Number",data:dataToShowMode}]},chartHandler.prototype.fillDateChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_creation){var dataSplited=ObjKey.split("-"),tempObj={name:ObjKey,x:Date.UTC(parseInt(dataSplited[0]),parseInt(dataSplited[1])-1,parseInt(dataSplited[2])),y:result.data.data.page_creation[ObjKey]};dataToShowMode.push(tempObj)}$scope.DateChartConfig.series=[{name:"Per Day",data:dataToShowMode}]},chartHandler.prototype.fillCitiesChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_count_by_cities){var tempObj={name:ObjKey,y:result.data.data.page_count_by_cities[ObjKey],drilldown:ObjKey};dataToShowMode.length<10&&dataToShowMode.push(tempObj)}$scope.CitiChartConfig.series=[{name:"Number",data:dataToShowMode}]},chartHandler.prototype.fillOperatorsChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_count_by_operators){var tempObj={name:ObjKey,y:result.data.data.page_count_by_operators[ObjKey],drilldown:ObjKey};dataToShowMode.push(tempObj)}$scope.OperatorsChart.series=[{name:"Number",data:dataToShowMode}]},chartHandler.prototype.fillGuildsChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_count_by_guilds){var tempObj={name:ObjKey,y:result.data.data.page_count_by_guilds[ObjKey],drilldown:ObjKey};dataToShowMode.push(tempObj)}$scope.GuildsChartConfig.series=[{name:"Number",data:dataToShowMode}]},chartHandler.prototype.fillProvidersChart=function(result){var dataToShowMode=[];for(var ObjKey in result.data.data.page_count_by_providers){var tempObj={name:ObjKey,y:result.data.data.page_count_by_providers[ObjKey],drilldown:ObjKey};dataToShowMode.push(tempObj)}$scope.ProvidersChartConfig.series=[{name:"Number",data:dataToShowMode}]},$scope.submitionAdvancedSearch=function(){$scope.chartContainerVisible=!1;var FormDataToSend=PrepareForSearch();PreviousSearch=FormDataToSend,WebServices.GetStatisticsList($scope.pageOfSearch,FormDataToSend).then(function(result){resetAllCharts(),responseOfGetinList(result)},utils.MHandler[1])},$scope.nextPage=function(pageNumToSearch){PreviousSearch&&($scope.pageOfSearch<lastPageOfSearch||pageNumToSearch)&&($scope.pageOfSearch++,pageNumToSearch&&($scope.pageOfSearch=pageNumToSearch),WebServices.GetStatisticsList($scope.pageOfSearch,PreviousSearch).then(function(result){responseOfGetinList(result)},utils.MHandler[1]))},$scope.prevPage=function(){PreviousSearch&&$scope.pageOfSearch>1&&($scope.pageOfSearch--,WebServices.GetStatisticsList($scope.pageOfSearch,PreviousSearch).then(function(result){responseOfGetinList(result)},utils.MHandler[1]))},$scope.SubmitFormToGetMap=function(){$scope.ShowTheMapOfResults=!0,setTimeout(function(){$scope.ResultMap.control.refresh()},1e3);var FormDataToSend=PrepareForSearch();WebServices.GetStatisticsMapNodes(FormDataToSend).then(function(result){if(ngProgress.complete(),result.data.status){utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.ResultMarkers=result.data.data;for(var i=$scope.ResultMarkers.length-1;i>=0;i--)$scope.ResultMarkers[i].latitude=$scope.ResultMarkers[i].lat,
$scope.ResultMarkers[i].longitude=$scope.ResultMarkers[i].lng,$scope.ResultMarkers[i].id=$scope.ResultMarkers[i].uuid,$scope.ResultMarkers[i].icon=appConfig.BaseTheme+"/images/markers/dummymarker.png",$scope.ResultMarkers[i].show=!1,$scope.ResultMarkers[i].base=$rootScope.base}else ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.CloseMapResults=function(){$scope.ShowTheMapOfResults=!1,$scope.ResultMarkers=[]},$scope.PieChartConfig={options:{chart:{type:"pie",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1,options3d:{enabled:!0,alpha:45,beta:0}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,dataLabels:{enabled:!0,format:"<b>{point.name}</b>  :  {point.y:.1f} ",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"},connectorColor:"silver"}},series:{stacking:"percent"}}},tooltip:{pointFormat:"{point.y:.1f}"},credits:{enabled:!0},loading:!1,size:{}},$scope.ColumnChartConfig={options:{chart:{type:"column"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}},column:{pointPadding:0,borderWidth:0}}},title:{text:"جزئیات"},xAxis:{type:"category"},yAxis:{title:{text:"مقادیر"}},tooltip:{visible:!1},credits:{enabled:!0},loading:!1,size:{}},$scope.DateChartConfig={options:{chart:{type:"line"},plotOptions:{series:{stacking:""}}},title:{text:"آمار تاریخ"},xAxis:{type:"datetime"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}},$scope.CitiChartConfig={options:{chart:{type:"column"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}},column:{pointPadding:0,borderWidth:0}}},title:{text:"آمار شهرها"},xAxis:{type:"category"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}},$scope.OperatorsChart={options:{chart:{type:"column"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}},column:{pointPadding:0,borderWidth:0}}},title:{text:"آمار اپراتورها"},xAxis:{type:"category"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}},$scope.GuildsChartConfig={options:{chart:{type:"column"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}},column:{pointPadding:0,borderWidth:0}}},title:{text:"آمار فراوانی اصناف"},xAxis:{type:"category"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}},$scope.ProvidersChartConfig={options:{chart:{type:"column"},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"{point.y}"}},column:{pointPadding:0,borderWidth:0}}},title:{text:"آمار عکاس ها"},xAxis:{type:"category"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}};var FillAreaInput=function(value){$scope.areaString=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.areaString.length>2?$scope.areaAutocompleteTools.runsearch($scope.areaString):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.search=function(JobPackage){if(void 0===$scope.SearchInGuild||0===$scope.SearchInGuild.length)return!0;var match=!1;return angular.forEach(JobPackage.children,function(children){children.title.indexOf($scope.SearchInGuild)>-1&&(match=!0)}),match},$scope.colFilter=[];var colFilterTitles=["عنوان","آدرس","تلفن","موبایل","تاریخ ایجاد","تاریخ به روزرسانی","امتیاز","منبع","وضعیت","نوع ثبت","لینک","لینک مدیریت"];$scope.colFiltersItems=makeFilterColItemTitles(colFilterTitles),$scope.colFilterValue={};for(var i=0;13>i;i++)-1==[3,5,6,8,9].indexOf(i)?$scope.colFilterValue[i]=!0:$scope.colFilterValue[i]=!1;$scope.addRemoveFilter=function(){$scope.classFilteringForTable=prepareTheClassForTableFilteredByRowNames($scope.colFilterValue)},$scope.addRemoveFilter()}),angular.module("ibartarApp").controller("TempValidityCtrl",function($scope,$state,$timeout,$stateParams,operatorGame,notifications,tempPageData,uiGmapGoogleMapApi,appConfig,operatorRequests,utils,guildlist){tempPageData.data.status||(utils.NormalNotificationForServerResponse(tempPageData.data.message),$state.go("home")),$scope.pageData=tempPageData.data.data.entity,$scope.pageData.pretty_additional_data.guilds||($scope.pageData.pretty_additional_data.guilds=[]),$scope.JobPackages=guildlist.data.data,$scope.HasMoreProperty=!1,($scope.pageData.pretty_phone_numbers&&$scope.pageData.pretty_phone_numbers[1]||$scope.pageData.mobile||$scope.pageData.email||$scope.pageData.website||$scope.pageData.description||$scope.pageData.slogan)&&($scope.HasMoreProperty=!0),$state.is("temp-validity-supervisor")?$scope.isSupervisor=!0:($scope.pageData.translated_title&&($scope.prevTitle=$scope.pageData.title,$scope.pageData.title=$scope.pageData.translated_title),$scope.pageData.translated_address&&($scope.prevAddress=$scope.pageData.address,$scope.pageData.address=$scope.pageData.translated_address)),uiGmapGoogleMapApi.then(function(maps){if($scope.map={control:{},center:{latitude:$scope.pageData.latitude,longitude:$scope.pageData.longitude},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.me={idKey:"me",icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!0,animation:google.maps.Animation.DROP}},$scope.pageData.latitude&&$scope.pageData.longitude)$scope.me.Coords={latitude:$scope.pageData.latitude,longitude:$scope.pageData.longitude};else{setTimeout(function(){var ThisJobMap=$scope.map.control.getGMap();google.maps.event.addListener(ThisJobMap,"click",function(event){var JobLat=event.latLng.lat(),JobLng=event.latLng.lng();$scope.me.Coords={latitude:JobLat,longitude:JobLng},ThisJobMap.setOptions({zoom:15}),ThisJobMap.setCenter({lat:JobLat,lng:JobLng})})},10);var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},notifications.showError("این کسب و کار نقطه ای روی نقشه نداشته است")}}),$timeout(function(){$scope.map.control.refresh()},1e3),$scope.SubmitForNextStep=function(){$scope.pageData.update=!0,$scope.pageData.phone_numbers=$scope.pageData.pretty_phone_numbers,$scope.pageData.guilds=$scope.pageData.pretty_additional_data.guilds,$scope.pageData.latitude=$scope.me.Coords.latitude,$scope.pageData.longitude=$scope.me.Coords.longitude;var methodOfSubmit;methodOfSubmit=$state.is("temp-validity")?"NextForTempPage":"ConvertToPage",operatorRequests[methodOfSubmit]($scope.pageData.id,$scope.pageData).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(error){422!=error.status||error.data.status?utils.MHandler[1](error):utils.NormalNotificationForServerResponse(error.data.message,!1)})},$scope.pushBackStep=function(){operatorRequests.PushBack($scope.pageData.id).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(error){422!=error.status||error.data.status?utils.MHandler[1](error):utils.NormalNotificationForServerResponse(error.data.message,!1)})},$scope.RejectThisStep=function(){operatorRequests.deleteTempPage($scope.pageData.id).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},function(error){422!=error.status||error.data.status?utils.MHandler[1](error):utils.NormalNotificationForServerResponse(error.data.message,!1)})}}),angular.module("ibartarApp").controller("OperatorImportCtrl",function($scope,$timeout,$state,$stateParams,operatorGame,uiGmapGoogleMapApi,appConfig,utils,operatorRequests){var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},events:{drag:function(){$scope.reusltsForSame=[],$scope.FormErrors={}}},zoom:11,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.me={idKey:"me",icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!0,animation:google.maps.Animation.DROP}}}),$timeout(function(){var ThisJobMap=$scope.map.control.getGMap();google.maps.event.addListener(ThisJobMap,"click",function(event){var JobLat=(ThisJobMap.getZoom(),event.latLng.lat()),JobLng=event.latLng.lng();$scope.me.Coords={latitude:JobLat,longitude:JobLng},ThisJobMap.setOptions({zoom:13}),ThisJobMap.setCenter({lat:JobLat,lng:JobLng}),google.maps.event.clearListeners(ThisJobMap,"click"),google.maps.event.addListener(ThisJobMap,"click",function(event){$scope.FormErrors={},$scope.reusltsForSame=[],$scope.$apply()}),ThisJobMap.setOptions({draggableCursor:"default",draggingCursor:"move"}),$scope.JobRegStep=2})},10),$scope.SubmitImportByOperator=function(){var FormToImport={title:$scope.title,address:$scope.address,email:$scope.email,description:$scope.description,latitude:$scope.me.Coords.latitude,longitude:$scope.me.Coords.longitude,slogan:$scope.slogan,website:$scope.website};FormToImport.phone_numbers=[],FormToImport.phone_numbers.push($scope.phone_numbers),operatorRequests.OperatorImport(FormToImport).then(function(result){utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($state.current,$stateParams,{reload:!0})},function(error){422!=error.status||error.data.status?utils.MHandler[1](error):utils.NormalNotificationForServerResponse(error.data.message,!1)})}}),angular.module("ibartarApp").controller("UniqePageCtrl",function($stateParams,$state,$scope,$timeout,MapMarker,appConfig,uiGmapGoogleMapApi,ThisPageData,operatorGame,SearchRequests,utils,searchTraceService,operatorRequests,$ocLazyLoad,$rootScope){if(!ThisPageData.data.status)return utils.NormalNotificationForServerResponse(ThisPageData.data.message,!1),$state.go("home"),!0;var RecivedPageData=ThisPageData.data.data.entity;$scope.Data=RecivedPageData,SearchRequests.GetNodesOfSearchByObj({q:RecivedPageData.title,ignore_exact_title:!0,ignore_exact_guild:!0,ignore_substring:!0,ignore_guild_filtered:!0,mode:"search_detail",area:"1,"+RecivedPageData.lat+","+RecivedPageData.lng,current_location:RecivedPageData.lat+","+RecivedPageData.lng},searchTraceService.setTrace("similar")).then(function(result){function arrayUnique(array){for(var a=array.concat(),i=0;i<a.length;++i)for(var j=i+1;j<a.length;++j)a[i].uuid===a[j].uuid&&a.splice(j--,1);return a}$scope.sameResults=angular.copy(result.data.data),$scope.sameResults=arrayUnique($scope.sameResults.concat([$scope.Data]));for(var i=result.data.data.length-1;i>=0;i--)result.data.data[i].uuid==RecivedPageData.uuid&&(result.data.data=utils.ArrRemove(result.data.data,result.data.data[i]));$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers(result.data.data),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},500)},utils.MHandler[1]),uiGmapGoogleMapApi.then(function(maps){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){$scope.map={control:{},center:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMarkers=[],$scope.controlMarkers={},$scope.me={idKey:"me",Coords:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!1,animation:google.maps.Animation.DROP}}})}),$scope.ChangeMarker=function(uuid){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),hoveredMarker.setZIndex(1e5),MapMarker.AtachBanner(hoveredMarker))}},$scope.ResetIcon=function(uuid,status){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),MapMarker.CloseBanner(hoveredMarker),hoveredMarker.setZIndex(1))}},$scope.SendToNextStep=function(){var notFound=!0;for(var key in $scope.sameResults)if($scope.sameResults[key].uuid==$scope.Data.uuid){notFound=!1;break}return 1==notFound?($state.go($state.current,$stateParams,{reload:!0}),!1):void operatorRequests.PageCorrectionSendToNextStep($scope.Data.uuid).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),operatorGame.tryToShow(),$state.go($state.current,$stateParams,{reload:!0})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.deleteThisPage=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید این صفحه را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?operatorRequests.PageCorrectionDeleteAction(RecivedPageData.uuid).then(function(result){result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("حذف شد","","success"),$state.go($state.current,$stateParams,{reload:!0})):(utils.NormalNotificationForServerResponse(result.data.message,!1),$state.go("home"))},utils.MHandler[1]):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.removeThisPage=function(uuid,title,index){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید "+title+" را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?operatorRequests.PageCorrectionDeleteAction(uuid).then(function(result){if(result.data.status){utils.NormalNotificationForServerResponse(result.data.message,!0),swal("حذف شد","","success");for(var indexToRemove=null,i=0;i<$scope.sameResults.length;i++)if($scope.sameResults[i].uuid==uuid){indexToRemove=i;break}$scope.sameResults.splice(indexToRemove,1);for(var markersArr=angular.copy($scope.sameResults),i=markersArr.length-1;i>=0;i--)markersArr[i].uuid==RecivedPageData.uuid&&(markersArr=utils.ArrRemove(markersArr,result.data.data[i]));$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers(markersArr),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},500)}else utils.NormalNotificationForServerResponse(result.data.message,!1),$state.go("home")},utils.MHandler[1]):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.order="distance",$scope.SetOrder=function(order){return"distance"!=$scope.order?($scope.order="distance",!1):void($scope.order=order)},$scope.selection=[],$scope.toggleSelection=function(uuid){var idx=$scope.selection.indexOf(uuid);return idx>-1?void $scope.selection.splice(idx,1):void $scope.selection.push(uuid)},$scope.sendForMerge=function(){var mergePages=[];$scope.sameResults.forEach(function(page){-1!=$scope.selection.indexOf(page.uuid)&&mergePages.push(page)}),mergePages.sort(function(a,b){var first=new Date(a.created_at),second=new Date(b.created_at);return first.getTime()-second.getTime()});var uuidsForMerge=[];mergePages.forEach(function(value,index){uuidsForMerge[index]=value.uuid}),$state.go("mergeReq",{uuids:uuidsForMerge.join(",")})}}),angular.module("ibartarApp").controller("ClaimCtrl",function($scope,notifications,$state,$rootScope,$stateParams,$timeout,WebServices,utils,ngProgress,Analytics){function SwitchController(State){switch(State){case"mobile_conflict":case"page_has_owner":$scope.StepNum=1;break;case"user_not_verified":$scope.StepNum=2;break;case"claimed":$timeout(function(){$state.go("editshow",{uuid:$stateParams.uuid})},5e3),$scope.StepNum=3}$scope.StepNum>1&&Analytics.trackEvent("claimPage",State,$stateParams.uuid,$scope.UserMobile)}$scope.StepNum=1,$rootScope.IbartarUserInfo&&($scope.UserMobile=$rootScope.IbartarUserInfo.mobile,$scope.UpdateMobileUrl=$rootScope.IbartarUserInfo._links.updateMobile),$scope.SubmitUserClaim=function(newMobile){$scope.mobileUser=newMobile;var NewMobileObj=new FormData;NewMobileObj.append("mobile",newMobile),WebServices.UpdateMobileEditProfile($scope.UpdateMobileUrl,NewMobileObj).success(function(response){ngProgress.complete(),SwitchController("user_not_verified")}).error(function(errors){$scope.errors=errors.errors,notifications.showError($scope.errors)})},$scope.SubmitVerification=function(codeVerify){var CodeObj=new FormData;CodeObj.append("code",codeVerify),WebServices.UpdateMobileEditProfile($scope.UpdateMobileUrl,CodeObj).success(function(response){ngProgress.complete(),WebServices.claimBiz($rootScope.claimUrl).success(function(response){ngProgress.complete(),SwitchController("claimed"),notifications.showSuccess("شما با موفقیت صاحب این کسب و کار شده اید.")}).error(function(errors){$scope.errors=errors.errors,notifications.showError($scope.errors)})}).error(function(errors){$scope.errors=errors.errors,notifications.showError($scope.errors)})},$scope.ResendSms=function(){ngProgress.start();var NewMobileObj=new FormData;NewMobileObj.append("mobile",$scope.mobileUser),WebServices.UpdateMobileEditProfile($scope.UpdateMobileUrl,NewMobileObj).success(function(response){ngProgress.complete(),SwitchController("user_not_verified")}).error(function(errors){notifications.showError("مشکلی در سرور وجود دارد")})}}),angular.module("ibartarApp").controller("AreaEditorCtrl",function($scope,$timeout,WebServices,utils,uiGmapGoogleMapApi,ngProgress){$scope.childTabBar=[],$scope.ResultOfSearch=[],$scope.SearchTheAreaList=function(Query){$scope.childTabBar=[],$scope.ResultOfSearch=[],ngProgress.start(),jQuery(".GroupContainer").remove(),WebServices.areaSearchQueryHirarical(Query).then(function(result){$scope.ResultOfSearch=[],ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.ResultOfSearch=result.data.data):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.RenderPoly=function(inputToRender){if($scope.ifFitToPoly=!0,$scope.IdItemSelected=inputToRender.id,$scope.updatingIitem=inputToRender,$scope.areaName=inputToRender.title,inputToRender.polygon&&inputToRender.polygon.length>0)$scope.polygon.path=JSON.parse(inputToRender.polygon);else if(inputToRender.rectangle){var nw={latitude:parseFloat(inputToRender.rectangle.nw.split(",")[0]),longitude:parseFloat(inputToRender.rectangle.nw.split(",")[1])},se={latitude:parseFloat(inputToRender.rectangle.se.split(",")[0]),longitude:parseFloat(inputToRender.rectangle.se.split(",")[1])},StartLatLng=new google.maps.LatLng(nw.latitude,nw.longitude),EndLatLng=new google.maps.LatLng(se.latitude,se.longitude),ThisBounds=new google.maps.LatLngBounds;ThisBounds.extend(StartLatLng),ThisBounds.extend(EndLatLng);var ne={latitude:ThisBounds.getNorthEast().lat(),longitude:ThisBounds.getNorthEast().lng()},sw={latitude:ThisBounds.getSouthWest().lat(),longitude:ThisBounds.getSouthWest().lng()};$scope.polygon.path=[{latitude:ne.latitude,longitude:ne.longitude},{latitude:nw.latitude,longitude:nw.longitude},{latitude:sw.latitude,longitude:sw.longitude},{latitude:se.latitude,longitude:se.longitude}]}$scope.polygon.visible=!0,$timeout(function(){$scope.ifFitToPoly=!1},50)},$scope.SubmitAreaPoly=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا از منقطه ای که تغییر داده اید اطمینان دارید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!1}).then(function(isConfirm){if(isConfirm){ngProgress.start();var sendingObj={id:$scope.updatingIitem.id,title:$scope.areaName,polygon:$scope.polygon.path};WebServices.SubmitPolyfun(sendingObj).then(function(result){ngProgress.complete(),result.data.status?(swal("اطلاعات با موفقیت ذخیره شد","","success"),utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.updatingIitem.polygon=JSON.stringify($scope.polygon.path)):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}})};var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},uiGmapGoogleMapApi.then(function(maps){$scope.ifFitToPoly=!0,$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.polygon={path:[{latitude:36.366689,longitude:50.266373},{latitude:35.98415855,longitude:52.2676279},{latitude:34.704418,longitude:54.105365}],stroke:{color:"#00affa",weight:1},events:{rightclick:function(e,d,q,f){var item,vertexInedex=f[0].vertex;$scope.polygon.path.length>3&&($scope.polygon.path=utils.ArrRemove($scope.polygon.path,item,vertexInedex))}},visible:!1,fill:{color:"#00affa",opacity:.2}}});var FillAreaInput=function(value){$scope.AreaSearchQuery=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaSearchQuery.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaSearchQuery):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.goForEditMode=function(event){$scope.NewArea&&$scope.NewArea.length>0?($scope.editMode=!0,jQuery(".SearchBoxInCreatePage").removeClass("displayNone"),$timeout(function(){$scope.map.control.refresh(),$scope.$apply()},500)):event.preventDefault()},$scope.backFromEditMode=function(){$scope.editMode=!1,$scope.IdItemSelected=!1,$scope.polygon.visible=!1,jQuery(".SearchBoxInCreatePage").addClass("displayNone"),$timeout(function(){$scope.map.control.refresh(),$scope.$apply()},500)},$scope.renderAtCenter=function(){var bounds=$scope.map.control.getGMap().getBounds();if(bounds){var boundTopRight=bounds.getNorthEast(),boundLeftBottom=bounds.getSouthWest(),rectangleBoundReadyForRendering={rectangle:{nw:boundTopRight.lat()+","+boundLeftBottom.lng(),se:boundLeftBottom.lat()+","+boundTopRight.lng()}};$scope.RenderPoly(rectangleBoundReadyForRendering)}},$scope.removePolyGon=function(){$scope.polygon.visible=!1},$scope.SubmitNewArea=function(){ngProgress.start();var dataToSend={formated_address:$scope.NewArea,polygon:$scope.polygon.path};WebServices.SubmitNewArea(JSON.stringify(dataToSend)).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.backFromEditMode(),$scope.NewArea="",$scope.polygon.path={}):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.erasePolyFromMap=function(){$scope.polygon.path=[],$scope.polygon.visible=!1},$timeout(function(){$scope.ifFitToPoly=!1},50),$scope.ToggleFullScreen=function(){!$scope.ExpandedMapOrNot||!$scope.ExpandedMapOrNot.length>0?$scope.ExpandedMapOrNot="expandedMapStyle":$scope.ExpandedMapOrNot="",$timeout(function(){$scope.map.control.refresh()},50)}}),angular.module("ibartarApp").controller("RevisionCtrl",function($scope,$rootScope,$state,WebServices,JobList,uiGmapGoogleMapApi,utils,amMoment,ngProgress,dateFilter,$ocLazyLoad,$stateParams,SearchRequests,notifications,appConfig){function responseOfGetinList(result){if(ngProgress.complete(),result.data.status){utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.NodesOnPage=result.data.data.data,angular.forEach($scope.NodesOnPage,function(page){page.modified=!1}),$scope.pagesOfPagination=[];for(var i=1;i<=result.data.data.last_page;i++)$scope.pagesOfPagination.push({title:"صفحه "+i,key:i});lastPageOfSearch=result.data.data.last_page}else ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!1)}function AttachGoogleMapListeners(){var ThisMap=$scope.map.control.getGMap(),startRec={},endRec={};google.maps.event.addListener(ThisMap,"mousedown",function(event){startRec={latitude:event.latLng.lat(),longitude:event.latLng.lng()},$scope.visibleRectangle=!0,$scope.areaString="انتخاب از نقشه",$scope.ShowEraser=!0}),google.maps.event.addListener(ThisMap,"mouseup",function(event){DrewRectangle=!0,endRec={latitude:event.latLng.lat(),longitude:event.latLng.lng()};var StartLatLng=new google.maps.LatLng(startRec.latitude,startRec.longitude),EndLatLng=new google.maps.LatLng(endRec.latitude,endRec.longitude),ThisBounds=new google.maps.LatLngBounds;ThisBounds.extend(StartLatLng),ThisBounds.extend(EndLatLng),$scope.bounds.ne={latitude:ThisBounds.getNorthEast().lat(),longitude:ThisBounds.getNorthEast().lng()},$scope.bounds.sw={latitude:ThisBounds.getSouthWest().lat(),longitude:ThisBounds.getSouthWest().lng()},google.maps.event.clearListeners(ThisMap,"mouseup"),google.maps.event.clearListeners(ThisMap,"mousedown"),$scope.ToggleTheMapControl(),$scope.$apply()})}function PrepareForSearch(){ngProgress.start();var FormDataToSend={title:$scope.revision_title,tel_1:$scope.revision_tel,address:$scope.revision_address,created_by:$scope.revision_creator,user_id:$scope.revision_manager,pipeline_status:$scope.revision_pipeline_status,guilds:$scope.JobGuildArr,mobile:$scope.revision_mobile,uuid:$scope.revision_uuid,per_page:$scope.revision_per_page};for(key in FormDataToSend)(void 0===FormDataToSend[key]||0===FormDataToSend[key].length||-1===FormDataToSend[key])&&delete FormDataToSend[key];return"ندارد"===FormDataToSend.tel_1&&(FormDataToSend.tel_1=""),"ندارد"===FormDataToSend.mobile&&(FormDataToSend.mobile=""),$scope.sourceArr&&$scope.sourceArr.length>0&&(filters.source=$scope.sourceArr),$scope.visibleRectangle?FormDataToSend.area={lat_nw:$scope.bounds.ne.latitude,lng_nw:$scope.bounds.sw.longitude,lat_se:$scope.bounds.sw.latitude,lng_se:$scope.bounds.ne.longitude}:$scope.areaString.length&&(FormDataToSend.area=$scope.areaString),FormDataToSend}function makeFilterColItemTitles(arrOfTitles){var result=[];return arrOfTitles.forEach(function(title,index){result.push({title:title,key:index})}),result}function prepareTheClassForTableFilteredByRowNames(arrOfColFilterValue){var classString="";for(var key in arrOfColFilterValue)arrOfColFilterValue[key]||(classString=classString+" filter-col-"+(parseInt(key)+1));return classString}function makeFilterColItemTitles(arrOfTitles){var result=[];return arrOfTitles.forEach(function(title,index){result.push({title:title,key:index})}),result}function prepareTheClassForTableFilteredByRowNames(arrOfColFilterValue){var classString="";for(var key in arrOfColFilterValue)arrOfColFilterValue[key]||(classString=classString+" filter-col-"+(parseInt(key)+1));return classString}amMoment.loadPersian(),$scope.JobPackages=JobList.data.data,$scope.JobGuildArr=[],$scope.multipleSelectedRow=[],$scope.showMap=!1,$scope.MapStuck=!1,$scope.selectedAll=!1;var DrewRectangle=!1;$scope.hasPhoneShow=!1,$scope.hasMobileShow=!1,$scope.pageOfSearch=1,$scope.revision_per_page=10;var lastPageOfSearch,PreviousSearch;$scope.pipelineCollection=[{name:"مشتریان ثبت شده",key:"is_complete"},{name:"گزارش خطا",key:"is_correct"},{name:"تکراری بودن",key:"is_unique"},{name:"بررسی نهایی",key:"is_final"},{name:"اتمام بررسی",key:"finished"},{name:"-",key:-1}],$scope.perPageCollection=[{name:" 10 ",key:"10"},{name:" 20",key:"20"},{name:" 50",key:"50"},{name:"100 ",key:"100"}],$scope.hasPhone=function(){$scope.hasPhoneShow=!$scope.hasPhoneShow},$scope.noPhone=function(){$scope.hasPhoneShow=!1,$scope.revision_tel="ندارد"},$scope.hasMobile=function(){$scope.hasMobileShow=!$scope.hasMobileShow},$scope.noMobile=function(){$scope.hasMobileShow=!1,$scope.revision_mobile="ندارد"};var events={places_changed:function(searchBox){var CreateMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);CreateMap.fitBounds(bounds),CreateMap.setOptions({zoom:14})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMap={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMarkers=[],$scope.controlMarkers={},$scope.clusterOptions={imagePath:appConfig.BaseTheme+"/images/markers/cluster"},$scope.bounds={sw:{latitude:0,longitude:0},ne:{latitude:4,longitude:4}},$scope.visibleRectangle=!1,$scope.areaString="",$scope.ShowEraser=!1,$scope.TogglePanel=function(){$scope.showMap=!$scope.showMap,setTimeout(function(){$scope.map.control.refresh()},1e3)}}),$scope.ToggleTheMapControl=function(){if($scope.MapStuck=!$scope.MapStuck,$scope.MapStuck){var ThisMap=$scope.map.control.getGMap();ThisMap.setOptions({draggable:!1}),AttachGoogleMapListeners()}else{var ThisMap=$scope.map.control.getGMap();google.maps.event.clearListeners(ThisMap,"mousedown"),google.maps.event.clearListeners(ThisMap,"mouseup"),ThisMap.setOptions({draggable:!0})}},$scope.eraseRec=function(){DrewRectangle&&(DrewRectangle=!1,$scope.visibleRectangle=!1,$scope.areaString="",$scope.ShowEraser=!0,AttachGoogleMapListeners())},$scope.submitionAdvancedSearch=function(){var FormDataToSend=PrepareForSearch();PreviousSearch=FormDataToSend,WebServices.GetRevisionList($scope.pageOfSearch,FormDataToSend).then(function(result){responseOfGetinList(result),$scope.selectedAll=!1},utils.MHandler[1])},$scope.nextPage=function(pageNumToSearch){PreviousSearch&&($scope.pageOfSearch<lastPageOfSearch||pageNumToSearch)&&($scope.pageOfSearch++,pageNumToSearch&&($scope.pageOfSearch=pageNumToSearch),WebServices.GetRevisionList($scope.pageOfSearch,PreviousSearch).then(function(result){responseOfGetinList(result)},utils.MHandler[1]))},$scope.prevPage=function(){PreviousSearch&&$scope.pageOfSearch>1&&($scope.pageOfSearch--,WebServices.GetRevisionList($scope.pageOfSearch,PreviousSearch).then(function(result){
responseOfGetinList(result)},utils.MHandler[1]))},$scope.SubmitFormToGetMap=function(){$scope.ShowTheMapOfResults=!0,setTimeout(function(){$scope.ResultMap.control.refresh()},1e3);var FormDataToSend=PrepareForSearch();WebServices.GetStatisticsMapNodes(FormDataToSend).then(function(result){if(ngProgress.complete(),result.data.status){utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.ResultMarkers=result.data.data;for(var i=$scope.ResultMarkers.length-1;i>=0;i--)$scope.ResultMarkers[i].latitude=$scope.ResultMarkers[i].lat,$scope.ResultMarkers[i].longitude=$scope.ResultMarkers[i].lng,$scope.ResultMarkers[i].id=$scope.ResultMarkers[i].uuid,$scope.ResultMarkers[i].icon=appConfig.BaseTheme+"/images/markers/dummymarker.png",$scope.ResultMarkers[i].show=!1,$scope.ResultMarkers[i].base=$rootScope.base}else ngProgress.complete(),utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])},$scope.CloseMapResults=function(){$scope.ShowTheMapOfResults=!1,$scope.ResultMarkers=[]};var FillAreaInput=function(value){$scope.areaString=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.areaString.length>2?$scope.areaAutocompleteTools.runsearch($scope.areaString):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.colFilter=[];var colFilterTitles=["عنوان","آدرس","تلفن","موبایل","تاریخ ایجاد","تاریخ به روزرسانی","امتیاز","منبع","وضعیت","نوع ثبت","لینک","لینک مدیریت"];$scope.colFiltersItems=makeFilterColItemTitles(colFilterTitles),$scope.colFilterValue={};for(var i=0;13>i;i++)-1==[3,5,6,8,9].indexOf(i)?$scope.colFilterValue[i]=!0:$scope.colFilterValue[i]=!1;$scope.addRemoveFilter=function(){$scope.classFilteringForTable=prepareTheClassForTableFilteredByRowNames($scope.colFilterValue)},$scope.addRemoveFilter(),$scope.selectedItemDictionary={},$scope.checkAll=function(boolValue){$scope.NodesOnPage.forEach(function(customer){$scope.selectedItemDictionary[customer.uuid]=boolValue})},$scope.updateCustomer=function(){var new_status=$scope.revision_pipeline_status_change;if(void 0===new_status)return void notifications.showError("هیچ یک از وضعیتها انتخاب نشده است.");var selectedItemDictionaryUpdate=[];Object.keys($scope.selectedItemDictionary).forEach(function(selectedItemUUID){$scope.selectedItemDictionary[selectedItemUUID]&&(selectedItemDictionaryUpdate.push({uuid:selectedItemUUID,new_status:new_status}),angular.forEach($scope.NodesOnPage,function(page){page.uuid===selectedItemUUID&&(page.pipeline_status=new_status,page.modified=!0)}))});var reqJSon={updates:selectedItemDictionaryUpdate};WebServices.UpdateRevisionList(reqJSon).then(function(result){result.data.status?(swal(" بروزرسانی شد.","","success"),Object.keys($scope.selectedItemDictionary).forEach(function(selectedItemUUID){angular.forEach($scope.NodesOnPage,function(page){if(page.uuid===selectedItemUUID){var index=$scope.NodesOnPage.indexOf(page);$scope.NodesOnPage.splice(index,1),$scope.selectedItemDictionary={}}})})):notifications.showError("مشکلی در سرور وجود دارد")})},$scope.deleteCustomer=function(){swal({title:"آیا مطمئن هستید؟",text:"آیا برای حذف منو اطمینان دارید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){if(isConfirm){var UUIDArray=[];Object.keys($scope.selectedItemDictionary).forEach(function(selectedItemUUID){$scope.selectedItemDictionary[selectedItemUUID]&&UUIDArray.push(selectedItemUUID)});var reqJSon={pages_uuid:UUIDArray};WebServices.DeleteRevisionList(reqJSon).then(function(result){result.data.status?(swal("حذف شد","","success"),Object.keys($scope.selectedItemDictionary).forEach(function(selectedItemUUID){angular.forEach($scope.NodesOnPage,function(page){if(page.uuid===selectedItemUUID){var index=$scope.NodesOnPage.indexOf(page);$scope.NodesOnPage.splice(index,1),$scope.selectedItemDictionary={}}})})):notifications.showError("هیچ موردی توسط شما انتخاب نشده است!")})}})},$scope.colFilter=[];var colFilterTitles=["انتخاب","عنوان","آدرس","تلفن","موبایل","تاریخ ایجاد","تاریخ به روزرسانی","امتیاز","منبع","وضعیت","نوع ثبت","لینک"," ویرایش"];$scope.colFiltersItems=makeFilterColItemTitles(colFilterTitles),$scope.colFilterValue={};for(var i=0;14>i;i++)-1==[3,5,6,8,9].indexOf(i)?$scope.colFilterValue[i]=!0:$scope.colFilterValue[i]=!1;$scope.addRemoveFilter=function(){$scope.classFilteringForTable=prepareTheClassForTableFilteredByRowNames($scope.colFilterValue)},$scope.addRemoveFilter()}),angular.module("ibartarApp").run(function($rootScope){$rootScope.routesOfRoles=[{title:"عملیات اپراتوری",roles:["operatortask","operatortask","operator_is_correct","operator_is_complete","operator_is_unique","operator_page_revision","operator_manage_comments"],child:[{title:"تایید فید",roles:["operatortask"],child:[{url:$rootScope.base+"/operators/media-check",title:"تایید عکس",roles:["operatortask"]},{url:$rootScope.base+"/operators/product-check",title:"تایید محصول",roles:["operatortask"]}]},{url:$rootScope.base+"/operators/page-correct",title:"بررسی گزارش خطا",roles:["operator_is_correct"]},{url:$rootScope.base+"/operators/page-revision",title:"بررسی سریع",roles:["operator_is_correct"]},{url:$rootScope.base+"/operators/page-final",title:"بررسی نهایی صفحات مشتری",roles:["operator_is_final"]}]},{title:"لیگ پیک برتر",roles:["admin"],child:[{url:$rootScope.base+"/league",title:"لیگ دعوت شدگان",roles:["registered"]},{url:$rootScope.base+"/user/scores",title:"بانک امتیازات",roles:["admin"]}]},{url:$rootScope.base+"/counsellor/panel",title:"لیست مشتریان شما",roles:["counsellor"]},{url:$rootScope.base+"/admin/schedule",title:"برنامه هفتگی",roles:["admin"]},{title:"آمار",roles:["statistic_panel"],child:[{url:$rootScope.base+"/amar",title:"آمار مشتریان",roles:["statistic_panel"]},{url:$rootScope.base+"/operators/bug-log",title:"آمار خطاها",roles:["statistic_panel"]},{url:$rootScope.base+"/operators/statistics",title:"آمار اپراتورها",roles:["admin"]},{url:$rootScope.base+"/pages-deleted",title:"آمار صفحات حذف شده ",roles:["admin"]},{url:$rootScope.base+"/operators/page-log",title:"آمار نمایش صفحات",roles:["admin"]}]},{url:$rootScope.base+"/operators/area-editor",title:"ویرایش نواحی",roles:["area_edit"]}]}),angular.module("ibartarApp").config(function($ocLazyLoadProvider){var ThemePrefix="webApplication/desktop/app",ThemePrefixNew="webApplication/desktop/newStyle/assets/css";$ocLazyLoadProvider.config({modules:[{name:"OpeningHours",files:[ThemePrefix+"/scripts/modules/openingHours.js"]},{name:"collections",files:[ThemePrefixNew+"/collections.css","webApplication/desktop/bower_components/angular-drag-and-drop-lists/angular-drag-and-drop-lists.min.js"]},{name:"nazargardi",files:[ThemePrefixNew+"/nazargardi.css"]},{name:"wu.masonry",files:["webApplication/desktop/bower_components/masonry/dist/masonry.pkgd.min.js","webApplication/desktop/bower_components/angular-masonry/angular-masonry.js","webApplication/desktop/bower_components/imagesloaded/imagesloaded.pkgd.min.js"]},{name:"highcharts-ng",files:["webApplication/desktop/bower_components/highcharts/highcharts.js","webApplication/desktop/bower_components/highcharts-ng/dist/highcharts-ng.min.js"]},{name:"sotos.crop-image",files:["webApplication/desktop/app/scripts/modules/imageEditTool.js"]},{name:"timer",files:["webApplication/desktop/bower_components/humanize-duration/humanize-duration.js","webApplication/desktop/bower_components/angular-timer/dist/angular-timer.min.js"]},{name:"ngUploadPreview",files:["webApplication/desktop/app/scripts/directives/uploadimgpreview.js"]},{name:"ngJoyRide",files:["webApplication/desktop/app/scripts/modules/ng-joyride.js"]},{name:"sticky",files:["webApplication/desktop/app/scripts/modules/ngsticky.js"]},{name:"720kb.socialshare",files:["webApplication/desktop/bower_components/angularjs-socialshare/src/js/angular-socialshare.js"]},{name:"ui.bootstrap.datepicker",files:["webApplication/desktop/app/scripts/utils/dateparser.js","webApplication/desktop/app/scripts/utils/position.js","webApplication/desktop/app/scripts/utils/datepicker-tpls.js"]},{name:"ui.bootstrap.persian.datepicker",files:["webApplication/desktop/app/scripts/utils/persiandate.js","webApplication/desktop/app/scripts/utils/persian-datepicker-tpls.js"]}]})}).run(function($rootScope){$rootScope.lazyLoad={ngUploadPreview:["webApplication/desktop/app/scripts/directives/uploadimgpreview.js"],prettyPhoto:["webApplication/desktop/bower_components/jquery-prettyPhoto/js/jquery.prettyPhoto.js","webApplication/desktop/app/scripts/directives/prettyphoto.js","webApplication/desktop/bower_components/jquery-prettyPhoto/css/prettyPhoto.css"],JwPlayer:["webApplication/desktop/bower_components/jplayer-classid/dist/skin/blue.monday/css/jplayer.blue.monday.min.css","webApplication/desktop/bower_components/jplayer-classid/dist/jplayer/jquery.jplayer.min.js","webApplication/desktop/bower_components/jplayer-classid/dist/add-on/jplayer.playlist.min.js"],masonry:["webApplication/desktop/bower_components/masonry/dist/masonry.pkgd.min.js","webApplication/desktop/bower_components/angular-masonry/angular-masonry.js","webApplication/desktop/bower_components/imagesloaded/imagesloaded.pkgd.min.js"],highChart:["webApplication/desktop/bower_components/highcharts/highcharts.js","webApplication/desktop/bower_components/highcharts/highcharts-3d.js","webApplication/desktop/bower_components/highcharts/modules/exporting.js","webApplication/desktop/bower_components/highcharts-ng/dist/highcharts-ng.min.js"]}}),angular.module("ibartarApp").controller("mediaCheckerCtrl",function($scope,$sce,$state,operatorGame,WebServices,ngProgress,utils,mediaPoped,operatorRequests){if($scope.loadingForNewMedia=!1,!mediaPoped.data.status)return utils.NormalNotificationForServerResponse(mediaPoped.data.message,!1),$state.go("home"),!1;var TimeBeautifier=function(Time){var result={};return Time.split(" ").forEach(function(data){-1!=data.indexOf("-")?result.date=data:result.time=data}),result};$scope.mediaPoped=mediaPoped.data.data,$scope.mediaPoped.created_at=TimeBeautifier($scope.mediaPoped.created_at),$scope.acceptMedia=function(feedOrNot){ngProgress.start(),$scope.loadingForNewMedia=!0,operatorRequests.acceptOrFeedTheMedia($scope.mediaPoped.id,feedOrNot).then(function(result){return $scope.loadingForNewMedia=!1,ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.mesage,!0),operatorGame.tryToShow(),void popNewImage()):void utils.NormalNotificationForServerResponse(result.data.mesage,!1)},utils.MHandler[1])},$scope.removeMedia=function(){ngProgress.start(),$scope.loadingForNewMedia=!0,swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید که میخواهید این تصویر حذف گردد",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?WebServices.removeMedia($scope.mediaPoped.id).then(function(result){$scope.loadingForNewMedia=!1,ngProgress.complete(),result.data.status&&(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("حذف شد","","success"),popNewImage())},utils.MHandler[1]):(ngProgress.complete(),$scope.loadingForNewMedia=!1,swal("لغو","شما از حذف این مورد صرف نظر کردید","error"))})};var popNewImage=function(){ngProgress.start(),$scope.loadingForNewMedia=!0,operatorRequests.popMedia().then(function(result){return ngProgress.complete(),$scope.loadingForNewMedia=!1,result.data.status?($scope.mediaPoped=result.data.data,void($scope.mediaPoped.created_at=TimeBeautifier($scope.mediaPoped.created_at))):(utils.NormalNotificationForServerResponse(result.data.message,!1),!1)},utils.MHandler[1])};$scope.trustSrc=function(src){return $sce.trustAsResourceUrl(src)}}),angular.module("ibartarApp").controller("productCheckerCtrl",function($scope,$state,operatorGame,WebServices,ngProgress,utils,productPoped,operatorRequests){if(!productPoped.data.status)return utils.NormalNotificationForServerResponse(productPoped.data.message,!1),$state.go("home"),!1;$scope.productPoped=productPoped.data.data,$scope.acceptProduct=function(feedOrNot){ngProgress.start(),$scope.loadingForNewMedia=!0,operatorRequests.acceptOrFeedTheProduct($scope.productPoped.id,feedOrNot).then(function(result){return ngProgress.complete(),$scope.loadingForNewMedia=!1,result.data.status?(utils.NormalNotificationForServerResponse(result.data.mesage,!0),operatorGame.tryToShow(),void popNewProduct()):void utils.NormalNotificationForServerResponse(result.data.mesage,!1)},utils.MHandler[1])},$scope.removeProduct=function(){$scope.loadingForNewMedia=!0,ngProgress.start(),swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید که میخواهید این محصول حذف گردد",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?WebServices.RemoveProduct($scope.productPoped.uuid,$scope.productPoped.id).then(function(result){$scope.loadingForNewMedia=!1,ngProgress.complete(),result.data.status&&(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("حذف شد","","success"),popNewProduct())},utils.MHandler[1]):($scope.loadingForNewMedia=!1,ngProgress.complete(),swal("لغو","شما از حذف این مورد صرف نظر کردید","error"))})};var popNewProduct=function(){ngProgress.start(),operatorRequests.popProduct().then(function(result){return ngProgress.complete(),result.data.status?void($scope.productPoped=result.data.data):(utils.NormalNotificationForServerResponse(result.data.message,!1),!1)},utils.MHandler[1])}}),angular.module("ibartarApp").controller("favouriteCtrl",function($scope,$state,$rootScope,$stateParams,favoriteList,WebServices,utils,channelService){function compare(a,b){return a.data.length>b.data.length?-1:1}$rootScope.PageHeader="لیست علاقه مندی های من | دانرو",$scope.myFavorites={},angular.forEach(favoriteList.data.data,function(value,key){angular.forEach(value.guilds,function(val,id){$scope.myFavorites[id]||($scope.myFavorites[id]={}),$scope.myFavorites[id].guildname=val,$scope.myFavorites[id].data||($scope.myFavorites[id].data=[],$scope.guildcount++),$scope.myFavorites[id].data.push(value),$scope.favcount++})}),$scope.arrayOfFavorites=[],angular.forEach($scope.myFavorites,function(result){$scope.arrayOfFavorites.push(result)}),$scope.arrayOfFavorites=$scope.arrayOfFavorites.sort(compare),$scope.SetChannel=function(uuid){channelService.setChannel("favorites",{},uuid)},$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))}}),angular.module("ibartarApp").controller("invitationLeagueCtrl",function($scope,$rootScope,$timeout,$filter,amMoment,notifications,ngProgress,WebServices,userPbCode,utils,appConfig){function userScoreModel(){var that=this,scoreDataType={score:0,count:0},scoreType={rejects:{appInstalls:angular.copy(scoreDataType),jobReg:angular.copy(scoreDataType),inviteReg:angular.copy(scoreDataType),Manual:angular.copy(scoreDataType),pageCompletion:angular.copy(scoreDataType),loginUsage:angular.copy(scoreDataType),Usage:angular.copy(scoreDataType)},accepts:{appInstalls:angular.copy(scoreDataType),jobReg:angular.copy(scoreDataType),inviteReg:angular.copy(scoreDataType),Manual:angular.copy(scoreDataType),pageCompletion:angular.copy(scoreDataType),loginUsage:angular.copy(scoreDataType),Usage:angular.copy(scoreDataType)}},scoresWeights={accepts:{appInstalls:1,jobReg:1,inviteReg:1,Manual:1,pageCompletion:1,loginUsage:1,Usage:1},rejects:{appInstalls:1,jobReg:1,inviteReg:1,Manual:1,pageCompletion:1,loginUsage:1,Usage:1}};this.roundScore=angular.copy(scoreType),this.totalScore=angular.copy(scoreType),this.userRoundScore=0,this.userTotalScore=0,this.calcUserScore=function(){that.userRoundScore=0,that.userTotalScore=0;for(var acceptKey in scoreType)for(var key in scoreType[acceptKey])that.userRoundScore+=that.roundScore[acceptKey][key]?that.roundScore[acceptKey][key].score*scoresWeights[acceptKey][key]:0,that.userTotalScore+=that.totalScore[acceptKey][key]?that.totalScore[acceptKey][key].score*scoresWeights[acceptKey][key]:0;return[that.userRoundScore,that.userTotalScore]};var topUsersRound=[],topUsersTotal=[];this.setTopUsersRound=function(value){for(var temp=value,i=0;i<temp.length;i++)temp[i].name=temp[i].name?temp[i].name:"بدون نام",0==temp[i].name.length&&(temp[i].name="بدون نام");topUsersRound=temp},this.getTopUsersRound=function(){return topUsersRound},this.setTopUsersTotal=function(value){if(topUsersTotal=[],0==value.length)return!1;var i,j,temparray,tempVal=value,chunk=10;for(i=0;i<tempVal.length;i++)tempVal[i].name=tempVal[i].name?tempVal[i].name:"بدون نام",0==tempVal[i].name.length&&(tempVal[i].name="بدون نام");for(i=0,j=tempVal.length;j>i;i+=chunk)temparray=tempVal.slice(i,i+chunk),topUsersTotal[topUsersTotal.length]=temparray},this.getTopUsersTotal=function(){return topUsersTotal}}$scope.seeDetailsOfScores={title:"جزئیات امتیازات",OpenModalClass:"seeDetailsOfScoresButton",width:700,template:appConfig.BaseTheme+"/views/userScoreDetailModal.html"},$rootScope.PageHeader="لیگ پیک برتر",$rootScope.Pagedescriptions="";var userScoreData=new userScoreModel;userScoreData.setTopUsersTotal(userPbCode.data.data.ranking),userScoreData.setTopUsersRound(userPbCode.data.data.ranking_round);for(var userScoresKeys=[{title:"user_score_round",translation:"roundScore"},{title:"user_score",translation:"totalScore"}],j=0;j<userScoresKeys.length;j++)if(userPbCode.data.data[userScoresKeys[j].title]&&userPbCode.data.data[userScoresKeys[j].title].length>0)for(var i=0;i<userPbCode.data.data[userScoresKeys[j].title].length;i++)switch(userPbCode.data.data[userScoresKeys[j].title][i].type){case"create_page":userScoreData[userScoresKeys[j].translation].accepts.jobReg=userPbCode.data.data[userScoresKeys[j].title][i];break;case"provide_page":userScoreData[userScoresKeys[j].translation].accepts.inviteReg=userPbCode.data.data[userScoresKeys[j].title][i];break;case"install":userScoreData[userScoresKeys[j].translation].accepts.appInstalls=userPbCode.data.data[userScoresKeys[j].title][i];break;case"removed_created_page":userScoreData[userScoresKeys[j].translation].rejects.jobReg=userPbCode.data.data[userScoresKeys[j].title][i];break;case"removed_provided_page":userScoreData[userScoresKeys[j].translation].rejects.inviteReg=userPbCode.data.data[userScoresKeys[j].title][i];break;case"removed_install":userScoreData[userScoresKeys[j].translation].rejects.appInstalls=userPbCode.data.data[userScoresKeys[j].title][i];break;case"manual_plus":userScoreData[userScoresKeys[j].translation].accepts.Manual=userPbCode.data.data[userScoresKeys[j].title][i];break;case"manual_minus":userScoreData[userScoresKeys[j].translation].rejects.Manual=userPbCode.data.data[userScoresKeys[j].title][i];break;case"page_completion":userScoreData[userScoresKeys[j].translation].accepts.pageCompletion=userPbCode.data.data[userScoresKeys[j].title][i];break;case"login_usage":userScoreData[userScoresKeys[j].translation].accepts.loginUsage=userPbCode.data.data[userScoresKeys[j].title][i];break;case"usage":userScoreData[userScoresKeys[j].translation].accepts.Usage=userPbCode.data.data[userScoresKeys[j].title][i]}userScoreData.calcUserScore(),$scope.scores=userScoreData,$scope.scores.topUsersTotal=userScoreData.getTopUsersTotal(),$scope.scores.topUsersRound=userScoreData.getTopUsersRound(),amMoment.loadPersian(),$scope.countDown=userPbCode.data.data.count_down,$scope.hiddenCounterFunction=function(){$scope.hiddenCounter=!0},$scope.updatePbCode=function(){ngProgress.start(),WebServices.getUserPbCodeCountInstaller($rootScope.IbartarUserInfo.id).then(function(result){ngProgress.complete(),$scope.score=result.data.data,notifications.showSuccess("به روز رسانی شد")},utils.MHandler[1])},$scope.copiedText=[],$scope.copyToClipboard=function(text){$scope.copiedText=[],$scope.copiedText[text]=utils.copyTextToClipboard(text)},$scope.paginationIndex=0,$scope.changePageOfTopUsers=function(value){$scope.paginationIndex=value}}),angular.module("ibartarApp").controller("userScoreDetailModalCtrl",function($scope,$rootScope,WebServices,utils){$scope.options.AfterOpenModalFunc=function(){WebServices.score.getDetailByUserId($rootScope.IbartarUserInfo.id).then(function(result){$scope.detailsSubmission=result.data.data.detail,$scope.currentPage=$scope.detailsSubmission.current_page,$scope.lastPage=$scope.detailsSubmission.last_page},utils.MHandler[1])},$scope.goToPageNum=function(pageNum){ngProgress.start(),WebServices.score.getDetailByUserId($rootScope.IbartarUserInfo.id,{page:pageNum}).then(function(result){ngProgress.complete(),$scope.detailsSubmission=result.data.data.detail,$scope.currentPage=$scope.detailsSubmission.current_page,$scope.lastPage=$scope.detailsSubmission.last_page})}}),angular.module("ibartarApp").controller("checkLogCtrl",function($scope,$rootScope,operatorGame,operatorRequests,notifications,dateFilter,operators,utils,ngProgress){function getNumber(num){return new Array(num)}function prepareMinOrHour(input){return String(input).length>1?input:"0"+input}if($rootScope.PageHeader="آمار اپراتورها",!operators.data.status)return notifications.showError("مشکلی در سرور وجود دارد"),!1;$scope.operators=operators.data.data;var operatoNameDic={};for(var key in $scope.operators)""==$scope.operators[key].name&&($scope.operators[key].name=$scope.operators[key].mobile),operatoNameDic[$scope.operators[key].id]=$scope.operators[key].name;$scope.operators.push({name:"همه",user_id:-1}),$scope.getArrOfIndexes=function(num){for(var result=[],i=0;i<=getNumber(num).length;i++)result.push(i);return result},$scope.lastKeyOfObj=function(obj){return Object.keys(obj)[Object.keys(obj).length-1]},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenEndTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenEndTimeVal=!0},$scope.OpenStartTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenStartTimeVal=!0},$scope.submitTheForm=function(){$scope.allSearched=!1,$scope.showMoreBut=!1;var FormDataToSend={};($scope.startTime||$scope.endTime)&&($scope.startTime&&(FormDataToSend.start_time=dateFilter($scope.startTime,"yyyy-MM-dd")),$scope.endTime&&(FormDataToSend.end_time=dateFilter($scope.endTime,"yyyy-MM-dd"))),"undefined"!=typeof $scope.startHour&&"undefined"!=typeof $scope.startMinute&&FormDataToSend.start_time&&(FormDataToSend.start_time+=" "+prepareMinOrHour($scope.startHour)+":"+prepareMinOrHour($scope.startMinute)+":00"),"undefined"!=typeof $scope.endHour&&"undefined"!=typeof $scope.endMinute&&FormDataToSend.end_time&&(FormDataToSend.end_time+=" "+prepareMinOrHour($scope.endHour)+":"+prepareMinOrHour($scope.endMinute)+":00"),-1!=$scope.operatorUser&&(FormDataToSend.user_id=$scope.operatorUser),$scope.operatorUser||($scope.allSearched=!0),ngProgress.start(),operatorRequests.getOperatorLog(FormDataToSend).then(function(result){$scope.tables={};for(var userKey in result.data.data.report){$scope.tables[userKey]={};var tables=new prepareDataToRender(result.data.data.report[userKey]),showingTable=tables.getTables();for(var key in showingTable){$scope.tables[userKey][key]=showingTable[key];var TableName="total"==userKey?userKey:operatoNameDic[userKey];TableName=TableName?TableName:userKey,$scope.tables[userKey][key].tableName=TableName+"_"+key}}if($scope.allSearched){var fillAnotherTable=function(){$scope.tables.total.operatorScores=operatorGame.takeTabledOfScores(),$scope.tables.total.operatorScores.tableName="امتیاز اپراتورها"};operatorGame.operatorNameDicInit(operatoNameDic),operatorGame.giveManualOperatorLog(result.data.data.report,fillAnotherTable)}ngProgress.complete()},utils.MHandler[1])};var prepareDataToRender=function(receivedData){this.tables={},this.rawData=receivedData};prepareDataToRender.prototype.getSecondLevelKeys=function(Obj){var keys=[];for(key in Obj)"object"==typeof Obj[key]&&(keys=keys.concat(Object.keys(Obj[key])));for(var i=0;i<keys.length;++i)for(var j=i+1;j<keys.length;++j)keys[i]===keys[j]&&keys.splice(j--,1);return keys},prepareDataToRender.prototype.fillTables=function(){var that=this;for(var key in this.rawData)that.tables[key]={},that.tables[key].headers=that.getSecondLevelKeys(that.rawData[key]),that.tables[key].rows=that.getTableRows(that.rawData[key]),that.tables[key].total=that.getTotals(that.tables[key])},prepareDataToRender.prototype.gettableRow=function(rowKey,headersArr,obj){var result=[];result[0]=rowKey;for(var i=0;i<headersArr.length;i++)result[i+1]=0;for(var key in obj)-1!=headersArr.indexOf(key)&&(result[headersArr.indexOf(key)+1]=obj[key]);return result},prepareDataToRender.prototype.getTableRows=function(tableOb){var rows=[],that=this,headers=that.getSecondLevelKeys(tableOb);for(var key in tableOb)rows.push(that.gettableRow(key,headers,tableOb[key]));return rows},prepareDataToRender.prototype.getTotals=function(table){var result=[];result[0]="جمع کل";for(var rowkey in table.rows)for(var i=1;i<table.rows[rowkey].length;i++)result[i]?result[i]+=parseInt(table.rows[rowkey][i]):result[i]=parseInt(table.rows[rowkey][i]);return result},prepareDataToRender.prototype.getTables=function(){return this.fillTables(),this.tables}}),angular.module("ibartarApp").controller("messagePanelCtrl",function($rootScope,$scope,$stateParams,$state,$timeout,messagesOfUser,WebServices,utils,ngProgress){function updatePreviousMessageInSideMenuForJobs(message,forUUID){for(var key in $scope.messageListOfJobs)$scope.messageListOfJobs[key].page_uuid==forUUID&&($scope.messageListOfJobs[key].body=message.substr(0,10)+"..")}function updatePreviousMessageInSideMenuForUsers(message,forUserId){for(var key in $scope.messageListOfUsers)$scope.messageListOfUsers[key].user_id==forUserId&&($scope.messageListOfUsers[key].body=message.substr(0,10)+"..")}function goToLastMessage(){$timeout(function(){var scroller=document.getElementsByClassName("MessagesContent")[0];scroller.scrollTop=scroller.scrollHeight})}$scope.messageListOfJobs=messagesOfUser.data.data;var thisUserId=$rootScope.IbartarUserInfo.id,typeOfMessagePanel="user",thisJobUUID=null;if($scope.messageContents=[],$scope.selectedUuid=null,$scope.selectedUserId=null,$rootScope.loadFooter=!1,$stateParams.title&&$stateParams.uuid){var title=$stateParams.title.split("-").join(" ");typeOfMessagePanel="user",$scope.selectedUuid=$stateParams.uuid,$scope.messageListOfJobs.unshift({ago:"هم اکنون",page_title:title,page_uuid:$stateParams.uuid}),$timeout(function(){$scope.showMassageOfMine($stateParams.uuid)})}$scope.showMassageOfMine=function(uuid){getMessageContent(uuid,thisUserId),typeOfMessagePanel="user",$scope.selectedUuid=uuid,$scope.selectedUuid=uuid},$scope.showMassageOfUser=function(userId){$scope.selectedUserId=userId,getMessageContent(thisJobUUID,userId)};var getMessageContent=function(uuid,userId){WebServices.message.showMessage(uuid,userId).then(function(result){$scope.messageContents=result.data.data,goToLastMessage()},utils.MHandler[1])};$scope.ChangeToJobConversation=function(userPage){typeOfMessagePanel="job",$scope.messageContents=[],$scope.currentPanelName=userPage.title,ngProgress.start(),WebServices.message.pageInbox(userPage.uuid).then(function(result){ngProgress.complete(),result.data.status?($scope.messageListOfJobs=[],$scope.selectedUuid=null,$scope.messageListOfUsers=result.data.data,thisJobUUID=userPage.uuid):console.error(result)},utils.MHandler[1])},$scope.ChangeToPersonConversation=function(){typeOfMessagePanel="user",$scope.messageContents=[],ngProgress.start(),$scope.currentPanelName=$rootScope.IbartarUserInfo.name,WebServices.message.personInbox().then(function(result){ngProgress.complete(),result.data.status?($scope.messageListOfUsers=[],$scope.selectedUserId=null,$scope.messageListOfJobs=result.data.data):console.error(result)},utils.MHandler[1])},$scope.sendMessage=function(){if("user"==typeOfMessagePanel&&$scope.selectedUuid)WebServices.message.personCreateMessage({body:$scope.messageText,uuid:$scope.selectedUuid}).then(function(result){result.data.status?(result.data.data.owner=!0,$scope.messageContents.messages.push(result.data.data),$scope.addingNewMessage=!0,updatePreviousMessageInSideMenuForJobs($scope.messageText,$scope.selectedUuid),$scope.messageText="",$timeout(function(){$scope.addingNewMessage=!1},1e3),goToLastMessage()):(utils.NormalNotificationForServerResponse(result.data.message,!1),console.error(result.data))},utils.MHandler[1]);else if("job"==typeOfMessagePanel&&$scope.selectedUserId&&thisJobUUID){var preparedJson={uuid:thisJobUUID,body:$scope.messageText,selective_users:[$scope.selectedUserId]};WebServices.message.pageCreateMessage(preparedJson).then(function(result){result.data.status?(result.data.data.owner=!0,$scope.messageContents.messages.push(result.data.data),$scope.addingNewMessage=!0,updatePreviousMessageInSideMenuForUsers($scope.messageText,$scope.selectedUserId),$scope.messageText="",$timeout(function(){$scope.addingNewMessage=!1},1e3),goToLastMessage()):(utils.NormalNotificationForServerResponse(result.data.message,!1),console.error(result.data))},utils.MHandler[1])}}}),angular.module("ibartarApp").controller("bugLogCtrl",function($scope,$ocLazyLoad,$rootScope,WebServices,dateFilter,ngProgress){function prepareDataForSubmitions(){var FormDataToSend={};return $scope.startTime&&(FormDataToSend.start_time=dateFilter($scope.startTime,"yyyy-MM-dd")),$scope.endTime&&(FormDataToSend.end_time=dateFilter($scope.endTime,"yyyy-MM-dd")),$scope.bugStatus&&(FormDataToSend.status=$scope.bugStatus),PreviousSearch=FormDataToSend,FormDataToSend}function sendRequestAndRenderData(FormDataToSend){ngProgress.start(),WebServices.bugServices.bugsLog($scope.pageOfSearch,FormDataToSend).then(function(result){ngProgress.complete(),PreviousSearch=FormDataToSend,$scope.NodesOnPage=result.data.data.data;for(var i=0;i<$scope.NodesOnPage.length;i++){for(var bugsReported=[],bugKey=0;bugKey<$scope.NodesOnPage[i].bug_type.length;bugKey++)bugsReported.push(translationsKey[$scope.NodesOnPage[i].bug_type[bugKey]]);$scope.NodesOnPage[i].bugsReported=bugsReported.join(" ,"),$scope.NodesOnPage[i].bugsReportedArr=bugsReported}$scope.pagesOfPagination=[];for(var i=1;i<=result.data.data.last_page;i++)$scope.pagesOfPagination.push({title:"صفحه "+i,key:i});$scope.totalOfBugsLog=result.data.data.total,$scope.lastPageOfSearch=result.data.data.last_page})}$rootScope.PageHeader="پنل آمار خطا | دانرو",$rootScope.Pagedescriptions="آمار خطاهایی که از سمت کاربران برای سیستم ارسال شده اند را در این پنل می توان مشاهده نمود",$ocLazyLoad.load($rootScope.lazyLoad.highChart);var PreviousSearch=null;$scope.lastPageOfSearch=1,$scope.pageOfSearch=1,$scope.bugStatusCollection=[{id:"fixed",name:"بررسی شده"},{id:"open",name:"معلق"},{name:"همه"}],$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenEndTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenEndTimeVal=!0},$scope.OpenStartTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenStartTimeVal=!0};var translationsKey={incorrect_media:"مدیا",inappropriate_media:"مدیا",map:"نقشه",contact_info:"اطلاعات تماس",opening_hours:"ساعت کاری",services:"خدمات",duplicate_page:"تکراری"};$scope.submitThisFormFortTables=function(){var FormDataToSend=prepareDataForSubmitions();$scope.pageOfSearch=1,$scope.DateChartConfig.series=[],sendRequestAndRenderData(FormDataToSend)},$scope.submitThisFormForChart=function(){ngProgress.start(),$scope.NodesOnPage=[];var FormDataToSend=prepareDataForSubmitions();WebServices.bugServices.dailyLog(FormDataToSend).then(function(result){ngProgress.complete(),$scope.DateChartConfig.series=[];
var dataToShowOpenMode=[],dataToShowFixMode=[];for(var ObjKey in result.data.data){var dataSplited=ObjKey.split("-");if(result.data.data[ObjKey].open){var tempObj={name:ObjKey,x:Date.UTC(parseInt(dataSplited[0]),parseInt(dataSplited[1])-1,parseInt(dataSplited[2])),y:parseInt(result.data.data[ObjKey].open)};dataToShowOpenMode.push(tempObj)}if(result.data.data[ObjKey].fixed){var tempObj={name:ObjKey,x:Date.UTC(parseInt(dataSplited[0]),parseInt(dataSplited[1])-1,parseInt(dataSplited[2])),y:parseInt(result.data.data[ObjKey].fixed)};dataToShowFixMode.push(tempObj)}}$scope.DateChartConfig.series=[{name:"معلق",data:dataToShowOpenMode},{name:"بررسی شده",data:dataToShowFixMode}]})},$scope.nextPage=function(pageNumToSearch){PreviousSearch&&($scope.pageOfSearch<$scope.lastPageOfSearch||pageNumToSearch)&&($scope.pageOfSearch++,pageNumToSearch&&($scope.pageOfSearch=pageNumToSearch),sendRequestAndRenderData(PreviousSearch))},$scope.prevPage=function(){PreviousSearch&&$scope.pageOfSearch>1&&($scope.pageOfSearch--,sendRequestAndRenderData(PreviousSearch))},$scope.DateChartConfig={options:{chart:{type:"column"},plotOptions:{column:{stacking:"normal"}}},title:{text:"امار خطاهای گزارش شده"},xAxis:{type:"datetime"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}}}),angular.module("ibartarApp").controller("pageViewLogCtrl",function($scope,dateFilter,WebServices,$ocLazyLoad,$rootScope,utils,ngProgress){$rootScope.PageHeader="پنل گزارش بازدید از صفحات",$rootScope.Pagedescriptions="میزان بازدید از صفحات را میتوانید از این پنل مشاهده نمایید",$ocLazyLoad.load($rootScope.lazyLoad.highChart),$scope.countSelection=[20,25,30,40],$scope.count=20,$scope.devices=["mobile_client","android","IOS","desktop"],$scope.devArray={};var selectedDev=[];$scope.AddRemoveDevArrayElement=function(){selectedDev=[];for(var key in $scope.devArray)$scope.devArray[key]&&selectedDev.push(key)},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenEndTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenEndTimeVal=!0},$scope.OpenStartTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenStartTimeVal=!0},$scope.submitThisForm=function(){ngProgress.start();var sendingObj={from:dateFilter($scope.startTime,"yyyy-MM-dd"),to:dateFilter($scope.endTime,"yyyy-MM-dd"),count:$scope.count,devices:selectedDev};WebServices.getViewsOfPage(null,sendingObj).then(function(result){ngProgress.complete();var arrayOfCategories=[],arrayOfTotalVisits=[],arrayOfUniqueVisits=[];result.data.data.data&&result.data.data.data.length&&result.data.data.data.forEach(function(val,index){var nameOfJob=val.title||val.uuid;arrayOfCategories.push(nameOfJob),arrayOfTotalVisits.push(val.total_visits),arrayOfUniqueVisits.push(val.unique_visits)}),$scope.totalResultCount=result.data.data.total,$scope.pageViewReporterConfig.xAxis={categories:arrayOfCategories},$scope.pageViewReporterConfig.series=[{name:"total_visits",data:arrayOfTotalVisits,stack:"total_visits"},{name:"unique_visits",data:arrayOfUniqueVisits,stack:"unique_visits"}]},utils.MHandler[1])},$scope.pageViewReporterConfig={options:{chart:{type:"column"},plotOptions:{column:{stacking:"normal"}}},title:{text:"آمار مشاهده صفحات مشتری"},yAxis:{title:{text:"مقادیر"}},credits:{enabled:!0},loading:!1,size:{}}}),angular.module("ibartarApp").controller("userCreatedPagesCtrl",function($scope,$rootScope,createdPagesArr,WebServices,utils){$scope.CreatedPages=createdPagesArr.data.data,$rootScope.loadFooter=!1,$rootScope.PageHeader="صفحات ایجاد شده | دانرو",$rootScope.Pagedescriptions="شما می توانید در این صفحه تمامی کسب و کارهایی را که خودتان در سیستم دانرو به ثبت رسانده اید را مشاهده نمایید و تا قبل از ثبت نهایی در دانرو آن را ویرایش نمایید",$scope.currentPage=parseInt($scope.CreatedPages.current_page)-1,$scope.totalPagesCount=parseInt($scope.CreatedPages.total),$scope.lastPage=parseInt($scope.CreatedPages.last_page),$scope.changePageButtonTouchUpInside=function(pageIndex){WebServices.getPageListCreatedByUser({page:pageIndex+1}).then(function(result){$scope.CreatedPages=result.data.data,$scope.currentPage=parseInt($scope.CreatedPages.current_page)-1},utils.MHandler[1])}}),angular.module("ibartarApp").controller("scoreBankCtrl",function($scope,WebServices,ngProgress,utils){$scope.users=[],$scope.avaiableScoreTypes=["create_page","provide_page","install","manual","page_completion"],$scope.scoreData=!1,$scope.submitToGetScores=function(name){$scope.users=[],ngProgress.start(),WebServices.score.getByName(name).then(function(result){return ngProgress.complete(),result.data.status?($scope.scoreData=!0,void result.data.data.forEach(function(userData){var scores={};userData.scores.forEach(function(score){var keyOfAction=score.type.replace("removed_","");keyOfAction=keyOfAction.replace("_plus",""),keyOfAction=keyOfAction.replace("_minus",""),keyOfAction=keyOfAction.replace("d_","_");var positiveOrMinus=-1==score.type.indexOf("removed_")?"positive":"negative";-1!=score.type.indexOf("manual")&&(positiveOrMinus=-1!=score.type.indexOf("plus")?"positive":"negative"),scores[keyOfAction]||(scores[keyOfAction]={}),scores[keyOfAction][positiveOrMinus]={count:score.count,score:score.score}});var totalScore=0;for(var scoreKey in scores)totalScore+=scores[scoreKey].positive?Math.abs(parseInt(scores[scoreKey].positive.score)):0,totalScore-=scores[scoreKey].negative?Math.abs(parseInt(scores[scoreKey].negative.score)):0;userData.totalScore=totalScore,userData.scores=scores,$scope.users.push(userData)})):void utils.NormalNotificationForServerResponse(result.data.message,!1)})}}),angular.module("ibartarApp").controller("scoreBankDetailsCtrl",function($scope,$stateParams,userScoreContent,WebServices,ngProgress,utils,userProfile){function updateSummeryBySummerArray(summeryArray){var scores={};summeryArray.forEach(function(score){var keyOfAction=score.type.replace("removed_","");keyOfAction=keyOfAction.replace("_plus",""),keyOfAction=keyOfAction.replace("_minus",""),keyOfAction=keyOfAction.replace("d_","_");var positiveOrMinus=-1==score.type.indexOf("removed_")?"positive":"negative";-1!=score.type.indexOf("manual")&&(positiveOrMinus=-1!=score.type.indexOf("plus")?"positive":"negative"),scores[keyOfAction]||(scores[keyOfAction]={}),scores[keyOfAction][positiveOrMinus]={count:score.count,score:score.score}}),$scope.userSummery=scores}$scope.userProfile=userProfile.data.data,$scope.avaiableScoreTypes=["create_page","provide_page","install","manual"],updateSummeryBySummerArray(userScoreContent.data.data.summery),$scope.detailsSubmission=userScoreContent.data.data.detail,$scope.currentPage=$scope.detailsSubmission.current_page,$scope.lastPage=$scope.detailsSubmission.last_page,$scope.goToPageNum=function(pageNum){ngProgress.start(),WebServices.score.getDetailByUserId($stateParams.userId,{page:pageNum}).then(function(result){ngProgress.complete(),$scope.detailsSubmission=result.data.data.detail,$scope.currentPage=$scope.detailsSubmission.current_page,$scope.lastPage=$scope.detailsSubmission.last_page,updateSummeryBySummerArray(result.data.data.summery)})},$scope.submitNewScoreByBoolSign=function(boolSign){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید "+$scope.submitScore+" امتیاز بابت "+$scope.desc+" به "+$scope.userProfile.name+(boolSign?" اضافه گردد؟":" کم شود؟ "),type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm&&(ngProgress.start(),WebServices.score.create({score:$scope.submitScore,description:$scope.desc,user_id:$stateParams.userId,score_sign:boolSign?"plus":"minus"}).then(function(result){return ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),$scope.desc="",$scope.submitScore="",void $scope.goToPageNum(1)):void utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1]))})}}),angular.module("ibartarApp").controller("mergeReqCtrl",function($scope,$stateParams,$rootScope,$q,$timeout,$state,$ocLazyLoad,uiGmapGoogleMapApi,SearchRequests,MapMarker,ngProgress,utils,WebServices){function mergeReq(arrayOfUuids){return this.defer=$q.defer(),"object"!=typeof arrayOfUuids?(this.defer.reject(),!1):(this.arrayOfUuids=arrayOfUuids,this.pagesContentsArr=[],this.pageProperties=["address","description","email","guilds","keywords","latLng","logo","media","opening_hours","products","slogan","tel_1","private_mobile","tel_2","title","website","user_id"],this.mergeResult={},this.colIndex=[],"function"!=typeof this.getPagesContent?(this.defer.reject(),!1):void this.getPagesContent())}function mergeSending(callBack){$scope.mergedForm.main_page=$scope.mergedObj.colIndex[0].uuid,$scope.mergedForm.candidate_pages=[],$scope.mergedObj.colIndex.forEach(function(tableIndex,index){0!=index&&$scope.mergedForm.candidate_pages.push(tableIndex.uuid)});for(var key in $scope.mergedObj)$scope.mergedObj[key]&&$scope.mergedObj[key].merged&&"merged"!=Object.keys($scope.mergedObj[key])[0]&&"user_id"!=key&&($scope.mergedForm[key]=$scope.mergedObj[key][Object.keys($scope.mergedObj[key])[0]]);$scope.mergedObj.opening_hours&&$scope.mergedObj.opening_hours.merged&&"merged"!=Object.keys($scope.mergedObj.opening_hours)[0]&&($scope.mergedForm.opening_hours=Object.keys($scope.mergedObj.opening_hours)[0]),$scope.mergedForm.latLng.lat||($scope.mergedForm.latLng=JSON.parse($scope.mergedForm.latLng)),$scope.mergedForm.latLng.lat||($scope.mergedForm.latLng=JSON.parse($scope.mergedForm.latLng)),$scope.mergedForm.lat=$scope.mergedForm.latLng.lat,$scope.mergedForm.lng=$scope.mergedForm.latLng.lng,$scope.mergedForm.guilds=[];for(var guildKey in $scope.mergedObj.guilds)$scope.mergedForm.guilds.push(guildKey);$scope.mergedForm.keywords=[];for(var keywordsKey in $scope.mergedObj.keywords)$scope.mergedForm.keywords.push($scope.mergedObj.keywords[keywordsKey]);["products","media"].forEach(function(property){$scope.mergedForm[property]=[],$scope.mergedObj[property].forEach(function(data){$scope.mergedForm[property].push(data.id)})}),ngProgress.start(),WebServices.mergePages($scope.mergedForm).then(function(result){return ngProgress.complete(),result.data.status?callBack&&"function"==typeof callBack?void callBack():void $state.go("editJobs",{uuid:$scope.mergedObj.colIndex[0].uuid}):void utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])}function lastCheckToMerge(callBack){swal({title:"آیا مطمئن هستید؟",text:"آیا از ادغام صفحات مطمئن هستید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!0,closeOnCancel:!0}).then(function(isConfirm){isConfirm?mergeSending(callBack):swal("لغو","شما از ادغام صرف نظر نموده اید","error")})}if("undefined"==typeof $stateParams.uuids)return!1;mergeReq.prototype.getPagesContent=function(){var that=this,counter=0;this.arrayOfUuids.forEach(function(uuid,index){SearchRequests.GetExtendEdiMode(uuid).then(function(pageRequestRespond){if(pageRequestRespond.data.data){that.pagesContentsArr[index]=pageRequestRespond.data.data;var a={uuid:pageRequestRespond.data.data.uuid,source:pageRequestRespond.data.data.source};that.colIndex[index]=a,counter==that.arrayOfUuids.length-1&&that.merge(),counter++}})})},mergeReq.prototype.prepareForMerge=function(){var tempPageContentArr=[];this.pagesContentsArr.forEach(function(page){var tempPage=page;tempPage.latLng={lat:page.lat,lng:page.lng},tempPage.media.logo&&tempPage.media.logo&&(tempPage.logo=tempPage.media.logo[0]);for(var i=0;i<tempPage.products.length;i++)tempPage.products[i].uuid=tempPage.uuid;tempPageContentArr.push(tempPage)}),this.pagesContentsArr=tempPageContentArr},mergeReq.prototype.merge=function(){var that=this,specialProperties=["title","description","address","email","latLng","logo","slogan","tel_1","tel_2","website","opening_hours","private_mobile","user_id"];this.prepareForMerge(),this.pageProperties.forEach(function(property){return-1!=specialProperties.indexOf(property)?void that.pagesContentsArr.forEach(function(page){"undefined"==typeof that.mergeResult[property]&&(that.mergeResult[property]={}),that.mergeResult[property][page.uuid]=page[property]}):void that.pagesContentsArr.forEach(function(page){"undefined"==typeof that.mergeResult[property]&&(that.mergeResult[property]=[]),that.mergeResult[property].push(page[property])})});for(var propertyKey in this.mergeResult)switch(propertyKey){case"guilds":that.mergeResult[propertyKey]=that.uniqueGuilds(that.mergeResult[propertyKey]);break;case"keywords":that.mergeResult[propertyKey]=that.uniqueKeywords(that.mergeResult[propertyKey]);break;case"media":that.mergeResult[propertyKey]=that.uniqueMedia(that.mergeResult[propertyKey]);break;case"logo":that.mergeResult[propertyKey]=that.uniqueLogo(that.mergeResult[propertyKey]);break;case"opening_hours":that.mergeResult[propertyKey]=that.uniqueOpeningHours(that.mergeResult[propertyKey]);break;case"products":that.mergeResult[propertyKey]=that.uniqueProduct(that.mergeResult[propertyKey]);break;case"latLng":that.mergeResult[propertyKey]=that.uniqueLatLng(that.mergeResult[propertyKey]);break;default:that.mergeResult[propertyKey]=that.uniqueData(that.mergeResult[propertyKey])}this.mergeResult.colIndex=this.colIndex,this.defer.resolve(that.mergeResult)},mergeReq.prototype.uniqueLogo=function(logoObjs){return Object.keys(logoObjs).forEach(function(key){logoObjs[key].id||delete logoObjs[key]}),(1==Object.keys(logoObjs).length||0==Object.keys(logoObjs).length)&&(logoObjs.merged=!0),logoObjs},mergeReq.prototype.uniqueOpeningHours=function(openingHoursObj){return Object.keys(openingHoursObj).forEach(function(key){0==Object.keys(openingHoursObj[key]).length&&delete openingHoursObj[key]}),(1==Object.keys(openingHoursObj).length||0==Object.keys(openingHoursObj).length)&&(openingHoursObj.merged=!0),openingHoursObj},mergeReq.prototype.uniqueData=function(dataObj){var that=this,arr=Object.keys(dataObj).map(function(k){return dataObj[k]});arr.forEach(function(value,index){value&&null!=value||arr.splice(index,1)});var data=this.unique(arr),mergeData={};return mergeData[that.colIndex[0].uuid]=data[0]?data[0]:null,mergeData.merged=!0,1!=data.length&&0!=data.length||null!=data[0]?1==data.length||0==data.length?mergeData:dataObj:null},mergeReq.prototype.uniqueMedia=function(mediaArray){for(var concatMedia=[],i=0;i<mediaArray.length;i++)for(var mediaKey in mediaArray[i])"logo"!=mediaKey&&(concatMedia=concatMedia.concat(mediaArray[i][mediaKey]));return this.uniqueById(concatMedia)},mergeReq.prototype.uniqueById=function(array){function compareFunc(a,b){return parseInt(a.id)-parseInt(b.id)}return this.unique(array,compareFunc)},mergeReq.prototype.uniqueProduct=function(productArray){for(var concatArray=[],i=0;i<productArray.length;i++)concatArray=concatArray.concat(productArray[i]);return this.uniqueById(concatArray)},mergeReq.prototype.uniqueLatLng=function(latLags){function compareFunc(a,b){return a.lat==b.lat&&a.lng==b.lng?0:1}var latLngArray=[];for(var key in latLags)latLngArray.push(latLags[key]);var data=this.unique(latLngArray,compareFunc),result={};return result[this.colIndex[0].uuid]=data[0],result.merged=!0,1==data.length?result:latLags},mergeReq.prototype.uniqueKeywords=function(keywordsArray){for(var result={},i=0;i<keywordsArray.length;i++)for(var key in keywordsArray[i])for(var keywordKey in keywordsArray[i][key])result[keywordKey]=keywordsArray[i][key][keywordKey];return result},mergeReq.prototype.uniqueGuilds=function(guildsArray){for(var result={},i=0;i<guildsArray.length;i++)for(var key in guildsArray[i])result[key]=guildsArray[i][key];return result},mergeReq.prototype.getResult=function(){return this.defer.promise},mergeReq.prototype.unique=function(a,compareFunc){a.sort(compareFunc),"undefined"==typeof compareFunc&&(compareFunc=function(a,b){return a==b?0:a-b});for(var i=1;i<a.length;)0===compareFunc(a[i-1],a[i])?a.splice(i,1):i++;return a},$rootScope.loadFooter=!1,$scope.isEmpty=utils.isEmpty;var mergeObj=new mergeReq($stateParams.uuids.split(","));mergeObj.getResult().then(function(result){var cellsSumWidth=1030-24*result.colIndex.length;$scope.dynamicWidthForTableCell=cellsSumWidth/result.colIndex.length,$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers(mergeObj.pagesContentsArr),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},2e3),$scope.mergedObj=result,$scope.tableColName=result.colIndex;var userIdUUIDMap={};if(result.user_id)for(var key in result.user_id)"merged"!=key&&(userIdUUIDMap[result.user_id[key]]=key,WebServices.GetProfile(result.user_id[key]).then(function(userResult){var userProfileData=userResult.data.data;$scope.mergedObj.owner||($scope.mergedObj.owner=result.user_id);var uuid=userIdUUIDMap[userProfileData.id];$scope.mergedObj.owner[uuid]={};for(var profileKey in userProfileData)$scope.mergedObj.owner[uuid][profileKey]=userProfileData[profileKey];$scope.mergedObj.owner&&($scope.mergedForm.user_id=$scope.mergedObj.owner[$scope.mergedObj.colIndex[0].uuid].id)}));$scope.simpleMergeItems=[{key:"title",name:"نام"},{key:"description",name:"توضیحات"},{key:"email",name:"ایمیل"},{key:"slogan",name:"شعار"},{key:"website",name:"وبسایت"},{key:"tel_1",name:"تلفن ۱"},{key:"tel_2",name:"تلفن ۲"},{key:"private_mobile",name:"موبایل شخصی"},{key:"address",name:"آدرس"}],$scope.simpleMergeItems.forEach(function(item){$scope.mergedObj[item.key]&&($scope.mergedForm[item.key]=$scope.mergedObj[item.key][$scope.mergedObj.colIndex[0].uuid])}),$scope.mergedObj.logo&&$scope.mergedObj.logo[$scope.mergedObj.colIndex[0].uuid]&&$scope.mergedObj.logo[$scope.mergedObj.colIndex[0].uuid].id&&($scope.mergedForm.logo_id=$scope.mergedObj.logo[$scope.mergedObj.colIndex[0].uuid].id),$scope.mergedObj.opening_hours&&($scope.mergedForm.opening_hours=$scope.mergedObj.colIndex[0].uuid),$scope.mergedObj.latLng&&($scope.mergedForm.latLng=JSON.stringify($scope.mergedObj.latLng[$scope.mergedObj.colIndex[0].uuid]))}),$scope.removeGuildsById=function(id){return Object.keys($scope.mergedObj.guilds).length<=1?!1:void delete $scope.mergedObj.guilds[id]},$scope.removeKeywordsByName=function(name){delete $scope.mergedObj.keywords[name]},$scope.removeMediaById=function(id){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید می خواهید این مدیا را حذف کنید",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.removeMedia(id).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("مدیا با موفقیت حذف شد","","success"),$scope.mergedObj.media.forEach(function(value,index){value.id==id&&$scope.mergedObj.media.splice(index,1)})):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.removeProductById=function(uuid,id){swal({title:"آیا مطمئن هستید؟",text:"آیا مطمئن هستید میخواهید این محصول را حذف کنید؟",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"بله، مطمئن!",cancelButtonText:"خیر",closeOnConfirm:!1,closeOnCancel:!0}).then(function(isConfirm){isConfirm?(ngProgress.start(),WebServices.RemoveProduct(id,uuid).then(function(result){ngProgress.complete(),result.data.status?(utils.NormalNotificationForServerResponse(result.data.message,!0),swal("محصول مورد نظر با موفقیت حذف شد","","success")):utils.NormalNotificationForServerResponse(result.data.message,!1)},utils.MHandler[1])):swal("لغو","شما از حذف این مورد صرف نظر کردید","error")})},$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},$scope.notSorted=function(obj){return obj?Object.keys(obj):[]},uiGmapGoogleMapApi.then(function(maps){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){$scope.map={control:{},center:{latitude:35.755707,longitude:51.430709},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}}},$scope.ResultMarkers=[],$scope.controlMarkers={}})}),$scope.ChangeMarker=function(uuid){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),hoveredMarker.setZIndex(1e5),MapMarker.AtachBanner(hoveredMarker))}},$scope.ResetIcon=function(uuid){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),MapMarker.CloseBanner(hoveredMarker),hoveredMarker.setZIndex(1))}},$scope.mergedForm={},$scope.mergeButtonTouchUpInside=function(){lastCheckToMerge()}}),angular.module("ibartarApp").controller("editJobsCtrl",function($stateParams,$state,$scope,$timeout,JobList,ShowPageJob,MapMarker,appConfig,uiGmapGoogleMapApi,utils,ngProgress,searchTraceService,operatorRequests,$ocLazyLoad,$rootScope,notifications){function PrepareForSave(){ngProgress.start();var FormDataToSave={title:$scope.Data.title,tel_1:$scope.Data.tel_1,tel_2:$scope.Data.tel_2,tel_3:$scope.Data.tel_3,guild:$scope.guildPages,slogan:$scope.Data.slogan,website:$scope.Data.website,mobile:$scope.Data.mobile,private_mobile:$scope.Data.private_mobile,email:$scope.Data.email,keywords:$scope.Data.keywords,description:$scope.Data.description,address:$scope.Data.address,lat:RecivedPageData.lat,lng:RecivedPageData.lng};for(key in FormDataToSave)void 0===FormDataToSave[key]&&delete FormDataToSave[key];return FormDataToSave}function PrepareForSaveWhitDelay(){ngProgress.start();var FormDataToSaveWhitDelay={title:$scope.Data.title,tel_1:$scope.Data.tel_1,tel_2:$scope.Data.tel_2,tel_3:$scope.Data.tel_3,guild:$scope.guildPages,slogan:$scope.Data.slogan,website:$scope.Data.website,mobile:$scope.Data.mobile,private_mobile:$scope.Data.private_mobile,email:$scope.Data.email,keywords:$scope.Data.keywords,description:$scope.Data.description,address:$scope.Data.address,lat:RecivedPageData.lat,lng:RecivedPageData.lng,message:"",hours:""};for(key in FormDataToSaveWhitDelay)void 0===FormDataToSaveWhitDelay[key]&&delete FormDataToSaveWhitDelay[key];return FormDataToSaveWhitDelay}if($rootScope.PageHeader="مدیریت صفحات",$scope.popTaskResult=ShowPageJob.data.data,$scope.JobPackages=JobList.data.data,$scope.guildPages=[],void 0===$scope.popTaskResult)return notifications.showError("صفحه ای با این مشخصات یافت نشد."),void $state.go("home");var RecivedPageData=$scope.popTaskResult.page;$scope.manager=RecivedPageData.manager,$scope.keywordsMainPage=RecivedPageData.keywords;var MessagesOfMainPage=$scope.popTaskResult.delay_messages,bugsReport=$scope.popTaskResult.bugs,bugsTypes={};$scope.BugMessages=[],$scope.bugsMap=!1,$scope.bugsContactInfo=!1,$scope.bugsServices=!1,$scope.bugsDuplicatePage=!1,$scope.displayDelayMessageMore=!1,$rootScope.customMessageDelay="",$scope.firstArrayOfMessages=[],$scope.secondArrayOfMessages=[];var uuidPage=RecivedPageData.uuid;$scope.Data={},$scope.Data=RecivedPageData,$scope.DataGuild=RecivedPageData.guilds,$scope.keywordsLength=Object.keys($scope.Data.keywords).length,$scope.JobGuildArr=[],$scope.similarPage=!0,$scope.noKeywords=!1,$scope.NoRepeatPages=!0,$scope.showModalForDelayPage=!1,$scope.showModalForDeletePage=!1,$scope.showModalForSave=!1,$scope.noCustomMessage=!1,$scope.showMessagesDelay=!1,$scope.showMessagesReport=!1,$scope.showFormOfMainPage=!0,$scope.noRepeatFlag=!1,$scope.hasManager=!1,$scope.showLogo=!1,$scope.FormDataToDelay={message:null,hours:720},$scope.FormDataToDelete={message:null},$scope.messagesDelay=[{name:"پاسخگو نبودن",value:"message1"},{name:"پیغام گیر",value:"message2"},{name:"مشغول بودن",value:"message3"},{name:"در دسترس نبودن ",value:"message4"},{name:"بوق خرابی ",value:"message5"},{name:"خاموش",value:"message6"},{name:"قطع",value:"message7"},{name:"مسدود",value:"message8"},{name:"عدم برقراری ارتباط",value:"message9"},{name:"هیچ کدام - افزودن گزینه جدید",value:"message10"}],$scope.hoursDelay=[{name:"1 ساعت  ",value:"1"},{name:" 2 ساعت",value:"2"},{name:"3 ساعت ",value:"3"},{name:"4 ساعت",value:"4"},{name:"5 ساعت  ",value:"5"},{name:" 6 ساعت",value:"6"},{name:"7 ساعت",value:"7"},{name:" یک روز",value:"24"},{name:"دو روز ",value:"48"},{name:"یک هفته",value:"168"},{name:"دو هفته   ",value:"336"},{name:"یک ماه",value:"720"}],$scope.messagesDelete=[{name:"کسب و کار جمع شده",value:"message1"},{name:"شماره تلفن اشتباه",value:"message2"},{name:"منزل است.",value:"message3"},{name:" روی فاکس",value:"message4"},{name:"عدم تمایل صاحب کسب و کار",value:"message5"},{name:"تکراری",value:"message6"},{name:"شماره مورد نظر موجود نمی باشد.",value:"message7"},{name:"هیچ کدام - افزودن گزینه جدید",value:"message8"}],RecivedPageData.has_manager&&($scope.hasManager=!0);var bugId;bugsReport.forEach(function(value,index){$scope.BugMessages[index]=value.message,bugsTypes[index]=value.bug_type,bugId=value.id}),$scope.BugMessages.length>0?$scope.showMessagesReport=!0:$scope.showMessagesReport=!1,angular.forEach(bugsTypes,function(value,key){value.forEach(function(bugValue,i){switch(bugValue){case"map":$scope.bugsMap=!0;break;case"contact_info":$scope.bugsContactInfo=!0;break;case"services":$scope.bugsServices=!0;break;case"duplicate_page":$scope.bugsDuplicatePage=!0}})}),MessagesOfMainPage.forEach(function(value,index){5>index?$scope.firstArrayOfMessages[index]={message:value.message,user_name:value.user_name,date:value.date.date}:($scope.displayDelayMessageMore=!0,$scope.secondArrayOfMessages[index-5]={message:value.message,user_name:value.user_name,date:value.date.date})}),MessagesOfMainPage.length>0?$scope.showMessagesDelay=!0:$scope.showMessagesDelay=!1;var similarPagesOld=[];if($scope.popTaskResult.similar_pages){var similarPages=$scope.popTaskResult.similar_pages.data;similarPages.forEach(function(page){similarPagesOld.length<5&&similarPagesOld.push(page)}),similarPages.forEach(function(page){if($scope.Data.uuid===page.uuid){var index=similarPages.indexOf(page);similarPages.splice(index,1)}}),$scope.sameResults=similarPages}else{$scope.NoRepeatPages=!1;var similarPages="";$scope.similarPage=!1,$scope.noRepeatFlag=!0,$scope.sameResults=RecivedPageData}angular.forEach($scope.Data.guilds,function(value,key){$scope.guildPages.push(key)}),0===$scope.keywordsLength&&($scope.noKeywords=!0),$scope.removeKeywordsByName=function(parent,child,idKeyword){delete $scope.keywordsMainPage[parent][child],operatorRequests.editJobs.DeleteKeywordsMainPage(uuidPage,idKeyword).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("کلمه کلیدی مورد نظر  حذف شد.")):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])},$scope.Data.logo.Small&&$scope.Data.logo.Small.indexOf("/media/")>-1?$scope.showLogo=!0:$scope.showLogo=!1,$scope.removeLogo=function(logo){delete $scope.Data[logo],$scope.showLogo=!1,operatorRequests.editJobs.DeleteLogoMainPage(uuidPage).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("لوگوی صفحه با موفقیت حذف شد.")):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])},$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers(similarPages),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},4e3),uiGmapGoogleMapApi.then(function(maps){$ocLazyLoad.load($rootScope.lazyLoad.infoBox).then(function(){$scope.map={control:{},center:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},zoom:15,options:{disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}},events:{}},$scope.windowOptions={visible:!0},$scope.ResultMarkers=[],$scope.controlMarkers={},$scope.mainPage={idKey:"mainPage",Coords:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!1,animation:google.maps.Animation.DROP}}})}),$scope.ChangeMarker=function(uuid){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),hoveredMarker.setZIndex(1e5),MapMarker.AtachBanner(hoveredMarker))}},$scope.ResetIcon=function(uuid,status){if("undefined"!=typeof google&&$scope.controlMarkers&&$scope.controlMarkers.getGMarkers&&utils.isEmpty($scope.controlMarkers.getGMarkers)){var hoveredMarker,CoMarkers=$scope.controlMarkers.getGMarkers();for(var markerKey in CoMarkers)if(CoMarkers[markerKey].key==uuid){hoveredMarker=CoMarkers[markerKey];break}hoveredMarker&&(MapMarker.openInfoWindow(hoveredMarker),MapMarker.CloseBanner(hoveredMarker),hoveredMarker.setZIndex(1))}},$scope.EditMapPanel={title:"ویرایش نقشه",OpenModalClass:"EditMapBut",width:950,passdata:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng,address:RecivedPageData.address,changeLocation:function(submitMapLat,submitMapLng){RecivedPageData.lat=submitMapLat,RecivedPageData.lng=submitMapLng,$scope.map.center={latitude:submitMapLat,longitude:submitMapLng},$scope.mainPage.Coords={latitude:submitMapLat,longitude:submitMapLng}}},template:appConfig.BaseTheme+"/views/EditJobs/editMapJob.html"},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},zoom:15,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!1},events:{}},$scope.windowOptions={visible:!0},$scope.mainPage={Coords:{latitude:RecivedPageData.lat,longitude:RecivedPageData.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!1,animation:google.maps.Animation.DROP}}}),$scope.noRepeat=function(){if($scope.noRepeatFlag){var FormDataToSaveFinal=PrepareForSave(),FormDataToSave=new FormData;if(FormDataToSave.append("title",FormDataToSaveFinal.title),null!==FormDataToSaveFinal.tel_1&&FormDataToSave.append("tel_1",FormDataToSaveFinal.tel_1),null!==FormDataToSaveFinal.tel_2&&FormDataToSave.append("tel_2",FormDataToSaveFinal.tel_2),null!==FormDataToSaveFinal.tel_3&&FormDataToSave.append("tel_3",FormDataToSaveFinal.tel_3),null!==FormDataToSaveFinal.guild)for(var i in FormDataToSaveFinal.guild)FormDataToSave.append("guild[]",FormDataToSaveFinal.guild[i]);null!==FormDataToSaveFinal.slogan&&FormDataToSave.append("slogan",FormDataToSaveFinal.slogan),null!==FormDataToSaveFinal.website&&FormDataToSave.append("website",FormDataToSaveFinal.website),null!==FormDataToSaveFinal.mobile&&FormDataToSave.append("mobile",FormDataToSaveFinal.mobile),null!==FormDataToSaveFinal.private_mobile&&FormDataToSave.append("private_mobile",FormDataToSaveFinal.private_mobile),null!==FormDataToSaveFinal.description&&FormDataToSave.append("description",FormDataToSaveFinal.description),null!==FormDataToSaveFinal.address&&FormDataToSave.append("address",FormDataToSaveFinal.address),null!==FormDataToSaveFinal.lat&&void 0!==FormDataToSaveFinal.lat&&FormDataToSave.append("lat",FormDataToSaveFinal.lat),
null!==FormDataToSaveFinal.lng&&void 0!==FormDataToSaveFinal.lng&&FormDataToSave.append("lng",FormDataToSaveFinal.lng),$scope.noRepeatFlag=!1,operatorRequests.editJobs.savePageNext(uuidPage,FormDataToSave).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("تغییرات شما با موفقیت نهایی و ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])}else $scope.similarPage=!1,$scope.NoRepeatPages=!1,$scope.noRepeatFlag=!0},$scope.SaveDataForm=function(event){var FormDataToSaveFinal=PrepareForSave(),FormDataToSave=new FormData;if(FormDataToSave.append("title",FormDataToSaveFinal.title),null!==FormDataToSaveFinal.tel_1&&FormDataToSave.append("tel_1",FormDataToSaveFinal.tel_1),null!==FormDataToSaveFinal.tel_2&&FormDataToSave.append("tel_2",FormDataToSaveFinal.tel_2),null!==FormDataToSaveFinal.tel_3&&FormDataToSave.append("tel_3",FormDataToSaveFinal.tel_3),null!==FormDataToSaveFinal.guild)for(var i in FormDataToSaveFinal.guild)FormDataToSave.append("guild[]",FormDataToSaveFinal.guild[i]);null!==FormDataToSaveFinal.slogan&&FormDataToSave.append("slogan",FormDataToSaveFinal.slogan),null!==FormDataToSaveFinal.website&&FormDataToSave.append("website",FormDataToSaveFinal.website),null!==FormDataToSaveFinal.mobile&&FormDataToSave.append("mobile",FormDataToSaveFinal.mobile),null!==FormDataToSaveFinal.private_mobile&&FormDataToSave.append("private_mobile",FormDataToSaveFinal.private_mobile),null!==FormDataToSaveFinal.description&&FormDataToSave.append("description",FormDataToSaveFinal.description),null!==FormDataToSaveFinal.address&&FormDataToSave.append("address",FormDataToSaveFinal.address),null!==FormDataToSaveFinal.lat&&void 0!==FormDataToSaveFinal.lat&&FormDataToSave.append("lat",FormDataToSaveFinal.lat),null!==FormDataToSaveFinal.lng&&void 0!==FormDataToSaveFinal.lng&&FormDataToSave.append("lng",FormDataToSaveFinal.lng),1==$scope.correctPage?operatorRequests.editJobs.UpdatePageJob(bugId,event.currentTarget.id,FormDataToSave).then(function(result){function PrepareForSimilarPages(){var FormDataToSimilarPages={location:$scope.Data.lat+","+$scope.Data.lng,q:FormDataToSaveFinal.title,tel:FormDataToSaveFinal.tel_1};return FormDataToSimilarPages}if(result.data.status){ngProgress.start(),notifications.showSuccess("تغییرات شما با موفقیت ذخیره شد.");var similarPagesNew=[],similarPageLast=[],FormDataToSimilarPages=PrepareForSimilarPages();operatorRequests.editJobs.similarPages(FormDataToSimilarPages).then(function(result){if(result.data.data){ngProgress.complete();var similarPages=result.data.data;similarPages.forEach(function(page){similarPagesNew.length<5&&similarPagesNew.push(page)}),similarPagesOld.forEach(function(pageOld){similarPagesNew.forEach(function(pageNew){if(pageNew.uuid===pageOld.uuid){var index=similarPagesNew.indexOf(pageNew);similarPagesNew.splice(index,1)}})}),similarPagesNew.forEach(function(pageNew){if($scope.Data.uuid===pageNew.uuid){var index=similarPagesNew.indexOf(pageNew);similarPagesNew.splice(index,1)}}),similarPageLast=similarPagesNew,$scope.sameResults=similarPageLast,$scope.sameResults.length>0?($timeout(function(){MapMarker.reset(),MapMarker.AddMarkers($scope.sameResults),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},4e3),$scope.similarPage=!0,$("html, body").animate({scrollTop:0},"fast"),$scope.showFormOfMainPage=!1):($scope.similarPage=!1,$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers($scope.sameResults),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},3e3),operatorRequests.editJobs.savePageNext(uuidPage,FormDataToSave).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("تغییرات شما با موفقیت نهایی و ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]))}else{var similarPages="";$scope.similarPage=!1,$scope.sameResults="",operatorRequests.editJobs.savePageNext(uuidPage,FormDataToSave).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("تغییرات شما با موفقیت نهایی و ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])}},utils.MHandler[1])}else utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد")},utils.MHandler[1]):operatorRequests.editJobs.UpdatePageJobFinal(uuidPage,FormDataToSave).then(function(result){function PrepareForSimilarPages(){var FormDataToSimilarPages={location:$scope.Data.lat+","+$scope.Data.lng,q:FormDataToSaveFinal.title,tel:FormDataToSaveFinal.tel_1};return FormDataToSimilarPages}if(result.data.status){ngProgress.start(),notifications.showSuccess("تغییرات شما با موفقیت ذخیره شد.");var similarPagesNew=[],similarPageLast=[],FormDataToSimilarPages=PrepareForSimilarPages();operatorRequests.editJobs.similarPages(FormDataToSimilarPages).then(function(result){if(result.data.data){ngProgress.complete();var similarPages=result.data.data;similarPages.forEach(function(page){similarPagesNew.length<5&&similarPagesNew.push(page)}),similarPagesOld.forEach(function(pageOld){similarPagesNew.forEach(function(pageNew){if(pageNew.uuid===pageOld.uuid){var index=similarPagesNew.indexOf(pageNew);similarPagesNew.splice(index,1)}})}),similarPagesNew.forEach(function(pageNew){if($scope.Data.uuid===pageNew.uuid){var index=similarPagesNew.indexOf(pageNew);similarPagesNew.splice(index,1)}}),similarPageLast=similarPagesNew,$scope.sameResults=similarPageLast,$scope.sameResults.length>0?($timeout(function(){MapMarker.reset(),MapMarker.AddMarkers($scope.sameResults),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},4e3),$scope.similarPage=!0,$("html, body").animate({scrollTop:0},"fast"),$scope.showFormOfMainPage=!1):($scope.similarPage=!1,$timeout(function(){MapMarker.reset(),MapMarker.AddMarkers($scope.sameResults),$scope.ResultMarkers=MapMarker.GetParam().Markers,$scope.Markerevents=MapMarker.GetParam().Events,$scope.$apply()},3e3),operatorRequests.editJobs.savePageNext(uuidPage,FormDataToSave).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("تغییرات شما با موفقیت نهایی و ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]))}else{var similarPages="";$scope.similarPage=!1,$scope.sameResults="",operatorRequests.editJobs.savePageNext(uuidPage,FormDataToSave).then(function(result){result.data.status?(ngProgress.complete(),notifications.showSuccess("تغییرات شما با موفقیت نهایی و ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1])}},utils.MHandler[1])}else utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد")},utils.MHandler[1])},$scope.changeValueDelay=function(){"message10"===$scope.FormDataToDelay.message.value?$scope.noCustomMessage=!0:$scope.noCustomMessage=!1},$scope.delayPageJob=function(){ngProgress.start();var FormDataToDelaySaving=PrepareForSaveWhitDelay(),FormDataToDelay=new FormData;if(FormDataToDelay.append("title",FormDataToDelaySaving.title),null!==FormDataToDelaySaving.tel_1&&FormDataToDelay.append("tel_1",FormDataToDelaySaving.tel_1),null!==FormDataToDelaySaving.tel_2&&FormDataToDelay.append("tel_2",FormDataToDelaySaving.tel_2),null!==FormDataToDelaySaving.tel_3&&FormDataToDelay.append("tel_3",FormDataToDelaySaving.tel_3),null!==FormDataToDelaySaving.guild)for(var i in FormDataToDelaySaving.guild)FormDataToDelay.append("guild[]",FormDataToDelaySaving.guild[i]);null!==FormDataToDelaySaving.slogan&&FormDataToDelay.append("slogan",FormDataToDelaySaving.slogan),null!==FormDataToDelaySaving.website&&FormDataToDelay.append("website",FormDataToDelaySaving.website),null!==FormDataToDelaySaving.mobile&&FormDataToDelay.append("mobile",FormDataToDelaySaving.mobile),null!==FormDataToDelaySaving.private_mobile&&FormDataToDelay.append("private_mobile",FormDataToDelaySaving.private_mobile),null!==FormDataToDelaySaving.description&&FormDataToDelay.append("description",FormDataToDelaySaving.description),null!==FormDataToDelaySaving.address&&FormDataToDelay.append("address",FormDataToDelaySaving.address),null!==FormDataToDelaySaving.lat&&void 0!==FormDataToDelaySaving.lat&&FormDataToDelay.append("lat",FormDataToDelaySaving.lat),null!==FormDataToDelaySaving.lng&&void 0!==FormDataToDelaySaving.lng&&FormDataToDelay.append("lng",FormDataToDelaySaving.lng),$scope.noCustomMessage?(FormDataToDelay.append("message",$rootScope.customMessageDelay),FormDataToDelay.append("hours",$scope.FormDataToDelay.hours.value)):(FormDataToDelay.append("message",$scope.FormDataToDelay.message.name),FormDataToDelay.append("hours",$scope.FormDataToDelay.hours.value)),operatorRequests.editJobs.DelayPageJob(uuidPage,FormDataToDelay).then(function(result){result.data.status?(notifications.showSuccess("پیام تعویق شما با موفقیت ذخیره شد."),$state.go($state.current,{},{reload:!0,inherit:!1})):notifications.showError("مشکلی در سرور وجود دارد")})},$scope.changeValueDelete=function(){"message8"===$scope.FormDataToDelete.message.value?$scope.noCustomMessage=!0:$scope.noCustomMessage=!1},$scope.deletePageJob=function(event){if($scope.noCustomMessage)var message=$rootScope.customMessageDelete;else var message=$scope.FormDataToDelete.message.name;var status;status="save"==event.currentTarget.id?"accept":"reject",1==$scope.correctPage?operatorRequests.editJobs.DeletePageJob(bugId,status,message).then(function(result){result.data.status?(notifications.showSuccess("صفحه موردنظر شما با موفقیت حذف شد"),$state.go($state.current,{},{reload:!0,inherit:!1})):notifications.showError("مشکلی در سرور وجود دارد")}):operatorRequests.editJobs.DeletePageJobFinal(uuidPage,message).then(function(result){result.data.status?(notifications.showSuccess("صفحه موردنظر شما با موفقیت حذف شد"),$state.go($state.current,{},{reload:!0,inherit:!1})):notifications.showError("مشکلی در سرور وجود دارد")})},$scope.toggleModalDelayPage=function(){$scope.showModalForDelayPage=!$scope.showModalForDelayPage},$scope.toggleModalDeletePage=function(){$scope.showModalForDeletePage=!$scope.showModalForDeletePage},$scope.correctPage=!1,"/operators/page-correct"==$state.current.url&&($scope.correctPage=!0,$scope.toggleShowModalForSave=function(){$scope.showModalForSave=!$scope.showModalForSave}),$scope.selection=[],$scope.toggleSelection=function(uuid){var idx=$scope.selection.indexOf(uuid);return idx>-1?void $scope.selection.splice(idx,1):void $scope.selection.push(uuid)},$scope.sendForMerge=function(){var mergePages=[];$scope.Data.uuid&&mergePages.push($scope.Data),$scope.sameResults.forEach(function(page){-1!=$scope.selection.indexOf(page.uuid)&&mergePages.push(page)}),mergePages.sort(function(a,b){var first=new Date(a.created_at),second=new Date(b.created_at);return first.getTime()-second.getTime()});var uuidsForMerge=[];mergePages.forEach(function(value,index){uuidsForMerge[index]=value.uuid}),$state.go("mergeReq",{uuids:uuidsForMerge.join(",")})}}),angular.module("ibartarApp").controller("MapEditCtrlJobs",function($scope,$state,$stateParams,$rootScope,appConfig,uiGmapGoogleMapApi){$scope.options.AfterOpenModalFunc=function(){$scope.map||setTimeout(function(){uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:$scope.options.passdata.latitude,longitude:$scope.options.passdata.longitude},zoom:15,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.LEFT_CENTER}},events:{click:function(map,eventName,args){var e=args[0],lat=e.latLng.lat(),lng=e.latLng.lng();$scope.mainPage.Coords={latitude:lat,longitude:lng},$scope.$apply()}}},$scope.windowOptions={visible:!0}}),$scope.mainPage={Coords:{latitude:$scope.options.passdata.latitude,longitude:$scope.options.passdata.longitude},icon:appConfig.BaseThemeNew+"/img/imgHome/pindrop.png",control:{},options:{draggable:!0}}},0)};var events={places_changed:function(searchBox){var ThisJobMap=$scope.map.control.getGMap(),places=searchBox.getPlaces();if(0!=places.length){for(var place,bounds=new google.maps.LatLngBounds,i=0;place=places[i];i++)bounds.extend(place.geometry.location);ThisJobMap.fitBounds(bounds),ThisJobMap.setOptions({zoom:15})}}};$scope.searchbox={template:"searchbox.tpl.html",events:events},$scope.SubmitMap=function(){$scope.options.passdata.changeLocation($scope.mainPage.Coords.latitude,$scope.mainPage.Coords.longitude,!1)}}).animation(".showMessageDelayMainPageTotal",function(){var NG_HIDE_CLASS="ng-hide";return{beforeAddClass:function(element,className,done){className===NG_HIDE_CLASS&&element.slideUp(done)},removeClass:function(element,className,done){className===NG_HIDE_CLASS&&element.hide().slideDown(done)}}}).animation(".showMessageReportMainPageTotal",function(){var NG_HIDE_CLASS="ng-hide";return{beforeAddClass:function(element,className,done){className===NG_HIDE_CLASS&&element.slideUp(done)},removeClass:function(element,className,done){className===NG_HIDE_CLASS&&element.hide().slideDown(done)}}}),angular.module("ibartarApp").controller("firstSpecialCtrl",function($scope,$rootScope,$ocLazyLoad,$state,roundProgressService,$timeout,$stateParams,$log,$location,appConfig,uiGmapGoogleMapApi,utils,$interval,$window,MetaService,WebServices,Analytics,ngProgress,notifications,SearchRequests,channelService,$http,searchTraceService){function PrepareForRate(){ngProgress.start();var PrepareForRateObj={popular:$scope.popular,reliable:$scope.reliable,credible:$scope.credible};return PrepareForRateObj}if($(window).on("beforeunload",function(){$(window).scrollTop(0)}),$window.scrollTo(0,0),$(".contactInformationContainer .branchesContainer").niceScroll({cursorcolor:"#8329cc",cursorwidth:"6px",mousescrollstep:80,scrollspeed:120,smoothscroll:!0,cursordragspeed:1.2,background:"#f9f9f9"}),$scope.firstSpecialPage=$rootScope.ShowData.data.data,$scope.ShowComments=$rootScope.ShowComments.data.data,$scope.lazyLoadPrettyPhoto=$rootScope.lazyLoad.prettyPhoto,$rootScope.PageHeader=$scope.firstSpecialPage.title,$rootScope.OgTitle=$scope.firstSpecialPage.title,$rootScope.OgImage=$scope.firstSpecialPage.logo.Small,$rootScope.OgDescription="دانرو - "+$scope.firstSpecialPage.title+" واقع در "+$scope.firstSpecialPage.address+"  "+$scope.firstSpecialPage.tel_1,$rootScope.Pagedescriptions=$scope.firstSpecialPage.title+" واقع در "+$scope.firstSpecialPage.address+"  "+$scope.firstSpecialPage.tel_1,$rootScope.canonical=$scope.firstSpecialPage.canonicalLink,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage,$rootScope.canonical),$scope.templateData=$scope.firstSpecialPage.template,$scope.slider=$scope.templateData.header.slider,$scope.products=$scope.firstSpecialPage.products,$scope.branches=$scope.templateData.contact,$scope.videoFile=$scope.templateData.video.path+"/High.mp4",$scope.videoThumbnail=$scope.templateData.video.path+"/Thumbnail.png",$scope.likeImage="/img/images/heart-Final.svg",$scope.likedImage="/img/images/isLiked.svg",$scope.replyImage="/img/images/specialpageReply.svg",$scope.favorite=$scope.firstSpecialPage.liked_by_user,$scope.modalPropertiesAddComment={title:null,content:null,image:null},$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},$scope.lat_lon=[],$scope.latArray=[],$scope.lonArray=[],$scope.latSum=[],$scope.lonSum=[],angular.forEach($scope.templateData.contact,function(index,i){$scope.lat_lon.push(index.lat_lon.split(","));var item=$scope.lat_lon[i];$scope.latArray[i]=item[0],$scope.lonArray[i]=item[1],$scope.latSum.push(Number($scope.latArray[i])),$scope.lonSum.push(Number($scope.lonArray[i]))}),$scope.latSum.length>0)var latSum=$scope.latSum.reduce(function(a,b){return a+b});if($scope.lonSum.length>0)var lonSum=$scope.lonSum.reduce(function(a,b){return a+b});if(uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:latSum/$scope.templateData.contact.length,longitude:lonSum/$scope.templateData.contact.length},zoom:8,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!0,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1},events:{}},$scope.windowOptions={visible:!0},$scope.User={Coords1:{latitude:$scope.latArray[0],longitude:$scope.lonArray[0]},Coords2:{latitude:$scope.latArray[1],longitude:$scope.lonArray[1]},Coords3:{latitude:$scope.latArray[2],longitude:$scope.lonArray[2]},Coords4:{latitude:$scope.latArray[3],longitude:$scope.lonArray[3]},Coords5:{latitude:$scope.latArray[4],longitude:$scope.lonArray[4]},Coords6:{latitude:$scope.latArray[5],longitude:$scope.lonArray[5]},Coords7:{latitude:$scope.latArray[6],longitude:$scope.lonArray[6]},Coords8:{latitude:$scope.latArray[7],longitude:$scope.lonArray[7]},Coords9:{latitude:$scope.latArray[8],longitude:$scope.lonArray[8]},Coords10:{latitude:$scope.latArray[9],longitude:$scope.lonArray[9]},Coords11:{latitude:$scope.latArray[10],longitude:$scope.lonArray[10]},Coords12:{latitude:$scope.latArray[11],longitude:$scope.lonArray[11]},Coords13:{latitude:$scope.latArray[12],longitude:$scope.lonArray[12]},Coords14:{latitude:$scope.latArray[13],longitude:$scope.lonArray[13]},Coords15:{latitude:$scope.latArray[14],longitude:$scope.lonArray[14]},Coords16:{latitude:$scope.latArray[15],longitude:$scope.lonArray[15]},icon:appConfig.BaseThemeNew+"/img/imgHome/pinDropMap.png",control:{},options:{draggable:!1,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,animation:google.maps.Animation.DROP}}}),$scope.addRate=!0,$scope.addComment=!1,$scope.openModal=!1,$scope.addRateModal=!1,$scope.editRateModal=!1,$scope.doneRateModal=!1,$scope.addCommentModal=!1,$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!1,$scope.defaultRateReliable=!1,$scope.defaultRateCredible=!1,$scope.rate=$rootScope.CheckShowRate.data,$scope.rateData=$scope.rate.data,$scope.replyOpen=!1,$scope.popular=null,$scope.reliable=null,$scope.credible=null,$scope.rate.status&&null!==$scope.rate.data&&($scope.addRate=!1,$scope.addComment=!0),null!==$scope.firstSpecialPage.rates&&($scope.totalRates=$scope.firstSpecialPage.rates.count),null!==$scope.firstSpecialPage.rates&&($scope.fivestarRate=(($scope.firstSpecialPage.rates.credibility+$scope.firstSpecialPage.rates.popularity+$scope.firstSpecialPage.rates.reliability)/3*100).toFixed(0)/10),$scope.firstSpecialPage.rates&&$scope.firstSpecialPage.rates.popularity&&($scope.popularity=Math.round(100*$scope.firstSpecialPage.rates.popularity)),$scope.firstSpecialPage.rates&&$scope.firstSpecialPage.rates.reliability&&($scope.reliability=Math.round(100*$scope.firstSpecialPage.rates.reliability)),$scope.firstSpecialPage.rates&&$scope.firstSpecialPage.rates.credibility&&($scope.credibility=Math.round(100*$scope.firstSpecialPage.rates.credibility)),$timeout(function(){var c=document.getElementById("canvas"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=17,thirdRadius=25;ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),$scope.firstSpecialPage.rates&&(1==$scope.firstSpecialPage.rates.credibility&&($scope.firstSpecialPage.rates.credibility=0),1==$scope.firstSpecialPage.rates.popularity&&($scope.firstSpecialPage.rates.popularity=0),1==$scope.firstSpecialPage.rates.reliability&&($scope.firstSpecialPage.rates.reliability=0),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-$scope.firstSpecialPage.rates.credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=5,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-$scope.firstSpecialPage.rates.reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-$scope.firstSpecialPage.rates.popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#be49cc",ctx.stroke())},0),$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.firstSpecialPage),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.popularUpRate=function(){$scope.popular="1",$scope.defaultRatePopularUp=!0,$scope.defaultRatePopularDown=!1},$scope.popularDownRate=function(){$scope.popular="0",$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!0},$scope.reliableUpRate=function(){$scope.reliable="1",$scope.defaultRateReliableUp=!0,$scope.defaultRateReliableDown=!1},$scope.reliableDownRate=function(){$scope.reliable="0",$scope.defaultRateReliableUp=!1,$scope.defaultRateReliableDown=!0},$scope.credibleUpRate=function(){$scope.credible="1",$scope.defaultRateCredibleUp=!0,$scope.defaultRateCredibleDown=!1},$scope.credibleDownRate=function(){$scope.credible="0",$scope.defaultRateCredibleUp=!1,$scope.defaultRateCredibleDown=!0},$scope.showAddMyComment=function(){$scope.addCommentModal=!$scope.addCommentModal,$scope.doneRateModal=!$scope.doneRateModal},$scope.showAddMyCommentModal=function(){$scope.openModal=!$scope.openModal,$scope.addCommentModal=!0},$scope.addMyComment=function(){if($scope.dontComment=!0,null!==$scope.modalPropertiesAddComment.title&&($scope.dontComment=!1),null!==$scope.modalPropertiesAddComment.content&&($scope.dontComment=!1),$scope.dontComment)$scope.openModal=!1,$scope.addCommentModal=!1,notifications.showError(" برای دیدگاه خود عنوان و متن قرار دهید!"),$timeout(function(){$scope.openModal=!0,$scope.addCommentModal=!0},500);else{var FormDataToAddComment=new FormData;if(FormDataToAddComment.append("title",$scope.modalPropertiesAddComment.title),FormDataToAddComment.append("content",$scope.modalPropertiesAddComment.content),$scope.fileReadyToUpload){var imageHandPicked=$scope.fileReadyToUpload;FormDataToAddComment.append("image",imageHandPicked)}WebServices.addComment($scope.firstSpecialPage.uuid,FormDataToAddComment).then(function(result){result.data.status?(ngProgress.complete(),$scope.addCommentModal=!$scope.addCommentModal,$window.location.reload(),notifications.showSuccess("دیدگاه شما با موفقیت ثبت گردید.")):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"),$state.go($state.current,$stateParams,{reload:!0,inherit:!1}))},utils.MHandler[1])}},$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.prepareToUpload=function(data){$scope.uploadImgComment=!0,$scope.theImageComment=!0,$scope.commentImg=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.deleteImgComment=function(data){$scope.uploadImgComment=!1,$scope.theImageComment=!1,$scope.commentImg="",$scope.imgEditorConfig.image=data,$scope.fileToUpload=!1,$scope.fileReadyToUpload=""},$scope.addRatePage=function(pageModal){ngProgress.start(),$scope.modalRatePage=angular.copy(pageModal);var FormDataToRate=PrepareForRate(),FormDataToRateModal=new FormData;FormDataToRateModal.append("popular",FormDataToRate.popular),FormDataToRateModal.append("reliable",FormDataToRate.reliable),FormDataToRateModal.append("credible",FormDataToRate.credible),WebServices.addRatePage($scope.firstSpecialPage.uuid,FormDataToRateModal).then(function(result){result.data.status?(ngProgress.complete(),$scope.addRateModal=!$scope.addRateModal,$scope.doneRateModal=!$scope.doneRateModal,$timeout(function(){var c=document.getElementById("canvas-modal"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=13,secondRadius=22,thirdRadius=28;if($scope.modalRatePage.rates)var count=parseInt($scope.modalRatePage.rates.count),pagePopularity=$scope.modalRatePage.rates.popularity,pageReliability=$scope.modalRatePage.rates.reliability,pageCredibility=$scope.modalRatePage.rates.credibility;else var count=0,pagePopularity=0,pageReliability=0,pageCredibility=0;$scope.rate.data?(countRate=count,oldRatePopular=$scope.rate.data.popular,oldRateCredible=$scope.rate.data.credible,oldRateReliable=$scope.rate.data.reliable):(countRate=count+1,oldRatePopular="0",oldRateCredible="0",oldRateReliable="0");var popularity=pagePopularity+(FormDataToRate.popular-oldRatePopular)/countRate,reliability=pageReliability+(FormDataToRate.reliable-oldRateReliable)/countRate,credibility=pageCredibility+(FormDataToRate.credible-oldRateCredible)/countRate,modalRate={popularity:popularity,reliability:reliability,credibility:credibility};$scope.pageModal.rates=modalRate,ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#be49cc",ctx.stroke()},0)):notifications.showError("پر کردن هر سه فیلد اجباری است!")},utils.MHandler[1])},$scope.editRate=function(){$scope.pageModal=angular.copy($scope.firstSpecialPage),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.editRateModal=!$scope.editRateModal,$scope.addCommentModal=!$scope.addCommentModal},$scope.likeFunc=function(comment){$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.firstSpecialPage.uuid+"/comments/"+comment.id+"/commentAction",data:{action:"like"}}).then(function(response){response.data.UserLikeDislikeStatus?comment.UserLikeDislikeStatus="like":comment.UserLikeDislikeStatus=null,comment.likeCount=response.data.likeCount},function(response){notifications.showError(response.message.info[0]),ngProgress.complete(),notifications.showError(response.statusText)}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.addToWishList=function(){$rootScope.IbartarUserInfo?WebServices.addToFavorite($scope.firstSpecialPage.uuid).then(function(result){result.data.status&&($scope.favorite=!$scope.favorite,utils.NormalNotificationForServerResponse(result.data.message,!0))},utils.MHandler[1]):notifications.showError("لطفا ابتدا وارد سیستم شوید")},$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.firstSpecialPage),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.daysSchedule=$scope.firstSpecialPage.opening_hours,$scope.times=[],$scope.shifTiemes=[],$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},angular.forEach($scope.daysSchedule,function(ObjDay,i){$scope.times.push([ObjDay[0],ObjDay[1]])}),$("#back-to-top").length){var scrollTrigger=100,backToTop=function(){var scrollTop=$(window).scrollTop();scrollTop>scrollTrigger?$("#back-to-top").addClass("show"):$("#back-to-top").removeClass("show")};backToTop(),$(window).on("scroll",function(){backToTop()}),$("#back-to-top").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},700)})}$scope.replyCommentModal=!1,$scope.openModalReply=!1;var commentId,commentLinks,indexComment;$scope.commentReply=function(comment){commentId=comment.id,indexComment=$scope.ShowComments.comments.indexOf(comment),commentLinks=comment._links.allReplies,$scope.comment=comment,comment.reply.total>3&&$http({method:"GET",url:commentLinks}).then(function(response){$scope.comment.reply.items=response.data.items},function(response){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور وجود دارد.")}),$scope.openModalReply=!0,$scope.replyCommentModal=!0},$scope.addReplyComment=function(replyCommentText){$scope.replyContent=replyCommentText,$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.firstSpecialPage.uuid+"/comments/"+commentId+"/replyComment",data:{replyContent:$scope.replyContent}}).then(function(response){ngProgress.complete(),$window.location.reload(),notifications.showSuccess("جواب شما ثبت شد.")},function(response){422==response.status?notifications.showError(response.data.error):(ngProgress.complete(),notifications.showError(response.statusText))}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.reportCommentFunc=function(comment){$rootScope.IbartarUserInfo?WebServices.reportComment($scope.firstSpecialPage.uuid,comment.id).then(function(result){result.data.status?(ngProgress.complete(),comment.UserLikeDislikeStatus="reports",notifications.showSuccess(result.data.message.info)):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))}}),angular.module("ibartarApp").controller("secondSpecialCtrl",function($scope,appConfig,$rootScope,$ocLazyLoad,$window,MetaService,WebServices,uiGmapGoogleMapApi,$timeout,$http,$state,$stateParams,$location,utils,$interval,Analytics,ngProgress,notifications){function PrepareForRate(){ngProgress.start();var PrepareForRateObj={popular:$scope.popular,reliable:$scope.reliable,credible:$scope.credible};return PrepareForRateObj}if($(window).on("beforeunload",function(){$(window).scrollTop(0)}),$window.scrollTo(0,0),$scope.pageData=$rootScope.ShowData.data.data,$scope.ShowComments=$rootScope.ShowComments.data.data,$scope.templateData=$rootScope.ShowData.data.data.template,$rootScope.PageHeader=$scope.pageData.title,$rootScope.OgTitle=$scope.pageData.title,$rootScope.OgImage=$scope.pageData.logo.Small,$scope.lazyLoadPrettyPhoto=$rootScope.lazyLoad.prettyPhoto,$rootScope.OgDescription="دانرو - "+$scope.pageData.title+" واقع در "+$scope.pageData.address+"  "+$scope.pageData.tel_1,$rootScope.Pagedescriptions=$scope.pageData.title+" واقع در "+$scope.pageData.address+"  "+$scope.pageData.tel_1,
$rootScope.canonical=$scope.pageData.canonicalLink,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage,$rootScope.canonical),$scope.headerObj=$scope.templateData.header,$scope.advantages=$scope.templateData.advantages,$scope.videoFile=$scope.templateData.video.path+"/High.mp4",$scope.videoThumbnail=$scope.templateData.video.path+"/Thumbnail.png",$scope.likeImage="/img/images/heart-Final.svg",$scope.likedImage="/img/images/isLiked.svg",$scope.replyImage="/img/images/specialpageReply.svg",$scope.favorite=$scope.pageData.liked_by_user,$scope.uploadImgComment=!1,$scope.modalPropertiesAddComment={title:null,content:null,image:null},$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},uiGmapGoogleMapApi.then(function(maps){$scope.map={control:{},center:{latitude:$scope.pageData.lat,longitude:$scope.pageData.lng},zoom:15,options:{draggable:!0,disableDefaultUI:!0,zoomControl:!0,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,styles:[{elementType:"geometry",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#242f3e"}]},{elementType:"labels.text.fill",stylers:[{color:"#746855"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#263c3f"}]},{featureType:"poi.park",elementType:"labels.text.fill",stylers:[{color:"#6b9a76"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#38414e"}]},{featureType:"road",elementType:"geometry.stroke",stylers:[{color:"#212a37"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca5b3"}]},{featureType:"road.highway",elementType:"geometry",stylers:[{color:"#746855"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#1f2835"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#f3d19c"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#2f3948"}]},{featureType:"transit.station",elementType:"labels.text.fill",stylers:[{color:"#d59563"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#17263c"}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{color:"#515c6d"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{color:"#17263c"}]}]},events:{}},$scope.windowOptions={visible:!0},$scope.User={Coords:{latitude:$scope.pageData.lat,longitude:$scope.pageData.lng},icon:appConfig.BaseThemeNew+"/img/imgHome/withePinDrop.png",control:{},options:{draggable:!1,scrollwheel:!1,navigationControl:!1,mapTypeControl:!1,scaleControl:!1,animation:google.maps.Animation.DROP}}}),$scope.addRate=!0,$scope.addComment=!1,$scope.openModal=!1,$scope.addRateModal=!1,$scope.editRateModal=!1,$scope.doneRateModal=!1,$scope.addCommentModal=!1,$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!1,$scope.defaultRateReliable=!1,$scope.defaultRateCredible=!1,$scope.rate=$rootScope.CheckShowRate.data,$scope.rateData=$scope.rate.data,$scope.replyOpen=!1,$scope.popular=null,$scope.reliable=null,$scope.credible=null,$scope.rate.status&&null!==$scope.rate.data&&($scope.addRate=!1,$scope.addComment=!0),null!==$scope.pageData.rates&&($scope.totalRates=$scope.pageData.rates.count),null!==$scope.pageData.rates&&($scope.fivestarRate=(($scope.pageData.rates.credibility+$scope.pageData.rates.popularity+$scope.pageData.rates.reliability)/3*100).toFixed(0)/10),$scope.pageData.rates&&$scope.pageData.rates.popularity&&($scope.popularity=Math.round(100*$scope.pageData.rates.popularity)),$scope.pageData.rates&&$scope.pageData.rates.reliability&&($scope.reliability=Math.round(100*$scope.pageData.rates.reliability)),$scope.pageData.rates&&$scope.pageData.rates.credibility&&($scope.credibility=Math.round(100*$scope.pageData.rates.credibility)),$timeout(function(){var c=document.getElementById("canvas"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=18,thirdRadius=25;ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),$scope.pageData.rates&&(1==$scope.pageData.rates.credibility&&($scope.pageData.rates.credibility=0),1==$scope.pageData.rates.popularity&&($scope.pageData.rates.popularity=0),1==$scope.pageData.rates.reliability&&($scope.pageData.rates.reliability=0),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-$scope.pageData.rates.credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-$scope.pageData.rates.reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-$scope.pageData.rates.popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#be49cc",ctx.stroke())},0),$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.pageData),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.popularUpRate=function(){$scope.popular="1",$scope.defaultRatePopularUp=!0,$scope.defaultRatePopularDown=!1},$scope.popularDownRate=function(){$scope.popular="0",$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!0},$scope.reliableUpRate=function(){$scope.reliable="1",$scope.defaultRateReliableUp=!0,$scope.defaultRateReliableDown=!1},$scope.reliableDownRate=function(){$scope.reliable="0",$scope.defaultRateReliableUp=!1,$scope.defaultRateReliableDown=!0},$scope.credibleUpRate=function(){$scope.credible="1",$scope.defaultRateCredibleUp=!0,$scope.defaultRateCredibleDown=!1},$scope.credibleDownRate=function(){$scope.credible="0",$scope.defaultRateCredibleUp=!1,$scope.defaultRateCredibleDown=!0},$scope.showAddMyComment=function(){$scope.addCommentModal=!$scope.addCommentModal,$scope.doneRateModal=!$scope.doneRateModal},$scope.showAddMyCommentModal=function(){$scope.openModal=!$scope.openModal,$scope.addCommentModal=!0},$scope.addMyComment=function(){if($scope.dontComment=!0,null!==$scope.modalPropertiesAddComment.title&&($scope.dontComment=!1),null!==$scope.modalPropertiesAddComment.content&&($scope.dontComment=!1),$scope.dontComment)$scope.openModal=!1,$scope.addCommentModal=!1,notifications.showError(" برای دیدگاه خود عنوان و متن قرار دهید!"),$timeout(function(){$scope.openModal=!0,$scope.addCommentModal=!0},500);else{var FormDataToAddComment=new FormData;if(FormDataToAddComment.append("title",$scope.modalPropertiesAddComment.title),FormDataToAddComment.append("content",$scope.modalPropertiesAddComment.content),$scope.fileReadyToUpload){var imageHandPicked=$scope.fileReadyToUpload;FormDataToAddComment.append("image",imageHandPicked)}WebServices.addComment($scope.pageData.uuid,FormDataToAddComment).then(function(result){result.data.status?(ngProgress.complete(),$scope.addCommentModal=!$scope.addCommentModal,notifications.showSuccess("دیدگاه شما با موفقیت ثبت گردید."),$window.location.reload()):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"),$state.go($state.current,$stateParams,{reload:!0,inherit:!1}))},utils.MHandler[1])}},$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.prepareToUpload=function(data){$scope.uploadImgComment=!0,$scope.theImageComment=!0,$scope.commentImg=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.deleteImgComment=function(data){$scope.uploadImgComment=!1,$scope.theImageComment=!1,$scope.commentImg="",$scope.imgEditorConfig.image=data,$scope.fileToUpload=!1,$scope.fileReadyToUpload=""},$scope.addRatePage=function(pageModal){ngProgress.start(),$scope.modalRatePage=angular.copy(pageModal);var FormDataToRate=PrepareForRate(),FormDataToRateModal=new FormData;FormDataToRateModal.append("popular",FormDataToRate.popular),FormDataToRateModal.append("reliable",FormDataToRate.reliable),FormDataToRateModal.append("credible",FormDataToRate.credible),WebServices.addRatePage($scope.pageData.uuid,FormDataToRateModal).then(function(result){result.data.status?(ngProgress.complete(),$scope.addRateModal=!$scope.addRateModal,$scope.doneRateModal=!$scope.doneRateModal,$timeout(function(){var c=document.getElementById("canvas-modal"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=18,thirdRadius=25;if($scope.modalRatePage.rates)var count=parseInt($scope.modalRatePage.rates.count),pagePopularity=$scope.modalRatePage.rates.popularity,pageReliability=$scope.modalRatePage.rates.reliability,pageCredibility=$scope.modalRatePage.rates.credibility;else var count=0,pagePopularity=0,pageReliability=0,pageCredibility=0;$scope.rate.data?(countRate=count,oldRatePopular=$scope.rate.data.popular,oldRateCredible=$scope.rate.data.credible,oldRateReliable=$scope.rate.data.reliable):(countRate=count+1,oldRatePopular="0",oldRateCredible="0",oldRateReliable="0");var popularity=pagePopularity+(FormDataToRate.popular-oldRatePopular)/countRate,reliability=pageReliability+(FormDataToRate.reliable-oldRateReliable)/countRate,credibility=pageCredibility+(FormDataToRate.credible-oldRateCredible)/countRate,modalRate={popularity:popularity,reliability:reliability,credibility:credibility};$scope.pageModal.rates=modalRate,ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#be49cc",ctx.stroke()},0)):notifications.showError("پر کردن هر سه فیلد اجباری است!")},utils.MHandler[1])},$scope.editRate=function(){$scope.pageModal=angular.copy($scope.pageData),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.editRateModal=!$scope.editRateModal,$scope.addCommentModal=!$scope.addCommentModal},$scope.likeFunc=function(comment){$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.pageData.uuid+"/comments/"+comment.id+"/commentAction",data:{action:"like"}}).then(function(response){response.data.UserLikeDislikeStatus?comment.UserLikeDislikeStatus="like":comment.UserLikeDislikeStatus=null,comment.likeCount=response.data.likeCount},function(response){notifications.showError(response.message.info[0]),ngProgress.complete(),notifications.showError(response.statusText)}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.showReplyBox=[],$scope.loginCheck=function(index){$scope.showReplyBox[index]=!1,$rootScope.IbartarUserInfo?$scope.showReplyBox[index]=!0:($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.addToWishList=function(){$rootScope.IbartarUserInfo?WebServices.addToFavorite($scope.pageData.uuid).then(function(result){result.data.status&&($scope.favorite=!$scope.favorite,utils.NormalNotificationForServerResponse(result.data.message,!0))},utils.MHandler[1]):notifications.showError("لطفا ابتدا وارد سیستم شوید")},$scope.analyticsEvent=function(social){var userId=$rootScope.IbartarUserInfo?$rootScope.IbartarUserInfo.id:"no_user_id";Analytics.trackEvent("SocialShareEvent",social,userId+" in "+$stateParams.uuid)},$scope.daysSchedule=$scope.pageData.opening_hours,$scope.times=[],$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},angular.forEach($scope.daysSchedule,function(ObjDay,i){$scope.times.push([ObjDay[0],ObjDay[1]])}),$("#back-to-top").length){var scrollTrigger=100,backToTop=function(){var scrollTop=$(window).scrollTop();scrollTop>scrollTrigger?$("#back-to-top").addClass("show"):$("#back-to-top").removeClass("show")};backToTop(),$(window).on("scroll",function(){backToTop()}),$("#back-to-top").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},700)})}$scope.replyCommentModal=!1,$scope.openModalReply=!1;var commentId,commentLinks,indexComment;$scope.commentReply=function(comment){commentId=comment.id,indexComment=$scope.ShowComments.comments.indexOf(comment),commentLinks=comment._links.allReplies,$scope.comment=comment,comment.reply.total>3&&$http({method:"GET",url:commentLinks}).then(function(response){$scope.comment.reply.items=response.data.items},function(response){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور وجود دارد.")}),$scope.openModalReply=!0,$scope.replyCommentModal=!0},$scope.addReplyComment=function(replyCommentText){$scope.replyContent=replyCommentText,$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.pageData.uuid+"/comments/"+commentId+"/replyComment",data:{replyContent:$scope.replyContent}}).then(function(response){ngProgress.complete(),$window.location.reload(),notifications.showSuccess("جواب شما ثبت شد.")},function(response){422==response.status?notifications.showError(response.data.error):(ngProgress.complete(),notifications.showError(response.statusText))}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.reportCommentFunc=function(comment){$rootScope.IbartarUserInfo?WebServices.reportComment($scope.pageData.uuid,comment.id).then(function(result){result.data.status?(ngProgress.complete(),comment.UserLikeDislikeStatus="reports",notifications.showSuccess(result.data.message.info)):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.specialGallery=[],angular.forEach($scope.pageData.media.image,function(items){items.isSpecial&&$scope.specialGallery.push({FullSize:items.files.FullSize,description:items.description})})}),angular.module("ibartarApp").controller("thirdSpecialCtrl",function($scope,$rootScope,$ocLazyLoad,$state,roundProgressService,$timeout,$stateParams,$log,$location,appConfig,utils,$interval,$window,MetaService,WebServices,Analytics,ngProgress,notifications,SearchRequests,channelService,$http,searchTraceService){function PrepareForRate(){ngProgress.start();var PrepareForRateObj={popular:$scope.popular,reliable:$scope.reliable,credible:$scope.credible};return PrepareForRateObj}if($(window).on("beforeunload",function(){$(window).scrollTop(0)}),$window.scrollTo(0,0),$scope.thirdSpecial=$rootScope.ShowData.data.data,$scope.ShowComments=$rootScope.ShowComments.data.data,$scope.templateThree=$scope.thirdSpecial.template,$scope.features=$scope.templateThree.advantages.blocks,$rootScope.PageHeader=$scope.thirdSpecial.title,$rootScope.OgTitle=$scope.thirdSpecial.title,$rootScope.OgImage=$scope.thirdSpecial.logo.Small,$rootScope.OgDescription="دانرو - "+$scope.thirdSpecial.title+" واقع در "+$scope.thirdSpecial.address+"  "+$scope.thirdSpecial.tel_1,$rootScope.Pagedescriptions=$scope.thirdSpecial.title+" واقع در "+$scope.thirdSpecial.address+"  "+$scope.thirdSpecial.tel_1,$rootScope.canonical=$scope.thirdSpecial.canonicalLink,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage,$rootScope.canonical),$scope.videoFile=$scope.templateThree.contact.video.path+"/High.mp4",$scope.videoThumbnail=$scope.templateThree.contact.video.path+"/Thumbnail.png",$scope.likeImage="/img/images/heart-Final.svg",$scope.likedImage="/img/images/isLiked.svg",$scope.replyImage="/img/images/specialpageReply.svg",$scope.favorite=$scope.thirdSpecial.liked_by_user,$scope.modalPropertiesAddComment={title:null,content:null,image:null},$scope.imgEditorConfig={viewSizeWidth:300,outputImageSelfSizeCrop:!0,viewShowCropTool:!0,outputImageWidth:200,outputImageHeight:200},$scope.addRate=!0,$scope.addComment=!1,$scope.openModal=!1,$scope.addRateModal=!1,$scope.editRateModal=!1,$scope.doneRateModal=!1,$scope.addCommentModal=!1,$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!1,$scope.defaultRateReliable=!1,$scope.defaultRateCredible=!1,$scope.rate=$rootScope.CheckShowRate.data,$scope.rateData=$scope.rate.data,$scope.replyOpen=!1,$scope.popular=null,$scope.reliable=null,$scope.credible=null,$scope.rate.status&&null!==$scope.rate.data&&($scope.addRate=!1,$scope.addComment=!0),null!==$scope.thirdSpecial.rates&&($scope.totalRates=$scope.thirdSpecial.rates.count),null!==$scope.thirdSpecial.rates&&($scope.fivestarRate=(($scope.thirdSpecial.rates.credibility+$scope.thirdSpecial.rates.popularity+$scope.thirdSpecial.rates.reliability)/3*100).toFixed(0)/10),$scope.thirdSpecial.rates&&$scope.thirdSpecial.rates.popularity&&($scope.popularity=Math.round(100*$scope.thirdSpecial.rates.popularity)),$scope.thirdSpecial.rates&&$scope.thirdSpecial.rates.reliability&&($scope.reliability=Math.round(100*$scope.thirdSpecial.rates.reliability)),$scope.thirdSpecial.rates&&$scope.thirdSpecial.rates.credibility&&($scope.credibility=Math.round(100*$scope.thirdSpecial.rates.credibility)),$timeout(function(){var c=document.getElementById("canvas"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=10,secondRadius=17,thirdRadius=25;ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#ddd",ctx.stroke(),$scope.thirdSpecial.rates&&(1==$scope.thirdSpecial.rates.credibility&&($scope.thirdSpecial.rates.credibility=0),1==$scope.thirdSpecial.rates.popularity&&($scope.thirdSpecial.rates.popularity=0),1==$scope.thirdSpecial.rates.reliability&&($scope.thirdSpecial.rates.reliability=0),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-$scope.thirdSpecial.rates.credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=5,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-$scope.thirdSpecial.rates.reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-$scope.thirdSpecial.rates.popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=5,ctx.strokeStyle="#be49cc",ctx.stroke())},0),$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.thirdSpecial),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.popularUpRate=function(){$scope.popular="1",$scope.defaultRatePopularUp=!0,$scope.defaultRatePopularDown=!1},$scope.popularDownRate=function(){$scope.popular="0",$scope.defaultRatePopularUp=!1,$scope.defaultRatePopularDown=!0},$scope.reliableUpRate=function(){$scope.reliable="1",$scope.defaultRateReliableUp=!0,$scope.defaultRateReliableDown=!1},$scope.reliableDownRate=function(){$scope.reliable="0",$scope.defaultRateReliableUp=!1,$scope.defaultRateReliableDown=!0},$scope.credibleUpRate=function(){$scope.credible="1",$scope.defaultRateCredibleUp=!0,$scope.defaultRateCredibleDown=!1},$scope.credibleDownRate=function(){$scope.credible="0",$scope.defaultRateCredibleUp=!1,$scope.defaultRateCredibleDown=!0},$scope.showAddMyComment=function(){$scope.addCommentModal=!$scope.addCommentModal,$scope.doneRateModal=!$scope.doneRateModal},$scope.showAddMyCommentModal=function(){$scope.openModal=!$scope.openModal,$scope.addCommentModal=!0},$scope.addMyComment=function(){if($scope.dontComment=!0,null!==$scope.modalPropertiesAddComment.title&&($scope.dontComment=!1),null!==$scope.modalPropertiesAddComment.content&&($scope.dontComment=!1),$scope.dontComment)$scope.openModal=!1,$scope.addCommentModal=!1,notifications.showError(" برای دیدگاه خود عنوان و متن قرار دهید!"),$timeout(function(){$scope.openModal=!0,$scope.addCommentModal=!0},500);else{var FormDataToAddComment=new FormData;if(FormDataToAddComment.append("title",$scope.modalPropertiesAddComment.title),FormDataToAddComment.append("content",$scope.modalPropertiesAddComment.content),$scope.fileReadyToUpload){var imageHandPicked=$scope.fileReadyToUpload;FormDataToAddComment.append("image",imageHandPicked)}WebServices.addComment($scope.thirdSpecial.uuid,FormDataToAddComment).then(function(result){result.data.status?(ngProgress.complete(),$scope.addCommentModal=!$scope.addCommentModal,notifications.showSuccess("دیدگاه شما با موفقیت ثبت گردید."),$window.location.reload()):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"),$state.go($state.current,$stateParams,{reload:!0,inherit:!1}))},utils.MHandler[1])}},$scope.lazyLoadNgUploadPreview=$rootScope.lazyLoad.ngUploadPreview,$scope.prepareToUpload=function(data){$scope.uploadImgComment=!0,$scope.theImageComment=!0,$scope.commentImg=data,$scope.imgEditorConfig.image=data,$scope.fileToUpload=!0,$scope.fileReadyToUpload=utils.dataURItoBlob(data)},$scope.deleteImgComment=function(data){$scope.uploadImgComment=!1,$scope.theImageComment=!1,$scope.commentImg="",$scope.imgEditorConfig.image=data,$scope.fileToUpload=!1,$scope.fileReadyToUpload=""},$scope.addRatePage=function(pageModal){ngProgress.start(),$scope.modalRatePage=angular.copy(pageModal);var FormDataToRate=PrepareForRate(),FormDataToRateModal=new FormData;FormDataToRateModal.append("popular",FormDataToRate.popular),FormDataToRateModal.append("reliable",FormDataToRate.reliable),FormDataToRateModal.append("credible",FormDataToRate.credible),WebServices.addRatePage($scope.thirdSpecial.uuid,FormDataToRateModal).then(function(result){result.data.status?(ngProgress.complete(),$scope.addRateModal=!$scope.addRateModal,$scope.doneRateModal=!$scope.doneRateModal,$timeout(function(){var c=document.getElementById("canvas-modal"),ctx=c.getContext("2d"),centerX=canvas.width/2,centerY=canvas.height/2,firstRadius=13,secondRadius=22,thirdRadius=28;if($scope.modalRatePage.rates)var count=parseInt($scope.modalRatePage.rates.count),pagePopularity=$scope.modalRatePage.rates.popularity,pageReliability=$scope.modalRatePage.rates.reliability,pageCredibility=$scope.modalRatePage.rates.credibility;else var count=0,pagePopularity=0,pageReliability=0,pageCredibility=0;$scope.rate.data?(countRate=count,oldRatePopular=$scope.rate.data.popular,oldRateCredible=$scope.rate.data.credible,oldRateReliable=$scope.rate.data.reliable):(countRate=count+1,oldRatePopular="0",oldRateCredible="0",oldRateReliable="0");var popularity=pagePopularity+(FormDataToRate.popular-oldRatePopular)/countRate,reliability=pageReliability+(FormDataToRate.reliable-oldRateReliable)/countRate,credibility=pageCredibility+(FormDataToRate.credible-oldRateCredible)/countRate,modalRate={popularity:popularity,reliability:reliability,credibility:credibility};$scope.pageModal.rates=modalRate,ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,0,2*Math.PI,!0),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#ddd",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,firstRadius,1.5*Math.PI,(1.5-2*(1-credibility))*Math.PI,!1),ctx.stroke(),ctx.fillStyle="#fff",ctx.fill(),ctx.lineWidth=4,ctx.strokeStyle="#469acb",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,secondRadius,1.5*Math.PI,(1.5-2*(1-reliability))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#49cc74",ctx.stroke(),ctx.beginPath(),ctx.arc(centerX,centerY,thirdRadius,1.5*Math.PI,(1.5-2*(1-popularity))*Math.PI,!1),ctx.stroke(),ctx.lineWidth=4,ctx.strokeStyle="#be49cc",ctx.stroke()},0)):notifications.showError("پر کردن هر سه فیلد اجباری است!")},utils.MHandler[1])},$scope.editRate=function(){$scope.pageModal=angular.copy($scope.thirdSpecial),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.editRateModal=!$scope.editRateModal,$scope.addCommentModal=!$scope.addCommentModal},$scope.likeFunc=function(comment){$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.thirdSpecial.uuid+"/comments/"+comment.id+"/commentAction",data:{action:"like"}}).then(function(response){response.data.UserLikeDislikeStatus?comment.UserLikeDislikeStatus="like":comment.UserLikeDislikeStatus=null,comment.likeCount=response.data.likeCount},function(response){notifications.showError(response.message.info[0]),ngProgress.complete(),notifications.showError(response.statusText)}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.addToWishList=function(){$rootScope.IbartarUserInfo?WebServices.addToFavorite($scope.thirdSpecial.uuid).then(function(result){result.data.status&&($scope.favorite=!$scope.favorite,utils.NormalNotificationForServerResponse(result.data.message,!0))},utils.MHandler[1]):notifications.showError("لطفا ابتدا وارد سیستم شوید")},$scope.addRateFunc=function(){$rootScope.IbartarUserInfo?($scope.pageModal=angular.copy($scope.thirdSpecial),$scope.pageTitle=$scope.pageModal.title,$scope.modalAddRateObj={},$scope.openModal=!0,$scope.addRateModal=!0,$window.ga("send","event",{eventCategory:"business",eventAction:"rate"})):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.daysSchedule=$scope.thirdSpecial.opening_hours,$scope.times=[],$scope.days={Sat:"شنبه",Sun:"یکشنبه",Mon:"دوشنبه",Tue:"سه شنبه",Wed:"چهارشنبه",Thu:"پنجشنبه",Fri:"جمعه"},angular.forEach($scope.daysSchedule,function(ObjDay,i){$scope.times.push([ObjDay[0],ObjDay[1]])}),$("#back-to-top").length){var scrollTrigger=100,backToTop=function(){var scrollTop=$(window).scrollTop();scrollTop>scrollTrigger?$("#back-to-top").addClass("show"):$("#back-to-top").removeClass("show")};backToTop(),$(window).on("scroll",function(){backToTop()}),$("#back-to-top").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},700)})}var requestGetComment=Math.ceil($scope.ShowComments.total/10);if(requestGetComment>1)for(var i=2;15>(requestGetComment>=i);i++)$http({method:"GET",url:appConfig.api+"/page/"+$scope.thirdSpecial.uuid+"/comments?page="+i}).then(function(response){for(var j=0;j<response.data.data.comments.length;j++)$scope.ShowComments.comments.push(response.data.data.comments[j])});$scope.replyCommentModal=!1,$scope.openModalReply=!1;var commentId,commentLinks,indexComment;$scope.commentReply=function(comment){commentId=comment.id,indexComment=$scope.ShowComments.comments.indexOf(comment),commentLinks=comment._links.allReplies,$scope.comment=comment,comment.reply.total>3&&$http({method:"GET",url:commentLinks}).then(function(response){$scope.comment.reply.items=response.data.items},function(response){ngProgress.complete(),notifications.showError("خطایی در اتصال به سرور وجود دارد.")}),$scope.openModalReply=!0,$scope.replyCommentModal=!0},$scope.addReplyComment=function(replyCommentText){$scope.replyContent=replyCommentText,$rootScope.IbartarUserInfo?$http({method:"POST",url:appConfig.api+"/page/"+$scope.thirdSpecial.uuid+"/comments/"+commentId+"/replyComment",data:{replyContent:$scope.replyContent}}).then(function(response){ngProgress.complete(),$window.location.reload(),notifications.showSuccess("جواب شما ثبت شد.")},function(response){422==response.status?notifications.showError(response.data.error):(ngProgress.complete(),notifications.showError(response.statusText))}):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))},$scope.reportCommentFunc=function(comment){$rootScope.IbartarUserInfo?WebServices.reportComment($scope.thirdSpecial.uuid,comment.id).then(function(result){result.data.status?(ngProgress.complete(),comment.UserLikeDislikeStatus="reports",notifications.showSuccess(result.data.message.info)):(utils.NormalNotificationForServerResponse(result.data.message,!1),notifications.showError("مشکلی در سرور وجود دارد"))},utils.MHandler[1]):($state.go("userlogin",{redirect:$location.$$absUrl.toString()}),notifications.showError("شما ابتدا باید وارد شوید"))}}),angular.module("ibartarApp").controller("getReportPageCtrl",function($stateParams,$state,$scope,$timeout,ReportsOfPage,WebServices,utils,ngProgress,amMoment,appConfig,dateFilter,$ocLazyLoad,$http,notifications,$rootScope){$scope.currentDate=moment(),amMoment.loadPersian(),$rootScope.PageHeader="مشاهده هزینه های صفحه شما  ",$ocLazyLoad.load($rootScope.lazyLoad.highChart),$scope.showReportPage=!0,$scope.showDetailCost=!1,$scope.desableDetailCost=!1,$scope.toggleModalShowDetails=function(item){$scope.showDetailCost=!$scope.showDetailCost,$scope.modalDetailItemSelected=item},$scope.getReport=ReportsOfPage.data,$scope.items=$scope.getReport.items,$scope.titlePage=$scope.getReport.title,0==Object.keys($scope.items).length&&($scope.showReportPage=!1);var pay=[],spent=[],date=[],remain=[];$scope.totalDetail=$scope.getReport.totalCost,angular.forEach($scope.items,function(value,key){angular.forEach(value,function(valueItem,index){"pay"==index&&pay.push(parseInt(valueItem)),"spent"==index&&(0==Object.keys(spent).length?$scope.desableDetailCost=!0:$scope.desableDetailCost=!1,spent.push(parseInt(valueItem))),"date"==index&&date.push(valueItem),"remain"==index&&remain.push(valueItem)})}),$(function(){$("#chart").highcharts({title:{text:" نمودار امتیازات خریداری و مصرف شده :",x:-380,margin:50,align:"right",style:{color:"#632496",fontFamily:"IRANSans",fontSize:"17pt"}},xAxis:{categories:date},yAxis:{min:0,title:{text:"میزان مصرفی"}},tooltip:{pointFormat:'<div  dir="rtl" ><span style="color:{series.color}"> {series.name} </span>:<br/> <b>{point.y}</b><br/></div>',style:{padding:5,fontWeight:"bold",width:"150px"}},series:[{type:"column",name:"شارژشده ",data:pay,color:"#a86adb"},{type:"column",
name:"خرج شده",data:spent,color:"#ffc107"}]})}),$scope.openHelp=function(){$state.go("help")},$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.startDateVisitor=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.startDateVal=!$scope.startDateVal},$scope.finishDateVisitor=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.finishDateVal=!$scope.finishDateVal};var visitorHourlyKey=[],visitorDailyKey=[],visitorHourlyNumber=[],visitorDailyNumber=[];$scope.showBtn=!1,$scope.hourly=!1,$scope.daily=!1,$scope.hourlyChart=function(){$scope.hourly=!0,$scope.daily=!1},$scope.dailyChart=function(){$scope.hourly=!1,$scope.daily=!0},$scope.setTimeForChart=function(startDate,finishDate){$scope.showBtn=!0,$scope.daily=!0,finishDate>=startDate?$http({url:appConfig.apiV1_4+"/statistics/getPageStatistics/"+$scope.getReport.id,method:"POST",dataType:"json",data:{from:startDate.getTime()/1e3,to:finishDate.getTime()/1e3}}).success(function(response){$scope.chartDataHourly=response.hourly,angular.forEach($scope.chartDataHourly,function(item,i){visitorHourlyKey[i]=moment(item.timestamp).format("jYYYY/jM/jD HH:mm"),visitorHourlyNumber[i]=item.count}),$scope.chartDataDaily=response.daily,angular.forEach($scope.chartDataDaily,function(item,i){visitorDailyKey[i]=moment(item.timestamp).format("jYYYY/jM/jD HH:mm"),visitorDailyNumber[i]=item.count}),ngProgress.complete(),notifications.showSuccess("جستجو انجام گردید."),$(function(){$("#chartVisitorHourly").highcharts({title:{text:" نمودار بازدید بر اساس ساعت",x:-380,margin:50,align:"right",style:{color:"#632496",fontFamily:"IRANSans",fontSize:"17pt"}},xAxis:{categories:visitorHourlyKey},yAxis:{min:0,title:{text:"تعداد بازدید"}},series:[{type:"line",name:"بازدید ساعتی",data:visitorHourlyNumber,color:"#428bca"}]}),$("#chartVisitorDaily").highcharts({title:{text:" نمودار بازدید بر اساس ساعت",x:-380,margin:50,align:"right",style:{color:"#632496",fontFamily:"IRANSans",fontSize:"17pt"}},xAxis:{categories:visitorDailyKey},yAxis:{min:0,title:{text:"تعداد بازدید"}},series:[{type:"line",name:"بازدید روزانه",data:visitorDailyNumber,color:"#5cb85c"}]})})}).error(function(response){notifications.showError(response.error)}):notifications.showError("تاریخ پایان از تاریخ شروع باید بزرگتر باشد.")}}),angular.module("ibartarApp").controller("pagesDeletedReportCtrl",function($scope,$state,$rootScope,reportPagesDeleted,utils,amMoment,notifications,ngProgress,dateFilter,operatorRequests){function PrepareForData(){ngProgress.start();var FormData={from:$scope.startDate,to:$scope.endDate};for(key in FormData)void 0===FormData[key]&&delete FormData[key];return FormData}amMoment.loadPersian(),$scope.showReport=!0,$rootScope.PageHeader="آمار صفحات حذف شده",$scope.reportPagesDefaultCount=reportPagesDeleted.data.count,$scope.reportPagesDefault=reportPagesDeleted.data.items,angular.forEach($scope.reportPagesDefault,function(item,index){angular.forEach(item,function(value,id){"deleted_at"==id&&(dateString=moment.unix(value).format("jYYYY/jM/jD"),value=dateString,item.deleted_at=value)})}),0==Object.keys($scope.reportPagesDefault).length&&($scope.showReport=!1),$scope.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$scope.format=$scope.formats[0],$scope.initDay=new Date,$scope.dateOptions={formatYear:"yy",startingDay:6},$scope.OpenEndTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenEndTimeVal=!0},$scope.OpenStartTime=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.OpenStartTimeVal=!0},$scope.filterDateSearch=function(){$scope.startTime&&($scope.startDate=moment(dateFilter($scope.startTime,"yyyy-MM-dd")).unix()),$scope.Endtime&&($scope.endDate=moment(dateFilter($scope.Endtime,"yyyy-MM-dd")).unix());var infoSearchDeletedPage=PrepareForData();operatorRequests.pagesDeleted.getReportFilterPagesDeleted(infoSearchDeletedPage).success(function(response){ngProgress.complete(),$scope.showReport=!0,angular.forEach(response.items,function(item,index){angular.forEach(item,function(value,id){"deleted_at"==id&&(dateString=moment.unix(value).format("jYYYY/jM/jD"),value=dateString,item.deleted_at=value)})}),$scope.reportPagesDefaultCount=response.count,$scope.reportPagesDefault=response.items,0==Object.keys($scope.reportPagesDefault).length&&($scope.showReport=!1)}).error(function(error){$scope.error=error,utils.NormalNotificationForServerResponse(error,!1),notifications.showError("مشکلی در سرور وجود دارد")})}}),angular.module("ibartarApp").controller("weekScheduleCtrl",function($stateParams,$state,$scope,$timeout,weekSchedule,MapMarker,appConfig,uiGmapGoogleMapApi,utils,ngProgress,JobList,searchTraceService,operatorRequests,$ocLazyLoad,$rootScope,$interval,$http,notifications){$rootScope.PageHeader=" برنامه هفتگی",$scope.JobPackages=JobList.data.data,$scope.JobGuildArr=[],$scope.guildPages=[],$scope.weekSchedules=weekSchedule.data,$scope.removeGuildsByName=function(item){item.html("")},$scope.click=function(){operatorRequests.weekSchedule.GetGuilds().then(function(result){result.data&&ngProgress.complete()},utils.MHandler[1])};var vm=this;vm.multipleDemo={},$scope.guilds=[],vm.multipleDemo.guilds=[],operatorRequests.weekSchedule.GetGuilds().then(function(response){$scope.guilds=response.data},function(){}),angular.forEach($scope.weekSchedules,function(dayObj,dayName){angular.forEach(dayObj,function(hourObj,hourName){var guilds=hourObj.guilds,tempGuildArray=[];angular.forEach(guilds,function(guild,index){tempGuildArray.push(guild.title)}),vm.multipleDemo.guilds=tempGuildArray})})}),angular.module("ibartarApp").controller("LandingPageCtrl",function($scope,$state,$rootScope,MetaService){if($rootScope.PageHeader="دریافت اپلیکیشن دانرو",$rootScope.OgTitle="دریافت اپلیکیشن دانرو",$rootScope.OgImage="",$rootScope.OgDescription="اپلیکیشن دانرو راهنمای شما در اطلاعات تماس تمامی کسب و کارها و اماکن سطح کشور است. مشاهده تخفیف‌ها، جشنواره‌ها و دیگر رویدادهای مهم شهر.",$rootScope.Pagedescriptions="اپلیکیشن دانرو راهنمای شما در اطلاعات تماس تمامی کسب و کارها و اماکن سطح کشور است. مشاهده تخفیف‌ها، جشنواره‌ها و دیگر رویدادهای مهم شهر.",$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage),$('a[href*="#"]:not([href="#"])').click(function(){if(location.pathname.replace(/^\//,"")==this.pathname.replace(/^\//,"")&&location.hostname==this.hostname){var target=$(this.hash);if(target=target.length?target:$("[name="+this.hash.slice(1)+"]"),target.length)return $("html, body").animate({scrollTop:target.offset().top},600),!1}}),$("#back-to-top").length){var scrollTrigger=100,backToTop=function(){var scrollTop=$(window).scrollTop();scrollTop>scrollTrigger?$("#back-to-top").addClass("show"):$("#back-to-top").removeClass("show")};backToTop(),$(window).on("scroll",function(){backToTop()}),$("#back-to-top").on("click",function(e){e.preventDefault(),$("html,body").animate({scrollTop:0},700)})}window.sr=ScrollReveal(),sr.reveal("#highlited",{duration:800,mobile:!1}),sr.reveal("#featured .container",{duration:800,mobile:!1}),sr.reveal("#postscript",{duration:800,mobile:!1}),sr.reveal("#topFooter",{duration:800,mobile:!1})}),angular.module("ibartarApp").controller("tosCtrl",function($scope,$rootScope,MetaService){$rootScope.PageHeader="شرایط و قوانین دانرو",$rootScope.Pagedescriptions="بانک اطلاعات مشاغل محله : نزدیکترین و راحت ترین رو در دانرو پیدا کن به همراه اطلاعات تماس ، ساعت کاری ، امکانات و خدمات",$scope.OgTitle=$rootScope.PageHeader,$scope.OgImage="",$scope.OgDescription=$rootScope.Pagedescriptions,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage)}),angular.module("ibartarApp").controller("moreFavoriteCtrl",function($scope,$state,$location,$rootScope,Analytics,UserFavoritesBusiness){$rootScope.PageHeader=" مشاهده همه نشان شده ها | دانرو",$scope.UserFavoritesBusiness=UserFavoritesBusiness.data.data;var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})}}),angular.module("ibartarApp").controller("detectPageVersion",function($scope,$state,$location,$rootScope,$stateParams,ShowData,userMediaData,CheckShowRate,ShowComments,loadMapBeforeLoading){if($rootScope.ShowData=ShowData,$rootScope.userMediaData=userMediaData,$rootScope.CheckShowRate=CheckShowRate,$rootScope.ShowComments=ShowComments,$rootScope.loadMapBeforeLoading=loadMapBeforeLoading,"danger"==ShowData.data.errorType)$state.go("404",{reload:!1});else{0==ShowData.data.data.template.length?$state.go("defaultShow",{reload:!1}):(1==ShowData.data.data.template.type&&$state.go("specialPage1",{reload:!1}),2==ShowData.data.data.template.type&&$state.go("specialPage2",{reload:!1}),3==ShowData.data.data.template.type&&$state.go("specialPage3"));var properTitle=ShowData.data.data.title.split(" ").join("-");$state.is("show.hasTitle")||$state.go("show.hasTitle",{title:properTitle},{reload:!0})}}),angular.module("ibartarApp").controller("moreEventsCtrl",function($scope,$state,$location,$rootScope,Analytics,UserFavoritesEvents){$rootScope.PageHeader=" مشاهده همه رویدادها    | دانرو",$scope.UserFavoritesEvents=UserFavoritesEvents.data.items;var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})}}),angular.module("ibartarApp").controller("landingEventCtrl",function($scope,showEvent,$rootScope,MetaService,$http,$state,$stateParams,$location,utils,$interval,Analytics,ngProgress,notifications){function sticky_relocate(){var window_top=$(window).scrollTop(),footer_top=$(".footerContainer").offset().top,div_top=$("#sticky-anchor").offset().top,div_height=$("#sticky").height(),padding=20;window_top+div_height>footer_top-padding?$("#sticky").css({top:-1*(window_top+div_height-footer_top+padding)}):window_top>div_top?($("#sticky").addClass("stick"),$("#sticky").css({top:20})):$("#sticky").removeClass("stick")}if($scope.eventData=showEvent.data,$scope.eventDataCategories=showEvent.data.categories,$rootScope.PageHeader=$scope.eventData.title,$scope.OgTitle=$rootScope.PageHeader,$scope.OgImage=$scope.eventData.imageUrl,$rootScope.Pagedescriptions=$scope.eventData.description,$rootScope.OgDescription="دانرو - "+$scope.eventData.description,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage),$scope.startDateEvent=moment.unix($scope.eventData.start).format("YYYY/M/D"),$scope.endDateEvent=moment.unix($scope.eventData.end).format("YYYY/M/D"),($result=angular.equals($scope.startDateEvent,$scope.endDateEvent))&&($scope.startDateEvent=$result,$scope.display="none",$("#startDate").css("display","none"),$("#startDate1").css("display","none")),$scope.hideAttends=!0,$scope.showParticipantCount=!0,$scope.thumbsUp=!1,$scope.thumbsDown=!1,$scope.removeClass=!1,"after"!=$scope.eventData.state){$scope.hideAttends=!1;var urlThumbUp=$scope.eventData._links.thumbsUp,urlThumbsDown=$scope.eventData._links.thumbsDown}0==$scope.eventData.participantCount&&($scope.showParticipantCount=!1),"yes"==$scope.eventData.user.attends&&($scope.thumbsUp=!0),"no"==$scope.eventData.user.attends&&($scope.thumbsDown=!0),$scope.thumbsUpFun=function(){$http.post(urlThumbUp).success(function(response){$scope.thumbsUp=!0,$scope.thumbsDown=!1}).error(function(errors){})},$scope.thumbsDownFun=function(){$http.post(urlThumbsDown).success(function(response){$scope.thumbsDown=!0,$scope.removeClass=!0,$scope.thumbsUp=!1}).error(function(errors){})},$scope.eventsArray=showEvent.data.relatedEvents,$scope.beautyUriEvent=function(id,urlEvent){return decodeURIComponent($state.href("landingEvent",{id:id,urlEvent:urlEvent}))},$scope.guilds=showEvent.data.owner.guilds,$scope.beautyUri=function(uuid,title){return decodeURIComponent($state.href("show",{uuid:uuid,title:title}))};var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.fixedBox=!1,window.onscroll=function(){var windowScrollTop=window.pageYOffset,otherHeader=$(".MainMenuContainerHome");0!=windowScrollTop?otherHeader.css({boxShadow:" 0px 2px 4px rgba(0, 0, 0, 0.2)"}):otherHeader.css({boxShadow:"none"});var bodyHeight=$(".contentEvent").innerHeight(),offsetSidebar=($(".sidebar").innerHeight(),$(".contentEvent").offset().top),offsetFooter=($(".sidebar").offset().top,$(".footerContainer").position().top),offsetSidebarRound=Math.round(offsetSidebar);Math.round(offsetFooter);windowScrollTop>offsetSidebarRound&&bodyHeight-offsetSidebarRound-100>windowScrollTop?$scope.fixedBox=!0:$scope.fixedBox=!1},$scope.htmlReady(),$(function(){$(window).scroll(sticky_relocate),sticky_relocate()})}),angular.module("ibartarApp").controller("eventListCtrl",function($scope,appConfig,showEventList,showAllEvents,$rootScope,MetaService,$http,$state,$stateParams,$location,utils,$interval,Analytics,ngProgress,notifications){$rootScope.PageHeader="لیست رویدادها - دانرو",$rootScope.Pagedescriptions="دانرو کاملترین مرجع اطلاعات شهری در ایران است. نشانی نزدیکترین و بهترین کسب و کارهای شهر را در دانرو پیدا کنید.",$scope.OgTitle=$rootScope.PageHeader,$scope.OgImage=$rootScope.ThemebaseNew+"/img/logo/logo.png",$scope.OgDescription=$rootScope.Pagedescriptions,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage);var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.showAllEvents=showAllEvents.data,$scope.eventListDate=showEventList.data,angular.forEach($scope.eventListDate,function(objectData){angular.forEach(objectData,function(obj){"categories"==obj._type&&($scope.categories=obj.items),"slides"==obj._type&&($scope.slides=obj.items),"campaigns"==obj._type&&($scope.campaigns=obj.items),"newest"==obj._type&&($scope.newest=obj.items),"mostPopular"==obj._type&&($scope.mostPopular=obj.items)})}),angular.forEach($scope.showAllEvents,function(obj){$scope.lastPage=Math.round(obj[0].total/12),angular.forEach(obj,function(i){"all"==i._type&&($scope.all=i.items)})}),$scope.createArrByIndexes=function(Indexes){for(var arr=[],i=0;Indexes-1>=i;i++)arr[i]=i;return arr},$scope.Paginate=function(PageNum){$scope.CurrPage=PageNum,$http({url:appConfig.apiV1_3+"/events/category/home/"+$scope.CurrPage,method:"GET",dataType:"json"}).success(function(response){ngProgress.complete(),angular.forEach(response.data,function(obj){"all"==obj._type&&($scope.all=obj.items)})})}}),angular.module("ibartarApp").controller("eventCategoryCtrl",function($scope,showEventList,appConfig,eventCategory,$rootScope,MetaService,$http,$state,$stateParams,$location,utils,$interval,Analytics,ngProgress,notifications){$rootScope.PageHeader="لیست رویدادها - دانرو",$rootScope.Pagedescriptions="دانرو کاملترین مرجع اطلاعات شهری در ایران است. نشانی نزدیکترین و بهترین کسب و کارهای شهر را در دانرو پیدا کنید.",$scope.OgTitle=$rootScope.PageHeader,$scope.OgImage=$rootScope.ThemebaseNew+"/img/logo/logo.png",$scope.OgDescription=$rootScope.Pagedescriptions,$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage);var fillSearchInput=function(value){$scope.QueryValue=value};$scope.autocompleteTools={FillInput:fillSearchInput},$scope.getSuggestions=function(){$scope.QueryValue.length>2?$scope.autocompleteTools.runsearch($scope.QueryValue):$scope.autocompleteTools.clearSearch()};var FillAreaInput=function(value){$scope.AreaVaule=value};$scope.areaAutocompleteTools={FillInput:FillAreaInput},$scope.getAreaSuggestions=function(){$scope.AreaVaule.length>2?$scope.areaAutocompleteTools.runsearch($scope.AreaVaule):$scope.areaAutocompleteTools.clearSearch()},$scope.KeyListener=function(event){$scope.autocompleteTools.keyActions(event,event.keyCode)},$scope.KeyListenerOfArea=function(event){$scope.areaAutocompleteTools.keyActions(event,event.keyCode)},$scope.SubmitSearch=function(){Analytics.trackEvent("searchDirectly");var Query,QueryString,keywords,QueryToString;$scope.QueryValue&&(Query=$scope.QueryValue.split("#"),QueryString=Query[0],Query.splice(0,1),keywords=Query.join(),QueryToString=QueryString.trim()),$state.go("search",{q:QueryToString,keyword:keywords,area:$scope.AreaVaule})},$scope.getClass=function(path){return $location.path()==path?"active":""},$scope.eventCategory=eventCategory.data,$scope.eventListDate=showEventList.data,angular.forEach($scope.eventListDate,function(objectData){angular.forEach(objectData,function(obj){"categories"==obj._type&&($scope.categories=obj.items),"slides"==obj._type&&($scope.slides=obj.items),"campaigns"==obj._type&&($scope.campaigns=obj.items)})}),angular.forEach($scope.eventCategory,function(obj){$scope.lastPage=Math.round(obj[0].total/12),angular.forEach(obj,function(i){"all"==i._type&&($scope.all=i.items),"newest"==i._type&&($scope.newest=i.items),"mostPopular"==i._type&&($scope.mostPopular=i.items)})}),$scope.createArrByIndexes=function(Indexes){for(var arr=[],i=0;Indexes-1>=i;i++)arr[i]=i;return arr},$scope.Paginate=function(PageNum){$scope.CurrPage=PageNum,$http({url:appConfig.apiV1_3+"/events/category/"+$stateParams.id+"/"+$scope.CurrPage,method:"GET",dataType:"json"}).success(function(response){ngProgress.complete(),angular.forEach(response.data,function(obj){"all"==obj._type&&($scope.all=obj.items)})})}}),angular.module("ibartarApp").controller("leaderBoardCtrl",function($scope,$rootScope,$state,$http,utils,leaderBoard,appConfig,notifications,ngProgress){$scope.LeaderBoard=leaderBoard.data,$rootScope.ThemebaseNew=appConfig.BaseThemeNew,$rootScope.PageHeader="نظرگردی دانرو",$scope.LeaderBoardDAta=$scope.LeaderBoard.items,$scope.dailyWinners=$scope.LeaderBoard.dailyWinners,$scope.links=$scope.LeaderBoard._links.next,$scope.total=$scope.LeaderBoard._links.total,$scope.lastPage=$scope.LeaderBoard._links.last_page,$scope.CurrPage=$scope.LeaderBoard._links.current_page,angular.forEach($scope.dailyWinners,function(x){$scope.dailyWinnersDate=moment.unix(x.date).format("YYYY/M/D")}),$scope.leaderBoardSearch=function(){$http({url:appConfig.apiV1_3+"/commentCampaign/single",method:"POST",dataType:"json",data:{mobile:$scope.mobileNumber}}).success(function(data){ngProgress.complete(),notifications.showSuccess("جستجو انجام گردید."),$scope.LeaderBoardDAta=data[0].items}).error(function(error){$scope.error=error.errors,notifications.showError($scope.error)})},$scope.createArrByIndexes=function(Indexes){for(var arr=[],i=0;Indexes-1>=i;i++)arr[i]=i;return arr},$scope.Paginate=function(PageNum){$scope.CurrPage=PageNum,$http({url:appConfig.apiV1_3+"/commentCampaign/all/"+$scope.CurrPage,method:"GET",dataType:"json",data:{current_page:$scope.CurrPage}}).success(function(data){ngProgress.complete(),$scope.LeaderBoardDAta=data.items})}}),angular.module("ibartarApp").controller("samplingCtrl",function($scope,$state,$rootScope){$rootScope.PageHeader="پخش پیک برتر - درباره ما"}),angular.module("ibartarApp").controller("privacyCtrl",function($scope,$state,$rootScope){$rootScope.PageHeader="شرایط و قوانین - دانرو"}),angular.module("ibartarApp").controller("CPCCtrl",function($scope,$state,$rootScope,MetaService){$rootScope.PageHeader="جشنواره دانرو",$rootScope.OgTitle="جشنواره دانرو",$rootScope.OgDescription="اپلیکیشن دانرو راهنمای شما در اطلاعات تماس تمامی کسب و کارها و اماکن سطح کشور است. مشاهده تخفیف‌ها، جشنواره‌ها و دیگر رویدادهای مهم شهر.",$rootScope.metaservice=MetaService,$rootScope.metaservice.set($scope.OgTitle,$scope.OgDescription,$scope.OgImage),$(document).ready(function(){$(".firstSection").click(function(){$.fn.fullpage.moveSectionDown()}),$(".secondSection").click(function(){$.fn.fullpage.moveSectionDown()}),$(".thirdSection").click(function(){$.fn.fullpage.moveSectionDown()}),$.fn.fullpage({fixedElements:".secondSection,.firstSection,.thirdSection"}),$(".LogoOFWebSite").click(function(){window.location.href="http://dunro.com"}),$(".acceptJobs").click(function(){window.location.href="http://dunro.com/page/create"}),$("#cpcCampaign").fullpage({lockAnchors:!0,anchors:["firstPage","secondPage","thirdPage","fourthPage"],navigation:!0,navigationPosition:"right",showActiveTooltip:!0,slidesNavigation:!1,slidesNavPosition:"bottom",css3:!0,scrollingSpeed:650,autoScrolling:!0,fitToSection:!0,fitToSectionDelay:800,scrollBar:!1,easing:"easeInOutCubic",easingcss3:"ease",loopBottom:!0,loopTop:!1,loopHorizontal:!0,continuousVertical:!1,continuousHorizontal:!1,scrollHorizontally:!1,interlockedSlides:!1,dragAndMove:!1,offsetSections:!1,resetSliders:!1,fadingEffect:!1,scrollOverflow:!1,scrollOverflowReset:!1,scrollOverflowOptions:null,touchSensitivity:15,normalScrollElementTouchThreshold:5,bigSectionsDestination:null,keyboardScrolling:!0,animateAnchor:!0,recordHistory:!1,controlArrows:!0,verticalCentered:!0,sectionsColor:["gray","white","#eee","#fff"],responsiveWidth:0,responsiveHeight:0,responsiveSlides:!1,sectionSelector:".section",slideSelector:".slide",lazyLoading:!0})})}),angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.accordion","ui.bootstrap.alert","ui.bootstrap.buttons","ui.bootstrap.carousel","ui.bootstrap.collapse","ui.bootstrap.dialog","ui.bootstrap.dropdownToggle","ui.bootstrap.modal","ui.bootstrap.pagination","ui.bootstrap.popover","ui.bootstrap.tabs","ui.bootstrap.tooltip","ui.bootstrap.transition","ui.bootstrap.typeahead"]),angular.module("ui.bootstrap.tpls",["template/accordion/accordion-group.html","template/accordion/accordion.html","template/alert/alert.html","template/carousel/carousel.html","template/carousel/slide.html","template/dialog/message.html","template/pagination/pagination.html","template/popover/popover.html","template/tabs/pane.html","template/tabs/tabs.html","template/tooltip/tooltip-popup.html","template/typeahead/typeahead.html"]),angular.module("ui.bootstrap.accordion",["ui.bootstrap.collapse"]).constant("accordionConfig",{closeOthers:!0}).controller("AccordionController",["$scope","$attrs","accordionConfig",function($scope,$attrs,accordionConfig){this.groups=[],this.closeOthers=function(openGroup){var closeOthers=angular.isDefined($attrs.closeOthers)?$scope.$eval($attrs.closeOthers):accordionConfig.closeOthers;closeOthers&&angular.forEach(this.groups,function(group){group!==openGroup&&(group.isOpen=!1)})},this.addGroup=function(groupScope){var that=this;this.groups.push(groupScope),groupScope.$on("$destroy",function(event){that.removeGroup(groupScope)})},this.removeGroup=function(group){var index=this.groups.indexOf(group);-1!==index&&this.groups.splice(this.groups.indexOf(group),1)}}]).directive("accordion",function(){return{restrict:"EA",controller:"AccordionController",transclude:!0,replace:!1,templateUrl:"template/accordion/accordion.html"}}).directive("accordionGroup",["$parse","$transition","$timeout",function($parse,$transition,$timeout){return{require:"^accordion",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/accordion/accordion-group.html",scope:{heading:"@"},controller:["$scope",function($scope){this.setHeading=function(element){this.heading=element}}],link:function(scope,element,attrs,accordionCtrl){var getIsOpen,setIsOpen;accordionCtrl.addGroup(scope),scope.isOpen=!1,attrs.isOpen&&(getIsOpen=$parse(attrs.isOpen),setIsOpen=getIsOpen.assign,scope.$watch(function(){return getIsOpen(scope.$parent)},function(value){scope.isOpen=value}),scope.isOpen=getIsOpen?getIsOpen(scope.$parent):!1),scope.$watch("isOpen",function(value){value&&accordionCtrl.closeOthers(scope),setIsOpen&&setIsOpen(scope.$parent,value)})}}}]).directive("accordionHeading",function(){return{restrict:"E",transclude:!0,template:"",replace:!0,require:"^accordionGroup",compile:function(element,attr,transclude){return function(scope,element,attr,accordionGroupCtrl){accordionGroupCtrl.setHeading(transclude(scope,function(){}))}}}}).directive("accordionTransclude",function(){return{require:"^accordionGroup",link:function(scope,element,attr,controller){scope.$watch(function(){return controller[attr.accordionTransclude]},function(heading){heading&&(element.html(""),element.append(heading))})}}}),angular.module("ui.bootstrap.alert",[]).directive("alert",function(){return{restrict:"EA",templateUrl:"template/alert/alert.html",transclude:!0,replace:!0,scope:{type:"=",close:"&"}}}),angular.module("ui.bootstrap.buttons",[]).constant("buttonConfig",{activeClass:"active",toggleEvent:"click"}).directive("btnRadio",["buttonConfig",function(buttonConfig){var activeClass=buttonConfig.activeClass||"active",toggleEvent=buttonConfig.toggleEvent||"click";return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var value=scope.$eval(attrs.btnRadio);scope.$watch(function(){return ngModelCtrl.$modelValue},function(modelValue){angular.equals(modelValue,value)?element.addClass(activeClass):element.removeClass(activeClass)}),element.bind(toggleEvent,function(){element.hasClass(activeClass)||scope.$apply(function(){ngModelCtrl.$setViewValue(value)})})}}}]).directive("btnCheckbox",["buttonConfig",function(buttonConfig){var activeClass=buttonConfig.activeClass||"active",toggleEvent=buttonConfig.toggleEvent||"click";return{require:"ngModel",link:function(scope,element,attrs,ngModelCtrl){var trueValue=scope.$eval(attrs.btnCheckboxTrue),falseValue=scope.$eval(attrs.btnCheckboxFalse);trueValue=angular.isDefined(trueValue)?trueValue:!0,falseValue=angular.isDefined(falseValue)?falseValue:!1,scope.$watch(function(){return ngModelCtrl.$modelValue},function(modelValue){angular.equals(modelValue,trueValue)?element.addClass(activeClass):element.removeClass(activeClass)}),element.bind(toggleEvent,function(){scope.$apply(function(){ngModelCtrl.$setViewValue(element.hasClass(activeClass)?falseValue:trueValue)})})}}}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function($scope,$timeout,$transition,$q){function restartTimer(){function go(){isPlaying?($scope.next(),restartTimer()):$scope.pause()}currentTimeout&&$timeout.cancel(currentTimeout);var interval=+$scope.interval;!isNaN(interval)&&interval>=0&&(currentTimeout=$timeout(go,interval))}var currentTimeout,isPlaying,self=this,slides=self.slides=[],currentIndex=-1;self.currentSlide=null,self.select=function(nextSlide,direction){function goNext(){self.currentSlide&&angular.isString(direction)&&!$scope.noTransition&&nextSlide.$element?(nextSlide.$element.addClass(direction),nextSlide.$element[0].offsetWidth=nextSlide.$element[0].offsetWidth,angular.forEach(slides,function(slide){angular.extend(slide,{direction:"",entering:!1,leaving:!1,active:!1})}),angular.extend(nextSlide,{direction:direction,active:!0,entering:!0}),angular.extend(self.currentSlide||{},{direction:direction,leaving:!0}),$scope.$currentTransition=$transition(nextSlide.$element,{}),function(next,current){$scope.$currentTransition.then(function(){transitionDone(next,current)},function(){transitionDone(next,current)})}(nextSlide,self.currentSlide)):transitionDone(nextSlide,self.currentSlide),self.currentSlide=nextSlide,currentIndex=nextIndex,restartTimer()}function transitionDone(next,current){angular.extend(next,{direction:"",active:!0,leaving:!1,entering:!1}),angular.extend(current||{},{direction:"",active:!1,leaving:!1,entering:!1}),$scope.$currentTransition=null}var nextIndex=slides.indexOf(nextSlide);void 0===direction&&(direction=nextIndex>currentIndex?"next":"prev"),nextSlide&&nextSlide!==self.currentSlide&&($scope.$currentTransition?($scope.$currentTransition.cancel(),$timeout(goNext)):goNext())},self.indexOfSlide=function(slide){return slides.indexOf(slide)},$scope.next=function(){var newIndex=(currentIndex+1)%slides.length;return self.select(slides[newIndex],"next")},$scope.prev=function(){var newIndex=0>currentIndex-1?slides.length-1:currentIndex-1;return self.select(slides[newIndex],"prev")},$scope.select=function(slide){self.select(slide)},$scope.isActive=function(slide){return self.currentSlide===slide},$scope.slides=function(){return slides},$scope.$watch("interval",restartTimer),
$scope.play=function(){isPlaying||(isPlaying=!0,restartTimer())},$scope.pause=function(){isPlaying=!1,currentTimeout&&$timeout.cancel(currentTimeout)},self.addSlide=function(slide,element){slide.$element=element,slides.push(slide),1===slides.length||slide.active?(self.select(slides[slides.length-1]),1==slides.length&&$scope.play()):slide.active=!1},self.removeSlide=function(slide){var index=slides.indexOf(slide);slides.splice(index,1),slides.length>0&&slide.active&&(index>=slides.length?self.select(slides[index-1]):self.select(slides[index]))}}]).directive("carousel",[function(){return{restrict:"EA",transclude:!0,replace:!0,controller:"CarouselController",require:"carousel",templateUrl:"template/carousel/carousel.html",scope:{interval:"=",noTransition:"="}}}]).directive("slide",[function(){return{require:"^carousel",restrict:"EA",transclude:!0,replace:!0,templateUrl:"template/carousel/slide.html",scope:{active:"="},link:function(scope,element,attrs,carouselCtrl){carouselCtrl.addSlide(scope,element),scope.$on("$destroy",function(){carouselCtrl.removeSlide(scope)}),scope.$watch("active",function(active){active&&carouselCtrl.select(scope)})}}}]),angular.module("ui.bootstrap.collapse",["ui.bootstrap.transition"]).directive("collapse",["$transition",function($transition){var fixUpHeight=function(scope,element,height){element.removeClass("collapse"),element.css({height:height});element[0].offsetWidth;element.addClass("collapse")};return{link:function(scope,element,attrs){var isCollapsed,initialAnimSkip=!0;scope.$watch(function(){return element[0].scrollHeight},function(value){0!==element[0].scrollHeight&&(isCollapsed||(initialAnimSkip?fixUpHeight(scope,element,element[0].scrollHeight+"px"):fixUpHeight(scope,element,"auto")))}),scope.$watch(attrs.collapse,function(value){value?collapse():expand()});var currentTransition,doTransition=function(change){return currentTransition&&currentTransition.cancel(),currentTransition=$transition(element,change),currentTransition.then(function(){currentTransition=void 0},function(){currentTransition=void 0}),currentTransition},expand=function(){initialAnimSkip?(initialAnimSkip=!1,isCollapsed||fixUpHeight(scope,element,"auto")):doTransition({height:element[0].scrollHeight+"px"}).then(function(){isCollapsed||fixUpHeight(scope,element,"auto")}),isCollapsed=!1},collapse=function(){isCollapsed=!0,initialAnimSkip?(initialAnimSkip=!1,fixUpHeight(scope,element,0)):(fixUpHeight(scope,element,element[0].scrollHeight+"px"),doTransition({height:"0"}))}}}}]);var dialogModule=angular.module("ui.bootstrap.dialog",["ui.bootstrap.transition"]);dialogModule.controller("MessageBoxController",["$scope","dialog","model",function($scope,dialog,model){$scope.title=model.title,$scope.message=model.message,$scope.buttons=model.buttons,$scope.close=function(res){dialog.close(res)}}]),dialogModule.provider("$dialog",function(){var defaults={backdrop:!0,dialogClass:"modal",backdropClass:"modal-backdrop",transitionClass:"fade",triggerClass:"in",dialogOpenClass:"modal-open",resolve:{},backdropFade:!1,dialogFade:!1,keyboard:!0,backdropClick:!0},globalOptions={},activeBackdrops={value:0};this.options=function(value){globalOptions=value},this.$get=["$http","$document","$compile","$rootScope","$controller","$templateCache","$q","$transition","$injector",function($http,$document,$compile,$rootScope,$controller,$templateCache,$q,$transition,$injector){function createElement(clazz){var el=angular.element("<div>");return el.addClass(clazz),el}function Dialog(opts){var self=this,options=this.options=angular.extend({},defaults,globalOptions,opts);this.backdropEl=createElement(options.backdropClass),options.backdropFade&&(this.backdropEl.addClass(options.transitionClass),this.backdropEl.removeClass(options.triggerClass)),this.modalEl=createElement(options.dialogClass),options.dialogFade&&(this.modalEl.addClass(options.transitionClass),this.modalEl.removeClass(options.triggerClass)),this.handledEscapeKey=function(e){27===e.which&&(self.close(),e.preventDefault(),self.$scope.$apply())},this.handleBackDropClick=function(e){self.close(),e.preventDefault(),self.$scope.$apply()}}var body=$document.find("body");return Dialog.prototype.isOpen=function(){return this._open},Dialog.prototype.open=function(templateUrl,controller){var self=this,options=this.options;if(templateUrl&&(options.templateUrl=templateUrl),controller&&(options.controller=controller),!options.template&&!options.templateUrl)throw new Error("Dialog.open expected template or templateUrl, neither found. Use options or open method to specify them.");return this._loadResolves().then(function(locals){var $scope=locals.$scope=self.$scope=locals.$scope?locals.$scope:$rootScope.$new();if(self.modalEl.html(locals.$template),self.options.controller){var ctrl=$controller(self.options.controller,locals);self.modalEl.contents().data("ngControllerController",ctrl)}$compile(self.modalEl)($scope),self._addElementsToDom(),body.addClass(self.options.dialogOpenClass),setTimeout(function(){self.options.dialogFade&&self.modalEl.addClass(self.options.triggerClass),self.options.backdropFade&&self.backdropEl.addClass(self.options.triggerClass)}),self._bindEvents()}),this.deferred=$q.defer(),this.deferred.promise},Dialog.prototype.close=function(result){function removeTriggerClass(el){el.removeClass(self.options.triggerClass)}function onCloseComplete(){self._open&&self._onCloseComplete(result)}var self=this,fadingElements=this._getFadingElements();if(body.removeClass(self.options.dialogOpenClass),fadingElements.length>0)for(var i=fadingElements.length-1;i>=0;i--)$transition(fadingElements[i],removeTriggerClass).then(onCloseComplete);else this._onCloseComplete(result)},Dialog.prototype._getFadingElements=function(){var elements=[];return this.options.dialogFade&&elements.push(this.modalEl),this.options.backdropFade&&elements.push(this.backdropEl),elements},Dialog.prototype._bindEvents=function(){this.options.keyboard&&body.bind("keydown",this.handledEscapeKey),this.options.backdrop&&this.options.backdropClick&&this.backdropEl.bind("click",this.handleBackDropClick)},Dialog.prototype._unbindEvents=function(){this.options.keyboard&&body.unbind("keydown",this.handledEscapeKey),this.options.backdrop&&this.options.backdropClick&&this.backdropEl.unbind("click",this.handleBackDropClick)},Dialog.prototype._onCloseComplete=function(result){this._removeElementsFromDom(),this._unbindEvents(),this.deferred.resolve(result)},Dialog.prototype._addElementsToDom=function(){body.append(this.modalEl),this.options.backdrop&&(0===activeBackdrops.value&&body.append(this.backdropEl),activeBackdrops.value++),this._open=!0},Dialog.prototype._removeElementsFromDom=function(){this.modalEl.remove(),this.options.backdrop&&(activeBackdrops.value--,0===activeBackdrops.value&&this.backdropEl.remove()),this._open=!1},Dialog.prototype._loadResolves=function(){var templatePromise,values=[],keys=[],self=this;return this.options.template?templatePromise=$q.when(this.options.template):this.options.templateUrl&&(templatePromise=$http.get(this.options.templateUrl,{cache:$templateCache}).then(function(response){return response.data})),angular.forEach(this.options.resolve||[],function(value,key){keys.push(key),values.push(angular.isString(value)?$injector.get(value):$injector.invoke(value))}),keys.push("$template"),values.push(templatePromise),$q.all(values).then(function(values){var locals={};return angular.forEach(values,function(value,index){locals[keys[index]]=value}),locals.dialog=self,locals})},{dialog:function(opts){return new Dialog(opts)},messageBox:function(title,message,buttons){return new Dialog({templateUrl:"template/dialog/message.html",controller:"MessageBoxController",resolve:{model:function(){return{title:title,message:message,buttons:buttons}}}})}}}]}),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location","$window",function($document,$location,$window){var close,openElement=null;return{restrict:"CA",link:function(scope,element,attrs){scope.$watch(function(){return $location.path()},function(){close&&close()}),element.parent().bind("click",function(event){close&&close()}),element.bind("click",function(event){event.preventDefault(),event.stopPropagation();var iWasOpen=!1;openElement&&(iWasOpen=openElement===element,close()),iWasOpen||(element.parent().addClass("open"),openElement=element,close=function(event){event&&(event.preventDefault(),event.stopPropagation()),$document.unbind("click",close),element.parent().removeClass("open"),close=null,openElement=null},$document.bind("click",close))})}}}]),angular.module("ui.bootstrap.modal",["ui.bootstrap.dialog"]).directive("modal",["$parse","$dialog",function($parse,$dialog){angular.element(document.getElementsByTagName("body")[0]);return{restrict:"EA",terminal:!0,link:function(scope,elm,attrs){var setClosed,opts=angular.extend({},scope.$eval(attrs.uiOptions||attrs.bsOptions||attrs.options)),shownExpr=attrs.modal||attrs.show;opts=angular.extend(opts,{template:elm.html(),resolve:{$scope:function(){return scope}}});var dialog=$dialog.dialog(opts);elm.remove(),setClosed=attrs.close?function(){$parse(attrs.close)(scope)}:function(){angular.isFunction($parse(shownExpr).assign)&&$parse(shownExpr).assign(scope,!1)},scope.$watch(shownExpr,function(isShown,oldShown){isShown?dialog.open().then(function(){setClosed()}):dialog.isOpen()&&dialog.close()})}}}]),angular.module("ui.bootstrap.pagination",[]).constant("paginationConfig",{boundaryLinks:!1,directionLinks:!0,firstText:"First",previousText:"Previous",nextText:"Next",lastText:"Last"}).directive("pagination",["paginationConfig",function(paginationConfig){return{restrict:"EA",scope:{numPages:"=",currentPage:"=",maxSize:"=",onSelectPage:"&"},templateUrl:"template/pagination/pagination.html",replace:!0,link:function(scope,element,attrs){function makePage(number,text,isActive,isDisabled){return{number:number,text:text,active:isActive,disabled:isDisabled}}var boundaryLinks=angular.isDefined(attrs.boundaryLinks)?scope.$eval(attrs.boundaryLinks):paginationConfig.boundaryLinks,directionLinks=angular.isDefined(attrs.directionLinks)?scope.$eval(attrs.directionLinks):paginationConfig.directionLinks,firstText=angular.isDefined(attrs.firstText)?attrs.firstText:paginationConfig.firstText,previousText=angular.isDefined(attrs.previousText)?attrs.previousText:paginationConfig.previousText,nextText=angular.isDefined(attrs.nextText)?attrs.nextText:paginationConfig.nextText,lastText=angular.isDefined(attrs.lastText)?attrs.lastText:paginationConfig.lastText;scope.$watch("numPages + currentPage + maxSize",function(){scope.pages=[];var maxSize=scope.maxSize&&scope.maxSize<scope.numPages?scope.maxSize:scope.numPages,startPage=scope.currentPage-Math.floor(maxSize/2);1>startPage&&(startPage=1),startPage+maxSize-1>scope.numPages&&(startPage-=startPage+maxSize-1-scope.numPages);for(var number=startPage,max=startPage+maxSize;max>number;number++){var page=makePage(number,number,scope.isActive(number),!1);scope.pages.push(page)}if(directionLinks){var previousPage=makePage(scope.currentPage-1,previousText,!1,scope.noPrevious());scope.pages.unshift(previousPage);var nextPage=makePage(scope.currentPage+1,nextText,!1,scope.noNext());scope.pages.push(nextPage)}if(boundaryLinks){var firstPage=makePage(1,firstText,!1,scope.noPrevious());scope.pages.unshift(firstPage);var lastPage=makePage(scope.numPages,lastText,!1,scope.noNext());scope.pages.push(lastPage)}scope.currentPage>scope.numPages&&scope.selectPage(scope.numPages)}),scope.noPrevious=function(){return 1===scope.currentPage},scope.noNext=function(){return scope.currentPage===scope.numPages},scope.isActive=function(page){return scope.currentPage===page},scope.selectPage=function(page){!scope.isActive(page)&&page>0&&page<=scope.numPages&&(scope.currentPage=page,scope.onSelectPage({page:page}))}}}}]),angular.module("ui.bootstrap.popover",[]).directive("popoverPopup",function(){return{restrict:"EA",replace:!0,scope:{popoverTitle:"@",popoverContent:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/popover/popover.html"}}).directive("popover",["$compile","$timeout","$parse","$window",function($compile,$timeout,$parse,$window){var template='<popover-popup popover-title="{{tt_title}}" popover-content="{{tt_popover}}" placement="{{tt_placement}}" animation="tt_animation()" is-open="tt_isOpen"></popover-popup>';return{scope:!0,link:function(scope,element,attr){function getPosition(){var boundingClientRect=element[0].getBoundingClientRect();return{width:element.prop("offsetWidth"),height:element.prop("offsetHeight"),top:boundingClientRect.top+$window.pageYOffset,left:boundingClientRect.left+$window.pageXOffset}}function show(){var position,ttWidth,ttHeight,ttPosition;switch(transitionTimeout&&$timeout.cancel(transitionTimeout),popover.css({top:0,left:0,display:"block"}),element.after(popover),position=getPosition(),ttWidth=popover.prop("offsetWidth"),ttHeight=popover.prop("offsetHeight"),scope.tt_placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left+position.width+"px"};break;case"bottom":ttPosition={top:position.top+position.height+"px",left:position.left+position.width/2-ttWidth/2+"px"};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left-ttWidth+"px"};break;default:ttPosition={top:position.top-ttHeight+"px",left:position.left+position.width/2-ttWidth/2+"px"}}popover.css(ttPosition),scope.tt_isOpen=!0}function hide(){scope.tt_isOpen=!1,angular.isDefined(scope.tt_animation)&&scope.tt_animation()?transitionTimeout=$timeout(function(){popover.remove()},500):popover.remove()}var transitionTimeout,popover=$compile(template)(scope);attr.$observe("popover",function(val){scope.tt_popover=val}),attr.$observe("popoverTitle",function(val){scope.tt_title=val}),attr.$observe("popoverPlacement",function(val){scope.tt_placement=val||"top"}),attr.$observe("popoverAnimation",function(val){scope.tt_animation=$parse(val)}),scope.tt_isOpen=!1,element.bind("click",function(){scope.tt_isOpen?scope.$apply(hide):scope.$apply(show)})}}}]),angular.module("ui.bootstrap.tabs",[]).controller("TabsController",["$scope","$element",function($scope,$element){var panes=$scope.panes=[];this.select=$scope.select=function(pane){angular.forEach(panes,function(pane){pane.selected=!1}),pane.selected=!0},this.addPane=function(pane){panes.length||$scope.select(pane),panes.push(pane)},this.removePane=function(pane){var index=panes.indexOf(pane);panes.splice(index,1),pane.selected&&panes.length>0&&$scope.select(panes[index<panes.length?index:index-1])}}]).directive("tabs",function(){return{restrict:"EA",transclude:!0,scope:{},controller:"TabsController",templateUrl:"template/tabs/tabs.html",replace:!0}}).directive("pane",["$parse",function($parse){return{require:"^tabs",restrict:"EA",transclude:!0,scope:{heading:"@"},link:function(scope,element,attrs,tabsCtrl){var getSelected,setSelected;scope.selected=!1,attrs.active&&(getSelected=$parse(attrs.active),setSelected=getSelected.assign,scope.$watch(function(){return getSelected(scope.$parent)},function(value){scope.selected=value}),scope.selected=getSelected?getSelected(scope.$parent):!1),scope.$watch("selected",function(selected){selected&&tabsCtrl.select(scope),setSelected&&setSelected(scope.$parent,selected)}),tabsCtrl.addPane(scope),scope.$on("$destroy",function(){tabsCtrl.removePane(scope)})},templateUrl:"template/tabs/pane.html",replace:!0}}]),angular.module("ui.bootstrap.tooltip",[]).directive("tooltipPopup",function(){return{restrict:"EA",replace:!0,scope:{tooltipTitle:"@",placement:"@",animation:"&",isOpen:"&"},templateUrl:"template/tooltip/tooltip-popup.html"}}).directive("tooltip",["$compile","$timeout","$parse","$window",function($compile,$timeout,$parse,$window){var template='<tooltip-popup tooltip-title="{{tt_tooltip}}" placement="{{tt_placement}}" animation="tt_animation()" is-open="tt_isOpen"></tooltip-popup>';return{scope:!0,link:function(scope,element,attr){function getPosition(){var boundingClientRect=element[0].getBoundingClientRect();return{width:element.prop("offsetWidth"),height:element.prop("offsetHeight"),top:boundingClientRect.top+$window.pageYOffset,left:boundingClientRect.left+$window.pageXOffset}}function show(){var position,ttWidth,ttHeight,ttPosition;if(scope.tt_tooltip){switch(transitionTimeout&&$timeout.cancel(transitionTimeout),tooltip.css({top:0,left:0,display:"block"}),element.after(tooltip),position=getPosition(),ttWidth=tooltip.prop("offsetWidth"),ttHeight=tooltip.prop("offsetHeight"),scope.tt_placement){case"right":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left+position.width+"px"};break;case"bottom":ttPosition={top:position.top+position.height+"px",left:position.left+position.width/2-ttWidth/2+"px"};break;case"left":ttPosition={top:position.top+position.height/2-ttHeight/2+"px",left:position.left-ttWidth+"px"};break;default:ttPosition={top:position.top-ttHeight+"px",left:position.left+position.width/2-ttWidth/2+"px"}}tooltip.css(ttPosition),scope.tt_isOpen=!0}}function hide(){scope.tt_isOpen=!1,angular.isDefined(scope.tt_animation)&&scope.tt_animation()?transitionTimeout=$timeout(function(){tooltip.remove()},500):tooltip.remove()}var transitionTimeout,tooltip=$compile(template)(scope);attr.$observe("tooltip",function(val){scope.tt_tooltip=val}),attr.$observe("tooltipPlacement",function(val){scope.tt_placement=val||"top"}),attr.$observe("tooltipAnimation",function(val){scope.tt_animation=$parse(val)}),scope.tt_isOpen=!1,element.bind("mouseenter",function(){scope.$apply(show)}),element.bind("mouseleave",function(){scope.$apply(hide)})}}}]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function($q,$timeout,$rootScope){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(event){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",msTransition:"MSAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),angular.module("ui.bootstrap.typeahead",[]).factory("typeaheadParser",["$parse",function($parse){var TYPEAHEAD_REGEXP=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(input){var match=input.match(TYPEAHEAD_REGEXP);if(!match)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+input+"'.");return{itemName:match[3],source:$parse(match[4]),viewMapper:$parse(match[2]||match[1]),modelMapper:$parse(match[1])}}}}]).directive("typeahead",["$compile","$q","typeaheadParser",function($compile,$q,typeaheadParser){var HOT_KEYS=[9,13,27,38,40];return{require:"ngModel",link:function(originalScope,element,attrs,modelCtrl){var selected=modelCtrl.$modelValue,minSearch=originalScope.$eval(attrs.typeaheadMinLength)||1,parserResult=typeaheadParser.parse(attrs.typeahead),scope=originalScope.$new();originalScope.$on("$destroy",function(){scope.$destroy()});var resetMatches=function(){scope.matches=[],scope.activeIdx=-1},getMatchesAsync=function(inputValue){var locals={$viewValue:inputValue};$q.when(parserResult.source(scope,locals)).then(function(matches){if(inputValue===modelCtrl.$viewValue)if(matches.length>0){scope.activeIdx=0,scope.matches.length=0;for(var i=0;i<matches.length;i++)locals[parserResult.itemName]=matches[i],scope.matches.push({label:parserResult.viewMapper(scope,locals),model:matches[i]});scope.query=inputValue}else resetMatches()},resetMatches)};resetMatches(),scope.query=void 0,modelCtrl.$parsers.push(function(inputValue){return resetMatches(),selected?inputValue:void(inputValue&&inputValue.length>=minSearch&&getMatchesAsync(inputValue))}),modelCtrl.$render=function(){var locals={};locals[parserResult.itemName]=selected,element.val(parserResult.viewMapper(scope,locals)||modelCtrl.$viewValue),selected=void 0},scope.select=function(activeIdx){var locals={};locals[parserResult.itemName]=selected=scope.matches[activeIdx].model,modelCtrl.$setViewValue(parserResult.modelMapper(scope,locals)),modelCtrl.$render()},element.bind("keydown",function(evt){0!==scope.matches.length&&-1!==HOT_KEYS.indexOf(evt.which)&&(evt.preventDefault(),40===evt.which?(scope.activeIdx=(scope.activeIdx+1)%scope.matches.length,scope.$digest()):38===evt.which?(scope.activeIdx=(scope.activeIdx?scope.activeIdx:scope.matches.length)-1,scope.$digest()):13===evt.which||9===evt.which?scope.$apply(function(){scope.select(scope.activeIdx)}):27===evt.which&&(scope.matches=[],scope.$digest()))});var tplElCompiled=$compile("<typeahead-popup matches='matches' active='activeIdx' select='select(activeIdx)' query='query'></typeahead-popup>")(scope);element.after(tplElCompiled)}}}]).directive("typeaheadPopup",function(){return{restrict:"E",scope:{matches:"=",query:"=",active:"=",select:"&"},replace:!0,templateUrl:"template/typeahead/typeahead.html",link:function(scope,element,attrs){scope.isOpen=function(){return scope.matches.length>0},scope.isActive=function(matchIdx){return scope.active==matchIdx},scope.selectActive=function(matchIdx){scope.active=matchIdx},scope.selectMatch=function(activeIdx){scope.select({activeIdx:activeIdx})}}}}).filter("typeaheadHighlight",function(){return function(matchItem,query){return query?matchItem.replace(new RegExp(query,"gi"),"<strong>$&</strong>"):query}}),angular.module("template/accordion/accordion-group.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion-group.html",'<div class="accordion-group">  <div class="accordion-heading" ><a class="accordion-toggle" ng-click="isOpen = !isOpen" accordion-transclude="heading">{{heading}}</a></div>  <div class="accordion-body" collapse="!isOpen">    <div class="accordion-inner" ng-transclude></div>  </div></div>')}]),angular.module("template/accordion/accordion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/accordion/accordion.html",'<div class="accordion" ng-transclude></div>')}]),angular.module("template/alert/alert.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/alert/alert.html","<div class='alert' ng-class='type && \"alert-\" + type'>    <button type='button' class='close' ng-click='close()'>&times;</button>    <div ng-transclude></div></div>")}]),angular.module("template/carousel/carousel.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/carousel.html",'<div ng-mouseenter="pause()" ng-mouseleave="play()" class="carousel">    <ol class="carousel-indicators">        <li ng-repeat="slide in slides()" ng-class="{active: isActive(slide)}" ng-click="select(slide)"></li>    </ol>    <div class="carousel-inner" ng-transclude></div></div>')}]),angular.module("template/carousel/slide.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/carousel/slide.html","<div ng-class=\"{    'active': leaving || (active && !entering),    'prev': (next || active) && direction=='prev',    'next': (next || active) && direction=='next',    'right': direction=='prev',    'left': direction=='next'  }\" class=\"item\" ng-transclude></div>")}]),angular.module("template/dialog/message.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/dialog/message.html",'<div class="modal-header">	<h1>{{ title }}</h1></div><div class="modal-body">	<p>{{ message }}</p></div><div class="modal-footer">	<button ng-repeat="btn in buttons" ng-click="close(btn.result)" class=btn ng-class="btn.cssClass">{{ btn.label }}</button></div>')}]),angular.module("template/pagination/pagination.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/pagination/pagination.html",'<div class="pagination"><ul>  <li ng-repeat="page in pages" ng-class="{active: page.active, disabled: page.disabled}"><a ng-click="selectPage(page.number)">{{page.text}}</a></li>  </ul></div>')}]),angular.module("template/popover/popover.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/popover/popover.html",'<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">  <div class="arrow"></div>  <div class="popover-inner">      <h3 class="popover-title" ng-bind="popoverTitle" ng-show="popoverTitle"></h3>      <div class="popover-content" ng-bind="popoverContent"></div>  </div></div>')}]),angular.module("template/tabs/pane.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/pane.html",'<div class="tab-pane" ng-class="{active: selected}" ng-show="selected" ng-transclude></div>')}]),angular.module("template/tabs/tabs.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tabs/tabs.html",'<div class="tabbable">  <ul class="nav nav-tabs">    <li ng-repeat="pane in panes" ng-class="{active:pane.selected}">      <a href="" ng-click="select(pane)">{{pane.heading}}</a>    </li>  </ul>  <div class="tab-content" ng-transclude></div></div>')}]),angular.module("template/tooltip/tooltip-popup.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/tooltip/tooltip-popup.html",'<div class="tooltip {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">  <div class="tooltip-arrow"></div>  <div class="tooltip-inner" ng-bind="tooltipTitle"></div></div>')}]),angular.module("template/typeahead/typeahead.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/typeahead/typeahead.html",'<div class="dropdown clearfix" ng-class="{open: isOpen()}">    <ul class="typeahead dropdown-menu">        <li ng-repeat="match in matches" ng-class="{active: isActive($index) }" ng-mouseenter="selectActive($index)">            <a tabindex="-1" ng-click="selectMatch($index)" ng-bind-html-unsafe="match.label | typeaheadHighlight:query"></a>        </li>    </ul></div>')}]),!function(){"use strict";function e(n){return"undefined"==typeof this||Object.getPrototypeOf(this)!==e.prototype?new e(n):(O=this,O.version="3.3.2",O.tools=new E,O.isSupported()?(O.tools.extend(O.defaults,n||{}),O.defaults.container=t(O.defaults),O.store={elements:{},containers:[]},O.sequences={},O.history=[],O.uid=0,O.initialized=!1):"undefined"!=typeof console&&null!==console,O)}function t(e){if(e&&e.container){if("string"==typeof e.container)return window.document.documentElement.querySelector(e.container);if(O.tools.isNode(e.container))return e.container}return O.defaults.container}function n(e,t){return"string"==typeof e?Array.prototype.slice.call(t.querySelectorAll(e)):O.tools.isNode(e)?[e]:O.tools.isNodeList(e)?Array.prototype.slice.call(e):[]}function i(){return++O.uid}function o(e,t,n){t.container&&(t.container=n),e.config?e.config=O.tools.extendClone(e.config,t):e.config=O.tools.extendClone(O.defaults,t),"top"===e.config.origin||"bottom"===e.config.origin?e.config.axis="Y":e.config.axis="X"}function r(e){var t=window.getComputedStyle(e.domEl);e.styles||(e.styles={transition:{},transform:{},computed:{}},e.styles.inline=e.domEl.getAttribute("style")||"",e.styles.inline+="; visibility: visible; ",e.styles.computed.opacity=t.opacity,t.transition&&"all 0s ease 0s"!==t.transition?e.styles.computed.transition=t.transition+", ":e.styles.computed.transition=""),e.styles.transition.instant=s(e,0),e.styles.transition.delayed=s(e,e.config.delay),e.styles.transform.initial=" -webkit-transform:",e.styles.transform.target=" -webkit-transform:",a(e),e.styles.transform.initial+="transform:",e.styles.transform.target+="transform:",a(e)}function s(e,t){var n=e.config;return"-webkit-transition: "+e.styles.computed.transition+"-webkit-transform "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s, opacity "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s; transition: "+e.styles.computed.transition+"transform "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s, opacity "+n.duration/1e3+"s "+n.easing+" "+t/1e3+"s; "}function a(e){var t,n=e.config,i=e.styles.transform;t="top"===n.origin||"left"===n.origin?/^-/.test(n.distance)?n.distance.substr(1):"-"+n.distance:n.distance,parseInt(n.distance)&&(i.initial+=" translate"+n.axis+"("+t+")",i.target+=" translate"+n.axis+"(0)"),n.scale&&(i.initial+=" scale("+n.scale+")",i.target+=" scale(1)"),n.rotate.x&&(i.initial+=" rotateX("+n.rotate.x+"deg)",i.target+=" rotateX(0)"),n.rotate.y&&(i.initial+=" rotateY("+n.rotate.y+"deg)",i.target+=" rotateY(0)"),n.rotate.z&&(i.initial+=" rotateZ("+n.rotate.z+"deg)",i.target+=" rotateZ(0)"),i.initial+="; opacity: "+n.opacity+";",i.target+="; opacity: "+e.styles.computed.opacity+";"}function l(e){var t=e.config.container;t&&-1===O.store.containers.indexOf(t)&&O.store.containers.push(e.config.container),O.store.elements[e.id]=e}function c(e,t,n){var i={target:e,config:t,interval:n};O.history.push(i)}function f(){if(O.isSupported()){y();for(var e=0;e<O.store.containers.length;e++)O.store.containers[e].addEventListener("scroll",d),O.store.containers[e].addEventListener("resize",d);O.initialized||(window.addEventListener("scroll",d),window.addEventListener("resize",d),O.initialized=!0)}return O}function d(){T(y)}function u(){var e,t,n,i;O.tools.forOwn(O.sequences,function(o){i=O.sequences[o],e=!1;for(var r=0;r<i.elemIds.length;r++)n=i.elemIds[r],t=O.store.elements[n],q(t)&&!e&&(e=!0);i.active=e})}function y(){var e,t;u(),O.tools.forOwn(O.store.elements,function(n){t=O.store.elements[n],e=w(t),g(t)?(t.config.beforeReveal(t.domEl),e?t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.target+t.styles.transition.delayed):t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.target+t.styles.transition.instant),p("reveal",t,e),t.revealing=!0,t.seen=!0,t.sequence&&m(t,e)):v(t)&&(t.config.beforeReset(t.domEl),t.domEl.setAttribute("style",t.styles.inline+t.styles.transform.initial+t.styles.transition.instant),p("reset",t),t.revealing=!1)})}function m(e,t){var n=0,i=0,o=O.sequences[e.sequence.id];o.blocked=!0,t&&"onload"===e.config.useDelay&&(i=e.config.delay),e.sequence.timer&&(n=Math.abs(e.sequence.timer.started-new Date),window.clearTimeout(e.sequence.timer)),e.sequence.timer={started:new Date},e.sequence.timer.clock=window.setTimeout(function(){o.blocked=!1,e.sequence.timer=null,d()},Math.abs(o.interval)+i-n)}function p(e,t,n){var i=0,o=0,r="after";switch(e){case"reveal":o=t.config.duration,n&&(o+=t.config.delay),r+="Reveal";break;case"reset":o=t.config.duration,r+="Reset"}t.timer&&(i=Math.abs(t.timer.started-new Date),window.clearTimeout(t.timer.clock)),t.timer={started:new Date},t.timer.clock=window.setTimeout(function(){t.config[r](t.domEl),t.timer=null},o-i)}function g(e){if(e.sequence){var t=O.sequences[e.sequence.id];return t.active&&!t.blocked&&!e.revealing&&!e.disabled;
}return q(e)&&!e.revealing&&!e.disabled}function w(e){var t=e.config.useDelay;return"always"===t||"onload"===t&&!O.initialized||"once"===t&&!e.seen}function v(e){if(e.sequence){var t=O.sequences[e.sequence.id];return!t.active&&e.config.reset&&e.revealing&&!e.disabled}return!q(e)&&e.config.reset&&e.revealing&&!e.disabled}function b(e){return{width:e.clientWidth,height:e.clientHeight}}function h(e){if(e&&e!==window.document.documentElement){var t=x(e);return{x:e.scrollLeft+t.left,y:e.scrollTop+t.top}}return{x:window.pageXOffset,y:window.pageYOffset}}function x(e){var t=0,n=0,i=e.offsetHeight,o=e.offsetWidth;do isNaN(e.offsetTop)||(t+=e.offsetTop),isNaN(e.offsetLeft)||(n+=e.offsetLeft),e=e.offsetParent;while(e);return{top:t,left:n,height:i,width:o}}function q(e){function t(){var t=c+a*s,n=f+l*s,i=d-a*s,y=u-l*s,m=r.y+e.config.viewOffset.top,p=r.x+e.config.viewOffset.left,g=r.y-e.config.viewOffset.bottom+o.height,w=r.x-e.config.viewOffset.right+o.width;return g>t&&i>m&&n>p&&w>y}function n(){return"fixed"===window.getComputedStyle(e.domEl).position}var i=x(e.domEl),o=b(e.config.container),r=h(e.config.container),s=e.config.viewFactor,a=i.height,l=i.width,c=i.top,f=i.left,d=c+a,u=f+l;return t()||n()}function E(){}var O,T;e.prototype.defaults={origin:"bottom",distance:"20px",duration:500,delay:0,rotate:{x:0,y:0,z:0},opacity:0,scale:.9,easing:"cubic-bezier(0.6, 0.2, 0.1, 1)",container:window.document.documentElement,mobile:!0,reset:!1,useDelay:"always",viewFactor:.2,viewOffset:{top:0,right:0,bottom:0,left:0},beforeReveal:function(e){},beforeReset:function(e){},afterReveal:function(e){},afterReset:function(e){}},e.prototype.isSupported=function(){var e=document.documentElement.style;return"WebkitTransition"in e&&"WebkitTransform"in e||"transition"in e&&"transform"in e},e.prototype.reveal=function(e,s,a,d){var u,y,m,p,g,w;if(void 0!==s&&"number"==typeof s?(a=s,s={}):void 0!==s&&null!==s||(s={}),u=t(s),y=n(e,u),!y.length)return O;a&&"number"==typeof a&&(w=i(),g=O.sequences[w]={id:w,interval:a,elemIds:[],active:!1});for(var v=0;v<y.length;v++)p=y[v].getAttribute("data-sr-id"),p?m=O.store.elements[p]:(m={id:i(),domEl:y[v],seen:!1,revealing:!1},m.domEl.setAttribute("data-sr-id",m.id)),g&&(m.sequence={id:g.id,index:g.elemIds.length},g.elemIds.push(m.id)),o(m,s,u),r(m),l(m),O.tools.isMobile()&&!m.config.mobile||!O.isSupported()?(m.domEl.setAttribute("style",m.styles.inline),m.disabled=!0):m.revealing||m.domEl.setAttribute("style",m.styles.inline+m.styles.transform.initial);return!d&&O.isSupported()&&(c(e,s,a),O.initTimeout&&window.clearTimeout(O.initTimeout),O.initTimeout=window.setTimeout(f,0)),O},e.prototype.sync=function(){if(O.history.length&&O.isSupported()){for(var e=0;e<O.history.length;e++){var t=O.history[e];O.reveal(t.target,t.config,t.interval,!0)}f()}return O},E.prototype.isObject=function(e){return null!==e&&"object"==typeof e&&e.constructor===Object},E.prototype.isNode=function(e){return"object"==typeof window.Node?e instanceof window.Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName},E.prototype.isNodeList=function(e){var t=Object.prototype.toString.call(e),n=/^\[object (HTMLCollection|NodeList|Object)\]$/;return"object"==typeof window.NodeList?e instanceof window.NodeList:e&&"object"==typeof e&&n.test(t)&&"number"==typeof e.length&&(0===e.length||this.isNode(e[0]))},E.prototype.forOwn=function(e,t){if(!this.isObject(e))throw new TypeError('Expected "object", but received "'+typeof e+'".');for(var n in e)e.hasOwnProperty(n)&&t(n)},E.prototype.extend=function(e,t){return this.forOwn(t,function(n){this.isObject(t[n])?(e[n]&&this.isObject(e[n])||(e[n]={}),this.extend(e[n],t[n])):e[n]=t[n]}.bind(this)),e},E.prototype.extendClone=function(e,t){return this.extend(this.extend({},e),t)},E.prototype.isMobile=function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},T=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:window.ScrollReveal=e}(),!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery)}(function(t){function e(e,a){var o,l,d,r,c,u,h,p,f,m=this.data(),y=this.find("ul"),g=!1;if(m.vals&&0!==y.length){for(e||(e=m.seconds),m.intervalId&&(g=!0,clearTimeout(m.intervalId)),o=Math.floor(e/s),l=o*s,d=Math.floor((e-l)/n),l+=d*n,r=Math.floor((e-l)/60),l+=60*r,c=e-l,u=(100>o?"0"+(10>o?"0":""):"")+o+(10>d?"0":"")+d+(10>r?"0":"")+r+(10>c?"0":"")+c,h=m.vals.length-1,p=u.length-1;h>=0;h-=1,p-=1)f=parseInt(u.substr(p,1),10),m.vals[h]=f,y.eq(h).children().html(f);(g||a)&&(m.ttStartTime=t.now(),m.intervalId=setTimeout(i.bind(this),1e3),this.data("intervalId",m.intervalId))}}function i(e){var s,n,a,o,l,d,r=this,c=this.find("ul"),u=this.data();return u.vals&&0!==c.length?("undefined"==typeof e&&(e=u.iSec),s=u.vals[e],n=c.eq(e),a=n.children(),o=u.countdown?-1:1,a.eq(1).html(s),s+=o,e===u.iSec&&(l=u.tickTimeout,d=t.now()-u.ttStartTime,u.sec+=o,l+=Math.abs(u.seconds-u.sec)*l-d,u.intervalId=setTimeout(i.bind(this),l)),(0>s||s>u.limits[e])&&(0>s?(s=u.limits[e],e===u.iHour&&u.displayDays>0&&e>0&&0===u.vals[e-1]&&(s=3)):s=0,e>0&&i.call(this,e-1)),a.eq(0).html(s),t.support.transition?(n.addClass("transition"),n.css({top:0}),setTimeout(function(){n.removeClass("transition"),a.eq(1).html(s),n.css({top:"-"+u.height+"px"}),o>0||e!==u.iSec||(u.sec===u.countdownAlertLimit&&c.parent().addClass("timeTo-alert"),0===u.sec&&(c.parent().removeClass("timeTo-alert"),u.intervalId&&(clearTimeout(u.intervalId),r.data("intervalId",null)),"function"==typeof u.callback&&u.callback()))},410)):n.stop().animate({top:0},400,e!==u.iSec?null:function(){a.eq(1).html(s),n.css({top:"-"+u.height+"px"}),o>0||e!==u.iSec||(u.sec===u.countdownAlertLimit?c.parent().addClass("timeTo-alert"):0===u.sec&&(c.parent().removeClass("timeTo-alert"),u.intervalId&&(clearTimeout(u.intervalId),r.data("intervalId",null)),"function"==typeof u.callback&&u.callback()))}),void(u.vals[e]=s)):(u.intervalId&&(clearTimeout(u.intervalId),this.data("intervalId",null)),void(u.callback&&u.callback()))}var s=86400,n=3600,a={callback:null,captionSize:0,countdown:!0,countdownAlertLimit:10,displayCaptions:!1,displayDays:0,displayHours:!0,fontFamily:"Verdana, sans-serif",fontSize:0,lang:"en",languages:{},seconds:0,start:!0,theme:"white",width:25,height:30,gap:11,vals:[0,0,0,0,0,0,0,0,0],limits:[9,9,9,2,9,5,9,5,9],iSec:8,iHour:4,tickTimeout:1e3,intervalId:null},o={start:function(s){var n;s&&(e.call(this,s),n=setTimeout(i.bind(this),1e3),this.data("ttStartTime",t.now()),this.data("intervalId",n))},stop:function(){var t=this.data();return t.intervalId&&(clearTimeout(t.intervalId),this.data("intervalId",null)),t},reset:function(t){var i=o.stop.call(this),s="undefined"==typeof t?i.seconds:t;this.find("div").css({backgroundPosition:"left center"}),this.find("ul").parent().removeClass("timeTo-alert"),e.call(this,s,!0)}},l={en:{days:"days",hours:"hours",min:"minutes",sec:"seconds"},ru:{days:"дней",hours:"часов",min:"минут",sec:"секунд"},ua:{days:"днiв",hours:"годин",min:"хвилин",sec:"секунд"},de:{days:"Tag",hours:"Uhr",min:"Minuten",sec:"Secunden"},fr:{days:"jours",hours:"heures",min:"minutes",sec:"secondes"},sp:{days:"días",hours:"horas",min:"minutos",sec:"segundos"},it:{days:"giorni",hours:"ore",min:"minuti",sec:"secondi"},nl:{days:"dagen",hours:"uren",min:"minuten",sec:"seconden"},no:{days:"dager",hours:"timer",min:"minutter",sec:"sekunder"},pt:{days:"dias",hours:"horas",min:"minutos",sec:"segundos"},tr:{days:"gün",hours:"saat",min:"dakika",sec:"saniye"}};return"undefined"==typeof t.support.transition&&(t.support.transition=function(){var t=document.body||document.documentElement,e=t.style,i=void 0!==e.transition||void 0!==e.WebkitTransition||void 0!==e.MozTransition||void 0!==e.MsTransition||void 0!==e.OTransition;return i}()),t.fn.timeTo=function(){var i,d,r,c,u,h,p,f,m,y,g={},v=t.now();for(i=0;i<arguments.length;i+=1)d=arguments[i],0===i&&"string"==typeof d?c=d:"object"==typeof d?"function"==typeof d.getTime?g.timeTo=d:g=t.extend(g,d):"function"==typeof d?g.callback=d:(r=parseInt(d,10),isNaN(r)||(g.seconds=r));if(g.timeTo)g.timeTo.getTime?u=g.timeTo.getTime():"number"==typeof g.timeTo&&(u=g.timeTo),u>v?g.seconds=Math.floor((u-v)/1e3):g.seconds=0;else if(g.time||!g.seconds)if(u=g.time,u||(u=new Date),"object"==typeof u&&u.getTime)g.seconds=u.getHours()*n+60*u.getMinutes()+u.getSeconds(),g.countdown=!1;else if("string"==typeof u){for(p=u.split(":"),f=0,m=1;p.length;)y=p.pop(),f+=y*m,m*=60;g.seconds=f,g.countdown=!1}return g.countdown!==!1&&g.seconds>s&&"undefined"==typeof g.displayDays?(h=Math.floor(g.seconds/s),g.displayDays=10>h&&1||100>h&&2||3):g.displayDays===!0?g.displayDays=3:g.displayDays&&(g.displayDays=g.displayDays>0?Math.floor(g.displayDays):3),this.each(function(){var i,s,n,d,r,u,h,p,f,m,y,v,T,I,w,S,x,b,M,k,D,z,C=t(this),$=C.data();if($.intervalId&&(clearInterval($.intervalId),$.intervalId=null),$.vals)"reset"!==c&&t.extend($,g);else{if(s=$.opt?$.options:g,i=Object.keys(a).reduce(function(t,e){return Array.isArray(a[e])?t[e]=a[e].slice(0):t[e]=a[e],t},{}),$=t.extend(i,s),$.options=s,$.height=Math.round(100*$.fontSize/93)||$.height,$.width=Math.round(.8*$.fontSize+.13*$.height)||$.width,$.displayHours=!(!$.displayDays&&!$.displayHours),d={fontFamily:$.fontFamily},$.fontSize>0&&(d.fontSize=$.fontSize+"px"),r=$.languages[$.lang]||l[$.lang],C.addClass("timeTo").addClass("timeTo-"+$.theme).css(d),u=Math.round($.height/10),h='<ul style="left:'+u+"px; top:-"+$.height+'px"><li>0</li><li>0</li></ul></div>',p=$.fontSize?' style="width:'+$.width+"px; height:"+$.height+'px;"':' style=""',f='<div class="first"'+p+">"+h,m="<div"+p+">"+h,y="<span>:</span>",v=Math.round(2*$.width+3),T=$.captionSize||$.fontSize&&Math.round(.43*$.fontSize),I=T?"font-size:"+T+"px;":"",w=T?' style="'+I+'"':"",S=($.displayCaptions?($.displayHours?'<figure style="max-width:'+v+'px">$1<figcaption'+w+">"+r.hours+"</figcaption></figure>"+y:"")+'<figure style="max-width:'+v+'px">$1<figcaption'+w+">"+r.min+"</figcaption></figure>"+y+'<figure style="max-width:'+v+'px">$1<figcaption'+w+">"+r.sec+"</figcaption></figure>":($.displayHours?"$1"+y:"")+"$1"+y+"$1").replace(/\$1/g,f+m),$.displayDays>0){for(x=.4*$.fontSize||a.gap,b=f,n=$.displayDays-1;n>0;n-=1)b+=1===n?m.replace('">',"margin-right:"+Math.round(x)+'px">'):m;S=($.displayCaptions?'<figure style="width:'+Math.round($.width*$.displayDays+x+4)+'px">$1<figcaption style="'+I+"padding-right:"+Math.round(x)+'px">'+r.days+"</figcaption></figure>":"$1").replace(/\$1/,b)+S}C.html(S)}if(M=C.find("div"),M.length<$.vals.length){for(k=$.vals.length-M.length,D=$.vals,z=$.limits,$.vals=[],$.limits=[],n=0;n<M.length;n+=1)$.vals[n]=D[k+n],$.limits[n]=z[k+n];$.iSec=$.vals.length-1,$.iHour=$.vals.length-5}$.sec=$.seconds,C.data($),c&&o[c]?o[c].call(C,$.seconds):$.start?o.start.call(C,$.seconds):e.call(C,$.seconds)})},t}),function(){var $,win;$=this.jQuery||window.jQuery,win=$(window),$.fn.stick_in_parent=function(opts){var doc,elm,enable_bottoming,fn,i,inner_scrolling,len,manual_spacer,offset_top,parent_selector,recalc_every,sticky_class;for(null==opts&&(opts={}),sticky_class=opts.sticky_class,inner_scrolling=opts.inner_scrolling,recalc_every=opts.recalc_every,parent_selector=opts.parent,offset_top=opts.offset_top,manual_spacer=opts.spacer,enable_bottoming=opts.bottoming,null==offset_top&&(offset_top=0),null==parent_selector&&(parent_selector=void 0),null==inner_scrolling&&(inner_scrolling=!0),null==sticky_class&&(sticky_class="is_stuck"),doc=$(document),null==enable_bottoming&&(enable_bottoming=!0),fn=function(elm,padding_bottom,parent_top,parent_height,top,height,el_float,detached){var bottomed,detach,fixed,last_pos,last_scroll_height,offset,parent,recalc,recalc_and_tick,recalc_counter,spacer,tick;if(!elm.data("sticky_kit")){if(elm.data("sticky_kit",!0),last_scroll_height=doc.height(),parent=elm.parent(),null!=parent_selector&&(parent=parent.closest(parent_selector)),!parent.length)throw"failed to find stick parent";if(fixed=!1,bottomed=!1,spacer=null!=manual_spacer?manual_spacer&&elm.closest(manual_spacer):$("<div />"),spacer&&spacer.css("position",elm.css("position")),recalc=function(){var border_top,padding_top,restore;if(!detached)return last_scroll_height=doc.height(),border_top=parseInt(parent.css("border-top-width"),10),padding_top=parseInt(parent.css("padding-top"),10),padding_bottom=parseInt(parent.css("padding-bottom"),10),parent_top=parent.offset().top+border_top+padding_top,parent_height=parent.height(),fixed&&(fixed=!1,bottomed=!1,null==manual_spacer&&(elm.insertAfter(spacer),spacer.detach()),elm.css({position:"",top:"",width:"",bottom:""}).removeClass(sticky_class),restore=!0),top=elm.offset().top-(parseInt(elm.css("margin-top"),10)||0)-offset_top,height=elm.outerHeight(!0),el_float=elm.css("float"),spacer&&spacer.css({width:elm.outerWidth(!0),height:height,display:elm.css("display"),"vertical-align":elm.css("vertical-align"),"float":el_float}),restore?tick():void 0},recalc(),height!==parent_height)return last_pos=void 0,offset=offset_top,recalc_counter=recalc_every,tick=function(){var css,delta,recalced,scroll,will_bottom,win_height;if(!detached)return recalced=!1,null!=recalc_counter&&(recalc_counter-=1,0>=recalc_counter&&(recalc_counter=recalc_every,recalc(),recalced=!0)),recalced||doc.height()===last_scroll_height||(recalc(),recalced=!0),scroll=win.scrollTop(),null!=last_pos&&(delta=scroll-last_pos),last_pos=scroll,fixed?(enable_bottoming&&(will_bottom=scroll+height+offset>parent_height+parent_top,bottomed&&!will_bottom&&(bottomed=!1,elm.css({position:"fixed",bottom:"",top:offset}).trigger("sticky_kit:unbottom"))),top>scroll&&(fixed=!1,offset=offset_top,null==manual_spacer&&(("left"===el_float||"right"===el_float)&&elm.insertAfter(spacer),spacer.detach()),css={position:"",width:"",top:""},elm.css(css).removeClass(sticky_class).trigger("sticky_kit:unstick")),inner_scrolling&&(win_height=win.height(),height+offset_top>win_height&&(bottomed||(offset-=delta,offset=Math.max(win_height-height,offset),offset=Math.min(offset_top,offset),fixed&&elm.css({top:offset+"px"}))))):scroll>top&&(fixed=!0,css={position:"fixed",top:offset},css.width="border-box"===elm.css("box-sizing")?elm.outerWidth()+"px":elm.width()+"px",elm.css(css).addClass(sticky_class),null==manual_spacer&&(elm.after(spacer),("left"===el_float||"right"===el_float)&&spacer.append(elm)),elm.trigger("sticky_kit:stick")),fixed&&enable_bottoming&&(null==will_bottom&&(will_bottom=scroll+height+offset>parent_height+parent_top),!bottomed&&will_bottom)?(bottomed=!0,"static"===parent.css("position")&&parent.css({position:"relative"}),elm.css({position:"absolute",bottom:padding_bottom,top:"auto"}).trigger("sticky_kit:bottom")):void 0},recalc_and_tick=function(){return recalc(),tick()},detach=function(){return detached=!0,win.off("touchmove",tick),win.off("scroll",tick),win.off("resize",recalc_and_tick),$(document.body).off("sticky_kit:recalc",recalc_and_tick),elm.off("sticky_kit:detach",detach),elm.removeData("sticky_kit"),elm.css({position:"",bottom:"",top:"",width:""}),parent.position("position",""),fixed?(null==manual_spacer&&(("left"===el_float||"right"===el_float)&&elm.insertAfter(spacer),spacer.remove()),elm.removeClass(sticky_class)):void 0},win.on("touchmove",tick),win.on("scroll",tick),win.on("resize",recalc_and_tick),$(document.body).on("sticky_kit:recalc",recalc_and_tick),elm.on("sticky_kit:detach",detach),setTimeout(tick,0)}},i=0,len=this.length;len>i;i++)elm=this[i],fn($(elm));return this}}.call(this);